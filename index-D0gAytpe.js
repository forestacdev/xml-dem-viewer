var Jy=Object.defineProperty;var Qy=(_,o,u)=>o in _?Jy(_,o,{enumerable:!0,configurable:!0,writable:!0,value:u}):_[o]=u;var sn=(_,o,u)=>Qy(_,typeof o!="symbol"?o+"":o,u);(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const P of document.querySelectorAll('link[rel="modulepreload"]'))v(P);new MutationObserver(P=>{for(const k of P)if(k.type==="childList")for(const w of k.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&v(w)}).observe(document,{childList:!0,subtree:!0});function u(P){const k={};return P.integrity&&(k.integrity=P.integrity),P.referrerPolicy&&(k.referrerPolicy=P.referrerPolicy),P.crossOrigin==="use-credentials"?k.credentials="include":P.crossOrigin==="anonymous"?k.credentials="omit":k.credentials="same-origin",k}function v(P){if(P.ep)return;P.ep=!0;const k=u(P);fetch(P.href,k)}})();var su=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ev(_){return _&&_.__esModule&&Object.prototype.hasOwnProperty.call(_,"default")?_.default:_}function ou(_){throw new Error('Could not dynamically require "'+_+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var jd={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var wm;function tv(){return wm||(wm=1,function(_,o){(function(u){_.exports=u()})(function(){return function u(v,P,k){function w(K,ne){if(!P[K]){if(!v[K]){var te=typeof ou=="function"&&ou;if(!ne&&te)return te(K,!0);if(a)return a(K,!0);var oe=new Error("Cannot find module '"+K+"'");throw oe.code="MODULE_NOT_FOUND",oe}var L=P[K]={exports:{}};v[K][0].call(L.exports,function(H){var q=v[K][1][H];return w(q||H)},L,L.exports,u,v,P,k)}return P[K].exports}for(var a=typeof ou=="function"&&ou,$=0;$<k.length;$++)w(k[$]);return w}({1:[function(u,v,P){var k=u("./utils"),w=u("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";P.encode=function($){for(var K,ne,te,oe,L,H,q,le=[],ie=0,ge=$.length,Te=ge,Ae=k.getTypeOf($)!=="string";ie<$.length;)Te=ge-ie,te=Ae?(K=$[ie++],ne=ie<ge?$[ie++]:0,ie<ge?$[ie++]:0):(K=$.charCodeAt(ie++),ne=ie<ge?$.charCodeAt(ie++):0,ie<ge?$.charCodeAt(ie++):0),oe=K>>2,L=(3&K)<<4|ne>>4,H=1<Te?(15&ne)<<2|te>>6:64,q=2<Te?63&te:64,le.push(a.charAt(oe)+a.charAt(L)+a.charAt(H)+a.charAt(q));return le.join("")},P.decode=function($){var K,ne,te,oe,L,H,q=0,le=0,ie="data:";if($.substr(0,ie.length)===ie)throw new Error("Invalid base64 input, it looks like a data url.");var ge,Te=3*($=$.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if($.charAt($.length-1)===a.charAt(64)&&Te--,$.charAt($.length-2)===a.charAt(64)&&Te--,Te%1!=0)throw new Error("Invalid base64 input, bad content length.");for(ge=w.uint8array?new Uint8Array(0|Te):new Array(0|Te);q<$.length;)K=a.indexOf($.charAt(q++))<<2|(oe=a.indexOf($.charAt(q++)))>>4,ne=(15&oe)<<4|(L=a.indexOf($.charAt(q++)))>>2,te=(3&L)<<6|(H=a.indexOf($.charAt(q++))),ge[le++]=K,L!==64&&(ge[le++]=ne),H!==64&&(ge[le++]=te);return ge}},{"./support":30,"./utils":32}],2:[function(u,v,P){var k=u("./external"),w=u("./stream/DataWorker"),a=u("./stream/Crc32Probe"),$=u("./stream/DataLengthProbe");function K(ne,te,oe,L,H){this.compressedSize=ne,this.uncompressedSize=te,this.crc32=oe,this.compression=L,this.compressedContent=H}K.prototype={getContentWorker:function(){var ne=new w(k.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new $("data_length")),te=this;return ne.on("end",function(){if(this.streamInfo.data_length!==te.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),ne},getCompressedWorker:function(){return new w(k.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},K.createWorkerFrom=function(ne,te,oe){return ne.pipe(new a).pipe(new $("uncompressedSize")).pipe(te.compressWorker(oe)).pipe(new $("compressedSize")).withStreamInfo("compression",te)},v.exports=K},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(u,v,P){var k=u("./stream/GenericWorker");P.STORE={magic:"\0\0",compressWorker:function(){return new k("STORE compression")},uncompressWorker:function(){return new k("STORE decompression")}},P.DEFLATE=u("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(u,v,P){var k=u("./utils"),w=function(){for(var a,$=[],K=0;K<256;K++){a=K;for(var ne=0;ne<8;ne++)a=1&a?3988292384^a>>>1:a>>>1;$[K]=a}return $}();v.exports=function(a,$){return a!==void 0&&a.length?k.getTypeOf(a)!=="string"?function(K,ne,te,oe){var L=w,H=oe+te;K^=-1;for(var q=oe;q<H;q++)K=K>>>8^L[255&(K^ne[q])];return-1^K}(0|$,a,a.length,0):function(K,ne,te,oe){var L=w,H=oe+te;K^=-1;for(var q=oe;q<H;q++)K=K>>>8^L[255&(K^ne.charCodeAt(q))];return-1^K}(0|$,a,a.length,0):0}},{"./utils":32}],5:[function(u,v,P){P.base64=!1,P.binary=!1,P.dir=!1,P.createFolders=!0,P.date=null,P.compression=null,P.compressionOptions=null,P.comment=null,P.unixPermissions=null,P.dosPermissions=null},{}],6:[function(u,v,P){var k=null;k=typeof Promise<"u"?Promise:u("lie"),v.exports={Promise:k}},{lie:37}],7:[function(u,v,P){var k=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",w=u("pako"),a=u("./utils"),$=u("./stream/GenericWorker"),K=k?"uint8array":"array";function ne(te,oe){$.call(this,"FlateWorker/"+te),this._pako=null,this._pakoAction=te,this._pakoOptions=oe,this.meta={}}P.magic="\b\0",a.inherits(ne,$),ne.prototype.processChunk=function(te){this.meta=te.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(K,te.data),!1)},ne.prototype.flush=function(){$.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},ne.prototype.cleanUp=function(){$.prototype.cleanUp.call(this),this._pako=null},ne.prototype._createPako=function(){this._pako=new w[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var te=this;this._pako.onData=function(oe){te.push({data:oe,meta:te.meta})}},P.compressWorker=function(te){return new ne("Deflate",te)},P.uncompressWorker=function(){return new ne("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(u,v,P){function k(L,H){var q,le="";for(q=0;q<H;q++)le+=String.fromCharCode(255&L),L>>>=8;return le}function w(L,H,q,le,ie,ge){var Te,Ae,Me=L.file,qe=L.compression,He=ge!==K.utf8encode,lt=a.transformTo("string",ge(Me.name)),Ke=a.transformTo("string",K.utf8encode(Me.name)),ut=Me.comment,It=a.transformTo("string",ge(ut)),be=a.transformTo("string",K.utf8encode(ut)),Xe=Ke.length!==Me.name.length,Z=be.length!==ut.length,Qe="",jt="",at="",Gt=Me.dir,dt=Me.date,Ft={crc32:0,compressedSize:0,uncompressedSize:0};H&&!q||(Ft.crc32=L.crc32,Ft.compressedSize=L.compressedSize,Ft.uncompressedSize=L.uncompressedSize);var Ue=0;H&&(Ue|=8),He||!Xe&&!Z||(Ue|=2048);var ze=0,Et=0;Gt&&(ze|=16),ie==="UNIX"?(Et=798,ze|=function(gt,fr){var Dr=gt;return gt||(Dr=fr?16893:33204),(65535&Dr)<<16}(Me.unixPermissions,Gt)):(Et=20,ze|=function(gt){return 63&(gt||0)}(Me.dosPermissions)),Te=dt.getUTCHours(),Te<<=6,Te|=dt.getUTCMinutes(),Te<<=5,Te|=dt.getUTCSeconds()/2,Ae=dt.getUTCFullYear()-1980,Ae<<=4,Ae|=dt.getUTCMonth()+1,Ae<<=5,Ae|=dt.getUTCDate(),Xe&&(jt=k(1,1)+k(ne(lt),4)+Ke,Qe+="up"+k(jt.length,2)+jt),Z&&(at=k(1,1)+k(ne(It),4)+be,Qe+="uc"+k(at.length,2)+at);var bt="";return bt+=`
\0`,bt+=k(Ue,2),bt+=qe.magic,bt+=k(Te,2),bt+=k(Ae,2),bt+=k(Ft.crc32,4),bt+=k(Ft.compressedSize,4),bt+=k(Ft.uncompressedSize,4),bt+=k(lt.length,2),bt+=k(Qe.length,2),{fileRecord:te.LOCAL_FILE_HEADER+bt+lt+Qe,dirRecord:te.CENTRAL_FILE_HEADER+k(Et,2)+bt+k(It.length,2)+"\0\0\0\0"+k(ze,4)+k(le,4)+lt+Qe+It}}var a=u("../utils"),$=u("../stream/GenericWorker"),K=u("../utf8"),ne=u("../crc32"),te=u("../signature");function oe(L,H,q,le){$.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=H,this.zipPlatform=q,this.encodeFileName=le,this.streamFiles=L,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(oe,$),oe.prototype.push=function(L){var H=L.meta.percent||0,q=this.entriesCount,le=this._sources.length;this.accumulate?this.contentBuffer.push(L):(this.bytesWritten+=L.data.length,$.prototype.push.call(this,{data:L.data,meta:{currentFile:this.currentFile,percent:q?(H+100*(q-le-1))/q:100}}))},oe.prototype.openedSource=function(L){this.currentSourceOffset=this.bytesWritten,this.currentFile=L.file.name;var H=this.streamFiles&&!L.file.dir;if(H){var q=w(L,H,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:q.fileRecord,meta:{percent:0}})}else this.accumulate=!0},oe.prototype.closedSource=function(L){this.accumulate=!1;var H=this.streamFiles&&!L.file.dir,q=w(L,H,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(q.dirRecord),H)this.push({data:function(le){return te.DATA_DESCRIPTOR+k(le.crc32,4)+k(le.compressedSize,4)+k(le.uncompressedSize,4)}(L),meta:{percent:100}});else for(this.push({data:q.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},oe.prototype.flush=function(){for(var L=this.bytesWritten,H=0;H<this.dirRecords.length;H++)this.push({data:this.dirRecords[H],meta:{percent:100}});var q=this.bytesWritten-L,le=function(ie,ge,Te,Ae,Me){var qe=a.transformTo("string",Me(Ae));return te.CENTRAL_DIRECTORY_END+"\0\0\0\0"+k(ie,2)+k(ie,2)+k(ge,4)+k(Te,4)+k(qe.length,2)+qe}(this.dirRecords.length,q,L,this.zipComment,this.encodeFileName);this.push({data:le,meta:{percent:100}})},oe.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},oe.prototype.registerPrevious=function(L){this._sources.push(L);var H=this;return L.on("data",function(q){H.processChunk(q)}),L.on("end",function(){H.closedSource(H.previous.streamInfo),H._sources.length?H.prepareNextSource():H.end()}),L.on("error",function(q){H.error(q)}),this},oe.prototype.resume=function(){return!!$.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},oe.prototype.error=function(L){var H=this._sources;if(!$.prototype.error.call(this,L))return!1;for(var q=0;q<H.length;q++)try{H[q].error(L)}catch{}return!0},oe.prototype.lock=function(){$.prototype.lock.call(this);for(var L=this._sources,H=0;H<L.length;H++)L[H].lock()},v.exports=oe},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(u,v,P){var k=u("../compressions"),w=u("./ZipFileWorker");P.generateWorker=function(a,$,K){var ne=new w($.streamFiles,K,$.platform,$.encodeFileName),te=0;try{a.forEach(function(oe,L){te++;var H=function(ge,Te){var Ae=ge||Te,Me=k[Ae];if(!Me)throw new Error(Ae+" is not a valid compression method !");return Me}(L.options.compression,$.compression),q=L.options.compressionOptions||$.compressionOptions||{},le=L.dir,ie=L.date;L._compressWorker(H,q).withStreamInfo("file",{name:oe,dir:le,date:ie,comment:L.comment||"",unixPermissions:L.unixPermissions,dosPermissions:L.dosPermissions}).pipe(ne)}),ne.entriesCount=te}catch(oe){ne.error(oe)}return ne}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(u,v,P){function k(){if(!(this instanceof k))return new k;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var w=new k;for(var a in this)typeof this[a]!="function"&&(w[a]=this[a]);return w}}(k.prototype=u("./object")).loadAsync=u("./load"),k.support=u("./support"),k.defaults=u("./defaults"),k.version="3.10.1",k.loadAsync=function(w,a){return new k().loadAsync(w,a)},k.external=u("./external"),v.exports=k},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(u,v,P){var k=u("./utils"),w=u("./external"),a=u("./utf8"),$=u("./zipEntries"),K=u("./stream/Crc32Probe"),ne=u("./nodejsUtils");function te(oe){return new w.Promise(function(L,H){var q=oe.decompressed.getContentWorker().pipe(new K);q.on("error",function(le){H(le)}).on("end",function(){q.streamInfo.crc32!==oe.decompressed.crc32?H(new Error("Corrupted zip : CRC32 mismatch")):L()}).resume()})}v.exports=function(oe,L){var H=this;return L=k.extend(L||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),ne.isNode&&ne.isStream(oe)?w.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):k.prepareContent("the loaded zip file",oe,!0,L.optimizedBinaryString,L.base64).then(function(q){var le=new $(L);return le.load(q),le}).then(function(q){var le=[w.Promise.resolve(q)],ie=q.files;if(L.checkCRC32)for(var ge=0;ge<ie.length;ge++)le.push(te(ie[ge]));return w.Promise.all(le)}).then(function(q){for(var le=q.shift(),ie=le.files,ge=0;ge<ie.length;ge++){var Te=ie[ge],Ae=Te.fileNameStr,Me=k.resolve(Te.fileNameStr);H.file(Me,Te.decompressed,{binary:!0,optimizedBinaryString:!0,date:Te.date,dir:Te.dir,comment:Te.fileCommentStr.length?Te.fileCommentStr:null,unixPermissions:Te.unixPermissions,dosPermissions:Te.dosPermissions,createFolders:L.createFolders}),Te.dir||(H.file(Me).unsafeOriginalName=Ae)}return le.zipComment.length&&(H.comment=le.zipComment),H})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(u,v,P){var k=u("../utils"),w=u("../stream/GenericWorker");function a($,K){w.call(this,"Nodejs stream input adapter for "+$),this._upstreamEnded=!1,this._bindStream(K)}k.inherits(a,w),a.prototype._bindStream=function($){var K=this;(this._stream=$).pause(),$.on("data",function(ne){K.push({data:ne,meta:{percent:0}})}).on("error",function(ne){K.isPaused?this.generatedError=ne:K.error(ne)}).on("end",function(){K.isPaused?K._upstreamEnded=!0:K.end()})},a.prototype.pause=function(){return!!w.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!w.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},v.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(u,v,P){var k=u("readable-stream").Readable;function w(a,$,K){k.call(this,$),this._helper=a;var ne=this;a.on("data",function(te,oe){ne.push(te)||ne._helper.pause(),K&&K(oe)}).on("error",function(te){ne.emit("error",te)}).on("end",function(){ne.push(null)})}u("../utils").inherits(w,k),w.prototype._read=function(){this._helper.resume()},v.exports=w},{"../utils":32,"readable-stream":16}],14:[function(u,v,P){v.exports={isNode:typeof Buffer<"u",newBufferFrom:function(k,w){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(k,w);if(typeof k=="number")throw new Error('The "data" argument must not be a number');return new Buffer(k,w)},allocBuffer:function(k){if(Buffer.alloc)return Buffer.alloc(k);var w=new Buffer(k);return w.fill(0),w},isBuffer:function(k){return Buffer.isBuffer(k)},isStream:function(k){return k&&typeof k.on=="function"&&typeof k.pause=="function"&&typeof k.resume=="function"}}},{}],15:[function(u,v,P){function k(Me,qe,He){var lt,Ke=a.getTypeOf(qe),ut=a.extend(He||{},ne);ut.date=ut.date||new Date,ut.compression!==null&&(ut.compression=ut.compression.toUpperCase()),typeof ut.unixPermissions=="string"&&(ut.unixPermissions=parseInt(ut.unixPermissions,8)),ut.unixPermissions&&16384&ut.unixPermissions&&(ut.dir=!0),ut.dosPermissions&&16&ut.dosPermissions&&(ut.dir=!0),ut.dir&&(Me=ie(Me)),ut.createFolders&&(lt=le(Me))&&ge.call(this,lt,!0);var It=Ke==="string"&&ut.binary===!1&&ut.base64===!1;He&&He.binary!==void 0||(ut.binary=!It),(qe instanceof te&&qe.uncompressedSize===0||ut.dir||!qe||qe.length===0)&&(ut.base64=!1,ut.binary=!0,qe="",ut.compression="STORE",Ke="string");var be=null;be=qe instanceof te||qe instanceof $?qe:H.isNode&&H.isStream(qe)?new q(Me,qe):a.prepareContent(Me,qe,ut.binary,ut.optimizedBinaryString,ut.base64);var Xe=new oe(Me,be,ut);this.files[Me]=Xe}var w=u("./utf8"),a=u("./utils"),$=u("./stream/GenericWorker"),K=u("./stream/StreamHelper"),ne=u("./defaults"),te=u("./compressedObject"),oe=u("./zipObject"),L=u("./generate"),H=u("./nodejsUtils"),q=u("./nodejs/NodejsStreamInputAdapter"),le=function(Me){Me.slice(-1)==="/"&&(Me=Me.substring(0,Me.length-1));var qe=Me.lastIndexOf("/");return 0<qe?Me.substring(0,qe):""},ie=function(Me){return Me.slice(-1)!=="/"&&(Me+="/"),Me},ge=function(Me,qe){return qe=qe!==void 0?qe:ne.createFolders,Me=ie(Me),this.files[Me]||k.call(this,Me,null,{dir:!0,createFolders:qe}),this.files[Me]};function Te(Me){return Object.prototype.toString.call(Me)==="[object RegExp]"}var Ae={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(Me){var qe,He,lt;for(qe in this.files)lt=this.files[qe],(He=qe.slice(this.root.length,qe.length))&&qe.slice(0,this.root.length)===this.root&&Me(He,lt)},filter:function(Me){var qe=[];return this.forEach(function(He,lt){Me(He,lt)&&qe.push(lt)}),qe},file:function(Me,qe,He){if(arguments.length!==1)return Me=this.root+Me,k.call(this,Me,qe,He),this;if(Te(Me)){var lt=Me;return this.filter(function(ut,It){return!It.dir&&lt.test(ut)})}var Ke=this.files[this.root+Me];return Ke&&!Ke.dir?Ke:null},folder:function(Me){if(!Me)return this;if(Te(Me))return this.filter(function(Ke,ut){return ut.dir&&Me.test(Ke)});var qe=this.root+Me,He=ge.call(this,qe),lt=this.clone();return lt.root=He.name,lt},remove:function(Me){Me=this.root+Me;var qe=this.files[Me];if(qe||(Me.slice(-1)!=="/"&&(Me+="/"),qe=this.files[Me]),qe&&!qe.dir)delete this.files[Me];else for(var He=this.filter(function(Ke,ut){return ut.name.slice(0,Me.length)===Me}),lt=0;lt<He.length;lt++)delete this.files[He[lt].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(Me){var qe,He={};try{if((He=a.extend(Me||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:w.utf8encode})).type=He.type.toLowerCase(),He.compression=He.compression.toUpperCase(),He.type==="binarystring"&&(He.type="string"),!He.type)throw new Error("No output type specified.");a.checkSupport(He.type),He.platform!=="darwin"&&He.platform!=="freebsd"&&He.platform!=="linux"&&He.platform!=="sunos"||(He.platform="UNIX"),He.platform==="win32"&&(He.platform="DOS");var lt=He.comment||this.comment||"";qe=L.generateWorker(this,He,lt)}catch(Ke){(qe=new $("error")).error(Ke)}return new K(qe,He.type||"string",He.mimeType)},generateAsync:function(Me,qe){return this.generateInternalStream(Me).accumulate(qe)},generateNodeStream:function(Me,qe){return(Me=Me||{}).type||(Me.type="nodebuffer"),this.generateInternalStream(Me).toNodejsStream(qe)}};v.exports=Ae},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(u,v,P){v.exports=u("stream")},{stream:void 0}],17:[function(u,v,P){var k=u("./DataReader");function w(a){k.call(this,a);for(var $=0;$<this.data.length;$++)a[$]=255&a[$]}u("../utils").inherits(w,k),w.prototype.byteAt=function(a){return this.data[this.zero+a]},w.prototype.lastIndexOfSignature=function(a){for(var $=a.charCodeAt(0),K=a.charCodeAt(1),ne=a.charCodeAt(2),te=a.charCodeAt(3),oe=this.length-4;0<=oe;--oe)if(this.data[oe]===$&&this.data[oe+1]===K&&this.data[oe+2]===ne&&this.data[oe+3]===te)return oe-this.zero;return-1},w.prototype.readAndCheckSignature=function(a){var $=a.charCodeAt(0),K=a.charCodeAt(1),ne=a.charCodeAt(2),te=a.charCodeAt(3),oe=this.readData(4);return $===oe[0]&&K===oe[1]&&ne===oe[2]&&te===oe[3]},w.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var $=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,$},v.exports=w},{"../utils":32,"./DataReader":18}],18:[function(u,v,P){var k=u("../utils");function w(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}w.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var $,K=0;for(this.checkOffset(a),$=this.index+a-1;$>=this.index;$--)K=(K<<8)+this.byteAt($);return this.index+=a,K},readString:function(a){return k.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},v.exports=w},{"../utils":32}],19:[function(u,v,P){var k=u("./Uint8ArrayReader");function w(a){k.call(this,a)}u("../utils").inherits(w,k),w.prototype.readData=function(a){this.checkOffset(a);var $=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,$},v.exports=w},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(u,v,P){var k=u("./DataReader");function w(a){k.call(this,a)}u("../utils").inherits(w,k),w.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},w.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},w.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},w.prototype.readData=function(a){this.checkOffset(a);var $=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,$},v.exports=w},{"../utils":32,"./DataReader":18}],21:[function(u,v,P){var k=u("./ArrayReader");function w(a){k.call(this,a)}u("../utils").inherits(w,k),w.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var $=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,$},v.exports=w},{"../utils":32,"./ArrayReader":17}],22:[function(u,v,P){var k=u("../utils"),w=u("../support"),a=u("./ArrayReader"),$=u("./StringReader"),K=u("./NodeBufferReader"),ne=u("./Uint8ArrayReader");v.exports=function(te){var oe=k.getTypeOf(te);return k.checkSupport(oe),oe!=="string"||w.uint8array?oe==="nodebuffer"?new K(te):w.uint8array?new ne(k.transformTo("uint8array",te)):new a(k.transformTo("array",te)):new $(te)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(u,v,P){P.LOCAL_FILE_HEADER="PK",P.CENTRAL_FILE_HEADER="PK",P.CENTRAL_DIRECTORY_END="PK",P.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",P.ZIP64_CENTRAL_DIRECTORY_END="PK",P.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(u,v,P){var k=u("./GenericWorker"),w=u("../utils");function a($){k.call(this,"ConvertWorker to "+$),this.destType=$}w.inherits(a,k),a.prototype.processChunk=function($){this.push({data:w.transformTo(this.destType,$.data),meta:$.meta})},v.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(u,v,P){var k=u("./GenericWorker"),w=u("../crc32");function a(){k.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}u("../utils").inherits(a,k),a.prototype.processChunk=function($){this.streamInfo.crc32=w($.data,this.streamInfo.crc32||0),this.push($)},v.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(u,v,P){var k=u("../utils"),w=u("./GenericWorker");function a($){w.call(this,"DataLengthProbe for "+$),this.propName=$,this.withStreamInfo($,0)}k.inherits(a,w),a.prototype.processChunk=function($){if($){var K=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=K+$.data.length}w.prototype.processChunk.call(this,$)},v.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(u,v,P){var k=u("../utils"),w=u("./GenericWorker");function a($){w.call(this,"DataWorker");var K=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,$.then(function(ne){K.dataIsReady=!0,K.data=ne,K.max=ne&&ne.length||0,K.type=k.getTypeOf(ne),K.isPaused||K._tickAndRepeat()},function(ne){K.error(ne)})}k.inherits(a,w),a.prototype.cleanUp=function(){w.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!w.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,k.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(k.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var $=null,K=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":$=this.data.substring(this.index,K);break;case"uint8array":$=this.data.subarray(this.index,K);break;case"array":case"nodebuffer":$=this.data.slice(this.index,K)}return this.index=K,this.push({data:$,meta:{percent:this.max?this.index/this.max*100:0}})},v.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(u,v,P){function k(w){this.name=w||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}k.prototype={push:function(w){this.emit("data",w)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(w){this.emit("error",w)}return!0},error:function(w){return!this.isFinished&&(this.isPaused?this.generatedError=w:(this.isFinished=!0,this.emit("error",w),this.previous&&this.previous.error(w),this.cleanUp()),!0)},on:function(w,a){return this._listeners[w].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(w,a){if(this._listeners[w])for(var $=0;$<this._listeners[w].length;$++)this._listeners[w][$].call(this,a)},pipe:function(w){return w.registerPrevious(this)},registerPrevious:function(w){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=w.streamInfo,this.mergeStreamInfo(),this.previous=w;var a=this;return w.on("data",function($){a.processChunk($)}),w.on("end",function(){a.end()}),w.on("error",function($){a.error($)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var w=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),w=!0),this.previous&&this.previous.resume(),!w},flush:function(){},processChunk:function(w){this.push(w)},withStreamInfo:function(w,a){return this.extraStreamInfo[w]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var w in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,w)&&(this.streamInfo[w]=this.extraStreamInfo[w])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var w="Worker "+this.name;return this.previous?this.previous+" -> "+w:w}},v.exports=k},{}],29:[function(u,v,P){var k=u("../utils"),w=u("./ConvertWorker"),a=u("./GenericWorker"),$=u("../base64"),K=u("../support"),ne=u("../external"),te=null;if(K.nodestream)try{te=u("../nodejs/NodejsStreamOutputAdapter")}catch{}function oe(H,q){return new ne.Promise(function(le,ie){var ge=[],Te=H._internalType,Ae=H._outputType,Me=H._mimeType;H.on("data",function(qe,He){ge.push(qe),q&&q(He)}).on("error",function(qe){ge=[],ie(qe)}).on("end",function(){try{var qe=function(He,lt,Ke){switch(He){case"blob":return k.newBlob(k.transformTo("arraybuffer",lt),Ke);case"base64":return $.encode(lt);default:return k.transformTo(He,lt)}}(Ae,function(He,lt){var Ke,ut=0,It=null,be=0;for(Ke=0;Ke<lt.length;Ke++)be+=lt[Ke].length;switch(He){case"string":return lt.join("");case"array":return Array.prototype.concat.apply([],lt);case"uint8array":for(It=new Uint8Array(be),Ke=0;Ke<lt.length;Ke++)It.set(lt[Ke],ut),ut+=lt[Ke].length;return It;case"nodebuffer":return Buffer.concat(lt);default:throw new Error("concat : unsupported type '"+He+"'")}}(Te,ge),Me);le(qe)}catch(He){ie(He)}ge=[]}).resume()})}function L(H,q,le){var ie=q;switch(q){case"blob":case"arraybuffer":ie="uint8array";break;case"base64":ie="string"}try{this._internalType=ie,this._outputType=q,this._mimeType=le,k.checkSupport(ie),this._worker=H.pipe(new w(ie)),H.lock()}catch(ge){this._worker=new a("error"),this._worker.error(ge)}}L.prototype={accumulate:function(H){return oe(this,H)},on:function(H,q){var le=this;return H==="data"?this._worker.on(H,function(ie){q.call(le,ie.data,ie.meta)}):this._worker.on(H,function(){k.delay(q,arguments,le)}),this},resume:function(){return k.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(H){if(k.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new te(this,{objectMode:this._outputType!=="nodebuffer"},H)}},v.exports=L},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(u,v,P){if(P.base64=!0,P.array=!0,P.string=!0,P.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",P.nodebuffer=typeof Buffer<"u",P.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")P.blob=!1;else{var k=new ArrayBuffer(0);try{P.blob=new Blob([k],{type:"application/zip"}).size===0}catch{try{var w=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);w.append(k),P.blob=w.getBlob("application/zip").size===0}catch{P.blob=!1}}}try{P.nodestream=!!u("readable-stream").Readable}catch{P.nodestream=!1}},{"readable-stream":16}],31:[function(u,v,P){for(var k=u("./utils"),w=u("./support"),a=u("./nodejsUtils"),$=u("./stream/GenericWorker"),K=new Array(256),ne=0;ne<256;ne++)K[ne]=252<=ne?6:248<=ne?5:240<=ne?4:224<=ne?3:192<=ne?2:1;K[254]=K[254]=1;function te(){$.call(this,"utf-8 decode"),this.leftOver=null}function oe(){$.call(this,"utf-8 encode")}P.utf8encode=function(L){return w.nodebuffer?a.newBufferFrom(L,"utf-8"):function(H){var q,le,ie,ge,Te,Ae=H.length,Me=0;for(ge=0;ge<Ae;ge++)(64512&(le=H.charCodeAt(ge)))==55296&&ge+1<Ae&&(64512&(ie=H.charCodeAt(ge+1)))==56320&&(le=65536+(le-55296<<10)+(ie-56320),ge++),Me+=le<128?1:le<2048?2:le<65536?3:4;for(q=w.uint8array?new Uint8Array(Me):new Array(Me),ge=Te=0;Te<Me;ge++)(64512&(le=H.charCodeAt(ge)))==55296&&ge+1<Ae&&(64512&(ie=H.charCodeAt(ge+1)))==56320&&(le=65536+(le-55296<<10)+(ie-56320),ge++),le<128?q[Te++]=le:(le<2048?q[Te++]=192|le>>>6:(le<65536?q[Te++]=224|le>>>12:(q[Te++]=240|le>>>18,q[Te++]=128|le>>>12&63),q[Te++]=128|le>>>6&63),q[Te++]=128|63&le);return q}(L)},P.utf8decode=function(L){return w.nodebuffer?k.transformTo("nodebuffer",L).toString("utf-8"):function(H){var q,le,ie,ge,Te=H.length,Ae=new Array(2*Te);for(q=le=0;q<Te;)if((ie=H[q++])<128)Ae[le++]=ie;else if(4<(ge=K[ie]))Ae[le++]=65533,q+=ge-1;else{for(ie&=ge===2?31:ge===3?15:7;1<ge&&q<Te;)ie=ie<<6|63&H[q++],ge--;1<ge?Ae[le++]=65533:ie<65536?Ae[le++]=ie:(ie-=65536,Ae[le++]=55296|ie>>10&1023,Ae[le++]=56320|1023&ie)}return Ae.length!==le&&(Ae.subarray?Ae=Ae.subarray(0,le):Ae.length=le),k.applyFromCharCode(Ae)}(L=k.transformTo(w.uint8array?"uint8array":"array",L))},k.inherits(te,$),te.prototype.processChunk=function(L){var H=k.transformTo(w.uint8array?"uint8array":"array",L.data);if(this.leftOver&&this.leftOver.length){if(w.uint8array){var q=H;(H=new Uint8Array(q.length+this.leftOver.length)).set(this.leftOver,0),H.set(q,this.leftOver.length)}else H=this.leftOver.concat(H);this.leftOver=null}var le=function(ge,Te){var Ae;for((Te=Te||ge.length)>ge.length&&(Te=ge.length),Ae=Te-1;0<=Ae&&(192&ge[Ae])==128;)Ae--;return Ae<0||Ae===0?Te:Ae+K[ge[Ae]]>Te?Ae:Te}(H),ie=H;le!==H.length&&(w.uint8array?(ie=H.subarray(0,le),this.leftOver=H.subarray(le,H.length)):(ie=H.slice(0,le),this.leftOver=H.slice(le,H.length))),this.push({data:P.utf8decode(ie),meta:L.meta})},te.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:P.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},P.Utf8DecodeWorker=te,k.inherits(oe,$),oe.prototype.processChunk=function(L){this.push({data:P.utf8encode(L.data),meta:L.meta})},P.Utf8EncodeWorker=oe},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(u,v,P){var k=u("./support"),w=u("./base64"),a=u("./nodejsUtils"),$=u("./external");function K(q){return q}function ne(q,le){for(var ie=0;ie<q.length;++ie)le[ie]=255&q.charCodeAt(ie);return le}u("setimmediate"),P.newBlob=function(q,le){P.checkSupport("blob");try{return new Blob([q],{type:le})}catch{try{var ie=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return ie.append(q),ie.getBlob(le)}catch{throw new Error("Bug : can't construct the Blob.")}}};var te={stringifyByChunk:function(q,le,ie){var ge=[],Te=0,Ae=q.length;if(Ae<=ie)return String.fromCharCode.apply(null,q);for(;Te<Ae;)le==="array"||le==="nodebuffer"?ge.push(String.fromCharCode.apply(null,q.slice(Te,Math.min(Te+ie,Ae)))):ge.push(String.fromCharCode.apply(null,q.subarray(Te,Math.min(Te+ie,Ae)))),Te+=ie;return ge.join("")},stringifyByChar:function(q){for(var le="",ie=0;ie<q.length;ie++)le+=String.fromCharCode(q[ie]);return le},applyCanBeUsed:{uint8array:function(){try{return k.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return k.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function oe(q){var le=65536,ie=P.getTypeOf(q),ge=!0;if(ie==="uint8array"?ge=te.applyCanBeUsed.uint8array:ie==="nodebuffer"&&(ge=te.applyCanBeUsed.nodebuffer),ge)for(;1<le;)try{return te.stringifyByChunk(q,ie,le)}catch{le=Math.floor(le/2)}return te.stringifyByChar(q)}function L(q,le){for(var ie=0;ie<q.length;ie++)le[ie]=q[ie];return le}P.applyFromCharCode=oe;var H={};H.string={string:K,array:function(q){return ne(q,new Array(q.length))},arraybuffer:function(q){return H.string.uint8array(q).buffer},uint8array:function(q){return ne(q,new Uint8Array(q.length))},nodebuffer:function(q){return ne(q,a.allocBuffer(q.length))}},H.array={string:oe,array:K,arraybuffer:function(q){return new Uint8Array(q).buffer},uint8array:function(q){return new Uint8Array(q)},nodebuffer:function(q){return a.newBufferFrom(q)}},H.arraybuffer={string:function(q){return oe(new Uint8Array(q))},array:function(q){return L(new Uint8Array(q),new Array(q.byteLength))},arraybuffer:K,uint8array:function(q){return new Uint8Array(q)},nodebuffer:function(q){return a.newBufferFrom(new Uint8Array(q))}},H.uint8array={string:oe,array:function(q){return L(q,new Array(q.length))},arraybuffer:function(q){return q.buffer},uint8array:K,nodebuffer:function(q){return a.newBufferFrom(q)}},H.nodebuffer={string:oe,array:function(q){return L(q,new Array(q.length))},arraybuffer:function(q){return H.nodebuffer.uint8array(q).buffer},uint8array:function(q){return L(q,new Uint8Array(q.length))},nodebuffer:K},P.transformTo=function(q,le){if(le=le||"",!q)return le;P.checkSupport(q);var ie=P.getTypeOf(le);return H[ie][q](le)},P.resolve=function(q){for(var le=q.split("/"),ie=[],ge=0;ge<le.length;ge++){var Te=le[ge];Te==="."||Te===""&&ge!==0&&ge!==le.length-1||(Te===".."?ie.pop():ie.push(Te))}return ie.join("/")},P.getTypeOf=function(q){return typeof q=="string"?"string":Object.prototype.toString.call(q)==="[object Array]"?"array":k.nodebuffer&&a.isBuffer(q)?"nodebuffer":k.uint8array&&q instanceof Uint8Array?"uint8array":k.arraybuffer&&q instanceof ArrayBuffer?"arraybuffer":void 0},P.checkSupport=function(q){if(!k[q.toLowerCase()])throw new Error(q+" is not supported by this platform")},P.MAX_VALUE_16BITS=65535,P.MAX_VALUE_32BITS=-1,P.pretty=function(q){var le,ie,ge="";for(ie=0;ie<(q||"").length;ie++)ge+="\\x"+((le=q.charCodeAt(ie))<16?"0":"")+le.toString(16).toUpperCase();return ge},P.delay=function(q,le,ie){setImmediate(function(){q.apply(ie||null,le||[])})},P.inherits=function(q,le){function ie(){}ie.prototype=le.prototype,q.prototype=new ie},P.extend=function(){var q,le,ie={};for(q=0;q<arguments.length;q++)for(le in arguments[q])Object.prototype.hasOwnProperty.call(arguments[q],le)&&ie[le]===void 0&&(ie[le]=arguments[q][le]);return ie},P.prepareContent=function(q,le,ie,ge,Te){return $.Promise.resolve(le).then(function(Ae){return k.blob&&(Ae instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(Ae))!==-1)&&typeof FileReader<"u"?new $.Promise(function(Me,qe){var He=new FileReader;He.onload=function(lt){Me(lt.target.result)},He.onerror=function(lt){qe(lt.target.error)},He.readAsArrayBuffer(Ae)}):Ae}).then(function(Ae){var Me=P.getTypeOf(Ae);return Me?(Me==="arraybuffer"?Ae=P.transformTo("uint8array",Ae):Me==="string"&&(Te?Ae=w.decode(Ae):ie&&ge!==!0&&(Ae=function(qe){return ne(qe,k.uint8array?new Uint8Array(qe.length):new Array(qe.length))}(Ae))),Ae):$.Promise.reject(new Error("Can't read the data of '"+q+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(u,v,P){var k=u("./reader/readerFor"),w=u("./utils"),a=u("./signature"),$=u("./zipEntry"),K=u("./support");function ne(te){this.files=[],this.loadOptions=te}ne.prototype={checkSignature:function(te){if(!this.reader.readAndCheckSignature(te)){this.reader.index-=4;var oe=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+w.pretty(oe)+", expected "+w.pretty(te)+")")}},isSignature:function(te,oe){var L=this.reader.index;this.reader.setIndex(te);var H=this.reader.readString(4)===oe;return this.reader.setIndex(L),H},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var te=this.reader.readData(this.zipCommentLength),oe=K.uint8array?"uint8array":"array",L=w.transformTo(oe,te);this.zipComment=this.loadOptions.decodeFileName(L)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var te,oe,L,H=this.zip64EndOfCentralSize-44;0<H;)te=this.reader.readInt(2),oe=this.reader.readInt(4),L=this.reader.readData(oe),this.zip64ExtensibleData[te]={id:te,length:oe,value:L}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var te,oe;for(te=0;te<this.files.length;te++)oe=this.files[te],this.reader.setIndex(oe.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),oe.readLocalPart(this.reader),oe.handleUTF8(),oe.processAttributes()},readCentralDir:function(){var te;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(te=new $({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(te);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var te=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(te<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(te);var oe=te;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===w.MAX_VALUE_16BITS||this.diskWithCentralDirStart===w.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===w.MAX_VALUE_16BITS||this.centralDirRecords===w.MAX_VALUE_16BITS||this.centralDirSize===w.MAX_VALUE_32BITS||this.centralDirOffset===w.MAX_VALUE_32BITS){if(this.zip64=!0,(te=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(te),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var L=this.centralDirOffset+this.centralDirSize;this.zip64&&(L+=20,L+=12+this.zip64EndOfCentralSize);var H=oe-L;if(0<H)this.isSignature(oe,a.CENTRAL_FILE_HEADER)||(this.reader.zero=H);else if(H<0)throw new Error("Corrupted zip: missing "+Math.abs(H)+" bytes.")},prepareReader:function(te){this.reader=k(te)},load:function(te){this.prepareReader(te),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},v.exports=ne},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(u,v,P){var k=u("./reader/readerFor"),w=u("./utils"),a=u("./compressedObject"),$=u("./crc32"),K=u("./utf8"),ne=u("./compressions"),te=u("./support");function oe(L,H){this.options=L,this.loadOptions=H}oe.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(L){var H,q;if(L.skip(22),this.fileNameLength=L.readInt(2),q=L.readInt(2),this.fileName=L.readData(this.fileNameLength),L.skip(q),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((H=function(le){for(var ie in ne)if(Object.prototype.hasOwnProperty.call(ne,ie)&&ne[ie].magic===le)return ne[ie];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+w.pretty(this.compressionMethod)+" unknown (inner file : "+w.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,H,L.readData(this.compressedSize))},readCentralPart:function(L){this.versionMadeBy=L.readInt(2),L.skip(2),this.bitFlag=L.readInt(2),this.compressionMethod=L.readString(2),this.date=L.readDate(),this.crc32=L.readInt(4),this.compressedSize=L.readInt(4),this.uncompressedSize=L.readInt(4);var H=L.readInt(2);if(this.extraFieldsLength=L.readInt(2),this.fileCommentLength=L.readInt(2),this.diskNumberStart=L.readInt(2),this.internalFileAttributes=L.readInt(2),this.externalFileAttributes=L.readInt(4),this.localHeaderOffset=L.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");L.skip(H),this.readExtraFields(L),this.parseZIP64ExtraField(L),this.fileComment=L.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var L=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),L==0&&(this.dosPermissions=63&this.externalFileAttributes),L==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var L=k(this.extraFields[1].value);this.uncompressedSize===w.MAX_VALUE_32BITS&&(this.uncompressedSize=L.readInt(8)),this.compressedSize===w.MAX_VALUE_32BITS&&(this.compressedSize=L.readInt(8)),this.localHeaderOffset===w.MAX_VALUE_32BITS&&(this.localHeaderOffset=L.readInt(8)),this.diskNumberStart===w.MAX_VALUE_32BITS&&(this.diskNumberStart=L.readInt(4))}},readExtraFields:function(L){var H,q,le,ie=L.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});L.index+4<ie;)H=L.readInt(2),q=L.readInt(2),le=L.readData(q),this.extraFields[H]={id:H,length:q,value:le};L.setIndex(ie)},handleUTF8:function(){var L=te.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=K.utf8decode(this.fileName),this.fileCommentStr=K.utf8decode(this.fileComment);else{var H=this.findExtraFieldUnicodePath();if(H!==null)this.fileNameStr=H;else{var q=w.transformTo(L,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(q)}var le=this.findExtraFieldUnicodeComment();if(le!==null)this.fileCommentStr=le;else{var ie=w.transformTo(L,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(ie)}}},findExtraFieldUnicodePath:function(){var L=this.extraFields[28789];if(L){var H=k(L.value);return H.readInt(1)!==1||$(this.fileName)!==H.readInt(4)?null:K.utf8decode(H.readData(L.length-5))}return null},findExtraFieldUnicodeComment:function(){var L=this.extraFields[25461];if(L){var H=k(L.value);return H.readInt(1)!==1||$(this.fileComment)!==H.readInt(4)?null:K.utf8decode(H.readData(L.length-5))}return null}},v.exports=oe},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(u,v,P){function k(H,q,le){this.name=H,this.dir=le.dir,this.date=le.date,this.comment=le.comment,this.unixPermissions=le.unixPermissions,this.dosPermissions=le.dosPermissions,this._data=q,this._dataBinary=le.binary,this.options={compression:le.compression,compressionOptions:le.compressionOptions}}var w=u("./stream/StreamHelper"),a=u("./stream/DataWorker"),$=u("./utf8"),K=u("./compressedObject"),ne=u("./stream/GenericWorker");k.prototype={internalStream:function(H){var q=null,le="string";try{if(!H)throw new Error("No output type specified.");var ie=(le=H.toLowerCase())==="string"||le==="text";le!=="binarystring"&&le!=="text"||(le="string"),q=this._decompressWorker();var ge=!this._dataBinary;ge&&!ie&&(q=q.pipe(new $.Utf8EncodeWorker)),!ge&&ie&&(q=q.pipe(new $.Utf8DecodeWorker))}catch(Te){(q=new ne("error")).error(Te)}return new w(q,le,"")},async:function(H,q){return this.internalStream(H).accumulate(q)},nodeStream:function(H,q){return this.internalStream(H||"nodebuffer").toNodejsStream(q)},_compressWorker:function(H,q){if(this._data instanceof K&&this._data.compression.magic===H.magic)return this._data.getCompressedWorker();var le=this._decompressWorker();return this._dataBinary||(le=le.pipe(new $.Utf8EncodeWorker)),K.createWorkerFrom(le,H,q)},_decompressWorker:function(){return this._data instanceof K?this._data.getContentWorker():this._data instanceof ne?this._data:new a(this._data)}};for(var te=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],oe=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},L=0;L<te.length;L++)k.prototype[te[L]]=oe;v.exports=k},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(u,v,P){(function(k){var w,a,$=k.MutationObserver||k.WebKitMutationObserver;if($){var K=0,ne=new $(H),te=k.document.createTextNode("");ne.observe(te,{characterData:!0}),w=function(){te.data=K=++K%2}}else if(k.setImmediate||k.MessageChannel===void 0)w="document"in k&&"onreadystatechange"in k.document.createElement("script")?function(){var q=k.document.createElement("script");q.onreadystatechange=function(){H(),q.onreadystatechange=null,q.parentNode.removeChild(q),q=null},k.document.documentElement.appendChild(q)}:function(){setTimeout(H,0)};else{var oe=new k.MessageChannel;oe.port1.onmessage=H,w=function(){oe.port2.postMessage(0)}}var L=[];function H(){var q,le;a=!0;for(var ie=L.length;ie;){for(le=L,L=[],q=-1;++q<ie;)le[q]();ie=L.length}a=!1}v.exports=function(q){L.push(q)!==1||a||w()}}).call(this,typeof su<"u"?su:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(u,v,P){var k=u("immediate");function w(){}var a={},$=["REJECTED"],K=["FULFILLED"],ne=["PENDING"];function te(ie){if(typeof ie!="function")throw new TypeError("resolver must be a function");this.state=ne,this.queue=[],this.outcome=void 0,ie!==w&&q(this,ie)}function oe(ie,ge,Te){this.promise=ie,typeof ge=="function"&&(this.onFulfilled=ge,this.callFulfilled=this.otherCallFulfilled),typeof Te=="function"&&(this.onRejected=Te,this.callRejected=this.otherCallRejected)}function L(ie,ge,Te){k(function(){var Ae;try{Ae=ge(Te)}catch(Me){return a.reject(ie,Me)}Ae===ie?a.reject(ie,new TypeError("Cannot resolve promise with itself")):a.resolve(ie,Ae)})}function H(ie){var ge=ie&&ie.then;if(ie&&(typeof ie=="object"||typeof ie=="function")&&typeof ge=="function")return function(){ge.apply(ie,arguments)}}function q(ie,ge){var Te=!1;function Ae(He){Te||(Te=!0,a.reject(ie,He))}function Me(He){Te||(Te=!0,a.resolve(ie,He))}var qe=le(function(){ge(Me,Ae)});qe.status==="error"&&Ae(qe.value)}function le(ie,ge){var Te={};try{Te.value=ie(ge),Te.status="success"}catch(Ae){Te.status="error",Te.value=Ae}return Te}(v.exports=te).prototype.finally=function(ie){if(typeof ie!="function")return this;var ge=this.constructor;return this.then(function(Te){return ge.resolve(ie()).then(function(){return Te})},function(Te){return ge.resolve(ie()).then(function(){throw Te})})},te.prototype.catch=function(ie){return this.then(null,ie)},te.prototype.then=function(ie,ge){if(typeof ie!="function"&&this.state===K||typeof ge!="function"&&this.state===$)return this;var Te=new this.constructor(w);return this.state!==ne?L(Te,this.state===K?ie:ge,this.outcome):this.queue.push(new oe(Te,ie,ge)),Te},oe.prototype.callFulfilled=function(ie){a.resolve(this.promise,ie)},oe.prototype.otherCallFulfilled=function(ie){L(this.promise,this.onFulfilled,ie)},oe.prototype.callRejected=function(ie){a.reject(this.promise,ie)},oe.prototype.otherCallRejected=function(ie){L(this.promise,this.onRejected,ie)},a.resolve=function(ie,ge){var Te=le(H,ge);if(Te.status==="error")return a.reject(ie,Te.value);var Ae=Te.value;if(Ae)q(ie,Ae);else{ie.state=K,ie.outcome=ge;for(var Me=-1,qe=ie.queue.length;++Me<qe;)ie.queue[Me].callFulfilled(ge)}return ie},a.reject=function(ie,ge){ie.state=$,ie.outcome=ge;for(var Te=-1,Ae=ie.queue.length;++Te<Ae;)ie.queue[Te].callRejected(ge);return ie},te.resolve=function(ie){return ie instanceof this?ie:a.resolve(new this(w),ie)},te.reject=function(ie){var ge=new this(w);return a.reject(ge,ie)},te.all=function(ie){var ge=this;if(Object.prototype.toString.call(ie)!=="[object Array]")return this.reject(new TypeError("must be an array"));var Te=ie.length,Ae=!1;if(!Te)return this.resolve([]);for(var Me=new Array(Te),qe=0,He=-1,lt=new this(w);++He<Te;)Ke(ie[He],He);return lt;function Ke(ut,It){ge.resolve(ut).then(function(be){Me[It]=be,++qe!==Te||Ae||(Ae=!0,a.resolve(lt,Me))},function(be){Ae||(Ae=!0,a.reject(lt,be))})}},te.race=function(ie){var ge=this;if(Object.prototype.toString.call(ie)!=="[object Array]")return this.reject(new TypeError("must be an array"));var Te=ie.length,Ae=!1;if(!Te)return this.resolve([]);for(var Me=-1,qe=new this(w);++Me<Te;)He=ie[Me],ge.resolve(He).then(function(lt){Ae||(Ae=!0,a.resolve(qe,lt))},function(lt){Ae||(Ae=!0,a.reject(qe,lt))});var He;return qe}},{immediate:36}],38:[function(u,v,P){var k={};(0,u("./lib/utils/common").assign)(k,u("./lib/deflate"),u("./lib/inflate"),u("./lib/zlib/constants")),v.exports=k},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(u,v,P){var k=u("./zlib/deflate"),w=u("./utils/common"),a=u("./utils/strings"),$=u("./zlib/messages"),K=u("./zlib/zstream"),ne=Object.prototype.toString,te=0,oe=-1,L=0,H=8;function q(ie){if(!(this instanceof q))return new q(ie);this.options=w.assign({level:oe,method:H,chunkSize:16384,windowBits:15,memLevel:8,strategy:L,to:""},ie||{});var ge=this.options;ge.raw&&0<ge.windowBits?ge.windowBits=-ge.windowBits:ge.gzip&&0<ge.windowBits&&ge.windowBits<16&&(ge.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new K,this.strm.avail_out=0;var Te=k.deflateInit2(this.strm,ge.level,ge.method,ge.windowBits,ge.memLevel,ge.strategy);if(Te!==te)throw new Error($[Te]);if(ge.header&&k.deflateSetHeader(this.strm,ge.header),ge.dictionary){var Ae;if(Ae=typeof ge.dictionary=="string"?a.string2buf(ge.dictionary):ne.call(ge.dictionary)==="[object ArrayBuffer]"?new Uint8Array(ge.dictionary):ge.dictionary,(Te=k.deflateSetDictionary(this.strm,Ae))!==te)throw new Error($[Te]);this._dict_set=!0}}function le(ie,ge){var Te=new q(ge);if(Te.push(ie,!0),Te.err)throw Te.msg||$[Te.err];return Te.result}q.prototype.push=function(ie,ge){var Te,Ae,Me=this.strm,qe=this.options.chunkSize;if(this.ended)return!1;Ae=ge===~~ge?ge:ge===!0?4:0,typeof ie=="string"?Me.input=a.string2buf(ie):ne.call(ie)==="[object ArrayBuffer]"?Me.input=new Uint8Array(ie):Me.input=ie,Me.next_in=0,Me.avail_in=Me.input.length;do{if(Me.avail_out===0&&(Me.output=new w.Buf8(qe),Me.next_out=0,Me.avail_out=qe),(Te=k.deflate(Me,Ae))!==1&&Te!==te)return this.onEnd(Te),!(this.ended=!0);Me.avail_out!==0&&(Me.avail_in!==0||Ae!==4&&Ae!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(w.shrinkBuf(Me.output,Me.next_out))):this.onData(w.shrinkBuf(Me.output,Me.next_out)))}while((0<Me.avail_in||Me.avail_out===0)&&Te!==1);return Ae===4?(Te=k.deflateEnd(this.strm),this.onEnd(Te),this.ended=!0,Te===te):Ae!==2||(this.onEnd(te),!(Me.avail_out=0))},q.prototype.onData=function(ie){this.chunks.push(ie)},q.prototype.onEnd=function(ie){ie===te&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=w.flattenChunks(this.chunks)),this.chunks=[],this.err=ie,this.msg=this.strm.msg},P.Deflate=q,P.deflate=le,P.deflateRaw=function(ie,ge){return(ge=ge||{}).raw=!0,le(ie,ge)},P.gzip=function(ie,ge){return(ge=ge||{}).gzip=!0,le(ie,ge)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(u,v,P){var k=u("./zlib/inflate"),w=u("./utils/common"),a=u("./utils/strings"),$=u("./zlib/constants"),K=u("./zlib/messages"),ne=u("./zlib/zstream"),te=u("./zlib/gzheader"),oe=Object.prototype.toString;function L(q){if(!(this instanceof L))return new L(q);this.options=w.assign({chunkSize:16384,windowBits:0,to:""},q||{});var le=this.options;le.raw&&0<=le.windowBits&&le.windowBits<16&&(le.windowBits=-le.windowBits,le.windowBits===0&&(le.windowBits=-15)),!(0<=le.windowBits&&le.windowBits<16)||q&&q.windowBits||(le.windowBits+=32),15<le.windowBits&&le.windowBits<48&&(15&le.windowBits)==0&&(le.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ne,this.strm.avail_out=0;var ie=k.inflateInit2(this.strm,le.windowBits);if(ie!==$.Z_OK)throw new Error(K[ie]);this.header=new te,k.inflateGetHeader(this.strm,this.header)}function H(q,le){var ie=new L(le);if(ie.push(q,!0),ie.err)throw ie.msg||K[ie.err];return ie.result}L.prototype.push=function(q,le){var ie,ge,Te,Ae,Me,qe,He=this.strm,lt=this.options.chunkSize,Ke=this.options.dictionary,ut=!1;if(this.ended)return!1;ge=le===~~le?le:le===!0?$.Z_FINISH:$.Z_NO_FLUSH,typeof q=="string"?He.input=a.binstring2buf(q):oe.call(q)==="[object ArrayBuffer]"?He.input=new Uint8Array(q):He.input=q,He.next_in=0,He.avail_in=He.input.length;do{if(He.avail_out===0&&(He.output=new w.Buf8(lt),He.next_out=0,He.avail_out=lt),(ie=k.inflate(He,$.Z_NO_FLUSH))===$.Z_NEED_DICT&&Ke&&(qe=typeof Ke=="string"?a.string2buf(Ke):oe.call(Ke)==="[object ArrayBuffer]"?new Uint8Array(Ke):Ke,ie=k.inflateSetDictionary(this.strm,qe)),ie===$.Z_BUF_ERROR&&ut===!0&&(ie=$.Z_OK,ut=!1),ie!==$.Z_STREAM_END&&ie!==$.Z_OK)return this.onEnd(ie),!(this.ended=!0);He.next_out&&(He.avail_out!==0&&ie!==$.Z_STREAM_END&&(He.avail_in!==0||ge!==$.Z_FINISH&&ge!==$.Z_SYNC_FLUSH)||(this.options.to==="string"?(Te=a.utf8border(He.output,He.next_out),Ae=He.next_out-Te,Me=a.buf2string(He.output,Te),He.next_out=Ae,He.avail_out=lt-Ae,Ae&&w.arraySet(He.output,He.output,Te,Ae,0),this.onData(Me)):this.onData(w.shrinkBuf(He.output,He.next_out)))),He.avail_in===0&&He.avail_out===0&&(ut=!0)}while((0<He.avail_in||He.avail_out===0)&&ie!==$.Z_STREAM_END);return ie===$.Z_STREAM_END&&(ge=$.Z_FINISH),ge===$.Z_FINISH?(ie=k.inflateEnd(this.strm),this.onEnd(ie),this.ended=!0,ie===$.Z_OK):ge!==$.Z_SYNC_FLUSH||(this.onEnd($.Z_OK),!(He.avail_out=0))},L.prototype.onData=function(q){this.chunks.push(q)},L.prototype.onEnd=function(q){q===$.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=w.flattenChunks(this.chunks)),this.chunks=[],this.err=q,this.msg=this.strm.msg},P.Inflate=L,P.inflate=H,P.inflateRaw=function(q,le){return(le=le||{}).raw=!0,H(q,le)},P.ungzip=H},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(u,v,P){var k=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";P.assign=function($){for(var K=Array.prototype.slice.call(arguments,1);K.length;){var ne=K.shift();if(ne){if(typeof ne!="object")throw new TypeError(ne+"must be non-object");for(var te in ne)ne.hasOwnProperty(te)&&($[te]=ne[te])}}return $},P.shrinkBuf=function($,K){return $.length===K?$:$.subarray?$.subarray(0,K):($.length=K,$)};var w={arraySet:function($,K,ne,te,oe){if(K.subarray&&$.subarray)$.set(K.subarray(ne,ne+te),oe);else for(var L=0;L<te;L++)$[oe+L]=K[ne+L]},flattenChunks:function($){var K,ne,te,oe,L,H;for(K=te=0,ne=$.length;K<ne;K++)te+=$[K].length;for(H=new Uint8Array(te),K=oe=0,ne=$.length;K<ne;K++)L=$[K],H.set(L,oe),oe+=L.length;return H}},a={arraySet:function($,K,ne,te,oe){for(var L=0;L<te;L++)$[oe+L]=K[ne+L]},flattenChunks:function($){return[].concat.apply([],$)}};P.setTyped=function($){$?(P.Buf8=Uint8Array,P.Buf16=Uint16Array,P.Buf32=Int32Array,P.assign(P,w)):(P.Buf8=Array,P.Buf16=Array,P.Buf32=Array,P.assign(P,a))},P.setTyped(k)},{}],42:[function(u,v,P){var k=u("./common"),w=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{w=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var $=new k.Buf8(256),K=0;K<256;K++)$[K]=252<=K?6:248<=K?5:240<=K?4:224<=K?3:192<=K?2:1;function ne(te,oe){if(oe<65537&&(te.subarray&&a||!te.subarray&&w))return String.fromCharCode.apply(null,k.shrinkBuf(te,oe));for(var L="",H=0;H<oe;H++)L+=String.fromCharCode(te[H]);return L}$[254]=$[254]=1,P.string2buf=function(te){var oe,L,H,q,le,ie=te.length,ge=0;for(q=0;q<ie;q++)(64512&(L=te.charCodeAt(q)))==55296&&q+1<ie&&(64512&(H=te.charCodeAt(q+1)))==56320&&(L=65536+(L-55296<<10)+(H-56320),q++),ge+=L<128?1:L<2048?2:L<65536?3:4;for(oe=new k.Buf8(ge),q=le=0;le<ge;q++)(64512&(L=te.charCodeAt(q)))==55296&&q+1<ie&&(64512&(H=te.charCodeAt(q+1)))==56320&&(L=65536+(L-55296<<10)+(H-56320),q++),L<128?oe[le++]=L:(L<2048?oe[le++]=192|L>>>6:(L<65536?oe[le++]=224|L>>>12:(oe[le++]=240|L>>>18,oe[le++]=128|L>>>12&63),oe[le++]=128|L>>>6&63),oe[le++]=128|63&L);return oe},P.buf2binstring=function(te){return ne(te,te.length)},P.binstring2buf=function(te){for(var oe=new k.Buf8(te.length),L=0,H=oe.length;L<H;L++)oe[L]=te.charCodeAt(L);return oe},P.buf2string=function(te,oe){var L,H,q,le,ie=oe||te.length,ge=new Array(2*ie);for(L=H=0;L<ie;)if((q=te[L++])<128)ge[H++]=q;else if(4<(le=$[q]))ge[H++]=65533,L+=le-1;else{for(q&=le===2?31:le===3?15:7;1<le&&L<ie;)q=q<<6|63&te[L++],le--;1<le?ge[H++]=65533:q<65536?ge[H++]=q:(q-=65536,ge[H++]=55296|q>>10&1023,ge[H++]=56320|1023&q)}return ne(ge,H)},P.utf8border=function(te,oe){var L;for((oe=oe||te.length)>te.length&&(oe=te.length),L=oe-1;0<=L&&(192&te[L])==128;)L--;return L<0||L===0?oe:L+$[te[L]]>oe?L:oe}},{"./common":41}],43:[function(u,v,P){v.exports=function(k,w,a,$){for(var K=65535&k|0,ne=k>>>16&65535|0,te=0;a!==0;){for(a-=te=2e3<a?2e3:a;ne=ne+(K=K+w[$++]|0)|0,--te;);K%=65521,ne%=65521}return K|ne<<16|0}},{}],44:[function(u,v,P){v.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(u,v,P){var k=function(){for(var w,a=[],$=0;$<256;$++){w=$;for(var K=0;K<8;K++)w=1&w?3988292384^w>>>1:w>>>1;a[$]=w}return a}();v.exports=function(w,a,$,K){var ne=k,te=K+$;w^=-1;for(var oe=K;oe<te;oe++)w=w>>>8^ne[255&(w^a[oe])];return-1^w}},{}],46:[function(u,v,P){var k,w=u("../utils/common"),a=u("./trees"),$=u("./adler32"),K=u("./crc32"),ne=u("./messages"),te=0,oe=4,L=0,H=-2,q=-1,le=4,ie=2,ge=8,Te=9,Ae=286,Me=30,qe=19,He=2*Ae+1,lt=15,Ke=3,ut=258,It=ut+Ke+1,be=42,Xe=113,Z=1,Qe=2,jt=3,at=4;function Gt(O,Je){return O.msg=ne[Je],Je}function dt(O){return(O<<1)-(4<O?9:0)}function Ft(O){for(var Je=O.length;0<=--Je;)O[Je]=0}function Ue(O){var Je=O.state,Ge=Je.pending;Ge>O.avail_out&&(Ge=O.avail_out),Ge!==0&&(w.arraySet(O.output,Je.pending_buf,Je.pending_out,Ge,O.next_out),O.next_out+=Ge,Je.pending_out+=Ge,O.total_out+=Ge,O.avail_out-=Ge,Je.pending-=Ge,Je.pending===0&&(Je.pending_out=0))}function ze(O,Je){a._tr_flush_block(O,0<=O.block_start?O.block_start:-1,O.strstart-O.block_start,Je),O.block_start=O.strstart,Ue(O.strm)}function Et(O,Je){O.pending_buf[O.pending++]=Je}function bt(O,Je){O.pending_buf[O.pending++]=Je>>>8&255,O.pending_buf[O.pending++]=255&Je}function gt(O,Je){var Ge,de,ae=O.max_chain_length,ke=O.strstart,it=O.prev_length,nt=O.nice_match,Oe=O.strstart>O.w_size-It?O.strstart-(O.w_size-It):0,pt=O.window,wt=O.w_mask,_t=O.prev,kt=O.strstart+ut,Xt=pt[ke+it-1],Ut=pt[ke+it];O.prev_length>=O.good_match&&(ae>>=2),nt>O.lookahead&&(nt=O.lookahead);do if(pt[(Ge=Je)+it]===Ut&&pt[Ge+it-1]===Xt&&pt[Ge]===pt[ke]&&pt[++Ge]===pt[ke+1]){ke+=2,Ge++;do;while(pt[++ke]===pt[++Ge]&&pt[++ke]===pt[++Ge]&&pt[++ke]===pt[++Ge]&&pt[++ke]===pt[++Ge]&&pt[++ke]===pt[++Ge]&&pt[++ke]===pt[++Ge]&&pt[++ke]===pt[++Ge]&&pt[++ke]===pt[++Ge]&&ke<kt);if(de=ut-(kt-ke),ke=kt-ut,it<de){if(O.match_start=Je,nt<=(it=de))break;Xt=pt[ke+it-1],Ut=pt[ke+it]}}while((Je=_t[Je&wt])>Oe&&--ae!=0);return it<=O.lookahead?it:O.lookahead}function fr(O){var Je,Ge,de,ae,ke,it,nt,Oe,pt,wt,_t=O.w_size;do{if(ae=O.window_size-O.lookahead-O.strstart,O.strstart>=_t+(_t-It)){for(w.arraySet(O.window,O.window,_t,_t,0),O.match_start-=_t,O.strstart-=_t,O.block_start-=_t,Je=Ge=O.hash_size;de=O.head[--Je],O.head[Je]=_t<=de?de-_t:0,--Ge;);for(Je=Ge=_t;de=O.prev[--Je],O.prev[Je]=_t<=de?de-_t:0,--Ge;);ae+=_t}if(O.strm.avail_in===0)break;if(it=O.strm,nt=O.window,Oe=O.strstart+O.lookahead,pt=ae,wt=void 0,wt=it.avail_in,pt<wt&&(wt=pt),Ge=wt===0?0:(it.avail_in-=wt,w.arraySet(nt,it.input,it.next_in,wt,Oe),it.state.wrap===1?it.adler=$(it.adler,nt,wt,Oe):it.state.wrap===2&&(it.adler=K(it.adler,nt,wt,Oe)),it.next_in+=wt,it.total_in+=wt,wt),O.lookahead+=Ge,O.lookahead+O.insert>=Ke)for(ke=O.strstart-O.insert,O.ins_h=O.window[ke],O.ins_h=(O.ins_h<<O.hash_shift^O.window[ke+1])&O.hash_mask;O.insert&&(O.ins_h=(O.ins_h<<O.hash_shift^O.window[ke+Ke-1])&O.hash_mask,O.prev[ke&O.w_mask]=O.head[O.ins_h],O.head[O.ins_h]=ke,ke++,O.insert--,!(O.lookahead+O.insert<Ke)););}while(O.lookahead<It&&O.strm.avail_in!==0)}function Dr(O,Je){for(var Ge,de;;){if(O.lookahead<It){if(fr(O),O.lookahead<It&&Je===te)return Z;if(O.lookahead===0)break}if(Ge=0,O.lookahead>=Ke&&(O.ins_h=(O.ins_h<<O.hash_shift^O.window[O.strstart+Ke-1])&O.hash_mask,Ge=O.prev[O.strstart&O.w_mask]=O.head[O.ins_h],O.head[O.ins_h]=O.strstart),Ge!==0&&O.strstart-Ge<=O.w_size-It&&(O.match_length=gt(O,Ge)),O.match_length>=Ke)if(de=a._tr_tally(O,O.strstart-O.match_start,O.match_length-Ke),O.lookahead-=O.match_length,O.match_length<=O.max_lazy_match&&O.lookahead>=Ke){for(O.match_length--;O.strstart++,O.ins_h=(O.ins_h<<O.hash_shift^O.window[O.strstart+Ke-1])&O.hash_mask,Ge=O.prev[O.strstart&O.w_mask]=O.head[O.ins_h],O.head[O.ins_h]=O.strstart,--O.match_length!=0;);O.strstart++}else O.strstart+=O.match_length,O.match_length=0,O.ins_h=O.window[O.strstart],O.ins_h=(O.ins_h<<O.hash_shift^O.window[O.strstart+1])&O.hash_mask;else de=a._tr_tally(O,0,O.window[O.strstart]),O.lookahead--,O.strstart++;if(de&&(ze(O,!1),O.strm.avail_out===0))return Z}return O.insert=O.strstart<Ke-1?O.strstart:Ke-1,Je===oe?(ze(O,!0),O.strm.avail_out===0?jt:at):O.last_lit&&(ze(O,!1),O.strm.avail_out===0)?Z:Qe}function er(O,Je){for(var Ge,de,ae;;){if(O.lookahead<It){if(fr(O),O.lookahead<It&&Je===te)return Z;if(O.lookahead===0)break}if(Ge=0,O.lookahead>=Ke&&(O.ins_h=(O.ins_h<<O.hash_shift^O.window[O.strstart+Ke-1])&O.hash_mask,Ge=O.prev[O.strstart&O.w_mask]=O.head[O.ins_h],O.head[O.ins_h]=O.strstart),O.prev_length=O.match_length,O.prev_match=O.match_start,O.match_length=Ke-1,Ge!==0&&O.prev_length<O.max_lazy_match&&O.strstart-Ge<=O.w_size-It&&(O.match_length=gt(O,Ge),O.match_length<=5&&(O.strategy===1||O.match_length===Ke&&4096<O.strstart-O.match_start)&&(O.match_length=Ke-1)),O.prev_length>=Ke&&O.match_length<=O.prev_length){for(ae=O.strstart+O.lookahead-Ke,de=a._tr_tally(O,O.strstart-1-O.prev_match,O.prev_length-Ke),O.lookahead-=O.prev_length-1,O.prev_length-=2;++O.strstart<=ae&&(O.ins_h=(O.ins_h<<O.hash_shift^O.window[O.strstart+Ke-1])&O.hash_mask,Ge=O.prev[O.strstart&O.w_mask]=O.head[O.ins_h],O.head[O.ins_h]=O.strstart),--O.prev_length!=0;);if(O.match_available=0,O.match_length=Ke-1,O.strstart++,de&&(ze(O,!1),O.strm.avail_out===0))return Z}else if(O.match_available){if((de=a._tr_tally(O,0,O.window[O.strstart-1]))&&ze(O,!1),O.strstart++,O.lookahead--,O.strm.avail_out===0)return Z}else O.match_available=1,O.strstart++,O.lookahead--}return O.match_available&&(de=a._tr_tally(O,0,O.window[O.strstart-1]),O.match_available=0),O.insert=O.strstart<Ke-1?O.strstart:Ke-1,Je===oe?(ze(O,!0),O.strm.avail_out===0?jt:at):O.last_lit&&(ze(O,!1),O.strm.avail_out===0)?Z:Qe}function Vt(O,Je,Ge,de,ae){this.good_length=O,this.max_lazy=Je,this.nice_length=Ge,this.max_chain=de,this.func=ae}function Pr(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ge,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new w.Buf16(2*He),this.dyn_dtree=new w.Buf16(2*(2*Me+1)),this.bl_tree=new w.Buf16(2*(2*qe+1)),Ft(this.dyn_ltree),Ft(this.dyn_dtree),Ft(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new w.Buf16(lt+1),this.heap=new w.Buf16(2*Ae+1),Ft(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new w.Buf16(2*Ae+1),Ft(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function or(O){var Je;return O&&O.state?(O.total_in=O.total_out=0,O.data_type=ie,(Je=O.state).pending=0,Je.pending_out=0,Je.wrap<0&&(Je.wrap=-Je.wrap),Je.status=Je.wrap?be:Xe,O.adler=Je.wrap===2?0:1,Je.last_flush=te,a._tr_init(Je),L):Gt(O,H)}function _i(O){var Je=or(O);return Je===L&&function(Ge){Ge.window_size=2*Ge.w_size,Ft(Ge.head),Ge.max_lazy_match=k[Ge.level].max_lazy,Ge.good_match=k[Ge.level].good_length,Ge.nice_match=k[Ge.level].nice_length,Ge.max_chain_length=k[Ge.level].max_chain,Ge.strstart=0,Ge.block_start=0,Ge.lookahead=0,Ge.insert=0,Ge.match_length=Ge.prev_length=Ke-1,Ge.match_available=0,Ge.ins_h=0}(O.state),Je}function ar(O,Je,Ge,de,ae,ke){if(!O)return H;var it=1;if(Je===q&&(Je=6),de<0?(it=0,de=-de):15<de&&(it=2,de-=16),ae<1||Te<ae||Ge!==ge||de<8||15<de||Je<0||9<Je||ke<0||le<ke)return Gt(O,H);de===8&&(de=9);var nt=new Pr;return(O.state=nt).strm=O,nt.wrap=it,nt.gzhead=null,nt.w_bits=de,nt.w_size=1<<nt.w_bits,nt.w_mask=nt.w_size-1,nt.hash_bits=ae+7,nt.hash_size=1<<nt.hash_bits,nt.hash_mask=nt.hash_size-1,nt.hash_shift=~~((nt.hash_bits+Ke-1)/Ke),nt.window=new w.Buf8(2*nt.w_size),nt.head=new w.Buf16(nt.hash_size),nt.prev=new w.Buf16(nt.w_size),nt.lit_bufsize=1<<ae+6,nt.pending_buf_size=4*nt.lit_bufsize,nt.pending_buf=new w.Buf8(nt.pending_buf_size),nt.d_buf=1*nt.lit_bufsize,nt.l_buf=3*nt.lit_bufsize,nt.level=Je,nt.strategy=ke,nt.method=Ge,_i(O)}k=[new Vt(0,0,0,0,function(O,Je){var Ge=65535;for(Ge>O.pending_buf_size-5&&(Ge=O.pending_buf_size-5);;){if(O.lookahead<=1){if(fr(O),O.lookahead===0&&Je===te)return Z;if(O.lookahead===0)break}O.strstart+=O.lookahead,O.lookahead=0;var de=O.block_start+Ge;if((O.strstart===0||O.strstart>=de)&&(O.lookahead=O.strstart-de,O.strstart=de,ze(O,!1),O.strm.avail_out===0)||O.strstart-O.block_start>=O.w_size-It&&(ze(O,!1),O.strm.avail_out===0))return Z}return O.insert=0,Je===oe?(ze(O,!0),O.strm.avail_out===0?jt:at):(O.strstart>O.block_start&&(ze(O,!1),O.strm.avail_out),Z)}),new Vt(4,4,8,4,Dr),new Vt(4,5,16,8,Dr),new Vt(4,6,32,32,Dr),new Vt(4,4,16,16,er),new Vt(8,16,32,32,er),new Vt(8,16,128,128,er),new Vt(8,32,128,256,er),new Vt(32,128,258,1024,er),new Vt(32,258,258,4096,er)],P.deflateInit=function(O,Je){return ar(O,Je,ge,15,8,0)},P.deflateInit2=ar,P.deflateReset=_i,P.deflateResetKeep=or,P.deflateSetHeader=function(O,Je){return O&&O.state?O.state.wrap!==2?H:(O.state.gzhead=Je,L):H},P.deflate=function(O,Je){var Ge,de,ae,ke;if(!O||!O.state||5<Je||Je<0)return O?Gt(O,H):H;if(de=O.state,!O.output||!O.input&&O.avail_in!==0||de.status===666&&Je!==oe)return Gt(O,O.avail_out===0?-5:H);if(de.strm=O,Ge=de.last_flush,de.last_flush=Je,de.status===be)if(de.wrap===2)O.adler=0,Et(de,31),Et(de,139),Et(de,8),de.gzhead?(Et(de,(de.gzhead.text?1:0)+(de.gzhead.hcrc?2:0)+(de.gzhead.extra?4:0)+(de.gzhead.name?8:0)+(de.gzhead.comment?16:0)),Et(de,255&de.gzhead.time),Et(de,de.gzhead.time>>8&255),Et(de,de.gzhead.time>>16&255),Et(de,de.gzhead.time>>24&255),Et(de,de.level===9?2:2<=de.strategy||de.level<2?4:0),Et(de,255&de.gzhead.os),de.gzhead.extra&&de.gzhead.extra.length&&(Et(de,255&de.gzhead.extra.length),Et(de,de.gzhead.extra.length>>8&255)),de.gzhead.hcrc&&(O.adler=K(O.adler,de.pending_buf,de.pending,0)),de.gzindex=0,de.status=69):(Et(de,0),Et(de,0),Et(de,0),Et(de,0),Et(de,0),Et(de,de.level===9?2:2<=de.strategy||de.level<2?4:0),Et(de,3),de.status=Xe);else{var it=ge+(de.w_bits-8<<4)<<8;it|=(2<=de.strategy||de.level<2?0:de.level<6?1:de.level===6?2:3)<<6,de.strstart!==0&&(it|=32),it+=31-it%31,de.status=Xe,bt(de,it),de.strstart!==0&&(bt(de,O.adler>>>16),bt(de,65535&O.adler)),O.adler=1}if(de.status===69)if(de.gzhead.extra){for(ae=de.pending;de.gzindex<(65535&de.gzhead.extra.length)&&(de.pending!==de.pending_buf_size||(de.gzhead.hcrc&&de.pending>ae&&(O.adler=K(O.adler,de.pending_buf,de.pending-ae,ae)),Ue(O),ae=de.pending,de.pending!==de.pending_buf_size));)Et(de,255&de.gzhead.extra[de.gzindex]),de.gzindex++;de.gzhead.hcrc&&de.pending>ae&&(O.adler=K(O.adler,de.pending_buf,de.pending-ae,ae)),de.gzindex===de.gzhead.extra.length&&(de.gzindex=0,de.status=73)}else de.status=73;if(de.status===73)if(de.gzhead.name){ae=de.pending;do{if(de.pending===de.pending_buf_size&&(de.gzhead.hcrc&&de.pending>ae&&(O.adler=K(O.adler,de.pending_buf,de.pending-ae,ae)),Ue(O),ae=de.pending,de.pending===de.pending_buf_size)){ke=1;break}ke=de.gzindex<de.gzhead.name.length?255&de.gzhead.name.charCodeAt(de.gzindex++):0,Et(de,ke)}while(ke!==0);de.gzhead.hcrc&&de.pending>ae&&(O.adler=K(O.adler,de.pending_buf,de.pending-ae,ae)),ke===0&&(de.gzindex=0,de.status=91)}else de.status=91;if(de.status===91)if(de.gzhead.comment){ae=de.pending;do{if(de.pending===de.pending_buf_size&&(de.gzhead.hcrc&&de.pending>ae&&(O.adler=K(O.adler,de.pending_buf,de.pending-ae,ae)),Ue(O),ae=de.pending,de.pending===de.pending_buf_size)){ke=1;break}ke=de.gzindex<de.gzhead.comment.length?255&de.gzhead.comment.charCodeAt(de.gzindex++):0,Et(de,ke)}while(ke!==0);de.gzhead.hcrc&&de.pending>ae&&(O.adler=K(O.adler,de.pending_buf,de.pending-ae,ae)),ke===0&&(de.status=103)}else de.status=103;if(de.status===103&&(de.gzhead.hcrc?(de.pending+2>de.pending_buf_size&&Ue(O),de.pending+2<=de.pending_buf_size&&(Et(de,255&O.adler),Et(de,O.adler>>8&255),O.adler=0,de.status=Xe)):de.status=Xe),de.pending!==0){if(Ue(O),O.avail_out===0)return de.last_flush=-1,L}else if(O.avail_in===0&&dt(Je)<=dt(Ge)&&Je!==oe)return Gt(O,-5);if(de.status===666&&O.avail_in!==0)return Gt(O,-5);if(O.avail_in!==0||de.lookahead!==0||Je!==te&&de.status!==666){var nt=de.strategy===2?function(Oe,pt){for(var wt;;){if(Oe.lookahead===0&&(fr(Oe),Oe.lookahead===0)){if(pt===te)return Z;break}if(Oe.match_length=0,wt=a._tr_tally(Oe,0,Oe.window[Oe.strstart]),Oe.lookahead--,Oe.strstart++,wt&&(ze(Oe,!1),Oe.strm.avail_out===0))return Z}return Oe.insert=0,pt===oe?(ze(Oe,!0),Oe.strm.avail_out===0?jt:at):Oe.last_lit&&(ze(Oe,!1),Oe.strm.avail_out===0)?Z:Qe}(de,Je):de.strategy===3?function(Oe,pt){for(var wt,_t,kt,Xt,Ut=Oe.window;;){if(Oe.lookahead<=ut){if(fr(Oe),Oe.lookahead<=ut&&pt===te)return Z;if(Oe.lookahead===0)break}if(Oe.match_length=0,Oe.lookahead>=Ke&&0<Oe.strstart&&(_t=Ut[kt=Oe.strstart-1])===Ut[++kt]&&_t===Ut[++kt]&&_t===Ut[++kt]){Xt=Oe.strstart+ut;do;while(_t===Ut[++kt]&&_t===Ut[++kt]&&_t===Ut[++kt]&&_t===Ut[++kt]&&_t===Ut[++kt]&&_t===Ut[++kt]&&_t===Ut[++kt]&&_t===Ut[++kt]&&kt<Xt);Oe.match_length=ut-(Xt-kt),Oe.match_length>Oe.lookahead&&(Oe.match_length=Oe.lookahead)}if(Oe.match_length>=Ke?(wt=a._tr_tally(Oe,1,Oe.match_length-Ke),Oe.lookahead-=Oe.match_length,Oe.strstart+=Oe.match_length,Oe.match_length=0):(wt=a._tr_tally(Oe,0,Oe.window[Oe.strstart]),Oe.lookahead--,Oe.strstart++),wt&&(ze(Oe,!1),Oe.strm.avail_out===0))return Z}return Oe.insert=0,pt===oe?(ze(Oe,!0),Oe.strm.avail_out===0?jt:at):Oe.last_lit&&(ze(Oe,!1),Oe.strm.avail_out===0)?Z:Qe}(de,Je):k[de.level].func(de,Je);if(nt!==jt&&nt!==at||(de.status=666),nt===Z||nt===jt)return O.avail_out===0&&(de.last_flush=-1),L;if(nt===Qe&&(Je===1?a._tr_align(de):Je!==5&&(a._tr_stored_block(de,0,0,!1),Je===3&&(Ft(de.head),de.lookahead===0&&(de.strstart=0,de.block_start=0,de.insert=0))),Ue(O),O.avail_out===0))return de.last_flush=-1,L}return Je!==oe?L:de.wrap<=0?1:(de.wrap===2?(Et(de,255&O.adler),Et(de,O.adler>>8&255),Et(de,O.adler>>16&255),Et(de,O.adler>>24&255),Et(de,255&O.total_in),Et(de,O.total_in>>8&255),Et(de,O.total_in>>16&255),Et(de,O.total_in>>24&255)):(bt(de,O.adler>>>16),bt(de,65535&O.adler)),Ue(O),0<de.wrap&&(de.wrap=-de.wrap),de.pending!==0?L:1)},P.deflateEnd=function(O){var Je;return O&&O.state?(Je=O.state.status)!==be&&Je!==69&&Je!==73&&Je!==91&&Je!==103&&Je!==Xe&&Je!==666?Gt(O,H):(O.state=null,Je===Xe?Gt(O,-3):L):H},P.deflateSetDictionary=function(O,Je){var Ge,de,ae,ke,it,nt,Oe,pt,wt=Je.length;if(!O||!O.state||(ke=(Ge=O.state).wrap)===2||ke===1&&Ge.status!==be||Ge.lookahead)return H;for(ke===1&&(O.adler=$(O.adler,Je,wt,0)),Ge.wrap=0,wt>=Ge.w_size&&(ke===0&&(Ft(Ge.head),Ge.strstart=0,Ge.block_start=0,Ge.insert=0),pt=new w.Buf8(Ge.w_size),w.arraySet(pt,Je,wt-Ge.w_size,Ge.w_size,0),Je=pt,wt=Ge.w_size),it=O.avail_in,nt=O.next_in,Oe=O.input,O.avail_in=wt,O.next_in=0,O.input=Je,fr(Ge);Ge.lookahead>=Ke;){for(de=Ge.strstart,ae=Ge.lookahead-(Ke-1);Ge.ins_h=(Ge.ins_h<<Ge.hash_shift^Ge.window[de+Ke-1])&Ge.hash_mask,Ge.prev[de&Ge.w_mask]=Ge.head[Ge.ins_h],Ge.head[Ge.ins_h]=de,de++,--ae;);Ge.strstart=de,Ge.lookahead=Ke-1,fr(Ge)}return Ge.strstart+=Ge.lookahead,Ge.block_start=Ge.strstart,Ge.insert=Ge.lookahead,Ge.lookahead=0,Ge.match_length=Ge.prev_length=Ke-1,Ge.match_available=0,O.next_in=nt,O.input=Oe,O.avail_in=it,Ge.wrap=ke,L},P.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(u,v,P){v.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(u,v,P){v.exports=function(k,w){var a,$,K,ne,te,oe,L,H,q,le,ie,ge,Te,Ae,Me,qe,He,lt,Ke,ut,It,be,Xe,Z,Qe;a=k.state,$=k.next_in,Z=k.input,K=$+(k.avail_in-5),ne=k.next_out,Qe=k.output,te=ne-(w-k.avail_out),oe=ne+(k.avail_out-257),L=a.dmax,H=a.wsize,q=a.whave,le=a.wnext,ie=a.window,ge=a.hold,Te=a.bits,Ae=a.lencode,Me=a.distcode,qe=(1<<a.lenbits)-1,He=(1<<a.distbits)-1;e:do{Te<15&&(ge+=Z[$++]<<Te,Te+=8,ge+=Z[$++]<<Te,Te+=8),lt=Ae[ge&qe];t:for(;;){if(ge>>>=Ke=lt>>>24,Te-=Ke,(Ke=lt>>>16&255)===0)Qe[ne++]=65535&lt;else{if(!(16&Ke)){if((64&Ke)==0){lt=Ae[(65535&lt)+(ge&(1<<Ke)-1)];continue t}if(32&Ke){a.mode=12;break e}k.msg="invalid literal/length code",a.mode=30;break e}ut=65535&lt,(Ke&=15)&&(Te<Ke&&(ge+=Z[$++]<<Te,Te+=8),ut+=ge&(1<<Ke)-1,ge>>>=Ke,Te-=Ke),Te<15&&(ge+=Z[$++]<<Te,Te+=8,ge+=Z[$++]<<Te,Te+=8),lt=Me[ge&He];r:for(;;){if(ge>>>=Ke=lt>>>24,Te-=Ke,!(16&(Ke=lt>>>16&255))){if((64&Ke)==0){lt=Me[(65535&lt)+(ge&(1<<Ke)-1)];continue r}k.msg="invalid distance code",a.mode=30;break e}if(It=65535&lt,Te<(Ke&=15)&&(ge+=Z[$++]<<Te,(Te+=8)<Ke&&(ge+=Z[$++]<<Te,Te+=8)),L<(It+=ge&(1<<Ke)-1)){k.msg="invalid distance too far back",a.mode=30;break e}if(ge>>>=Ke,Te-=Ke,(Ke=ne-te)<It){if(q<(Ke=It-Ke)&&a.sane){k.msg="invalid distance too far back",a.mode=30;break e}if(Xe=ie,(be=0)===le){if(be+=H-Ke,Ke<ut){for(ut-=Ke;Qe[ne++]=ie[be++],--Ke;);be=ne-It,Xe=Qe}}else if(le<Ke){if(be+=H+le-Ke,(Ke-=le)<ut){for(ut-=Ke;Qe[ne++]=ie[be++],--Ke;);if(be=0,le<ut){for(ut-=Ke=le;Qe[ne++]=ie[be++],--Ke;);be=ne-It,Xe=Qe}}}else if(be+=le-Ke,Ke<ut){for(ut-=Ke;Qe[ne++]=ie[be++],--Ke;);be=ne-It,Xe=Qe}for(;2<ut;)Qe[ne++]=Xe[be++],Qe[ne++]=Xe[be++],Qe[ne++]=Xe[be++],ut-=3;ut&&(Qe[ne++]=Xe[be++],1<ut&&(Qe[ne++]=Xe[be++]))}else{for(be=ne-It;Qe[ne++]=Qe[be++],Qe[ne++]=Qe[be++],Qe[ne++]=Qe[be++],2<(ut-=3););ut&&(Qe[ne++]=Qe[be++],1<ut&&(Qe[ne++]=Qe[be++]))}break}}break}}while($<K&&ne<oe);$-=ut=Te>>3,ge&=(1<<(Te-=ut<<3))-1,k.next_in=$,k.next_out=ne,k.avail_in=$<K?K-$+5:5-($-K),k.avail_out=ne<oe?oe-ne+257:257-(ne-oe),a.hold=ge,a.bits=Te}},{}],49:[function(u,v,P){var k=u("../utils/common"),w=u("./adler32"),a=u("./crc32"),$=u("./inffast"),K=u("./inftrees"),ne=1,te=2,oe=0,L=-2,H=1,q=852,le=592;function ie(be){return(be>>>24&255)+(be>>>8&65280)+((65280&be)<<8)+((255&be)<<24)}function ge(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new k.Buf16(320),this.work=new k.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function Te(be){var Xe;return be&&be.state?(Xe=be.state,be.total_in=be.total_out=Xe.total=0,be.msg="",Xe.wrap&&(be.adler=1&Xe.wrap),Xe.mode=H,Xe.last=0,Xe.havedict=0,Xe.dmax=32768,Xe.head=null,Xe.hold=0,Xe.bits=0,Xe.lencode=Xe.lendyn=new k.Buf32(q),Xe.distcode=Xe.distdyn=new k.Buf32(le),Xe.sane=1,Xe.back=-1,oe):L}function Ae(be){var Xe;return be&&be.state?((Xe=be.state).wsize=0,Xe.whave=0,Xe.wnext=0,Te(be)):L}function Me(be,Xe){var Z,Qe;return be&&be.state?(Qe=be.state,Xe<0?(Z=0,Xe=-Xe):(Z=1+(Xe>>4),Xe<48&&(Xe&=15)),Xe&&(Xe<8||15<Xe)?L:(Qe.window!==null&&Qe.wbits!==Xe&&(Qe.window=null),Qe.wrap=Z,Qe.wbits=Xe,Ae(be))):L}function qe(be,Xe){var Z,Qe;return be?(Qe=new ge,(be.state=Qe).window=null,(Z=Me(be,Xe))!==oe&&(be.state=null),Z):L}var He,lt,Ke=!0;function ut(be){if(Ke){var Xe;for(He=new k.Buf32(512),lt=new k.Buf32(32),Xe=0;Xe<144;)be.lens[Xe++]=8;for(;Xe<256;)be.lens[Xe++]=9;for(;Xe<280;)be.lens[Xe++]=7;for(;Xe<288;)be.lens[Xe++]=8;for(K(ne,be.lens,0,288,He,0,be.work,{bits:9}),Xe=0;Xe<32;)be.lens[Xe++]=5;K(te,be.lens,0,32,lt,0,be.work,{bits:5}),Ke=!1}be.lencode=He,be.lenbits=9,be.distcode=lt,be.distbits=5}function It(be,Xe,Z,Qe){var jt,at=be.state;return at.window===null&&(at.wsize=1<<at.wbits,at.wnext=0,at.whave=0,at.window=new k.Buf8(at.wsize)),Qe>=at.wsize?(k.arraySet(at.window,Xe,Z-at.wsize,at.wsize,0),at.wnext=0,at.whave=at.wsize):(Qe<(jt=at.wsize-at.wnext)&&(jt=Qe),k.arraySet(at.window,Xe,Z-Qe,jt,at.wnext),(Qe-=jt)?(k.arraySet(at.window,Xe,Z-Qe,Qe,0),at.wnext=Qe,at.whave=at.wsize):(at.wnext+=jt,at.wnext===at.wsize&&(at.wnext=0),at.whave<at.wsize&&(at.whave+=jt))),0}P.inflateReset=Ae,P.inflateReset2=Me,P.inflateResetKeep=Te,P.inflateInit=function(be){return qe(be,15)},P.inflateInit2=qe,P.inflate=function(be,Xe){var Z,Qe,jt,at,Gt,dt,Ft,Ue,ze,Et,bt,gt,fr,Dr,er,Vt,Pr,or,_i,ar,O,Je,Ge,de,ae=0,ke=new k.Buf8(4),it=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!be||!be.state||!be.output||!be.input&&be.avail_in!==0)return L;(Z=be.state).mode===12&&(Z.mode=13),Gt=be.next_out,jt=be.output,Ft=be.avail_out,at=be.next_in,Qe=be.input,dt=be.avail_in,Ue=Z.hold,ze=Z.bits,Et=dt,bt=Ft,Je=oe;e:for(;;)switch(Z.mode){case H:if(Z.wrap===0){Z.mode=13;break}for(;ze<16;){if(dt===0)break e;dt--,Ue+=Qe[at++]<<ze,ze+=8}if(2&Z.wrap&&Ue===35615){ke[Z.check=0]=255&Ue,ke[1]=Ue>>>8&255,Z.check=a(Z.check,ke,2,0),ze=Ue=0,Z.mode=2;break}if(Z.flags=0,Z.head&&(Z.head.done=!1),!(1&Z.wrap)||(((255&Ue)<<8)+(Ue>>8))%31){be.msg="incorrect header check",Z.mode=30;break}if((15&Ue)!=8){be.msg="unknown compression method",Z.mode=30;break}if(ze-=4,O=8+(15&(Ue>>>=4)),Z.wbits===0)Z.wbits=O;else if(O>Z.wbits){be.msg="invalid window size",Z.mode=30;break}Z.dmax=1<<O,be.adler=Z.check=1,Z.mode=512&Ue?10:12,ze=Ue=0;break;case 2:for(;ze<16;){if(dt===0)break e;dt--,Ue+=Qe[at++]<<ze,ze+=8}if(Z.flags=Ue,(255&Z.flags)!=8){be.msg="unknown compression method",Z.mode=30;break}if(57344&Z.flags){be.msg="unknown header flags set",Z.mode=30;break}Z.head&&(Z.head.text=Ue>>8&1),512&Z.flags&&(ke[0]=255&Ue,ke[1]=Ue>>>8&255,Z.check=a(Z.check,ke,2,0)),ze=Ue=0,Z.mode=3;case 3:for(;ze<32;){if(dt===0)break e;dt--,Ue+=Qe[at++]<<ze,ze+=8}Z.head&&(Z.head.time=Ue),512&Z.flags&&(ke[0]=255&Ue,ke[1]=Ue>>>8&255,ke[2]=Ue>>>16&255,ke[3]=Ue>>>24&255,Z.check=a(Z.check,ke,4,0)),ze=Ue=0,Z.mode=4;case 4:for(;ze<16;){if(dt===0)break e;dt--,Ue+=Qe[at++]<<ze,ze+=8}Z.head&&(Z.head.xflags=255&Ue,Z.head.os=Ue>>8),512&Z.flags&&(ke[0]=255&Ue,ke[1]=Ue>>>8&255,Z.check=a(Z.check,ke,2,0)),ze=Ue=0,Z.mode=5;case 5:if(1024&Z.flags){for(;ze<16;){if(dt===0)break e;dt--,Ue+=Qe[at++]<<ze,ze+=8}Z.length=Ue,Z.head&&(Z.head.extra_len=Ue),512&Z.flags&&(ke[0]=255&Ue,ke[1]=Ue>>>8&255,Z.check=a(Z.check,ke,2,0)),ze=Ue=0}else Z.head&&(Z.head.extra=null);Z.mode=6;case 6:if(1024&Z.flags&&(dt<(gt=Z.length)&&(gt=dt),gt&&(Z.head&&(O=Z.head.extra_len-Z.length,Z.head.extra||(Z.head.extra=new Array(Z.head.extra_len)),k.arraySet(Z.head.extra,Qe,at,gt,O)),512&Z.flags&&(Z.check=a(Z.check,Qe,gt,at)),dt-=gt,at+=gt,Z.length-=gt),Z.length))break e;Z.length=0,Z.mode=7;case 7:if(2048&Z.flags){if(dt===0)break e;for(gt=0;O=Qe[at+gt++],Z.head&&O&&Z.length<65536&&(Z.head.name+=String.fromCharCode(O)),O&&gt<dt;);if(512&Z.flags&&(Z.check=a(Z.check,Qe,gt,at)),dt-=gt,at+=gt,O)break e}else Z.head&&(Z.head.name=null);Z.length=0,Z.mode=8;case 8:if(4096&Z.flags){if(dt===0)break e;for(gt=0;O=Qe[at+gt++],Z.head&&O&&Z.length<65536&&(Z.head.comment+=String.fromCharCode(O)),O&&gt<dt;);if(512&Z.flags&&(Z.check=a(Z.check,Qe,gt,at)),dt-=gt,at+=gt,O)break e}else Z.head&&(Z.head.comment=null);Z.mode=9;case 9:if(512&Z.flags){for(;ze<16;){if(dt===0)break e;dt--,Ue+=Qe[at++]<<ze,ze+=8}if(Ue!==(65535&Z.check)){be.msg="header crc mismatch",Z.mode=30;break}ze=Ue=0}Z.head&&(Z.head.hcrc=Z.flags>>9&1,Z.head.done=!0),be.adler=Z.check=0,Z.mode=12;break;case 10:for(;ze<32;){if(dt===0)break e;dt--,Ue+=Qe[at++]<<ze,ze+=8}be.adler=Z.check=ie(Ue),ze=Ue=0,Z.mode=11;case 11:if(Z.havedict===0)return be.next_out=Gt,be.avail_out=Ft,be.next_in=at,be.avail_in=dt,Z.hold=Ue,Z.bits=ze,2;be.adler=Z.check=1,Z.mode=12;case 12:if(Xe===5||Xe===6)break e;case 13:if(Z.last){Ue>>>=7&ze,ze-=7&ze,Z.mode=27;break}for(;ze<3;){if(dt===0)break e;dt--,Ue+=Qe[at++]<<ze,ze+=8}switch(Z.last=1&Ue,ze-=1,3&(Ue>>>=1)){case 0:Z.mode=14;break;case 1:if(ut(Z),Z.mode=20,Xe!==6)break;Ue>>>=2,ze-=2;break e;case 2:Z.mode=17;break;case 3:be.msg="invalid block type",Z.mode=30}Ue>>>=2,ze-=2;break;case 14:for(Ue>>>=7&ze,ze-=7&ze;ze<32;){if(dt===0)break e;dt--,Ue+=Qe[at++]<<ze,ze+=8}if((65535&Ue)!=(Ue>>>16^65535)){be.msg="invalid stored block lengths",Z.mode=30;break}if(Z.length=65535&Ue,ze=Ue=0,Z.mode=15,Xe===6)break e;case 15:Z.mode=16;case 16:if(gt=Z.length){if(dt<gt&&(gt=dt),Ft<gt&&(gt=Ft),gt===0)break e;k.arraySet(jt,Qe,at,gt,Gt),dt-=gt,at+=gt,Ft-=gt,Gt+=gt,Z.length-=gt;break}Z.mode=12;break;case 17:for(;ze<14;){if(dt===0)break e;dt--,Ue+=Qe[at++]<<ze,ze+=8}if(Z.nlen=257+(31&Ue),Ue>>>=5,ze-=5,Z.ndist=1+(31&Ue),Ue>>>=5,ze-=5,Z.ncode=4+(15&Ue),Ue>>>=4,ze-=4,286<Z.nlen||30<Z.ndist){be.msg="too many length or distance symbols",Z.mode=30;break}Z.have=0,Z.mode=18;case 18:for(;Z.have<Z.ncode;){for(;ze<3;){if(dt===0)break e;dt--,Ue+=Qe[at++]<<ze,ze+=8}Z.lens[it[Z.have++]]=7&Ue,Ue>>>=3,ze-=3}for(;Z.have<19;)Z.lens[it[Z.have++]]=0;if(Z.lencode=Z.lendyn,Z.lenbits=7,Ge={bits:Z.lenbits},Je=K(0,Z.lens,0,19,Z.lencode,0,Z.work,Ge),Z.lenbits=Ge.bits,Je){be.msg="invalid code lengths set",Z.mode=30;break}Z.have=0,Z.mode=19;case 19:for(;Z.have<Z.nlen+Z.ndist;){for(;Vt=(ae=Z.lencode[Ue&(1<<Z.lenbits)-1])>>>16&255,Pr=65535&ae,!((er=ae>>>24)<=ze);){if(dt===0)break e;dt--,Ue+=Qe[at++]<<ze,ze+=8}if(Pr<16)Ue>>>=er,ze-=er,Z.lens[Z.have++]=Pr;else{if(Pr===16){for(de=er+2;ze<de;){if(dt===0)break e;dt--,Ue+=Qe[at++]<<ze,ze+=8}if(Ue>>>=er,ze-=er,Z.have===0){be.msg="invalid bit length repeat",Z.mode=30;break}O=Z.lens[Z.have-1],gt=3+(3&Ue),Ue>>>=2,ze-=2}else if(Pr===17){for(de=er+3;ze<de;){if(dt===0)break e;dt--,Ue+=Qe[at++]<<ze,ze+=8}ze-=er,O=0,gt=3+(7&(Ue>>>=er)),Ue>>>=3,ze-=3}else{for(de=er+7;ze<de;){if(dt===0)break e;dt--,Ue+=Qe[at++]<<ze,ze+=8}ze-=er,O=0,gt=11+(127&(Ue>>>=er)),Ue>>>=7,ze-=7}if(Z.have+gt>Z.nlen+Z.ndist){be.msg="invalid bit length repeat",Z.mode=30;break}for(;gt--;)Z.lens[Z.have++]=O}}if(Z.mode===30)break;if(Z.lens[256]===0){be.msg="invalid code -- missing end-of-block",Z.mode=30;break}if(Z.lenbits=9,Ge={bits:Z.lenbits},Je=K(ne,Z.lens,0,Z.nlen,Z.lencode,0,Z.work,Ge),Z.lenbits=Ge.bits,Je){be.msg="invalid literal/lengths set",Z.mode=30;break}if(Z.distbits=6,Z.distcode=Z.distdyn,Ge={bits:Z.distbits},Je=K(te,Z.lens,Z.nlen,Z.ndist,Z.distcode,0,Z.work,Ge),Z.distbits=Ge.bits,Je){be.msg="invalid distances set",Z.mode=30;break}if(Z.mode=20,Xe===6)break e;case 20:Z.mode=21;case 21:if(6<=dt&&258<=Ft){be.next_out=Gt,be.avail_out=Ft,be.next_in=at,be.avail_in=dt,Z.hold=Ue,Z.bits=ze,$(be,bt),Gt=be.next_out,jt=be.output,Ft=be.avail_out,at=be.next_in,Qe=be.input,dt=be.avail_in,Ue=Z.hold,ze=Z.bits,Z.mode===12&&(Z.back=-1);break}for(Z.back=0;Vt=(ae=Z.lencode[Ue&(1<<Z.lenbits)-1])>>>16&255,Pr=65535&ae,!((er=ae>>>24)<=ze);){if(dt===0)break e;dt--,Ue+=Qe[at++]<<ze,ze+=8}if(Vt&&(240&Vt)==0){for(or=er,_i=Vt,ar=Pr;Vt=(ae=Z.lencode[ar+((Ue&(1<<or+_i)-1)>>or)])>>>16&255,Pr=65535&ae,!(or+(er=ae>>>24)<=ze);){if(dt===0)break e;dt--,Ue+=Qe[at++]<<ze,ze+=8}Ue>>>=or,ze-=or,Z.back+=or}if(Ue>>>=er,ze-=er,Z.back+=er,Z.length=Pr,Vt===0){Z.mode=26;break}if(32&Vt){Z.back=-1,Z.mode=12;break}if(64&Vt){be.msg="invalid literal/length code",Z.mode=30;break}Z.extra=15&Vt,Z.mode=22;case 22:if(Z.extra){for(de=Z.extra;ze<de;){if(dt===0)break e;dt--,Ue+=Qe[at++]<<ze,ze+=8}Z.length+=Ue&(1<<Z.extra)-1,Ue>>>=Z.extra,ze-=Z.extra,Z.back+=Z.extra}Z.was=Z.length,Z.mode=23;case 23:for(;Vt=(ae=Z.distcode[Ue&(1<<Z.distbits)-1])>>>16&255,Pr=65535&ae,!((er=ae>>>24)<=ze);){if(dt===0)break e;dt--,Ue+=Qe[at++]<<ze,ze+=8}if((240&Vt)==0){for(or=er,_i=Vt,ar=Pr;Vt=(ae=Z.distcode[ar+((Ue&(1<<or+_i)-1)>>or)])>>>16&255,Pr=65535&ae,!(or+(er=ae>>>24)<=ze);){if(dt===0)break e;dt--,Ue+=Qe[at++]<<ze,ze+=8}Ue>>>=or,ze-=or,Z.back+=or}if(Ue>>>=er,ze-=er,Z.back+=er,64&Vt){be.msg="invalid distance code",Z.mode=30;break}Z.offset=Pr,Z.extra=15&Vt,Z.mode=24;case 24:if(Z.extra){for(de=Z.extra;ze<de;){if(dt===0)break e;dt--,Ue+=Qe[at++]<<ze,ze+=8}Z.offset+=Ue&(1<<Z.extra)-1,Ue>>>=Z.extra,ze-=Z.extra,Z.back+=Z.extra}if(Z.offset>Z.dmax){be.msg="invalid distance too far back",Z.mode=30;break}Z.mode=25;case 25:if(Ft===0)break e;if(gt=bt-Ft,Z.offset>gt){if((gt=Z.offset-gt)>Z.whave&&Z.sane){be.msg="invalid distance too far back",Z.mode=30;break}fr=gt>Z.wnext?(gt-=Z.wnext,Z.wsize-gt):Z.wnext-gt,gt>Z.length&&(gt=Z.length),Dr=Z.window}else Dr=jt,fr=Gt-Z.offset,gt=Z.length;for(Ft<gt&&(gt=Ft),Ft-=gt,Z.length-=gt;jt[Gt++]=Dr[fr++],--gt;);Z.length===0&&(Z.mode=21);break;case 26:if(Ft===0)break e;jt[Gt++]=Z.length,Ft--,Z.mode=21;break;case 27:if(Z.wrap){for(;ze<32;){if(dt===0)break e;dt--,Ue|=Qe[at++]<<ze,ze+=8}if(bt-=Ft,be.total_out+=bt,Z.total+=bt,bt&&(be.adler=Z.check=Z.flags?a(Z.check,jt,bt,Gt-bt):w(Z.check,jt,bt,Gt-bt)),bt=Ft,(Z.flags?Ue:ie(Ue))!==Z.check){be.msg="incorrect data check",Z.mode=30;break}ze=Ue=0}Z.mode=28;case 28:if(Z.wrap&&Z.flags){for(;ze<32;){if(dt===0)break e;dt--,Ue+=Qe[at++]<<ze,ze+=8}if(Ue!==(4294967295&Z.total)){be.msg="incorrect length check",Z.mode=30;break}ze=Ue=0}Z.mode=29;case 29:Je=1;break e;case 30:Je=-3;break e;case 31:return-4;case 32:default:return L}return be.next_out=Gt,be.avail_out=Ft,be.next_in=at,be.avail_in=dt,Z.hold=Ue,Z.bits=ze,(Z.wsize||bt!==be.avail_out&&Z.mode<30&&(Z.mode<27||Xe!==4))&&It(be,be.output,be.next_out,bt-be.avail_out)?(Z.mode=31,-4):(Et-=be.avail_in,bt-=be.avail_out,be.total_in+=Et,be.total_out+=bt,Z.total+=bt,Z.wrap&&bt&&(be.adler=Z.check=Z.flags?a(Z.check,jt,bt,be.next_out-bt):w(Z.check,jt,bt,be.next_out-bt)),be.data_type=Z.bits+(Z.last?64:0)+(Z.mode===12?128:0)+(Z.mode===20||Z.mode===15?256:0),(Et==0&&bt===0||Xe===4)&&Je===oe&&(Je=-5),Je)},P.inflateEnd=function(be){if(!be||!be.state)return L;var Xe=be.state;return Xe.window&&(Xe.window=null),be.state=null,oe},P.inflateGetHeader=function(be,Xe){var Z;return be&&be.state?(2&(Z=be.state).wrap)==0?L:((Z.head=Xe).done=!1,oe):L},P.inflateSetDictionary=function(be,Xe){var Z,Qe=Xe.length;return be&&be.state?(Z=be.state).wrap!==0&&Z.mode!==11?L:Z.mode===11&&w(1,Xe,Qe,0)!==Z.check?-3:It(be,Xe,Qe,Qe)?(Z.mode=31,-4):(Z.havedict=1,oe):L},P.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(u,v,P){var k=u("../utils/common"),w=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],$=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],K=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];v.exports=function(ne,te,oe,L,H,q,le,ie){var ge,Te,Ae,Me,qe,He,lt,Ke,ut,It=ie.bits,be=0,Xe=0,Z=0,Qe=0,jt=0,at=0,Gt=0,dt=0,Ft=0,Ue=0,ze=null,Et=0,bt=new k.Buf16(16),gt=new k.Buf16(16),fr=null,Dr=0;for(be=0;be<=15;be++)bt[be]=0;for(Xe=0;Xe<L;Xe++)bt[te[oe+Xe]]++;for(jt=It,Qe=15;1<=Qe&&bt[Qe]===0;Qe--);if(Qe<jt&&(jt=Qe),Qe===0)return H[q++]=20971520,H[q++]=20971520,ie.bits=1,0;for(Z=1;Z<Qe&&bt[Z]===0;Z++);for(jt<Z&&(jt=Z),be=dt=1;be<=15;be++)if(dt<<=1,(dt-=bt[be])<0)return-1;if(0<dt&&(ne===0||Qe!==1))return-1;for(gt[1]=0,be=1;be<15;be++)gt[be+1]=gt[be]+bt[be];for(Xe=0;Xe<L;Xe++)te[oe+Xe]!==0&&(le[gt[te[oe+Xe]]++]=Xe);if(He=ne===0?(ze=fr=le,19):ne===1?(ze=w,Et-=257,fr=a,Dr-=257,256):(ze=$,fr=K,-1),be=Z,qe=q,Gt=Xe=Ue=0,Ae=-1,Me=(Ft=1<<(at=jt))-1,ne===1&&852<Ft||ne===2&&592<Ft)return 1;for(;;){for(lt=be-Gt,ut=le[Xe]<He?(Ke=0,le[Xe]):le[Xe]>He?(Ke=fr[Dr+le[Xe]],ze[Et+le[Xe]]):(Ke=96,0),ge=1<<be-Gt,Z=Te=1<<at;H[qe+(Ue>>Gt)+(Te-=ge)]=lt<<24|Ke<<16|ut|0,Te!==0;);for(ge=1<<be-1;Ue&ge;)ge>>=1;if(ge!==0?(Ue&=ge-1,Ue+=ge):Ue=0,Xe++,--bt[be]==0){if(be===Qe)break;be=te[oe+le[Xe]]}if(jt<be&&(Ue&Me)!==Ae){for(Gt===0&&(Gt=jt),qe+=Z,dt=1<<(at=be-Gt);at+Gt<Qe&&!((dt-=bt[at+Gt])<=0);)at++,dt<<=1;if(Ft+=1<<at,ne===1&&852<Ft||ne===2&&592<Ft)return 1;H[Ae=Ue&Me]=jt<<24|at<<16|qe-q|0}}return Ue!==0&&(H[qe+Ue]=be-Gt<<24|64<<16|0),ie.bits=jt,0}},{"../utils/common":41}],51:[function(u,v,P){v.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(u,v,P){var k=u("../utils/common"),w=0,a=1;function $(ae){for(var ke=ae.length;0<=--ke;)ae[ke]=0}var K=0,ne=29,te=256,oe=te+1+ne,L=30,H=19,q=2*oe+1,le=15,ie=16,ge=7,Te=256,Ae=16,Me=17,qe=18,He=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],lt=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Ke=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ut=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],It=new Array(2*(oe+2));$(It);var be=new Array(2*L);$(be);var Xe=new Array(512);$(Xe);var Z=new Array(256);$(Z);var Qe=new Array(ne);$(Qe);var jt,at,Gt,dt=new Array(L);function Ft(ae,ke,it,nt,Oe){this.static_tree=ae,this.extra_bits=ke,this.extra_base=it,this.elems=nt,this.max_length=Oe,this.has_stree=ae&&ae.length}function Ue(ae,ke){this.dyn_tree=ae,this.max_code=0,this.stat_desc=ke}function ze(ae){return ae<256?Xe[ae]:Xe[256+(ae>>>7)]}function Et(ae,ke){ae.pending_buf[ae.pending++]=255&ke,ae.pending_buf[ae.pending++]=ke>>>8&255}function bt(ae,ke,it){ae.bi_valid>ie-it?(ae.bi_buf|=ke<<ae.bi_valid&65535,Et(ae,ae.bi_buf),ae.bi_buf=ke>>ie-ae.bi_valid,ae.bi_valid+=it-ie):(ae.bi_buf|=ke<<ae.bi_valid&65535,ae.bi_valid+=it)}function gt(ae,ke,it){bt(ae,it[2*ke],it[2*ke+1])}function fr(ae,ke){for(var it=0;it|=1&ae,ae>>>=1,it<<=1,0<--ke;);return it>>>1}function Dr(ae,ke,it){var nt,Oe,pt=new Array(le+1),wt=0;for(nt=1;nt<=le;nt++)pt[nt]=wt=wt+it[nt-1]<<1;for(Oe=0;Oe<=ke;Oe++){var _t=ae[2*Oe+1];_t!==0&&(ae[2*Oe]=fr(pt[_t]++,_t))}}function er(ae){var ke;for(ke=0;ke<oe;ke++)ae.dyn_ltree[2*ke]=0;for(ke=0;ke<L;ke++)ae.dyn_dtree[2*ke]=0;for(ke=0;ke<H;ke++)ae.bl_tree[2*ke]=0;ae.dyn_ltree[2*Te]=1,ae.opt_len=ae.static_len=0,ae.last_lit=ae.matches=0}function Vt(ae){8<ae.bi_valid?Et(ae,ae.bi_buf):0<ae.bi_valid&&(ae.pending_buf[ae.pending++]=ae.bi_buf),ae.bi_buf=0,ae.bi_valid=0}function Pr(ae,ke,it,nt){var Oe=2*ke,pt=2*it;return ae[Oe]<ae[pt]||ae[Oe]===ae[pt]&&nt[ke]<=nt[it]}function or(ae,ke,it){for(var nt=ae.heap[it],Oe=it<<1;Oe<=ae.heap_len&&(Oe<ae.heap_len&&Pr(ke,ae.heap[Oe+1],ae.heap[Oe],ae.depth)&&Oe++,!Pr(ke,nt,ae.heap[Oe],ae.depth));)ae.heap[it]=ae.heap[Oe],it=Oe,Oe<<=1;ae.heap[it]=nt}function _i(ae,ke,it){var nt,Oe,pt,wt,_t=0;if(ae.last_lit!==0)for(;nt=ae.pending_buf[ae.d_buf+2*_t]<<8|ae.pending_buf[ae.d_buf+2*_t+1],Oe=ae.pending_buf[ae.l_buf+_t],_t++,nt===0?gt(ae,Oe,ke):(gt(ae,(pt=Z[Oe])+te+1,ke),(wt=He[pt])!==0&&bt(ae,Oe-=Qe[pt],wt),gt(ae,pt=ze(--nt),it),(wt=lt[pt])!==0&&bt(ae,nt-=dt[pt],wt)),_t<ae.last_lit;);gt(ae,Te,ke)}function ar(ae,ke){var it,nt,Oe,pt=ke.dyn_tree,wt=ke.stat_desc.static_tree,_t=ke.stat_desc.has_stree,kt=ke.stat_desc.elems,Xt=-1;for(ae.heap_len=0,ae.heap_max=q,it=0;it<kt;it++)pt[2*it]!==0?(ae.heap[++ae.heap_len]=Xt=it,ae.depth[it]=0):pt[2*it+1]=0;for(;ae.heap_len<2;)pt[2*(Oe=ae.heap[++ae.heap_len]=Xt<2?++Xt:0)]=1,ae.depth[Oe]=0,ae.opt_len--,_t&&(ae.static_len-=wt[2*Oe+1]);for(ke.max_code=Xt,it=ae.heap_len>>1;1<=it;it--)or(ae,pt,it);for(Oe=kt;it=ae.heap[1],ae.heap[1]=ae.heap[ae.heap_len--],or(ae,pt,1),nt=ae.heap[1],ae.heap[--ae.heap_max]=it,ae.heap[--ae.heap_max]=nt,pt[2*Oe]=pt[2*it]+pt[2*nt],ae.depth[Oe]=(ae.depth[it]>=ae.depth[nt]?ae.depth[it]:ae.depth[nt])+1,pt[2*it+1]=pt[2*nt+1]=Oe,ae.heap[1]=Oe++,or(ae,pt,1),2<=ae.heap_len;);ae.heap[--ae.heap_max]=ae.heap[1],function(Ut,Kr){var ln,Ur,Se,N,G,Y,ce=Kr.dyn_tree,xe=Kr.max_code,Ee=Kr.stat_desc.static_tree,Fe=Kr.stat_desc.has_stree,Pe=Kr.stat_desc.extra_bits,$e=Kr.stat_desc.extra_base,Ve=Kr.stat_desc.max_length,Ie=0;for(N=0;N<=le;N++)Ut.bl_count[N]=0;for(ce[2*Ut.heap[Ut.heap_max]+1]=0,ln=Ut.heap_max+1;ln<q;ln++)Ve<(N=ce[2*ce[2*(Ur=Ut.heap[ln])+1]+1]+1)&&(N=Ve,Ie++),ce[2*Ur+1]=N,xe<Ur||(Ut.bl_count[N]++,G=0,$e<=Ur&&(G=Pe[Ur-$e]),Y=ce[2*Ur],Ut.opt_len+=Y*(N+G),Fe&&(Ut.static_len+=Y*(Ee[2*Ur+1]+G)));if(Ie!==0){do{for(N=Ve-1;Ut.bl_count[N]===0;)N--;Ut.bl_count[N]--,Ut.bl_count[N+1]+=2,Ut.bl_count[Ve]--,Ie-=2}while(0<Ie);for(N=Ve;N!==0;N--)for(Ur=Ut.bl_count[N];Ur!==0;)xe<(Se=Ut.heap[--ln])||(ce[2*Se+1]!==N&&(Ut.opt_len+=(N-ce[2*Se+1])*ce[2*Se],ce[2*Se+1]=N),Ur--)}}(ae,ke),Dr(pt,Xt,ae.bl_count)}function O(ae,ke,it){var nt,Oe,pt=-1,wt=ke[1],_t=0,kt=7,Xt=4;for(wt===0&&(kt=138,Xt=3),ke[2*(it+1)+1]=65535,nt=0;nt<=it;nt++)Oe=wt,wt=ke[2*(nt+1)+1],++_t<kt&&Oe===wt||(_t<Xt?ae.bl_tree[2*Oe]+=_t:Oe!==0?(Oe!==pt&&ae.bl_tree[2*Oe]++,ae.bl_tree[2*Ae]++):_t<=10?ae.bl_tree[2*Me]++:ae.bl_tree[2*qe]++,pt=Oe,Xt=(_t=0)===wt?(kt=138,3):Oe===wt?(kt=6,3):(kt=7,4))}function Je(ae,ke,it){var nt,Oe,pt=-1,wt=ke[1],_t=0,kt=7,Xt=4;for(wt===0&&(kt=138,Xt=3),nt=0;nt<=it;nt++)if(Oe=wt,wt=ke[2*(nt+1)+1],!(++_t<kt&&Oe===wt)){if(_t<Xt)for(;gt(ae,Oe,ae.bl_tree),--_t!=0;);else Oe!==0?(Oe!==pt&&(gt(ae,Oe,ae.bl_tree),_t--),gt(ae,Ae,ae.bl_tree),bt(ae,_t-3,2)):_t<=10?(gt(ae,Me,ae.bl_tree),bt(ae,_t-3,3)):(gt(ae,qe,ae.bl_tree),bt(ae,_t-11,7));pt=Oe,Xt=(_t=0)===wt?(kt=138,3):Oe===wt?(kt=6,3):(kt=7,4)}}$(dt);var Ge=!1;function de(ae,ke,it,nt){bt(ae,(K<<1)+(nt?1:0),3),function(Oe,pt,wt,_t){Vt(Oe),Et(Oe,wt),Et(Oe,~wt),k.arraySet(Oe.pending_buf,Oe.window,pt,wt,Oe.pending),Oe.pending+=wt}(ae,ke,it)}P._tr_init=function(ae){Ge||(function(){var ke,it,nt,Oe,pt,wt=new Array(le+1);for(Oe=nt=0;Oe<ne-1;Oe++)for(Qe[Oe]=nt,ke=0;ke<1<<He[Oe];ke++)Z[nt++]=Oe;for(Z[nt-1]=Oe,Oe=pt=0;Oe<16;Oe++)for(dt[Oe]=pt,ke=0;ke<1<<lt[Oe];ke++)Xe[pt++]=Oe;for(pt>>=7;Oe<L;Oe++)for(dt[Oe]=pt<<7,ke=0;ke<1<<lt[Oe]-7;ke++)Xe[256+pt++]=Oe;for(it=0;it<=le;it++)wt[it]=0;for(ke=0;ke<=143;)It[2*ke+1]=8,ke++,wt[8]++;for(;ke<=255;)It[2*ke+1]=9,ke++,wt[9]++;for(;ke<=279;)It[2*ke+1]=7,ke++,wt[7]++;for(;ke<=287;)It[2*ke+1]=8,ke++,wt[8]++;for(Dr(It,oe+1,wt),ke=0;ke<L;ke++)be[2*ke+1]=5,be[2*ke]=fr(ke,5);jt=new Ft(It,He,te+1,oe,le),at=new Ft(be,lt,0,L,le),Gt=new Ft(new Array(0),Ke,0,H,ge)}(),Ge=!0),ae.l_desc=new Ue(ae.dyn_ltree,jt),ae.d_desc=new Ue(ae.dyn_dtree,at),ae.bl_desc=new Ue(ae.bl_tree,Gt),ae.bi_buf=0,ae.bi_valid=0,er(ae)},P._tr_stored_block=de,P._tr_flush_block=function(ae,ke,it,nt){var Oe,pt,wt=0;0<ae.level?(ae.strm.data_type===2&&(ae.strm.data_type=function(_t){var kt,Xt=4093624447;for(kt=0;kt<=31;kt++,Xt>>>=1)if(1&Xt&&_t.dyn_ltree[2*kt]!==0)return w;if(_t.dyn_ltree[18]!==0||_t.dyn_ltree[20]!==0||_t.dyn_ltree[26]!==0)return a;for(kt=32;kt<te;kt++)if(_t.dyn_ltree[2*kt]!==0)return a;return w}(ae)),ar(ae,ae.l_desc),ar(ae,ae.d_desc),wt=function(_t){var kt;for(O(_t,_t.dyn_ltree,_t.l_desc.max_code),O(_t,_t.dyn_dtree,_t.d_desc.max_code),ar(_t,_t.bl_desc),kt=H-1;3<=kt&&_t.bl_tree[2*ut[kt]+1]===0;kt--);return _t.opt_len+=3*(kt+1)+5+5+4,kt}(ae),Oe=ae.opt_len+3+7>>>3,(pt=ae.static_len+3+7>>>3)<=Oe&&(Oe=pt)):Oe=pt=it+5,it+4<=Oe&&ke!==-1?de(ae,ke,it,nt):ae.strategy===4||pt===Oe?(bt(ae,2+(nt?1:0),3),_i(ae,It,be)):(bt(ae,4+(nt?1:0),3),function(_t,kt,Xt,Ut){var Kr;for(bt(_t,kt-257,5),bt(_t,Xt-1,5),bt(_t,Ut-4,4),Kr=0;Kr<Ut;Kr++)bt(_t,_t.bl_tree[2*ut[Kr]+1],3);Je(_t,_t.dyn_ltree,kt-1),Je(_t,_t.dyn_dtree,Xt-1)}(ae,ae.l_desc.max_code+1,ae.d_desc.max_code+1,wt+1),_i(ae,ae.dyn_ltree,ae.dyn_dtree)),er(ae),nt&&Vt(ae)},P._tr_tally=function(ae,ke,it){return ae.pending_buf[ae.d_buf+2*ae.last_lit]=ke>>>8&255,ae.pending_buf[ae.d_buf+2*ae.last_lit+1]=255&ke,ae.pending_buf[ae.l_buf+ae.last_lit]=255&it,ae.last_lit++,ke===0?ae.dyn_ltree[2*it]++:(ae.matches++,ke--,ae.dyn_ltree[2*(Z[it]+te+1)]++,ae.dyn_dtree[2*ze(ke)]++),ae.last_lit===ae.lit_bufsize-1},P._tr_align=function(ae){bt(ae,2,3),gt(ae,Te,It),function(ke){ke.bi_valid===16?(Et(ke,ke.bi_buf),ke.bi_buf=0,ke.bi_valid=0):8<=ke.bi_valid&&(ke.pending_buf[ke.pending++]=255&ke.bi_buf,ke.bi_buf>>=8,ke.bi_valid-=8)}(ae)}},{"../utils/common":41}],53:[function(u,v,P){v.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(u,v,P){(function(k){(function(w,a){if(!w.setImmediate){var $,K,ne,te,oe=1,L={},H=!1,q=w.document,le=Object.getPrototypeOf&&Object.getPrototypeOf(w);le=le&&le.setTimeout?le:w,$={}.toString.call(w.process)==="[object process]"?function(Ae){process.nextTick(function(){ge(Ae)})}:function(){if(w.postMessage&&!w.importScripts){var Ae=!0,Me=w.onmessage;return w.onmessage=function(){Ae=!1},w.postMessage("","*"),w.onmessage=Me,Ae}}()?(te="setImmediate$"+Math.random()+"$",w.addEventListener?w.addEventListener("message",Te,!1):w.attachEvent("onmessage",Te),function(Ae){w.postMessage(te+Ae,"*")}):w.MessageChannel?((ne=new MessageChannel).port1.onmessage=function(Ae){ge(Ae.data)},function(Ae){ne.port2.postMessage(Ae)}):q&&"onreadystatechange"in q.createElement("script")?(K=q.documentElement,function(Ae){var Me=q.createElement("script");Me.onreadystatechange=function(){ge(Ae),Me.onreadystatechange=null,K.removeChild(Me),Me=null},K.appendChild(Me)}):function(Ae){setTimeout(ge,0,Ae)},le.setImmediate=function(Ae){typeof Ae!="function"&&(Ae=new Function(""+Ae));for(var Me=new Array(arguments.length-1),qe=0;qe<Me.length;qe++)Me[qe]=arguments[qe+1];var He={callback:Ae,args:Me};return L[oe]=He,$(oe),oe++},le.clearImmediate=ie}function ie(Ae){delete L[Ae]}function ge(Ae){if(H)setTimeout(ge,0,Ae);else{var Me=L[Ae];if(Me){H=!0;try{(function(qe){var He=qe.callback,lt=qe.args;switch(lt.length){case 0:He();break;case 1:He(lt[0]);break;case 2:He(lt[0],lt[1]);break;case 3:He(lt[0],lt[1],lt[2]);break;default:He.apply(a,lt)}})(Me)}finally{ie(Ae),H=!1}}}}function Te(Ae){Ae.source===w&&typeof Ae.data=="string"&&Ae.data.indexOf(te)===0&&ge(+Ae.data.slice(te.length))}})(typeof self>"u"?k===void 0?this:k:self)}).call(this,typeof su<"u"?su:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})}(jd)),jd.exports}var rv=tv();const iv=ev(rv);class nv{constructor(){sn(this,"workers",[]);sn(this,"maxWorkers",4);sn(this,"isTerminated",!1);for(let o=0;o<this.maxWorkers;o++){const u=new Worker(new URL(""+new URL("worker.xml-parser-Y450Jixa.js",import.meta.url).href,import.meta.url),{type:"module"});this.workers.push(u)}}async parseXmlFiles(o,u=!1){if(this.isTerminated)throw new Error("Parser has been terminated");return new Promise((v,P)=>{const k=new Array(o.length),w=[];let a=0,$=0;const K=()=>{this.workers.forEach(te=>{te.onmessage=null,te.onerror=null})},ne=te=>{if($>=o.length||this.isTerminated)return;const oe=$++,L={id:oe,xmlText:o[oe],seaAtZero:u};this.workers[te].postMessage(L)};this.workers.forEach((te,oe)=>{te.onmessage=L=>{if(this.isTerminated)return;const H=L.data;H.error?w.push(`Task ${H.id}: ${H.error}`):k[H.id]=H.content,a++,ne(oe),a===o.length&&(K(),w.length>0?P(new Error(`XML parsing errors: ${w.join(", ")}`)):v(k))},te.onerror=L=>{K(),P(new Error(`Worker error: ${L.message}`))}});for(let te=0;te<Math.min(this.maxWorkers,o.length);te++)ne(te)})}terminate(){this.isTerminated||(this.isTerminated=!0,this.workers.forEach(o=>{o.onmessage=null,o.onerror=null}),this.workers.forEach(o=>{try{o.terminate()}catch(u){console.warn("Error terminating worker:",u)}}),this.workers=[])}}class ps extends Error{constructor(o){super(o),this.name="DemInputXmlException"}}class sv{constructor(o,u=!1){sn(this,"xmlTexts");sn(this,"allContentList",[]);sn(this,"meshCodeList",[]);sn(this,"metaDataList",[]);sn(this,"seaAtZero");sn(this,"npArrayList",[]);sn(this,"boundsLatLng",{lower_left:{lat:0,lon:0},upper_right:{lat:0,lon:0}});this.xmlTexts=Array.isArray(o)?o:[o],this.seaAtZero=u}async contentsToArray(){console.log(`Starting parallel XML parsing with ${this.xmlTexts.length} files`);const o=new nv;try{this.allContentList=await o.parseXmlFiles(this.xmlTexts,this.seaAtZero),this.allContentList.sort((u,v)=>u.mesh_code-v.mesh_code),console.log(`Parallel XML parsing completed: ${this.allContentList.length} files processed`),this.getMetadataList(),this.storeNpArrayList(),this.storeBoundsLatLng()}catch(u){throw console.error("Error during XML parsing:",u),u}finally{try{o.terminate()}catch(u){console.warn("Error terminating parser:",u)}}}checkMeshCodes(){const o=[],u=[];for(const v of this.meshCodeList){const P=v.toString();if(P.length===6)u.push(v);else if(P.length===8)o.push(v);else throw new ps(`Incorrect Mesh code: mesh_code=${v}`)}if(o.length>0&&u.length>0)throw new ps("Mixed mesh format (2nd mesh and 3rd mesh)")}getMetadataList(){this.meshCodeList=this.allContentList.map(o=>o.mesh_code),this.checkMeshCodes(),this.metaDataList=this.allContentList.map(o=>o.meta_data)}storeBoundsLatLng(){const o=Math.min(...this.metaDataList.map(k=>k.lower_corner.lat)),u=Math.min(...this.metaDataList.map(k=>k.lower_corner.lon)),v=Math.max(...this.metaDataList.map(k=>k.upper_corner.lat)),P=Math.max(...this.metaDataList.map(k=>k.upper_corner.lon));this.boundsLatLng={lower_left:{lat:o,lon:u},upper_right:{lat:v,lon:P}}}getNpArray(o){const u=o.mesh_code,v=o.meta_data,P=o.elevation.items,k=v.grid_length.x,w=v.grid_length.y,a=Array(w).fill(null).map(()=>Array(k).fill(-9999)),$=v.start_point.x,K=v.start_point.y;let ne=0,te=$;for(let oe=K;oe<w;oe++){for(let L=te;L<k;L++){try{const H=parseFloat(P[ne]);isNaN(H)||(a[oe][L]=H)}catch{break}ne++}te=0}return{mesh_code:u,array:a}}storeNpArrayList(){this.npArrayList=this.allContentList.map(o=>this.getNpArray(o))}getAllContentList(){return this.allContentList}getMeshCodeList(){return this.meshCodeList}getMetaDataList(){return this.metaDataList}}const ov=async(_,o=!1,u)=>{var v;try{const P=[],k=[];if(Array.isArray(_)){const a=_.filter($=>$.name.toLowerCase().endsWith(".xml"));if(a.length===0)throw new ps("No XML files found in the selected files.");for(let $=0;$<a.length;$++){const K=a[$];u&&u($+1,a.length,K.name);try{const ne=await K.text();P.push(ne),k.push(K.name)}catch{throw new ps(`Failed to read XML file: ${K.name}`)}}}else if(_.name.toLowerCase().endsWith(".xml"))try{const a=await _.text();P.push(a),k.push(_.name)}catch{throw new ps(`Failed to read XML file: ${_.name}`)}else{const a=await iv.loadAsync(_);if(a.forEach(($,K)=>{!K.dir&&$.toLowerCase().endsWith(".xml")&&k.push($)}),k.length===0)throw new ps("No XML files found in the ZIP file.");for(let $=0;$<k.length;$++){const K=k[$];u&&u($+1,k.length,K);try{const ne=await((v=a.file(K))==null?void 0:v.async("string"));ne&&P.push(ne)}catch{throw new ps(`Failed to read XML file from ZIP: ${K}`)}}}const w=new sv(P,o);return await w.contentsToArray(),w}catch(P){throw P instanceof ps?P:new ps("Failed to process input files.")}};class Vd extends Error{constructor(o){super(o),this.name="GeoTiffException"}}class av{constructor(o,u){sn(this,"dem");sn(this,"onProgress");this.dem=o,this.onProgress=u}calcImageSize(){const o=this.dem.boundsLatLng,u=this.dem.getMetaDataList();if(u.length===0)throw new Vd("No metadata available");const v=u[0].pixel_size,P=Math.round(Math.abs((o.upper_right.lon-o.lower_left.lon)/v.x)),k=Math.round(Math.abs((o.upper_right.lat-o.lower_left.lat)/Math.abs(v.y)));if(P>=32e3||k>=32e3)throw new Vd(`Image size is too large: x=${P}y=${k}`);return{x:P,y:k}}combineMetaDataAndContents(){const o=this.dem.getMetaDataList(),u=this.dem.npArrayList,v=[...o].sort((w,a)=>w.mesh_code-a.mesh_code),P=[...u].sort((w,a)=>w.mesh_code-a.mesh_code),k=[];for(let w=0;w<v.length;w++){const a=v[w],$=P[w];if(a.mesh_code!==$.mesh_code)throw new Vd(`Mesh code mismatch: ${a.mesh_code} !== ${$.mesh_code}`);k.push({...a,np_array:$.array})}return k}makeDataForGeoTiff(){this.onProgress&&this.onProgress(1,4,"Calculating image size...");const o=this.calcImageSize(),{x:u,y:v}=o;this.onProgress&&this.onProgress(2,4,"Creating merged array...");const P=Array(v).fill(null).map(()=>Array(u).fill(-9999)),k=this.dem.boundsLatLng,w=(k.upper_right.lon-k.lower_left.lon)/u,a=(k.lower_left.lat-k.upper_right.lat)/v;this.onProgress&&this.onProgress(3,4,"Combining mesh data...");const $=this.combineMetaDataAndContents();for(let ne=0;ne<$.length;ne++){const te=$[ne];this.onProgress&&ne%10===0&&this.onProgress(3,4,`Processing mesh ${ne+1}/${$.length}`);const oe=te.lower_corner.lat,L=te.lower_corner.lon,H=oe-k.lower_left.lat,q=L-k.lower_left.lon,le=Math.round(q/w),ie=Math.round(H/-a),ge=te.grid_length.x,Te=te.grid_length.y,Ae=Math.max(0,v-(ie+Te)),Me=Math.min(v,Ae+Te),qe=Math.max(0,le),He=Math.min(u,qe+ge),lt=Math.max(0,ie+Te-v),Ke=Math.max(0,-le),ut=te.np_array;for(let It=Ae;It<Me;It++)for(let be=qe;be<He;be++){const Xe=lt+(It-Ae),Z=Ke+(be-qe);if(Xe<ut.length&&Z<ut[Xe].length){const Qe=ut[Xe][Z];Qe!==-9999&&(P[It][be]=Qe)}}}return this.onProgress&&this.onProgress(4,4,"Creating geo transform..."),{geoTransform:{upperLeftX:k.lower_left.lon,pixelSizeX:w,rotationX:0,upperLeftY:k.upper_right.lat,rotationY:0,pixelSizeY:a},demArray:P,imageSize:o}}getStatistics(){const o=this.makeDataForGeoTiff(),{demArray:u}=o;let v=0,P=0,k=1/0,w=-1/0,a=0;for(const $ of u)for(const K of $)K===-9999?P++:(v++,k=Math.min(k,K),w=Math.max(w,K),a+=K);return{validPixels:v,invalidPixels:P,minElevation:k===1/0?0:k,maxElevation:w===-1/0?0:w,averageElevation:v>0?a/v:0,bounds:this.dem.boundsLatLng,imageSize:o.imageSize}}}const lv=async(_,o)=>{const u=new av(_,o),v=u.makeDataForGeoTiff(),P=u.getStatistics();return{...v,statistics:P}},Mc=async()=>new Promise(_=>{const o=document.getElementById("loading");o.style.display="none",_()}),a_=()=>{const _=document.getElementById("loading");_.style.display="flex"};var hu={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.6.0/LICENSE.txt
 */var cv=hu.exports,Cm;function hv(){return Cm||(Cm=1,function(_,o){(function(u,v){_.exports=v()})(cv,function(){var u={},v={};function P(w,a,$){if(v[w]=$,w==="index"){var K="var sharedModule = {}; ("+v.shared+")(sharedModule); ("+v.worker+")(sharedModule);",ne={};return v.shared(ne),v.index(u,ne),typeof window<"u"&&u.setWorkerUrl(window.URL.createObjectURL(new Blob([K],{type:"text/javascript"}))),u}}P("shared",["exports"],function(w){function a(n,t,i,s){return new(i||(i=Promise))(function(h,f){function m(T){try{x(s.next(T))}catch(E){f(E)}}function y(T){try{x(s.throw(T))}catch(E){f(E)}}function x(T){var E;T.done?h(T.value):(E=T.value,E instanceof i?E:new i(function(I){I(E)})).then(m,y)}x((s=s.apply(n,t||[])).next())})}function $(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var K,ne;function te(){if(ne)return K;function n(t,i){this.x=t,this.y=i}return ne=1,K=n,n.prototype={clone:function(){return new n(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,i){return this.clone()._rotateAround(t,i)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var i=t.x-this.x,s=t.y-this.y;return i*i+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,i){return Math.atan2(this.x*i-this.y*t,this.x*t+this.y*i)},_matMult:function(t){var i=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=i,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var i=Math.cos(t),s=Math.sin(t),h=s*this.x+i*this.y;return this.x=i*this.x-s*this.y,this.y=h,this},_rotateAround:function(t,i){var s=Math.cos(t),h=Math.sin(t),f=i.y+h*(this.x-i.x)+s*(this.y-i.y);return this.x=i.x+s*(this.x-i.x)-h*(this.y-i.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},n.convert=function(t){return t instanceof n?t:Array.isArray(t)?new n(t[0],t[1]):t},K}typeof SuppressedError=="function"&&SuppressedError;var oe,L,H=$(te()),q=function(){if(L)return oe;function n(t,i,s,h){this.cx=3*t,this.bx=3*(s-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(h-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=i,this.p2x=s,this.p2y=h}return L=1,oe=n,n.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,i){if(i===void 0&&(i=1e-6),t<0)return 0;if(t>1)return 1;for(var s=t,h=0;h<8;h++){var f=this.sampleCurveX(s)-t;if(Math.abs(f)<i)return s;var m=this.sampleCurveDerivativeX(s);if(Math.abs(m)<1e-6)break;s-=f/m}var y=0,x=1;for(s=t,h=0;h<20&&(f=this.sampleCurveX(s),!(Math.abs(f-t)<i));h++)t>f?y=s:x=s,s=.5*(x-y)+y;return s},solve:function(t,i){return this.sampleCurveY(this.solveCurveX(t,i))}},oe}(),le=$(q);let ie,ge;function Te(){return ie==null&&(ie=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ie}function Ae(){if(ge==null&&(ge=!1,Te())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let s=0;s<5*5;s++){const h=4*s;t.fillStyle=`rgb(${h},${h+1},${h+2})`,t.fillRect(s%5,Math.floor(s/5),1,1)}const i=t.getImageData(0,0,5,5).data;for(let s=0;s<5*5*4;s++)if(s%4!=3&&i[s]!==s){ge=!0;break}}}return ge||!1}var Me=1e-6,qe=typeof Float32Array<"u"?Float32Array:Array;function He(){var n=new qe(9);return qe!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function lt(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Ke(){var n=new qe(3);return qe!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function ut(n){return Math.hypot(n[0],n[1],n[2])}function It(n,t,i){var s=new qe(3);return s[0]=n,s[1]=t,s[2]=i,s}function be(n,t,i){return n[0]=t[0]+i[0],n[1]=t[1]+i[1],n[2]=t[2]+i[2],n}function Xe(n,t,i){return n[0]=t[0]*i,n[1]=t[1]*i,n[2]=t[2]*i,n}function Z(n,t,i){var s=t[0],h=t[1],f=t[2],m=i[0],y=i[1],x=i[2];return n[0]=h*x-f*y,n[1]=f*m-s*x,n[2]=s*y-h*m,n}Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});var Qe,jt=ut;function at(n,t,i){var s=t[0],h=t[1],f=t[2],m=t[3];return n[0]=i[0]*s+i[4]*h+i[8]*f+i[12]*m,n[1]=i[1]*s+i[5]*h+i[9]*f+i[13]*m,n[2]=i[2]*s+i[6]*h+i[10]*f+i[14]*m,n[3]=i[3]*s+i[7]*h+i[11]*f+i[15]*m,n}function Gt(){var n=new qe(4);return qe!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function dt(n,t,i,s){var h=.5*Math.PI/180;t*=h,i*=h,s*=h;var f=Math.sin(t),m=Math.cos(t),y=Math.sin(i),x=Math.cos(i),T=Math.sin(s),E=Math.cos(s);return n[0]=f*x*E-m*y*T,n[1]=m*y*E+f*x*T,n[2]=m*x*T-f*y*E,n[3]=m*x*E+f*y*T,n}function Ft(){var n=new qe(2);return qe!=Float32Array&&(n[0]=0,n[1]=0),n}function Ue(n,t){var i=new qe(2);return i[0]=n,i[1]=t,i}Ke(),Qe=new qe(4),qe!=Float32Array&&(Qe[0]=0,Qe[1]=0,Qe[2]=0,Qe[3]=0),Ke(),It(1,0,0),It(0,1,0),Gt(),Gt(),He(),Ft();const ze=8192;function Et(n,t,i){return t*(ze/(n.tileSize*Math.pow(2,i-n.tileID.overscaledZ)))}function bt(n,t){return(n%t+t)%t}function gt(n,t,i){return n*(1-i)+t*i}function fr(n){if(n<=0)return 0;if(n>=1)return 1;const t=n*n,i=t*n;return 4*(n<.5?i:3*(n-t)+i-.75)}function Dr(n,t,i,s){const h=new le(n,t,i,s);return f=>h.solve(f)}const er=Dr(.25,.1,.25,1);function Vt(n,t,i){return Math.min(i,Math.max(t,n))}function Pr(n,t,i){const s=i-t,h=((n-t)%s+s)%s+t;return h===t?i:h}function or(n,...t){for(const i of t)for(const s in i)n[s]=i[s];return n}let _i=1;function ar(n,t,i){const s={};for(const h in n)s[h]=t.call(this,n[h],h,n);return s}function O(n,t,i){const s={};for(const h in n)t.call(this,n[h],h,n)&&(s[h]=n[h]);return s}function Je(n){return Array.isArray(n)?n.map(Je):typeof n=="object"&&n?ar(n,Je):n}const Ge={};function de(n){Ge[n]||(typeof console<"u"&&console.warn(n),Ge[n]=!0)}function ae(n,t,i){return(i.y-n.y)*(t.x-n.x)>(t.y-n.y)*(i.x-n.x)}function ke(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let it=null;function nt(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const Oe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function pt(n,t,i,s,h){return a(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const f=new VideoFrame(n,{timestamp:0});try{const m=f==null?void 0:f.format;if(!m||!m.startsWith("BGR")&&!m.startsWith("RGB"))throw new Error(`Unrecognized format ${m}`);const y=m.startsWith("BGR"),x=new Uint8ClampedArray(s*h*4);if(yield f.copyTo(x,function(T,E,I,D,B){const j=4*Math.max(1,0),U=(Math.max(0,I)-I)*D*4+j,X=4*D,re=Math.max(0,E),we=Math.max(0,I);return{rect:{x:re,y:we,width:Math.min(T.width,E+D)-re,height:Math.min(T.height,I+B)-we},layout:[{offset:U,stride:X}]}}(n,t,i,s,h)),y)for(let T=0;T<x.length;T+=4){const E=x[T];x[T]=x[T+2],x[T+2]=E}return x}finally{f.close()}})}let wt,_t;function kt(n,t,i,s){return n.addEventListener(t,i,s),{unsubscribe:()=>{n.removeEventListener(t,i,s)}}}function Xt(n){return n*Math.PI/180}function Ut(n){return n/Math.PI*180}const Kr={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},ln={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Ur="AbortError";function Se(){return new Error(Ur)}const N={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function G(n){return N.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}const Y="global-dispatcher";class ce extends Error{constructor(t,i,s,h){super(`AJAXError: ${i} (${t}): ${s}`),this.status=t,this.statusText=i,this.url=s,this.body=h}}const xe=()=>ke(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Ee=function(n,t){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const s=G(n.url);if(s)return s(n,t);if(ke(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:Y},t)}if(!(/^file:/.test(i=n.url)||/^file:/.test(xe())&&!/^\w+:/.test(i))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(s,h){return a(this,void 0,void 0,function*(){const f=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,cache:s.cache,referrer:xe(),signal:h.signal});let m,y;s.type!=="json"||f.headers.has("Accept")||f.headers.set("Accept","application/json");try{m=yield fetch(f)}catch(T){throw new ce(0,T.message,s.url,new Blob)}if(!m.ok){const T=yield m.blob();throw new ce(m.status,m.statusText,s.url,T)}y=s.type==="arrayBuffer"||s.type==="image"?m.arrayBuffer():s.type==="json"?m.json():m.text();const x=yield y;if(h.signal.aborted)throw Se();return{data:x,cacheControl:m.headers.get("Cache-Control"),expires:m.headers.get("Expires")}})}(n,t);if(ke(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:Y},t)}var i;return function(s,h){return new Promise((f,m)=>{var y;const x=new XMLHttpRequest;x.open(s.method||"GET",s.url,!0),s.type!=="arrayBuffer"&&s.type!=="image"||(x.responseType="arraybuffer");for(const T in s.headers)x.setRequestHeader(T,s.headers[T]);s.type==="json"&&(x.responseType="text",!((y=s.headers)===null||y===void 0)&&y.Accept||x.setRequestHeader("Accept","application/json")),x.withCredentials=s.credentials==="include",x.onerror=()=>{m(new Error(x.statusText))},x.onload=()=>{if(!h.signal.aborted)if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let T=x.response;if(s.type==="json")try{T=JSON.parse(x.response)}catch(E){return void m(E)}f({data:T,cacheControl:x.getResponseHeader("Cache-Control"),expires:x.getResponseHeader("Expires")})}else{const T=new Blob([x.response],{type:x.getResponseHeader("Content-Type")});m(new ce(x.status,x.statusText,s.url,T))}},h.signal.addEventListener("abort",()=>{x.abort(),m(Se())}),x.send(s.body)})}(n,t)};function Fe(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const t=new URL(n),i=window.location;return t.protocol===i.protocol&&t.host===i.host}function Pe(n,t,i){i[n]&&i[n].indexOf(t)!==-1||(i[n]=i[n]||[],i[n].push(t))}function $e(n,t,i){if(i&&i[n]){const s=i[n].indexOf(t);s!==-1&&i[n].splice(s,1)}}class Ve{constructor(t,i={}){or(this,i),this.type=t}}class Ie extends Ve{constructor(t,i={}){super("error",or({error:t},i))}}class Ye{on(t,i){return this._listeners=this._listeners||{},Pe(t,i,this._listeners),{unsubscribe:()=>{this.off(t,i)}}}off(t,i){return $e(t,i,this._listeners),$e(t,i,this._oneTimeListeners),this}once(t,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Pe(t,i,this._oneTimeListeners),this):new Promise(s=>this.once(t,s))}fire(t,i){typeof t=="string"&&(t=new Ve(t,i||{}));const s=t.type;if(this.listens(s)){t.target=this;const h=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const y of h)y.call(this,t);const f=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const y of f)$e(s,y,this._oneTimeListeners),y.call(this,t);const m=this._eventedParent;m&&(or(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(t))}else t instanceof Ie&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,i){return this._eventedParent=t,this._eventedParentData=i,this}}var ve={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const yt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Rt(n,t){const i={};for(const s in n)s!=="ref"&&(i[s]=n[s]);return yt.forEach(s=>{s in t&&(i[s]=t[s])}),i}function xt(n,t){if(Array.isArray(n)){if(!Array.isArray(t)||n.length!==t.length)return!1;for(let i=0;i<n.length;i++)if(!xt(n[i],t[i]))return!1;return!0}if(typeof n=="object"&&n!==null&&t!==null){if(typeof t!="object"||Object.keys(n).length!==Object.keys(t).length)return!1;for(const i in n)if(!xt(n[i],t[i]))return!1;return!0}return n===t}function Mt(n,t){n.push(t)}function Ot(n,t,i){Mt(i,{command:"addSource",args:[n,t[n]]})}function br(n,t,i){Mt(t,{command:"removeSource",args:[n]}),i[n]=!0}function ur(n,t,i,s){br(n,i,s),Ot(n,t,i)}function lr(n,t,i){let s;for(s in n[i])if(Object.prototype.hasOwnProperty.call(n[i],s)&&s!=="data"&&!xt(n[i][s],t[i][s]))return!1;for(s in t[i])if(Object.prototype.hasOwnProperty.call(t[i],s)&&s!=="data"&&!xt(n[i][s],t[i][s]))return!1;return!0}function Bt(n,t,i,s,h,f){n=n||{},t=t||{};for(const m in n)Object.prototype.hasOwnProperty.call(n,m)&&(xt(n[m],t[m])||i.push({command:f,args:[s,m,t[m],h]}));for(const m in t)Object.prototype.hasOwnProperty.call(t,m)&&!Object.prototype.hasOwnProperty.call(n,m)&&(xt(n[m],t[m])||i.push({command:f,args:[s,m,t[m],h]}))}function rr(n){return n.id}function Yr(n,t){return n[t.id]=t,n}class ct{constructor(t,i,s,h){this.message=(t?`${t}: `:"")+s,h&&(this.identifier=h),i!=null&&i.__line__&&(this.line=i.__line__)}}function ai(n,...t){for(const i of t)for(const s in i)n[s]=i[s];return n}class Tr extends Error{constructor(t,i){super(i),this.message=i,this.key=t}}class Dn{constructor(t,i=[]){this.parent=t,this.bindings={};for(const[s,h]of i)this.bindings[s]=h}concat(t){return new Dn(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Kn={kind:"null"},mt={kind:"number"},qt={kind:"string"},Wt={kind:"boolean"},Ri={kind:"color"},sa={kind:"projectionDefinition"},cn={kind:"object"},Ht={kind:"value"},vn={kind:"collator"},Yn={kind:"formatted"},jr={kind:"padding"},so={kind:"colorArray"},oo={kind:"numberArray"},bn={kind:"resolvedImage"},ao={kind:"variableAnchorOffsetCollection"};function Li(n,t){return{kind:"array",itemType:n,N:t}}function Sr(n){if(n.kind==="array"){const t=Sr(n.itemType);return typeof n.N=="number"?`array<${t}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${t}>`}return n.kind}const Hc=[Kn,mt,qt,Wt,Ri,sa,Yn,cn,Li(Ht),jr,oo,so,bn,ao];function lo(n,t){if(t.kind==="error")return null;if(n.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!lo(n.itemType,t.itemType))&&(typeof n.N!="number"||n.N===t.N))return null}else{if(n.kind===t.kind)return null;if(n.kind==="value"){for(const i of Hc)if(!lo(i,t))return null}}return`Expected ${Sr(n)} but found ${Sr(t)} instead.`}function oa(n,t){return t.some(i=>i.kind===n.kind)}function Jn(n,t){return t.some(i=>i==="null"?n===null:i==="array"?Array.isArray(n):i==="object"?n&&!Array.isArray(n)&&typeof n=="object":i===typeof n)}function Rn(n,t){return n.kind==="array"&&t.kind==="array"?n.itemType.kind===t.itemType.kind&&typeof n.N=="number":n.kind===t.kind}const Xc=.96422,Kc=.82521,Yc=4/29,vs=6/29,Jc=3*vs*vs,Qc=vs*vs*vs,co=Math.PI/180,Cu=180/Math.PI;function eh(n){return(n%=360)<0&&(n+=360),n}function bs([n,t,i,s]){let h,f;const m=fl((.2225045*(n=pl(n))+.7168786*(t=pl(t))+.0606169*(i=pl(i)))/1);n===t&&t===i?h=f=m:(h=fl((.4360747*n+.3850649*t+.1430804*i)/Xc),f=fl((.0139322*n+.0971045*t+.7141733*i)/Kc));const y=116*m-16;return[y<0?0:y,500*(h-m),200*(m-f),s]}function pl(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function fl(n){return n>Qc?Math.pow(n,1/3):n/Jc+Yc}function th([n,t,i,s]){let h=(n+16)/116,f=isNaN(t)?h:h+t/500,m=isNaN(i)?h:h-i/200;return h=1*la(h),f=Xc*la(f),m=Kc*la(m),[aa(3.1338561*f-1.6168667*h-.4906146*m),aa(-.9787684*f+1.9161415*h+.033454*m),aa(.0719453*f-.2289914*h+1.4052427*m),s]}function aa(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function la(n){return n>vs?n*n*n:Jc*(n-Yc)}const hn=Object.hasOwn||function(n,t){return Object.prototype.hasOwnProperty.call(n,t)};function Kt(n,t){return hn(n,t)?n[t]:void 0}function xn(n){return parseInt(n.padEnd(2,n),16)/255}function wn(n,t){return Qn(t?n/100:n,0,1)}function Qn(n,t,i){return Math.min(Math.max(t,n),i)}function ml(n){return!n.some(Number.isNaN)}const _l={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Ui(n,t,i){return n+i*(t-n)}function Cn(n,t,i){return n.map((s,h)=>Ui(s,t[h],i))}class Yt{constructor(t,i,s,h=1,f=!0){this.r=t,this.g=i,this.b=s,this.a=h,f||(this.r*=h,this.g*=h,this.b*=h,h||this.overwriteGetter("rgb",[t,i,s,h]))}static parse(t){if(t instanceof Yt)return t;if(typeof t!="string")return;const i=function(s){if((s=s.toLowerCase().trim())==="transparent")return[0,0,0,0];const h=Kt(_l,s);if(h){const[m,y,x]=h;return[m/255,y/255,x/255,1]}if(s.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(s)){const m=s.length<6?1:2;let y=1;return[xn(s.slice(y,y+=m)),xn(s.slice(y,y+=m)),xn(s.slice(y,y+=m)),xn(s.slice(y,y+m)||"ff")]}if(s.startsWith("rgb")){const m=s.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[y,x,T,E,I,D,B,j,U,X,re,we]=m,pe=[E||" ",B||" ",X].join("");if(pe==="  "||pe==="  /"||pe===",,"||pe===",,,"){const F=[T,D,U].join(""),W=F==="%%%"?100:F===""?255:0;if(W){const me=[Qn(+x/W,0,1),Qn(+I/W,0,1),Qn(+j/W,0,1),re?wn(+re,we):1];if(ml(me))return me}}return}}const f=s.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(f){const[m,y,x,T,E,I,D,B,j]=f,U=[x||" ",E||" ",D].join("");if(U==="  "||U==="  /"||U===",,"||U===",,,"){const X=[+y,Qn(+T,0,100),Qn(+I,0,100),B?wn(+B,j):1];if(ml(X))return function([re,we,pe,F]){function W(me){const Le=(me+re/30)%12,et=we*Math.min(pe,1-pe);return pe-et*Math.max(-1,Math.min(Le-3,9-Le,1))}return re=eh(re),we/=100,pe/=100,[W(0),W(8),W(4),F]}(X)}}}(t);return i?new Yt(...i,!1):void 0}get rgb(){const{r:t,g:i,b:s,a:h}=this,f=h||1/0;return this.overwriteGetter("rgb",[t/f,i/f,s/f,h])}get hcl(){return this.overwriteGetter("hcl",function(t){const[i,s,h,f]=bs(t),m=Math.sqrt(s*s+h*h);return[Math.round(1e4*m)?eh(Math.atan2(h,s)*Cu):NaN,m,i,f]}(this.rgb))}get lab(){return this.overwriteGetter("lab",bs(this.rgb))}overwriteGetter(t,i){return Object.defineProperty(this,t,{value:i}),i}toString(){const[t,i,s,h]=this.rgb;return`rgba(${[t,i,s].map(f=>Math.round(255*f)).join(",")},${h})`}static interpolate(t,i,s,h="rgb"){switch(h){case"rgb":{const[f,m,y,x]=Cn(t.rgb,i.rgb,s);return new Yt(f,m,y,x,!1)}case"hcl":{const[f,m,y,x]=t.hcl,[T,E,I,D]=i.hcl;let B,j;if(isNaN(f)||isNaN(T))isNaN(f)?isNaN(T)?B=NaN:(B=T,y!==1&&y!==0||(j=E)):(B=f,I!==1&&I!==0||(j=m));else{let pe=T-f;T>f&&pe>180?pe-=360:T<f&&f-T>180&&(pe+=360),B=f+s*pe}const[U,X,re,we]=function([pe,F,W,me]){return pe=isNaN(pe)?0:pe*co,th([W,Math.cos(pe)*F,Math.sin(pe)*F,me])}([B,j??Ui(m,E,s),Ui(y,I,s),Ui(x,D,s)]);return new Yt(U,X,re,we,!1)}case"lab":{const[f,m,y,x]=th(Cn(t.lab,i.lab,s));return new Yt(f,m,y,x,!1)}}}}Yt.black=new Yt(0,0,0,1),Yt.white=new Yt(1,1,1,1),Yt.transparent=new Yt(0,0,0,0),Yt.red=new Yt(1,0,0,1);class ho{constructor(t,i,s){this.sensitivity=t?i?"variant":"case":i?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,i){return this.collator.compare(t,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const ca=["bottom","center","top"];class gl{constructor(t,i,s,h,f,m){this.text=t,this.image=i,this.scale=s,this.fontStack=h,this.textColor=f,this.verticalAlign=m}}class gi{constructor(t){this.sections=t}static fromString(t){return new gi([new gl(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof gi?t:gi.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class $r{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof $r)return t;if(typeof t=="number")return new $r([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const i of t)if(typeof i!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new $r(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,i,s){return new $r(Cn(t.values,i.values,s))}}class yi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof yi)return t;if(typeof t=="number")return new yi([t]);if(Array.isArray(t)){for(const i of t)if(typeof i!="number")return;return new yi(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,i,s){return new yi(Cn(t.values,i.values,s))}}class Jr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Jr)return t;if(typeof t=="string"){const s=Yt.parse(t);return s?new Jr([s]):void 0}if(!Array.isArray(t))return;const i=[];for(const s of t){if(typeof s!="string")return;const h=Yt.parse(s);if(!h)return;i.push(h)}return new Jr(i)}toString(){return JSON.stringify(this.values)}static interpolate(t,i,s,h="rgb"){const f=[];if(t.values.length!=i.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${i.values.length}), cannot interpolate.`);for(let m=0;m<t.values.length;m++)f.push(Yt.interpolate(t.values[m],i.values[m],s,h));return new Jr(f)}}class Er extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}const ha=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class ir{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof ir)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let i=0;i<t.length;i+=2){const s=t[i],h=t[i+1];if(typeof s!="string"||!ha.has(s)||!Array.isArray(h)||h.length!==2||typeof h[0]!="number"||typeof h[1]!="number")return}return new ir(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,i,s){const h=t.values,f=i.values;if(h.length!==f.length)throw new Er(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${i.toString()}`);const m=[];for(let y=0;y<h.length;y+=2){if(h[y]!==f[y])throw new Er(`Cannot interpolate values containing mismatched anchors. from[${y}]: ${h[y]}, to[${y}]: ${f[y]}`);m.push(h[y]);const[x,T]=h[y+1],[E,I]=f[y+1];m.push([Ui(x,E,s),Ui(T,I,s)])}return new ir(m)}}class Ei{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Ei({name:t,available:!1}):null}}class Nt{constructor(t,i,s){this.from=t,this.to=i,this.transition=s}static interpolate(t,i,s){return new Nt(t,i,s)}static parse(t){return t instanceof Nt?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new Nt(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new Nt(t.from,t.to,t.transition):typeof t=="string"?new Nt(t,t,1):void 0}}function $t(n,t,i,s){return typeof n=="number"&&n>=0&&n<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof i=="number"&&i>=0&&i<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[n,t,i,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[n,t,i,s]:[n,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function es(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Nt||n instanceof Yt||n instanceof ho||n instanceof gi||n instanceof $r||n instanceof yi||n instanceof Jr||n instanceof ir||n instanceof Ei)return!0;if(Array.isArray(n)){for(const t of n)if(!es(t))return!1;return!0}if(typeof n=="object"){for(const t in n)if(!es(n[t]))return!1;return!0}return!1}function Lt(n){if(n===null)return Kn;if(typeof n=="string")return qt;if(typeof n=="boolean")return Wt;if(typeof n=="number")return mt;if(n instanceof Yt)return Ri;if(n instanceof Nt)return sa;if(n instanceof ho)return vn;if(n instanceof gi)return Yn;if(n instanceof $r)return jr;if(n instanceof yi)return oo;if(n instanceof Jr)return so;if(n instanceof ir)return ao;if(n instanceof Ei)return bn;if(Array.isArray(n)){const t=n.length;let i;for(const s of n){const h=Lt(s);if(i){if(i===h)continue;i=Ht;break}i=h}return Li(i||Ht,t)}return cn}function ts(n){const t=typeof n;return n===null?"":t==="string"||t==="number"||t==="boolean"?String(n):n instanceof Yt||n instanceof Nt||n instanceof gi||n instanceof $r||n instanceof yi||n instanceof Jr||n instanceof ir||n instanceof Ei?n.toString():JSON.stringify(n)}class xi{constructor(t,i){this.type=t,this.value=i}static parse(t,i){if(t.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!es(t[1]))return i.error("invalid value");const s=t[1];let h=Lt(s);const f=i.expectedType;return h.kind!=="array"||h.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(h=f),new xi(h,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const xs={string:qt,number:mt,boolean:Wt,object:cn};class $i{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let s,h=1;const f=t[0];if(f==="array"){let y,x;if(t.length>2){const T=t[1];if(typeof T!="string"||!(T in xs)||T==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);y=xs[T],h++}else y=Ht;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return i.error('The length argument to "array" must be a positive integer literal',2);x=t[2],h++}s=Li(y,x)}else{if(!xs[f])throw new Error(`Types doesn't contain name = ${f}`);s=xs[f]}const m=[];for(;h<t.length;h++){const y=i.parse(t[h],h,Ht);if(!y)return null;m.push(y)}return new $i(s,m)}evaluate(t){for(let i=0;i<this.args.length;i++){const s=this.args[i].evaluate(t);if(!lo(this.type,Lt(s)))return s;if(i===this.args.length-1)throw new Er(`Expected value to be of type ${Sr(this.type)}, but found ${Sr(Lt(s))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const yl={"to-boolean":Wt,"to-color":Ri,"to-number":mt,"to-string":qt};class un{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const s=t[0];if(!yl[s])throw new Error(`Can't parse ${s} as it is not part of the known types`);if((s==="to-boolean"||s==="to-string")&&t.length!==2)return i.error("Expected one argument.");const h=yl[s],f=[];for(let m=1;m<t.length;m++){const y=i.parse(t[m],m,Ht);if(!y)return null;f.push(y)}return new un(h,f)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let i,s;for(const h of this.args){if(i=h.evaluate(t),s=null,i instanceof Yt)return i;if(typeof i=="string"){const f=t.parseColor(i);if(f)return f}else if(Array.isArray(i)&&(s=i.length<3||i.length>4?`Invalid rgba value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:$t(i[0],i[1],i[2],i[3]),!s))return new Yt(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Er(s||`Could not parse color from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"padding":{let i;for(const s of this.args){i=s.evaluate(t);const h=$r.parse(i);if(h)return h}throw new Er(`Could not parse padding from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"numberArray":{let i;for(const s of this.args){i=s.evaluate(t);const h=yi.parse(i);if(h)return h}throw new Er(`Could not parse numberArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"colorArray":{let i;for(const s of this.args){i=s.evaluate(t);const h=Jr.parse(i);if(h)return h}throw new Er(`Could not parse colorArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"variableAnchorOffsetCollection":{let i;for(const s of this.args){i=s.evaluate(t);const h=ir.parse(i);if(h)return h}throw new Er(`Could not parse variableAnchorOffsetCollection from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"number":{let i=null;for(const s of this.args){if(i=s.evaluate(t),i===null)return 0;const h=Number(i);if(!isNaN(h))return h}throw new Er(`Could not convert ${JSON.stringify(i)} to number.`)}case"formatted":return gi.fromString(ts(this.args[0].evaluate(t)));case"resolvedImage":return Ei.fromString(ts(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return ts(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const rh=["Unknown","Point","LineString","Polygon"];class ih{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?rh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let i=this._parseColorCache.get(t);return i||(i=Yt.parse(t),this._parseColorCache.set(t,i)),i}}class uo{constructor(t,i,s=[],h,f=new Dn,m=[]){this.registry=t,this.path=s,this.key=s.map(y=>`[${y}]`).join(""),this.scope=f,this.errors=m,this.expectedType=h,this._isConstant=i}parse(t,i,s,h,f={}){return i?this.concat(i,s,h)._parse(t,f):this._parse(t,f)}_parse(t,i){function s(h,f,m){return m==="assert"?new $i(f,[h]):m==="coerce"?new un(f,[h]):h}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=t[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[h];if(f){let m=f.parse(t,this);if(!m)return null;if(this.expectedType){const y=this.expectedType,x=m.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||x.kind!=="value"){if(y.kind==="projectionDefinition"&&["string","array"].includes(x.kind)||["color","formatted","resolvedImage"].includes(y.kind)&&["value","string"].includes(x.kind)||["padding","numberArray"].includes(y.kind)&&["value","number","array"].includes(x.kind)||y.kind==="colorArray"&&["value","string","array"].includes(x.kind)||y.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(x.kind))m=s(m,y,i.typeAnnotation||"coerce");else if(this.checkSubtype(y,x))return null}else m=s(m,y,i.typeAnnotation||"assert")}if(!(m instanceof xi)&&m.type.kind!=="resolvedImage"&&this._isConstant(m)){const y=new ih;try{m=new xi(m.type,m.evaluate(y))}catch(x){return this.error(x.message),null}}return m}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,i,s){const h=typeof t=="number"?this.path.concat(t):this.path,f=s?this.scope.concat(s):this.scope;return new uo(this.registry,this._isConstant,h,i||null,f,this.errors)}error(t,...i){const s=`${this.key}${i.map(h=>`[${h}]`).join("")}`;this.errors.push(new Tr(s,t))}checkSubtype(t,i){const s=lo(t,i);return s&&this.error(s),s}}class po{constructor(t,i){this.type=i.type,this.bindings=[].concat(t),this.result=i}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const i of this.bindings)t(i[1]);t(this.result)}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const s=[];for(let f=1;f<t.length-1;f+=2){const m=t[f];if(typeof m!="string")return i.error(`Expected string, but found ${typeof m} instead.`,f);if(/[^a-zA-Z0-9_]/.test(m))return i.error("Variable names must contain only alphanumeric characters or '_'.",f);const y=i.parse(t[f+1],f+1);if(!y)return null;s.push([m,y])}const h=i.parse(t[t.length-1],t.length-1,i.expectedType,s);return h?new po(s,h):null}outputDefined(){return this.result.outputDefined()}}class Ki{constructor(t,i){this.type=i.type,this.name=t,this.boundExpression=i}static parse(t,i){if(t.length!==2||typeof t[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const s=t[1];return i.scope.has(s)?new Ki(s,i.scope.get(s)):i.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Qr{constructor(t,i,s){this.type=t,this.index=i,this.input=s}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const s=i.parse(t[1],1,mt),h=i.parse(t[2],2,Li(i.expectedType||Ht));return s&&h?new Qr(h.type.itemType,s,h):null}evaluate(t){const i=this.index.evaluate(t),s=this.input.evaluate(t);if(i<0)throw new Er(`Array index out of bounds: ${i} < 0.`);if(i>=s.length)throw new Er(`Array index out of bounds: ${i} > ${s.length-1}.`);if(i!==Math.floor(i))throw new Er(`Array index must be an integer, but found ${i} instead.`);return s[i]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class ws{constructor(t,i){this.type=Wt,this.needle=t,this.haystack=i}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const s=i.parse(t[1],1,Ht),h=i.parse(t[2],2,Ht);return s&&h?oa(s.type,[Wt,qt,mt,Kn,Ht])?new ws(s,h):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Sr(s.type)} instead`):null}evaluate(t){const i=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!s)return!1;if(!Jn(i,["boolean","string","number","null"]))throw new Er(`Expected first argument to be of type boolean, string, number or null, but found ${Sr(Lt(i))} instead.`);if(!Jn(s,["string","array"]))throw new Er(`Expected second argument to be of type array or string, but found ${Sr(Lt(s))} instead.`);return s.indexOf(i)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class fo{constructor(t,i,s){this.type=mt,this.needle=t,this.haystack=i,this.fromIndex=s}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const s=i.parse(t[1],1,Ht),h=i.parse(t[2],2,Ht);if(!s||!h)return null;if(!oa(s.type,[Wt,qt,mt,Kn,Ht]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Sr(s.type)} instead`);if(t.length===4){const f=i.parse(t[3],3,mt);return f?new fo(s,h,f):null}return new fo(s,h)}evaluate(t){const i=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!Jn(i,["boolean","string","number","null"]))throw new Er(`Expected first argument to be of type boolean, string, number or null, but found ${Sr(Lt(i))} instead.`);let h;if(this.fromIndex&&(h=this.fromIndex.evaluate(t)),Jn(s,["string"])){const f=s.indexOf(i,h);return f===-1?-1:[...s.slice(0,f)].length}if(Jn(s,["array"]))return s.indexOf(i,h);throw new Er(`Expected second argument to be of type array or string, but found ${Sr(Lt(s))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Cs{constructor(t,i,s,h,f,m){this.inputType=t,this.type=i,this.input=s,this.cases=h,this.outputs=f,this.otherwise=m}static parse(t,i){if(t.length<5)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return i.error("Expected an even number of arguments.");let s,h;i.expectedType&&i.expectedType.kind!=="value"&&(h=i.expectedType);const f={},m=[];for(let T=2;T<t.length-1;T+=2){let E=t[T];const I=t[T+1];Array.isArray(E)||(E=[E]);const D=i.concat(T);if(E.length===0)return D.error("Expected at least one branch label.");for(const j of E){if(typeof j!="number"&&typeof j!="string")return D.error("Branch labels must be numbers or strings.");if(typeof j=="number"&&Math.abs(j)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof j=="number"&&Math.floor(j)!==j)return D.error("Numeric branch labels must be integer values.");if(s){if(D.checkSubtype(s,Lt(j)))return null}else s=Lt(j);if(f[String(j)]!==void 0)return D.error("Branch labels must be unique.");f[String(j)]=m.length}const B=i.parse(I,T,h);if(!B)return null;h=h||B.type,m.push(B)}const y=i.parse(t[1],1,Ht);if(!y)return null;const x=i.parse(t[t.length-1],t.length-1,h);return x?y.type.kind!=="value"&&i.concat(1).checkSubtype(s,y.type)?null:new Cs(s,h,y,f,m,x):null}evaluate(t){const i=this.input.evaluate(t);return(Lt(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Zr{constructor(t,i,s){this.type=t,this.branches=i,this.otherwise=s}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return i.error("Expected an odd number of arguments.");let s;i.expectedType&&i.expectedType.kind!=="value"&&(s=i.expectedType);const h=[];for(let m=1;m<t.length-1;m+=2){const y=i.parse(t[m],m,Wt);if(!y)return null;const x=i.parse(t[m+1],m+1,s);if(!x)return null;h.push([y,x]),s=s||x.type}const f=i.parse(t[t.length-1],t.length-1,s);if(!f)return null;if(!s)throw new Error("Can't infer output type");return new Zr(s,h,f)}evaluate(t){for(const[i,s]of this.branches)if(i.evaluate(t))return s.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[i,s]of this.branches)t(i),t(s);t(this.otherwise)}outputDefined(){return this.branches.every(([t,i])=>i.outputDefined())&&this.otherwise.outputDefined()}}class mo{constructor(t,i,s,h){this.type=t,this.input=i,this.beginIndex=s,this.endIndex=h}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const s=i.parse(t[1],1,Ht),h=i.parse(t[2],2,mt);if(!s||!h)return null;if(!oa(s.type,[Li(Ht),qt,Ht]))return i.error(`Expected first argument to be of type array or string, but found ${Sr(s.type)} instead`);if(t.length===4){const f=i.parse(t[3],3,mt);return f?new mo(s.type,s,h,f):null}return new mo(s.type,s,h)}evaluate(t){const i=this.input.evaluate(t),s=this.beginIndex.evaluate(t);let h;if(this.endIndex&&(h=this.endIndex.evaluate(t)),Jn(i,["string"]))return[...i].slice(s,h).join("");if(Jn(i,["array"]))return i.slice(s,h);throw new Er(`Expected first argument to be of type array or string, but found ${Sr(Lt(i))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Ps(n,t){const i=n.length-1;let s,h,f=0,m=i,y=0;for(;f<=m;)if(y=Math.floor((f+m)/2),s=n[y],h=n[y+1],s<=t){if(y===i||t<h)return y;f=y+1}else{if(!(s>t))throw new Er("Input is not a number.");m=y-1}return 0}class Ts{constructor(t,i,s){this.type=t,this.input=i,this.labels=[],this.outputs=[];for(const[h,f]of s)this.labels.push(h),this.outputs.push(f)}static parse(t,i){if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");const s=i.parse(t[1],1,mt);if(!s)return null;const h=[];let f=null;i.expectedType&&i.expectedType.kind!=="value"&&(f=i.expectedType);for(let m=1;m<t.length;m+=2){const y=m===1?-1/0:t[m],x=t[m+1],T=m,E=m+1;if(typeof y!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(h.length&&h[h.length-1][0]>=y)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const I=i.parse(x,E,f);if(!I)return null;f=f||I.type,h.push([y,I])}return new Ts(f,s,h)}evaluate(t){const i=this.labels,s=this.outputs;if(i.length===1)return s[0].evaluate(t);const h=this.input.evaluate(t);if(h<=i[0])return s[0].evaluate(t);const f=i.length;return h>=i[f-1]?s[f-1].evaluate(t):s[Ps(i,h)].evaluate(t)}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Pu(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ln,_o,vl=function(){if(_o)return Ln;function n(t,i,s,h){this.cx=3*t,this.bx=3*(s-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(h-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=i,this.p2x=s,this.p2y=h}return _o=1,Ln=n,n.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,i){if(i===void 0&&(i=1e-6),t<0)return 0;if(t>1)return 1;for(var s=t,h=0;h<8;h++){var f=this.sampleCurveX(s)-t;if(Math.abs(f)<i)return s;var m=this.sampleCurveDerivativeX(s);if(Math.abs(m)<1e-6)break;s-=f/m}var y=0,x=1;for(s=t,h=0;h<20&&(f=this.sampleCurveX(s),!(Math.abs(f-t)<i));h++)t>f?y=s:x=s,s=.5*(x-y)+y;return s},solve:function(t,i){return this.sampleCurveY(this.solveCurveX(t,i))}},Ln}(),Tu=Pu(vl);class wi{constructor(t,i,s,h,f){this.type=t,this.operator=i,this.interpolation=s,this.input=h,this.labels=[],this.outputs=[];for(const[m,y]of f)this.labels.push(m),this.outputs.push(y)}static interpolationFactor(t,i,s,h){let f=0;if(t.name==="exponential")f=Ss(i,t.base,s,h);else if(t.name==="linear")f=Ss(i,1,s,h);else if(t.name==="cubic-bezier"){const m=t.controlPoints;f=new Tu(m[0],m[1],m[2],m[3]).solve(Ss(i,1,s,h))}return f}static parse(t,i){let[s,h,f,...m]=t;if(!Array.isArray(h)||h.length===0)return i.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const T=h[1];if(typeof T!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:T}}else{if(h[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const T=h.slice(1);if(T.length!==4||T.some(E=>typeof E!="number"||E<0||E>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:T}}}if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(f=i.parse(f,2,mt),!f)return null;const y=[];let x=null;s!=="interpolate-hcl"&&s!=="interpolate-lab"||i.expectedType==so?i.expectedType&&i.expectedType.kind!=="value"&&(x=i.expectedType):x=Ri;for(let T=0;T<m.length;T+=2){const E=m[T],I=m[T+1],D=T+3,B=T+4;if(typeof E!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(y.length&&y[y.length-1][0]>=E)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const j=i.parse(I,B,x);if(!j)return null;x=x||j.type,y.push([E,j])}return Rn(x,mt)||Rn(x,sa)||Rn(x,Ri)||Rn(x,jr)||Rn(x,oo)||Rn(x,so)||Rn(x,ao)||Rn(x,Li(mt))?new wi(x,s,h,f,y):i.error(`Type ${Sr(x)} is not interpolatable.`)}evaluate(t){const i=this.labels,s=this.outputs;if(i.length===1)return s[0].evaluate(t);const h=this.input.evaluate(t);if(h<=i[0])return s[0].evaluate(t);const f=i.length;if(h>=i[f-1])return s[f-1].evaluate(t);const m=Ps(i,h),y=wi.interpolationFactor(this.interpolation,h,i[m],i[m+1]),x=s[m].evaluate(t),T=s[m+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Ui(x,T,y);case"color":return Yt.interpolate(x,T,y);case"padding":return $r.interpolate(x,T,y);case"colorArray":return Jr.interpolate(x,T,y);case"numberArray":return yi.interpolate(x,T,y);case"variableAnchorOffsetCollection":return ir.interpolate(x,T,y);case"array":return Cn(x,T,y);case"projectionDefinition":return Nt.interpolate(x,T,y)}case"interpolate-hcl":switch(this.type.kind){case"color":return Yt.interpolate(x,T,y,"hcl");case"colorArray":return Jr.interpolate(x,T,y,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Yt.interpolate(x,T,y,"lab");case"colorArray":return Jr.interpolate(x,T,y,"lab")}}}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Ss(n,t,i,s){const h=s-i,f=n-i;return h===0?0:t===1?f/h:(Math.pow(t,f)-1)/(Math.pow(t,h)-1)}const Fi={color:Yt.interpolate,number:Ui,padding:$r.interpolate,numberArray:yi.interpolate,colorArray:Jr.interpolate,variableAnchorOffsetCollection:ir.interpolate,array:Cn};class ki{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let s=null;const h=i.expectedType;h&&h.kind!=="value"&&(s=h);const f=[];for(const y of t.slice(1)){const x=i.parse(y,1+f.length,s,void 0,{typeAnnotation:"omit"});if(!x)return null;s=s||x.type,f.push(x)}if(!s)throw new Error("No output type");const m=h&&f.some(y=>lo(h,y.type));return new ki(m?Ht:s,f)}evaluate(t){let i,s=null,h=0;for(const f of this.args)if(h++,s=f.evaluate(t),s&&s instanceof Ei&&!s.available&&(i||(i=s.name),s=null,h===this.args.length&&(s=i)),s!==null)break;return s}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function bl(n,t){return n==="=="||n==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function go(n,t,i,s){return s.compare(t,i)===0}function Es(n,t,i){const s=n!=="=="&&n!=="!=";return class l_{constructor(f,m,y){this.type=Wt,this.lhs=f,this.rhs=m,this.collator=y,this.hasUntypedArgument=f.type.kind==="value"||m.type.kind==="value"}static parse(f,m){if(f.length!==3&&f.length!==4)return m.error("Expected two or three arguments.");const y=f[0];let x=m.parse(f[1],1,Ht);if(!x)return null;if(!bl(y,x.type))return m.concat(1).error(`"${y}" comparisons are not supported for type '${Sr(x.type)}'.`);let T=m.parse(f[2],2,Ht);if(!T)return null;if(!bl(y,T.type))return m.concat(2).error(`"${y}" comparisons are not supported for type '${Sr(T.type)}'.`);if(x.type.kind!==T.type.kind&&x.type.kind!=="value"&&T.type.kind!=="value")return m.error(`Cannot compare types '${Sr(x.type)}' and '${Sr(T.type)}'.`);s&&(x.type.kind==="value"&&T.type.kind!=="value"?x=new $i(T.type,[x]):x.type.kind!=="value"&&T.type.kind==="value"&&(T=new $i(x.type,[T])));let E=null;if(f.length===4){if(x.type.kind!=="string"&&T.type.kind!=="string"&&x.type.kind!=="value"&&T.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(E=m.parse(f[3],3,vn),!E)return null}return new l_(x,T,E)}evaluate(f){const m=this.lhs.evaluate(f),y=this.rhs.evaluate(f);if(s&&this.hasUntypedArgument){const x=Lt(m),T=Lt(y);if(x.kind!==T.kind||x.kind!=="string"&&x.kind!=="number")throw new Er(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${x.kind}, ${T.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const x=Lt(m),T=Lt(y);if(x.kind!=="string"||T.kind!=="string")return t(f,m,y)}return this.collator?i(f,m,y,this.collator.evaluate(f)):t(f,m,y)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}}}const xl=Es("==",function(n,t,i){return t===i},go),Su=Es("!=",function(n,t,i){return t!==i},function(n,t,i,s){return!go(0,t,i,s)}),Eu=Es("<",function(n,t,i){return t<i},function(n,t,i,s){return s.compare(t,i)<0}),ku=Es(">",function(n,t,i){return t>i},function(n,t,i,s){return s.compare(t,i)>0}),Mu=Es("<=",function(n,t,i){return t<=i},function(n,t,i,s){return s.compare(t,i)<=0}),ua=Es(">=",function(n,t,i){return t>=i},function(n,t,i,s){return s.compare(t,i)>=0});class da{constructor(t,i,s){this.type=vn,this.locale=s,this.caseSensitive=t,this.diacriticSensitive=i}static parse(t,i){if(t.length!==2)return i.error("Expected one argument.");const s=t[1];if(typeof s!="object"||Array.isArray(s))return i.error("Collator options argument must be an object.");const h=i.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,Wt);if(!h)return null;const f=i.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,Wt);if(!f)return null;let m=null;return s.locale&&(m=i.parse(s.locale,1,qt),!m)?null:new da(h,f,m)}evaluate(t){return new ho(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class pa{constructor(t,i,s,h,f){this.type=qt,this.number=t,this.locale=i,this.currency=s,this.minFractionDigits=h,this.maxFractionDigits=f}static parse(t,i){if(t.length!==3)return i.error("Expected two arguments.");const s=i.parse(t[1],1,mt);if(!s)return null;const h=t[2];if(typeof h!="object"||Array.isArray(h))return i.error("NumberFormat options argument must be an object.");let f=null;if(h.locale&&(f=i.parse(h.locale,1,qt),!f))return null;let m=null;if(h.currency&&(m=i.parse(h.currency,1,qt),!m))return null;let y=null;if(h["min-fraction-digits"]&&(y=i.parse(h["min-fraction-digits"],1,mt),!y))return null;let x=null;return h["max-fraction-digits"]&&(x=i.parse(h["max-fraction-digits"],1,mt),!x)?null:new pa(s,f,m,y,x)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class yo{constructor(t){this.type=Yn,this.sections=t}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const s=t[1];if(!Array.isArray(s)&&typeof s=="object")return i.error("First argument must be an image or text section.");const h=[];let f=!1;for(let m=1;m<=t.length-1;++m){const y=t[m];if(f&&typeof y=="object"&&!Array.isArray(y)){f=!1;let x=null;if(y["font-scale"]&&(x=i.parse(y["font-scale"],1,mt),!x))return null;let T=null;if(y["text-font"]&&(T=i.parse(y["text-font"],1,Li(qt)),!T))return null;let E=null;if(y["text-color"]&&(E=i.parse(y["text-color"],1,Ri),!E))return null;let I=null;if(y["vertical-align"]){if(typeof y["vertical-align"]=="string"&&!ca.includes(y["vertical-align"]))return i.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${y["vertical-align"]}' instead.`);if(I=i.parse(y["vertical-align"],1,qt),!I)return null}const D=h[h.length-1];D.scale=x,D.font=T,D.textColor=E,D.verticalAlign=I}else{const x=i.parse(t[m],1,Ht);if(!x)return null;const T=x.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,h.push({content:x,scale:null,font:null,textColor:null,verticalAlign:null})}}return new yo(h)}evaluate(t){return new gi(this.sections.map(i=>{const s=i.content.evaluate(t);return Lt(s)===bn?new gl("",s,null,null,null,i.verticalAlign?i.verticalAlign.evaluate(t):null):new gl(ts(s),null,i.scale?i.scale.evaluate(t):null,i.font?i.font.evaluate(t).join(","):null,i.textColor?i.textColor.evaluate(t):null,i.verticalAlign?i.verticalAlign.evaluate(t):null)}))}eachChild(t){for(const i of this.sections)t(i.content),i.scale&&t(i.scale),i.font&&t(i.font),i.textColor&&t(i.textColor),i.verticalAlign&&t(i.verticalAlign)}outputDefined(){return!1}}class wl{constructor(t){this.type=bn,this.input=t}static parse(t,i){if(t.length!==2)return i.error("Expected two arguments.");const s=i.parse(t[1],1,qt);return s?new wl(s):i.error("No image name provided.")}evaluate(t){const i=this.input.evaluate(t),s=Ei.fromString(i);return s&&t.availableImages&&(s.available=t.availableImages.indexOf(i)>-1),s}eachChild(t){t(this.input)}outputDefined(){return!1}}class fa{constructor(t){this.type=mt,this.input=t}static parse(t,i){if(t.length!==2)return i.error(`Expected 1 argument, but found ${t.length-1} instead.`);const s=i.parse(t[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Sr(s.type)} instead.`):new fa(s):null}evaluate(t){const i=this.input.evaluate(t);if(typeof i=="string")return[...i].length;if(Array.isArray(i))return i.length;throw new Er(`Expected value to be of type string or array, but found ${Sr(Lt(i))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const dn=8192;function Iu(n,t){const i=(180+n[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,h=Math.pow(2,t.z);return[Math.round(i*h*dn),Math.round(s*h*dn)]}function Cl(n,t){const i=Math.pow(2,t.z);return[(h=(n[0]/dn+t.x)/i,360*h-180),(s=(n[1]/dn+t.y)/i,360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90)];var s,h}function vo(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function bo(n,t){return!(n[0]<=t[0]||n[2]>=t[2]||n[1]<=t[1]||n[3]>=t[3])}function nh(n,t,i){const s=n[0]-t[0],h=n[1]-t[1],f=n[0]-i[0],m=n[1]-i[1];return s*m-f*h==0&&s*f<=0&&h*m<=0}function xo(n,t,i,s){return(h=[s[0]-i[0],s[1]-i[1]])[0]*(f=[t[0]-n[0],t[1]-n[1]])[1]-h[1]*f[0]!=0&&!(!ma(n,t,i,s)||!ma(i,s,n,t));var h,f}function sh(n,t,i){for(const s of i)for(let h=0;h<s.length-1;++h)if(xo(n,t,s[h],s[h+1]))return!0;return!1}function ks(n,t,i=!1){let s=!1;for(const y of t)for(let x=0;x<y.length-1;x++){if(nh(n,y[x],y[x+1]))return i;(f=y[x])[1]>(h=n)[1]!=(m=y[x+1])[1]>h[1]&&h[0]<(m[0]-f[0])*(h[1]-f[1])/(m[1]-f[1])+f[0]&&(s=!s)}var h,f,m;return s}function Au(n,t){for(const i of t)if(ks(n,i))return!0;return!1}function oh(n,t){for(const i of n)if(!ks(i,t))return!1;for(let i=0;i<n.length-1;++i)if(sh(n[i],n[i+1],t))return!1;return!0}function zu(n,t){for(const i of t)if(oh(n,i))return!0;return!1}function ma(n,t,i,s){const h=s[0]-i[0],f=s[1]-i[1],m=(n[0]-i[0])*f-h*(n[1]-i[1]),y=(t[0]-i[0])*f-h*(t[1]-i[1]);return m>0&&y<0||m<0&&y>0}function Pl(n,t,i){const s=[];for(let h=0;h<n.length;h++){const f=[];for(let m=0;m<n[h].length;m++){const y=Iu(n[h][m],i);vo(t,y),f.push(y)}s.push(f)}return s}function ah(n,t,i){const s=[];for(let h=0;h<n.length;h++){const f=Pl(n[h],t,i);s.push(f)}return s}function lh(n,t,i,s){if(n[0]<i[0]||n[0]>i[2]){const h=.5*s;let f=n[0]-i[0]>h?-s:i[0]-n[0]>h?s:0;f===0&&(f=n[0]-i[2]>h?-s:i[2]-n[0]>h?s:0),n[0]+=f}vo(t,n)}function Tl(n,t,i,s){const h=Math.pow(2,s.z)*dn,f=[s.x*dn,s.y*dn],m=[];for(const y of n)for(const x of y){const T=[x.x+f[0],x.y+f[1]];lh(T,t,i,h),m.push(T)}return m}function Sl(n,t,i,s){const h=Math.pow(2,s.z)*dn,f=[s.x*dn,s.y*dn],m=[];for(const x of n){const T=[];for(const E of x){const I=[E.x+f[0],E.y+f[1]];vo(t,I),T.push(I)}m.push(T)}if(t[2]-t[0]<=h/2){(y=t)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const x of m)for(const T of x)lh(T,t,i,h)}var y;return m}class rs{constructor(t,i){this.type=Wt,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(es(t[1])){const s=t[1];if(s.type==="FeatureCollection"){const h=[];for(const f of s.features){const{type:m,coordinates:y}=f.geometry;m==="Polygon"&&h.push(y),m==="MultiPolygon"&&h.push(...y)}if(h.length)return new rs(s,{type:"MultiPolygon",coordinates:h})}else if(s.type==="Feature"){const h=s.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new rs(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new rs(s,s)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(i,s){const h=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(s.type==="Polygon"){const y=Pl(s.coordinates,f,m),x=Tl(i.geometry(),h,f,m);if(!bo(h,f))return!1;for(const T of x)if(!ks(T,y))return!1}if(s.type==="MultiPolygon"){const y=ah(s.coordinates,f,m),x=Tl(i.geometry(),h,f,m);if(!bo(h,f))return!1;for(const T of x)if(!Au(T,y))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(i,s){const h=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(s.type==="Polygon"){const y=Pl(s.coordinates,f,m),x=Sl(i.geometry(),h,f,m);if(!bo(h,f))return!1;for(const T of x)if(!oh(T,y))return!1}if(s.type==="MultiPolygon"){const y=ah(s.coordinates,f,m),x=Sl(i.geometry(),h,f,m);if(!bo(h,f))return!1;for(const T of x)if(!zu(T,y))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let ch=class{constructor(n=[],t=(i,s)=>i<s?-1:i>s?1:0){if(this.data=n,this.length=this.data.length,this.compare=t,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:t,compare:i}=this,s=t[n];for(;n>0;){const h=n-1>>1,f=t[h];if(i(s,f)>=0)break;t[n]=f,n=h}t[n]=s}_down(n){const{data:t,compare:i}=this,s=this.length>>1,h=t[n];for(;n<s;){let f=1+(n<<1);const m=f+1;if(m<this.length&&i(t[m],t[f])<0&&(f=m),i(t[f],h)>=0)break;t[n]=t[f],n=f}t[n]=h}};function El(n,t,i=0,s=n.length-1,h=Du){for(;s>i;){if(s-i>600){const x=s-i+1,T=t-i+1,E=Math.log(x),I=.5*Math.exp(2*E/3),D=.5*Math.sqrt(E*I*(x-I)/x)*(T-x/2<0?-1:1);El(n,t,Math.max(i,Math.floor(t-T*I/x+D)),Math.min(s,Math.floor(t+(x-T)*I/x+D)),h)}const f=n[t];let m=i,y=s;for(Ms(n,i,t),h(n[s],f)>0&&Ms(n,i,s);m<y;){for(Ms(n,m,y),m++,y--;h(n[m],f)<0;)m++;for(;h(n[y],f)>0;)y--}h(n[i],f)===0?Ms(n,i,y):(y++,Ms(n,y,s)),y<=t&&(i=y+1),t<=y&&(s=y-1)}}function Ms(n,t,i){const s=n[t];n[t]=n[i],n[i]=s}function Du(n,t){return n<t?-1:n>t?1:0}function _a(n,t){if(n.length<=1)return[n];const i=[];let s,h;for(const f of n){const m=hh(f);m!==0&&(f.area=Math.abs(m),h===void 0&&(h=m<0),h===m<0?(s&&i.push(s),s=[f]):s.push(f))}if(s&&i.push(s),t>1)for(let f=0;f<i.length;f++)i[f].length<=t||(El(i[f],t,1,i[f].length-1,Ru),i[f]=i[f].slice(0,t));return i}function Ru(n,t){return t.area-n.area}function hh(n){let t=0;for(let i,s,h=0,f=n.length,m=f-1;h<f;m=h++)i=n[h],s=n[m],t+=(s.x-i.x)*(i.y+s.y);return t}const uh=1/298.257223563,dh=uh*(2-uh),ph=Math.PI/180;class kl{constructor(t){const i=6378.137*ph*1e3,s=Math.cos(t*ph),h=1/(1-dh*(1-s*s)),f=Math.sqrt(h);this.kx=i*f*s,this.ky=i*f*h*(1-dh)}distance(t,i){const s=this.wrap(t[0]-i[0])*this.kx,h=(t[1]-i[1])*this.ky;return Math.sqrt(s*s+h*h)}pointOnLine(t,i){let s,h,f,m,y=1/0;for(let x=0;x<t.length-1;x++){let T=t[x][0],E=t[x][1],I=this.wrap(t[x+1][0]-T)*this.kx,D=(t[x+1][1]-E)*this.ky,B=0;I===0&&D===0||(B=(this.wrap(i[0]-T)*this.kx*I+(i[1]-E)*this.ky*D)/(I*I+D*D),B>1?(T=t[x+1][0],E=t[x+1][1]):B>0&&(T+=I/this.kx*B,E+=D/this.ky*B)),I=this.wrap(i[0]-T)*this.kx,D=(i[1]-E)*this.ky;const j=I*I+D*D;j<y&&(y=j,s=T,h=E,f=x,m=B)}return{point:[s,h],index:f,t:Math.max(0,Math.min(1,m))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function cr(n,t){return t[0]-n[0]}function ga(n){return n[1]-n[0]+1}function Pn(n,t){return n[1]>=n[0]&&n[1]<t}function Ml(n,t){if(n[0]>n[1])return[null,null];const i=ga(n);if(t){if(i===2)return[n,null];const h=Math.floor(i/2);return[[n[0],n[0]+h],[n[0]+h,n[1]]]}if(i===1)return[n,null];const s=Math.floor(i/2)-1;return[[n[0],n[0]+s],[n[0]+s+1,n[1]]]}function Il(n,t){if(!Pn(t,n.length))return[1/0,1/0,-1/0,-1/0];const i=[1/0,1/0,-1/0,-1/0];for(let s=t[0];s<=t[1];++s)vo(i,n[s]);return i}function Al(n){const t=[1/0,1/0,-1/0,-1/0];for(const i of n)for(const s of i)vo(t,s);return t}function fh(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function zl(n,t,i){if(!fh(n)||!fh(t))return NaN;let s=0,h=0;return n[2]<t[0]&&(s=t[0]-n[2]),n[0]>t[2]&&(s=n[0]-t[2]),n[1]>t[3]&&(h=n[1]-t[3]),n[3]<t[1]&&(h=t[1]-n[3]),i.distance([0,0],[s,h])}function is(n,t,i){const s=i.pointOnLine(t,n);return i.distance(n,s.point)}function Dl(n,t,i,s,h){const f=Math.min(is(n,[i,s],h),is(t,[i,s],h)),m=Math.min(is(i,[n,t],h),is(s,[n,t],h));return Math.min(f,m)}function Lu(n,t,i,s,h){if(!Pn(t,n.length)||!Pn(s,i.length))return 1/0;let f=1/0;for(let m=t[0];m<t[1];++m){const y=n[m],x=n[m+1];for(let T=s[0];T<s[1];++T){const E=i[T],I=i[T+1];if(xo(y,x,E,I))return 0;f=Math.min(f,Dl(y,x,E,I,h))}}return f}function Fu(n,t,i,s,h){if(!Pn(t,n.length)||!Pn(s,i.length))return NaN;let f=1/0;for(let m=t[0];m<=t[1];++m)for(let y=s[0];y<=s[1];++y)if(f=Math.min(f,h.distance(n[m],i[y])),f===0)return f;return f}function Bu(n,t,i){if(ks(n,t,!0))return 0;let s=1/0;for(const h of t){const f=h[0],m=h[h.length-1];if(f!==m&&(s=Math.min(s,is(n,[m,f],i)),s===0))return s;const y=i.pointOnLine(h,n);if(s=Math.min(s,i.distance(n,y.point)),s===0)return s}return s}function Ou(n,t,i,s){if(!Pn(t,n.length))return NaN;for(let f=t[0];f<=t[1];++f)if(ks(n[f],i,!0))return 0;let h=1/0;for(let f=t[0];f<t[1];++f){const m=n[f],y=n[f+1];for(const x of i)for(let T=0,E=x.length,I=E-1;T<E;I=T++){const D=x[I],B=x[T];if(xo(m,y,D,B))return 0;h=Math.min(h,Dl(m,y,D,B,s))}}return h}function mh(n,t){for(const i of n)for(const s of i)if(ks(s,t,!0))return!0;return!1}function ju(n,t,i,s=1/0){const h=Al(n),f=Al(t);if(s!==1/0&&zl(h,f,i)>=s)return s;if(bo(h,f)){if(mh(n,t))return 0}else if(mh(t,n))return 0;let m=1/0;for(const y of n)for(let x=0,T=y.length,E=T-1;x<T;E=x++){const I=y[E],D=y[x];for(const B of t)for(let j=0,U=B.length,X=U-1;j<U;X=j++){const re=B[X],we=B[j];if(xo(I,D,re,we))return 0;m=Math.min(m,Dl(I,D,re,we,i))}}return m}function _h(n,t,i,s,h,f){if(!f)return;const m=zl(Il(s,f),h,i);m<t&&n.push([m,f,[0,0]])}function ya(n,t,i,s,h,f,m){if(!f||!m)return;const y=zl(Il(s,f),Il(h,m),i);y<t&&n.push([y,f,m])}function va(n,t,i,s,h=1/0){let f=Math.min(s.distance(n[0],i[0][0]),h);if(f===0)return f;const m=new ch([[0,[0,n.length-1],[0,0]]],cr),y=Al(i);for(;m.length>0;){const x=m.pop();if(x[0]>=f)continue;const T=x[1],E=t?50:100;if(ga(T)<=E){if(!Pn(T,n.length))return NaN;if(t){const I=Ou(n,T,i,s);if(isNaN(I)||I===0)return I;f=Math.min(f,I)}else for(let I=T[0];I<=T[1];++I){const D=Bu(n[I],i,s);if(f=Math.min(f,D),f===0)return 0}}else{const I=Ml(T,t);_h(m,f,s,n,y,I[0]),_h(m,f,s,n,y,I[1])}}return f}function ba(n,t,i,s,h,f=1/0){let m=Math.min(f,h.distance(n[0],i[0]));if(m===0)return m;const y=new ch([[0,[0,n.length-1],[0,i.length-1]]],cr);for(;y.length>0;){const x=y.pop();if(x[0]>=m)continue;const T=x[1],E=x[2],I=t?50:100,D=s?50:100;if(ga(T)<=I&&ga(E)<=D){if(!Pn(T,n.length)&&Pn(E,i.length))return NaN;let B;if(t&&s)B=Lu(n,T,i,E,h),m=Math.min(m,B);else if(t&&!s){const j=n.slice(T[0],T[1]+1);for(let U=E[0];U<=E[1];++U)if(B=is(i[U],j,h),m=Math.min(m,B),m===0)return m}else if(!t&&s){const j=i.slice(E[0],E[1]+1);for(let U=T[0];U<=T[1];++U)if(B=is(n[U],j,h),m=Math.min(m,B),m===0)return m}else B=Fu(n,T,i,E,h),m=Math.min(m,B)}else{const B=Ml(T,t),j=Ml(E,s);ya(y,m,h,n,i,B[0],j[0]),ya(y,m,h,n,i,B[0],j[1]),ya(y,m,h,n,i,B[1],j[0]),ya(y,m,h,n,i,B[1],j[1])}}return m}function Rl(n){return n.type==="MultiPolygon"?n.coordinates.map(t=>({type:"Polygon",coordinates:t})):n.type==="MultiLineString"?n.coordinates.map(t=>({type:"LineString",coordinates:t})):n.type==="MultiPoint"?n.coordinates.map(t=>({type:"Point",coordinates:t})):[n]}class ns{constructor(t,i){this.type=mt,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(es(t[1])){const s=t[1];if(s.type==="FeatureCollection")return new ns(s,s.features.map(h=>Rl(h.geometry)).flat());if(s.type==="Feature")return new ns(s,Rl(s.geometry));if("type"in s&&"coordinates"in s)return new ns(s,Rl(s))}return i.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(i,s){const h=i.geometry(),f=h.flat().map(x=>Cl([x.x,x.y],i.canonical));if(h.length===0)return NaN;const m=new kl(f[0][1]);let y=1/0;for(const x of s){switch(x.type){case"Point":y=Math.min(y,ba(f,!1,[x.coordinates],!1,m,y));break;case"LineString":y=Math.min(y,ba(f,!1,x.coordinates,!0,m,y));break;case"Polygon":y=Math.min(y,va(f,!1,x.coordinates,m,y))}if(y===0)return y}return y}(t,this.geometries);if(t.geometryType()==="LineString")return function(i,s){const h=i.geometry(),f=h.flat().map(x=>Cl([x.x,x.y],i.canonical));if(h.length===0)return NaN;const m=new kl(f[0][1]);let y=1/0;for(const x of s){switch(x.type){case"Point":y=Math.min(y,ba(f,!0,[x.coordinates],!1,m,y));break;case"LineString":y=Math.min(y,ba(f,!0,x.coordinates,!0,m,y));break;case"Polygon":y=Math.min(y,va(f,!0,x.coordinates,m,y))}if(y===0)return y}return y}(t,this.geometries);if(t.geometryType()==="Polygon")return function(i,s){const h=i.geometry();if(h.length===0||h[0].length===0)return NaN;const f=_a(h,0).map(x=>x.map(T=>T.map(E=>Cl([E.x,E.y],i.canonical)))),m=new kl(f[0][0][0][1]);let y=1/0;for(const x of s)for(const T of f){switch(x.type){case"Point":y=Math.min(y,va([x.coordinates],!1,T,m,y));break;case"LineString":y=Math.min(y,va(x.coordinates,!0,T,m,y));break;case"Polygon":y=Math.min(y,ju(T,x.coordinates,m,y))}if(y===0)return y}return y}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class wo{constructor(t){this.type=Ht,this.key=t}static parse(t,i){if(t.length!==2)return i.error(`Expected 1 argument, but found ${t.length-1} instead.`);const s=t[1];return s==null?i.error("Global state property must be defined."):typeof s!="string"?i.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new wo(s)}evaluate(t){var i;const s=(i=t.globals)===null||i===void 0?void 0:i.globalState;return s&&Object.keys(s).length!==0?Kt(s,this.key):null}eachChild(){}outputDefined(){return!1}}const Is={"==":xl,"!=":Su,">":ku,"<":Eu,">=":ua,"<=":Mu,array:$i,at:Qr,boolean:$i,case:Zr,coalesce:ki,collator:da,format:yo,image:wl,in:ws,"index-of":fo,interpolate:wi,"interpolate-hcl":wi,"interpolate-lab":wi,length:fa,let:po,literal:xi,match:Cs,number:$i,"number-format":pa,object:$i,slice:mo,step:Ts,string:$i,"to-boolean":un,"to-color":un,"to-number":un,"to-string":un,var:Ki,within:rs,distance:ns,"global-state":wo};class Zi{constructor(t,i,s,h){this.name=t,this.type=i,this._evaluate=s,this.args=h}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,i){const s=t[0],h=Zi.definitions[s];if(!h)return i.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(h)?h[0]:h.type,m=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,y=m.filter(([T])=>!Array.isArray(T)||T.length===t.length-1);let x=null;for(const[T,E]of y){x=new uo(i.registry,xa,i.path,null,i.scope);const I=[];let D=!1;for(let B=1;B<t.length;B++){const j=t[B],U=Array.isArray(T)?T[B-1]:T.type,X=x.parse(j,1+I.length,U);if(!X){D=!0;break}I.push(X)}if(!D)if(Array.isArray(T)&&T.length!==I.length)x.error(`Expected ${T.length} arguments, but found ${I.length} instead.`);else{for(let B=0;B<I.length;B++){const j=Array.isArray(T)?T[B]:T.type,U=I[B];x.concat(B+1).checkSubtype(j,U.type)}if(x.errors.length===0)return new Zi(s,f,E,I)}}if(y.length===1)i.errors.push(...x.errors);else{const T=(y.length?y:m).map(([I])=>{return D=I,Array.isArray(D)?`(${D.map(Sr).join(", ")})`:`(${Sr(D.type)}...)`;var D}).join(" | "),E=[];for(let I=1;I<t.length;I++){const D=i.parse(t[I],1+E.length);if(!D)return null;E.push(Sr(D.type))}i.error(`Expected arguments of type ${T}, but found (${E.join(", ")}) instead.`)}return null}static register(t,i){Zi.definitions=i;for(const s in i)t[s]=Zi}}function gh(n,[t,i,s,h]){t=t.evaluate(n),i=i.evaluate(n),s=s.evaluate(n);const f=h?h.evaluate(n):1,m=$t(t,i,s,f);if(m)throw new Er(m);return new Yt(t/255,i/255,s/255,f,!1)}function yh(n,t){return n in t}function Ll(n,t){const i=t[n];return i===void 0?null:i}function ss(n){return{type:n}}function xa(n){if(n instanceof Ki)return xa(n.boundExpression);if(n instanceof Zi&&n.name==="error"||n instanceof da||n instanceof rs||n instanceof ns||n instanceof wo)return!1;const t=n instanceof un||n instanceof $i;let i=!0;return n.eachChild(s=>{i=t?i&&xa(s):i&&s instanceof xi}),!!i&&wa(n)&&As(n,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function wa(n){if(n instanceof Zi&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof rs||n instanceof ns)return!1;let t=!0;return n.eachChild(i=>{t&&!wa(i)&&(t=!1)}),t}function Co(n){if(n instanceof Zi&&n.name==="feature-state")return!1;let t=!0;return n.eachChild(i=>{t&&!Co(i)&&(t=!1)}),t}function As(n,t){if(n instanceof Zi&&t.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild(s=>{i&&!As(s,t)&&(i=!1)}),i}function vh(n){return{result:"success",value:n}}function zs(n){return{result:"error",value:n}}function Ds(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function Fl(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Bl(n){return!!n.expression&&n.expression.interpolated}function Jt(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function os(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&Lt(n)===cn}function bh(n){return n}function xh(n,t){const i=n.stops&&typeof n.stops[0][0]=="object",s=i||!(i||n.property!==void 0),h=n.type||(Bl(t)?"exponential":"interval"),f=function(E){switch(E.type){case"color":return Yt.parse;case"padding":return $r.parse;case"numberArray":return yi.parse;case"colorArray":return Jr.parse;default:return null}}(t);if(f&&((n=ai({},n)).stops&&(n.stops=n.stops.map(E=>[E[0],f(E[1])])),n.default=f(n.default?n.default:t.default)),n.colorSpace&&(m=n.colorSpace)!=="rgb"&&m!=="hcl"&&m!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var m;const y=function(E){switch(E){case"exponential":return wh;case"interval":return Nu;case"categorical":return Vu;case"identity":return Ch;default:throw new Error(`Unknown function type "${E}"`)}}(h);let x,T;if(h==="categorical"){x=Object.create(null);for(const E of n.stops)x[E[0]]=E[1];T=typeof n.stops[0][0]}if(i){const E={},I=[];for(let j=0;j<n.stops.length;j++){const U=n.stops[j],X=U[0].zoom;E[X]===void 0&&(E[X]={zoom:X,type:n.type,property:n.property,default:n.default,stops:[]},I.push(X)),E[X].stops.push([U[0].value,U[1]])}const D=[];for(const j of I)D.push([E[j].zoom,xh(E[j],t)]);const B={name:"linear"};return{kind:"composite",interpolationType:B,interpolationFactor:wi.interpolationFactor.bind(void 0,B),zoomStops:D.map(j=>j[0]),evaluate:({zoom:j},U)=>wh({stops:D,base:n.base},t,j).evaluate(j,U)}}if(s){const E=h==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:wi.interpolationFactor.bind(void 0,E),zoomStops:n.stops.map(I=>I[0]),evaluate:({zoom:I})=>y(n,t,I,x,T)}}return{kind:"source",evaluate(E,I){const D=I&&I.properties?I.properties[n.property]:void 0;return D===void 0?Po(n.default,t.default):y(n,t,D,x,T)}}}function Po(n,t,i){return n!==void 0?n:t!==void 0?t:i!==void 0?i:void 0}function Vu(n,t,i,s,h){return Po(typeof i===h?s[i]:void 0,n.default,t.default)}function Nu(n,t,i){if(Jt(i)!=="number")return Po(n.default,t.default);const s=n.stops.length;if(s===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[s-1][0])return n.stops[s-1][1];const h=Ps(n.stops.map(f=>f[0]),i);return n.stops[h][1]}function wh(n,t,i){const s=n.base!==void 0?n.base:1;if(Jt(i)!=="number")return Po(n.default,t.default);const h=n.stops.length;if(h===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[h-1][0])return n.stops[h-1][1];const f=Ps(n.stops.map(E=>E[0]),i),m=function(E,I,D,B){const j=B-D,U=E-D;return j===0?0:I===1?U/j:(Math.pow(I,U)-1)/(Math.pow(I,j)-1)}(i,s,n.stops[f][0],n.stops[f+1][0]),y=n.stops[f][1],x=n.stops[f+1][1],T=Fi[t.type]||bh;return typeof y.evaluate=="function"?{evaluate(...E){const I=y.evaluate.apply(void 0,E),D=x.evaluate.apply(void 0,E);if(I!==void 0&&D!==void 0)return T(I,D,m,n.colorSpace)}}:T(y,x,m,n.colorSpace)}function Ch(n,t,i){switch(t.type){case"color":i=Yt.parse(i);break;case"formatted":i=gi.fromString(i.toString());break;case"resolvedImage":i=Ei.fromString(i.toString());break;case"padding":i=$r.parse(i);break;case"colorArray":i=Jr.parse(i);break;case"numberArray":i=yi.parse(i);break;default:Jt(i)===t.type||t.type==="enum"&&t.values[i]||(i=void 0)}return Po(i,n.default,t.default)}Zi.register(Is,{error:[{kind:"error"},[qt],(n,[t])=>{throw new Er(t.evaluate(n))}],typeof:[qt,[Ht],(n,[t])=>Sr(Lt(t.evaluate(n)))],"to-rgba":[Li(mt,4),[Ri],(n,[t])=>{const[i,s,h,f]=t.evaluate(n).rgb;return[255*i,255*s,255*h,f]}],rgb:[Ri,[mt,mt,mt],gh],rgba:[Ri,[mt,mt,mt,mt],gh],has:{type:Wt,overloads:[[[qt],(n,[t])=>yh(t.evaluate(n),n.properties())],[[qt,cn],(n,[t,i])=>yh(t.evaluate(n),i.evaluate(n))]]},get:{type:Ht,overloads:[[[qt],(n,[t])=>Ll(t.evaluate(n),n.properties())],[[qt,cn],(n,[t,i])=>Ll(t.evaluate(n),i.evaluate(n))]]},"feature-state":[Ht,[qt],(n,[t])=>Ll(t.evaluate(n),n.featureState||{})],properties:[cn,[],n=>n.properties()],"geometry-type":[qt,[],n=>n.geometryType()],id:[Ht,[],n=>n.id()],zoom:[mt,[],n=>n.globals.zoom],"heatmap-density":[mt,[],n=>n.globals.heatmapDensity||0],elevation:[mt,[],n=>n.globals.elevation||0],"line-progress":[mt,[],n=>n.globals.lineProgress||0],accumulated:[Ht,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[mt,ss(mt),(n,t)=>{let i=0;for(const s of t)i+=s.evaluate(n);return i}],"*":[mt,ss(mt),(n,t)=>{let i=1;for(const s of t)i*=s.evaluate(n);return i}],"-":{type:mt,overloads:[[[mt,mt],(n,[t,i])=>t.evaluate(n)-i.evaluate(n)],[[mt],(n,[t])=>-t.evaluate(n)]]},"/":[mt,[mt,mt],(n,[t,i])=>t.evaluate(n)/i.evaluate(n)],"%":[mt,[mt,mt],(n,[t,i])=>t.evaluate(n)%i.evaluate(n)],ln2:[mt,[],()=>Math.LN2],pi:[mt,[],()=>Math.PI],e:[mt,[],()=>Math.E],"^":[mt,[mt,mt],(n,[t,i])=>Math.pow(t.evaluate(n),i.evaluate(n))],sqrt:[mt,[mt],(n,[t])=>Math.sqrt(t.evaluate(n))],log10:[mt,[mt],(n,[t])=>Math.log(t.evaluate(n))/Math.LN10],ln:[mt,[mt],(n,[t])=>Math.log(t.evaluate(n))],log2:[mt,[mt],(n,[t])=>Math.log(t.evaluate(n))/Math.LN2],sin:[mt,[mt],(n,[t])=>Math.sin(t.evaluate(n))],cos:[mt,[mt],(n,[t])=>Math.cos(t.evaluate(n))],tan:[mt,[mt],(n,[t])=>Math.tan(t.evaluate(n))],asin:[mt,[mt],(n,[t])=>Math.asin(t.evaluate(n))],acos:[mt,[mt],(n,[t])=>Math.acos(t.evaluate(n))],atan:[mt,[mt],(n,[t])=>Math.atan(t.evaluate(n))],min:[mt,ss(mt),(n,t)=>Math.min(...t.map(i=>i.evaluate(n)))],max:[mt,ss(mt),(n,t)=>Math.max(...t.map(i=>i.evaluate(n)))],abs:[mt,[mt],(n,[t])=>Math.abs(t.evaluate(n))],round:[mt,[mt],(n,[t])=>{const i=t.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[mt,[mt],(n,[t])=>Math.floor(t.evaluate(n))],ceil:[mt,[mt],(n,[t])=>Math.ceil(t.evaluate(n))],"filter-==":[Wt,[qt,Ht],(n,[t,i])=>n.properties()[t.value]===i.value],"filter-id-==":[Wt,[Ht],(n,[t])=>n.id()===t.value],"filter-type-==":[Wt,[qt],(n,[t])=>n.geometryType()===t.value],"filter-<":[Wt,[qt,Ht],(n,[t,i])=>{const s=n.properties()[t.value],h=i.value;return typeof s==typeof h&&s<h}],"filter-id-<":[Wt,[Ht],(n,[t])=>{const i=n.id(),s=t.value;return typeof i==typeof s&&i<s}],"filter->":[Wt,[qt,Ht],(n,[t,i])=>{const s=n.properties()[t.value],h=i.value;return typeof s==typeof h&&s>h}],"filter-id->":[Wt,[Ht],(n,[t])=>{const i=n.id(),s=t.value;return typeof i==typeof s&&i>s}],"filter-<=":[Wt,[qt,Ht],(n,[t,i])=>{const s=n.properties()[t.value],h=i.value;return typeof s==typeof h&&s<=h}],"filter-id-<=":[Wt,[Ht],(n,[t])=>{const i=n.id(),s=t.value;return typeof i==typeof s&&i<=s}],"filter->=":[Wt,[qt,Ht],(n,[t,i])=>{const s=n.properties()[t.value],h=i.value;return typeof s==typeof h&&s>=h}],"filter-id->=":[Wt,[Ht],(n,[t])=>{const i=n.id(),s=t.value;return typeof i==typeof s&&i>=s}],"filter-has":[Wt,[Ht],(n,[t])=>t.value in n.properties()],"filter-has-id":[Wt,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Wt,[Li(qt)],(n,[t])=>t.value.indexOf(n.geometryType())>=0],"filter-id-in":[Wt,[Li(Ht)],(n,[t])=>t.value.indexOf(n.id())>=0],"filter-in-small":[Wt,[qt,Li(Ht)],(n,[t,i])=>i.value.indexOf(n.properties()[t.value])>=0],"filter-in-large":[Wt,[qt,Li(Ht)],(n,[t,i])=>function(s,h,f,m){for(;f<=m;){const y=f+m>>1;if(h[y]===s)return!0;h[y]>s?m=y-1:f=y+1}return!1}(n.properties()[t.value],i.value,0,i.value.length-1)],all:{type:Wt,overloads:[[[Wt,Wt],(n,[t,i])=>t.evaluate(n)&&i.evaluate(n)],[ss(Wt),(n,t)=>{for(const i of t)if(!i.evaluate(n))return!1;return!0}]]},any:{type:Wt,overloads:[[[Wt,Wt],(n,[t,i])=>t.evaluate(n)||i.evaluate(n)],[ss(Wt),(n,t)=>{for(const i of t)if(i.evaluate(n))return!0;return!1}]]},"!":[Wt,[Wt],(n,[t])=>!t.evaluate(n)],"is-supported-script":[Wt,[qt],(n,[t])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(t.evaluate(n))}],upcase:[qt,[qt],(n,[t])=>t.evaluate(n).toUpperCase()],downcase:[qt,[qt],(n,[t])=>t.evaluate(n).toLowerCase()],concat:[qt,ss(Ht),(n,t)=>t.map(i=>ts(i.evaluate(n))).join("")],"resolved-locale":[qt,[vn],(n,[t])=>t.evaluate(n).resolvedLocale()]});class Ca{constructor(t,i){this.expression=t,this._warningHistory={},this._evaluator=new ih,this._defaultValue=i?function(s){if(s.type==="color"&&os(s.default))return new Yt(0,0,0,0);switch(s.type){case"color":return Yt.parse(s.default)||null;case"padding":return $r.parse(s.default)||null;case"numberArray":return yi.parse(s.default)||null;case"colorArray":return Jr.parse(s.default)||null;case"variableAnchorOffsetCollection":return ir.parse(s.default)||null;case"projectionDefinition":return Nt.parse(s.default)||null;default:return s.default===void 0?null:s.default}}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(t,i,s,h,f,m){return this._evaluator.globals=t,this._evaluator.feature=i,this._evaluator.featureState=s,this._evaluator.canonical=h,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m,this.expression.evaluate(this._evaluator)}evaluate(t,i,s,h,f,m){this._evaluator.globals=t,this._evaluator.feature=i||null,this._evaluator.featureState=s||null,this._evaluator.canonical=h,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m||null;try{const y=this.expression.evaluate(this._evaluator);if(y==null||typeof y=="number"&&y!=y)return this._defaultValue;if(this._enumValues&&!(y in this._enumValues))throw new Er(`Expected value to be one of ${Object.keys(this._enumValues).map(x=>JSON.stringify(x)).join(", ")}, but found ${JSON.stringify(y)} instead.`);return y}catch(y){return this._warningHistory[y.message]||(this._warningHistory[y.message]=!0,typeof console<"u"&&console.warn(y.message)),this._defaultValue}}}function Pa(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Is}function Ta(n,t){const i=new uo(Is,xa,[],t?function(h){const f={color:Ri,string:qt,number:mt,enum:qt,boolean:Wt,formatted:Yn,padding:jr,numberArray:oo,colorArray:so,projectionDefinition:sa,resolvedImage:bn,variableAnchorOffsetCollection:ao};return h.type==="array"?Li(f[h.value]||Ht,h.length):f[h.type]}(t):void 0),s=i.parse(n,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?vh(new Ca(s,t)):zs(i.errors)}class To{constructor(t,i){this.kind=t,this._styleExpression=i,this.isStateDependent=t!=="constant"&&!Co(i.expression),this.globalStateRefs=Ls(i.expression)}evaluateWithoutErrorHandling(t,i,s,h,f,m){return this._styleExpression.evaluateWithoutErrorHandling(t,i,s,h,f,m)}evaluate(t,i,s,h,f,m){return this._styleExpression.evaluate(t,i,s,h,f,m)}}class Sa{constructor(t,i,s,h){this.kind=t,this.zoomStops=s,this._styleExpression=i,this.isStateDependent=t!=="camera"&&!Co(i.expression),this.globalStateRefs=Ls(i.expression),this.interpolationType=h}evaluateWithoutErrorHandling(t,i,s,h,f,m){return this._styleExpression.evaluateWithoutErrorHandling(t,i,s,h,f,m)}evaluate(t,i,s,h,f,m){return this._styleExpression.evaluate(t,i,s,h,f,m)}interpolationFactor(t,i,s){return this.interpolationType?wi.interpolationFactor(this.interpolationType,t,i,s):0}}function Ol(n,t){const i=Ta(n,t);if(i.result==="error")return i;const s=i.value.expression,h=wa(s);if(!h&&!Ds(t))return zs([new Tr("","data expressions not supported")]);const f=As(s,["zoom"]);if(!f&&!Fl(t))return zs([new Tr("","zoom expressions not supported")]);const m=Rs(s);return m||f?m instanceof Tr?zs([m]):m instanceof wi&&!Bl(t)?zs([new Tr("",'"interpolate" expressions cannot be used with this property')]):vh(m?new Sa(h?"camera":"composite",i.value,m.labels,m instanceof wi?m.interpolation:void 0):new To(h?"constant":"source",i.value)):zs([new Tr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class So{constructor(t,i){this._parameters=t,this._specification=i,ai(this,xh(this._parameters,this._specification))}static deserialize(t){return new So(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Rs(n){let t=null;if(n instanceof po)t=Rs(n.result);else if(n instanceof ki){for(const i of n.args)if(t=Rs(i),t)break}else(n instanceof Ts||n instanceof wi)&&n.input instanceof Zi&&n.input.name==="zoom"&&(t=n);return t instanceof Tr||n.eachChild(i=>{const s=Rs(i);s instanceof Tr?t=s:!t&&s?t=new Tr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&s&&t!==s&&(t=new Tr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Ls(n,t=new Set){return n instanceof wo&&t.add(n.key),n.eachChild(i=>{Ls(i,t)}),t}function Eo(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const t of n.slice(1))if(!Eo(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const jl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Fn(n){if(n==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Eo(n)||(n=Ea(n));const t=Ta(n,jl);if(t.result==="error")throw new Error(t.value.map(i=>`${i.key}: ${i.message}`).join(", "));return{filter:(i,s,h)=>t.value.evaluate(i,s,{},h),needGeometry:Ph(n),getGlobalStateRefs:()=>Ls(t.value.expression)}}function Uu(n,t){return n<t?-1:n>t?1:0}function Ph(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let t=1;t<n.length;t++)if(Ph(n[t]))return!0;return!1}function Ea(n){if(!n)return!0;const t=n[0];return n.length<=1?t!=="any":t==="=="?Vl(n[1],n[2],"=="):t==="!="?ko(Vl(n[1],n[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Vl(n[1],n[2],t):t==="any"?(i=n.slice(1),["any"].concat(i.map(Ea))):t==="all"?["all"].concat(n.slice(1).map(Ea)):t==="none"?["all"].concat(n.slice(1).map(Ea).map(ko)):t==="in"?Th(n[1],n.slice(2)):t==="!in"?ko(Th(n[1],n.slice(2))):t==="has"?Sh(n[1]):t!=="!has"||ko(Sh(n[1]));var i}function Vl(n,t,i){switch(n){case"$type":return[`filter-type-${i}`,t];case"$id":return[`filter-id-${i}`,t];default:return[`filter-${i}`,n,t]}}function Th(n,t){if(t.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(i=>typeof i!=typeof t[0])?["filter-in-large",n,["literal",t.sort(Uu)]]:["filter-in-small",n,["literal",t]]}}function Sh(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function ko(n){return["!",n]}function ka(n){const t=typeof n;if(t==="number"||t==="boolean"||t==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let h="[";for(const f of n)h+=`${ka(f)},`;return`${h}]`}const i=Object.keys(n).sort();let s="{";for(let h=0;h<i.length;h++)s+=`${JSON.stringify(i[h])}:${ka(n[i[h]])},`;return`${s}}`}function Ma(n){let t="";for(const i of yt)t+=`/${ka(n[i])}`;return t}function Eh(n){const t=n.value;return t?[new ct(n.key,t,"constants have been deprecated as of v8")]:[]}function Rr(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Bn(n){if(Array.isArray(n))return n.map(Bn);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const t={};for(const i in n)t[i]=Bn(n[i]);return t}return Rr(n)}function Gi(n){const t=n.key,i=n.value,s=n.valueSpec||{},h=n.objectElementValidators||{},f=n.style,m=n.styleSpec,y=n.validateSpec;let x=[];const T=Jt(i);if(T!=="object")return[new ct(t,i,`object expected, ${T} found`)];for(const E in i){const I=E.split(".")[0],D=Kt(s,I)||s["*"];let B;if(Kt(h,I))B=h[I];else if(Kt(s,I))B=y;else if(h["*"])B=h["*"];else{if(!s["*"]){x.push(new ct(t,i[E],`unknown property "${E}"`));continue}B=y}x=x.concat(B({key:(t&&`${t}.`)+E,value:i[E],valueSpec:D,style:f,styleSpec:m,object:i,objectKey:E,validateSpec:y},i))}for(const E in s)h[E]||s[E].required&&s[E].default===void 0&&i[E]===void 0&&x.push(new ct(t,i,`missing required property "${E}"`));return x}function Ia(n){const t=n.value,i=n.valueSpec,s=n.style,h=n.styleSpec,f=n.key,m=n.arrayElementValidator||n.validateSpec;if(Jt(t)!=="array")return[new ct(f,t,`array expected, ${Jt(t)} found`)];if(i.length&&t.length!==i.length)return[new ct(f,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new ct(f,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let y={type:i.value,values:i.values};h.$version<7&&(y.function=i.function),Jt(i.value)==="object"&&(y=i.value);let x=[];for(let T=0;T<t.length;T++)x=x.concat(m({array:t,arrayIndex:T,value:t[T],valueSpec:y,validateSpec:n.validateSpec,style:s,styleSpec:h,key:`${f}[${T}]`}));return x}function Mo(n){const t=n.key,i=n.value,s=n.valueSpec;let h=Jt(i);return h==="number"&&i!=i&&(h="NaN"),h!=="number"?[new ct(t,i,`number expected, ${h} found`)]:"minimum"in s&&i<s.minimum?[new ct(t,i,`${i} is less than the minimum value ${s.minimum}`)]:"maximum"in s&&i>s.maximum?[new ct(t,i,`${i} is greater than the maximum value ${s.maximum}`)]:[]}function Fs(n){const t=n.valueSpec,i=Rr(n.value.type);let s,h,f,m={};const y=i!=="categorical"&&n.value.property===void 0,x=!y,T=Jt(n.value.stops)==="array"&&Jt(n.value.stops[0])==="array"&&Jt(n.value.stops[0][0])==="object",E=Gi({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(B){if(i==="identity")return[new ct(B.key,B.value,'identity function may not have a "stops" property')];let j=[];const U=B.value;return j=j.concat(Ia({key:B.key,value:U,valueSpec:B.valueSpec,validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:I})),Jt(U)==="array"&&U.length===0&&j.push(new ct(B.key,U,"array must have at least one stop")),j},default:function(B){return B.validateSpec({key:B.key,value:B.value,valueSpec:t,validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec})}}});return i==="identity"&&y&&E.push(new ct(n.key,n.value,'missing required property "property"')),i==="identity"||n.value.stops||E.push(new ct(n.key,n.value,'missing required property "stops"')),i==="exponential"&&n.valueSpec.expression&&!Bl(n.valueSpec)&&E.push(new ct(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(x&&!Ds(n.valueSpec)?E.push(new ct(n.key,n.value,"property functions not supported")):y&&!Fl(n.valueSpec)&&E.push(new ct(n.key,n.value,"zoom functions not supported"))),i!=="categorical"&&!T||n.value.property!==void 0||E.push(new ct(n.key,n.value,'"property" property is required')),E;function I(B){let j=[];const U=B.value,X=B.key;if(Jt(U)!=="array")return[new ct(X,U,`array expected, ${Jt(U)} found`)];if(U.length!==2)return[new ct(X,U,`array length 2 expected, length ${U.length} found`)];if(T){if(Jt(U[0])!=="object")return[new ct(X,U,`object expected, ${Jt(U[0])} found`)];if(U[0].zoom===void 0)return[new ct(X,U,"object stop key must have zoom")];if(U[0].value===void 0)return[new ct(X,U,"object stop key must have value")];if(f&&f>Rr(U[0].zoom))return[new ct(X,U[0].zoom,"stop zoom values must appear in ascending order")];Rr(U[0].zoom)!==f&&(f=Rr(U[0].zoom),h=void 0,m={}),j=j.concat(Gi({key:`${X}[0]`,value:U[0],valueSpec:{zoom:{}},validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:Mo,value:D}}))}else j=j.concat(D({key:`${X}[0]`,value:U[0],validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec},U));return Pa(Bn(U[1]))?j.concat([new ct(`${X}[1]`,U[1],"expressions are not allowed in function stops.")]):j.concat(B.validateSpec({key:`${X}[1]`,value:U[1],valueSpec:t,validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec}))}function D(B,j){const U=Jt(B.value),X=Rr(B.value),re=B.value!==null?B.value:j;if(s){if(U!==s)return[new ct(B.key,re,`${U} stop domain type must match previous stop domain type ${s}`)]}else s=U;if(U!=="number"&&U!=="string"&&U!=="boolean")return[new ct(B.key,re,"stop domain value must be a number, string, or boolean")];if(U!=="number"&&i!=="categorical"){let we=`number expected, ${U} found`;return Ds(t)&&i===void 0&&(we+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ct(B.key,re,we)]}return i!=="categorical"||U!=="number"||isFinite(X)&&Math.floor(X)===X?i!=="categorical"&&U==="number"&&h!==void 0&&X<h?[new ct(B.key,re,"stop domain values must appear in ascending order")]:(h=X,i==="categorical"&&X in m?[new ct(B.key,re,"stop domain values must be unique")]:(m[X]=!0,[])):[new ct(B.key,re,`integer expected, found ${X}`)]}}function Bs(n){const t=(n.expressionContext==="property"?Ol:Ta)(Bn(n.value),n.valueSpec);if(t.result==="error")return t.value.map(s=>new ct(`${n.key}${s.key}`,n.value,s.message));const i=t.value.expression||t.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!i.outputDefined())return[new ct(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!Co(i))return[new ct(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!Co(i))return[new ct(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!As(i,["zoom","feature-state"]))return[new ct(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!wa(i))return[new ct(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Nl(n){const t=n.key,i=n.value,s=Jt(i);return s!=="string"?[new ct(t,i,`color expected, ${s} found`)]:Yt.parse(String(i))?[]:[new ct(t,i,`color expected, "${i}" found`)]}function Io(n){const t=n.key,i=n.value,s=n.valueSpec,h=[];return Array.isArray(s.values)?s.values.indexOf(Rr(i))===-1&&h.push(new ct(t,i,`expected one of [${s.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(s.values).indexOf(Rr(i))===-1&&h.push(new ct(t,i,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(i)} found`)),h}function Ul(n){return Eo(Bn(n.value))?Bs(ai({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):kh(n)}function kh(n){const t=n.value,i=n.key;if(Jt(t)!=="array")return[new ct(i,t,`array expected, ${Jt(t)} found`)];const s=n.styleSpec;let h,f=[];if(t.length<1)return[new ct(i,t,"filter array must have at least 1 element")];switch(f=f.concat(Io({key:`${i}[0]`,value:t[0],valueSpec:s.filter_operator,style:n.style,styleSpec:n.styleSpec})),Rr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Rr(t[1])==="$type"&&f.push(new ct(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&f.push(new ct(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(h=Jt(t[1]),h!=="string"&&f.push(new ct(`${i}[1]`,t[1],`string expected, ${h} found`)));for(let m=2;m<t.length;m++)h=Jt(t[m]),Rr(t[1])==="$type"?f=f.concat(Io({key:`${i}[${m}]`,value:t[m],valueSpec:s.geometry_type,style:n.style,styleSpec:n.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&f.push(new ct(`${i}[${m}]`,t[m],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let m=1;m<t.length;m++)f=f.concat(kh({key:`${i}[${m}]`,value:t[m],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":h=Jt(t[1]),t.length!==2?f.push(new ct(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):h!=="string"&&f.push(new ct(`${i}[1]`,t[1],`string expected, ${h} found`))}return f}function Mh(n,t){const i=n.key,s=n.validateSpec,h=n.style,f=n.styleSpec,m=n.value,y=n.objectKey,x=f[`${t}_${n.layerType}`];if(!x)return[];const T=y.match(/^(.*)-transition$/);if(t==="paint"&&T&&x[T[1]]&&x[T[1]].transition)return s({key:i,value:m,valueSpec:f.transition,style:h,styleSpec:f});const E=n.valueSpec||x[y];if(!E)return[new ct(i,m,`unknown property "${y}"`)];let I;if(Jt(m)==="string"&&Ds(E)&&!E.tokens&&(I=/^{([^}]+)}$/.exec(m)))return[new ct(i,m,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(I[1])} }\`.`)];const D=[];return n.layerType==="symbol"&&(y==="text-field"&&h&&!h.glyphs&&D.push(new ct(i,m,'use of "text-field" requires a style "glyphs" property')),y==="text-font"&&os(Bn(m))&&Rr(m.type)==="identity"&&D.push(new ct(i,m,'"text-font" does not support identity functions'))),D.concat(s({key:n.key,value:m,valueSpec:E,style:h,styleSpec:f,expressionContext:"property",propertyType:t,propertyKey:y}))}function Os(n){return Mh(n,"paint")}function js(n){return Mh(n,"layout")}function Mi(n){let t=[];const i=n.value,s=n.key,h=n.style,f=n.styleSpec;if(Jt(i)!=="object")return[new ct(s,i,`object expected, ${Jt(i)} found`)];i.type||i.ref||t.push(new ct(s,i,'either "type" or "ref" is required'));let m=Rr(i.type);const y=Rr(i.ref);if(i.id){const x=Rr(i.id);for(let T=0;T<n.arrayIndex;T++){const E=h.layers[T];Rr(E.id)===x&&t.push(new ct(s,i.id,`duplicate layer id "${i.id}", previously used at line ${E.id.__line__}`))}}if("ref"in i){let x;["type","source","source-layer","filter","layout"].forEach(T=>{T in i&&t.push(new ct(s,i[T],`"${T}" is prohibited for ref layers`))}),h.layers.forEach(T=>{Rr(T.id)===y&&(x=T)}),x?x.ref?t.push(new ct(s,i.ref,"ref cannot reference another ref layer")):m=Rr(x.type):t.push(new ct(s,i.ref,`ref layer "${y}" not found`))}else if(m!=="background")if(i.source){const x=h.sources&&h.sources[i.source],T=x&&Rr(x.type);x?T==="vector"&&m==="raster"?t.push(new ct(s,i.source,`layer "${i.id}" requires a raster source`)):T!=="raster-dem"&&m==="hillshade"||T!=="raster-dem"&&m==="color-relief"?t.push(new ct(s,i.source,`layer "${i.id}" requires a raster-dem source`)):T==="raster"&&m!=="raster"?t.push(new ct(s,i.source,`layer "${i.id}" requires a vector source`)):T!=="vector"||i["source-layer"]?T==="raster-dem"&&m!=="hillshade"&&m!=="color-relief"?t.push(new ct(s,i.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):m!=="line"||!i.paint||!i.paint["line-gradient"]||T==="geojson"&&x.lineMetrics||t.push(new ct(s,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new ct(s,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new ct(s,i.source,`source "${i.source}" not found`))}else t.push(new ct(s,i,'missing required property "source"'));return t=t.concat(Gi({key:s,value:i,valueSpec:f.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${s}.type`,value:i.type,valueSpec:f.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:i,objectKey:"type"}),filter:Ul,layout:x=>Gi({layer:i,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":T=>js(ai({layerType:m},T))}}),paint:x=>Gi({layer:i,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":T=>Os(ai({layerType:m},T))}})}})),t}function Yi(n){const t=n.value,i=n.key,s=Jt(t);return s!=="string"?[new ct(i,t,`string expected, ${s} found`)]:[]}const $l={promoteId:function({key:n,value:t}){if(Jt(t)==="string")return Yi({key:n,value:t});{const i=[];for(const s in t)i.push(...Yi({key:`${n}.${s}`,value:t[s]}));return i}}};function Ih(n){const t=n.value,i=n.key,s=n.styleSpec,h=n.style,f=n.validateSpec;if(!t.type)return[new ct(i,t,'"type" is required')];const m=Rr(t.type);let y;switch(m){case"vector":case"raster":return y=Gi({key:i,value:t,valueSpec:s[`source_${m.replace("-","_")}`],style:n.style,styleSpec:s,objectElementValidators:$l,validateSpec:f}),y;case"raster-dem":return y=function(x){var T;const E=(T=x.sourceName)!==null&&T!==void 0?T:"",I=x.value,D=x.styleSpec,B=D.source_raster_dem,j=x.style;let U=[];const X=Jt(I);if(I===void 0)return U;if(X!=="object")return U.push(new ct("source_raster_dem",I,`object expected, ${X} found`)),U;const re=Rr(I.encoding)==="custom",we=["redFactor","greenFactor","blueFactor","baseShift"],pe=x.value.encoding?`"${x.value.encoding}"`:"Default";for(const F in I)!re&&we.includes(F)?U.push(new ct(F,I[F],`In "${E}": "${F}" is only valid when "encoding" is set to "custom". ${pe} encoding found`)):B[F]?U=U.concat(x.validateSpec({key:F,value:I[F],valueSpec:B[F],validateSpec:x.validateSpec,style:j,styleSpec:D})):U.push(new ct(F,I[F],`unknown property "${F}"`));return U}({sourceName:i,value:t,style:n.style,styleSpec:s,validateSpec:f}),y;case"geojson":if(y=Gi({key:i,value:t,valueSpec:s.source_geojson,style:h,styleSpec:s,validateSpec:f,objectElementValidators:$l}),t.cluster)for(const x in t.clusterProperties){const[T,E]=t.clusterProperties[x],I=typeof T=="string"?[T,["accumulated"],["get",x]]:T;y.push(...Bs({key:`${i}.${x}.map`,value:E,expressionContext:"cluster-map"})),y.push(...Bs({key:`${i}.${x}.reduce`,value:I,expressionContext:"cluster-reduce"}))}return y;case"video":return Gi({key:i,value:t,valueSpec:s.source_video,style:h,validateSpec:f,styleSpec:s});case"image":return Gi({key:i,value:t,valueSpec:s.source_image,style:h,validateSpec:f,styleSpec:s});case"canvas":return[new ct(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Io({key:`${i}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Ah(n){const t=n.value,i=n.styleSpec,s=i.light,h=n.style;let f=[];const m=Jt(t);if(t===void 0)return f;if(m!=="object")return f=f.concat([new ct("light",t,`object expected, ${m} found`)]),f;for(const y in t){const x=y.match(/^(.*)-transition$/);f=f.concat(x&&s[x[1]]&&s[x[1]].transition?n.validateSpec({key:y,value:t[y],valueSpec:i.transition,validateSpec:n.validateSpec,style:h,styleSpec:i}):s[y]?n.validateSpec({key:y,value:t[y],valueSpec:s[y],validateSpec:n.validateSpec,style:h,styleSpec:i}):[new ct(y,t[y],`unknown property "${y}"`)])}return f}function Vs(n){const t=n.value,i=n.styleSpec,s=i.sky,h=n.style,f=Jt(t);if(t===void 0)return[];if(f!=="object")return[new ct("sky",t,`object expected, ${f} found`)];let m=[];for(const y in t)m=m.concat(s[y]?n.validateSpec({key:y,value:t[y],valueSpec:s[y],style:h,styleSpec:i}):[new ct(y,t[y],`unknown property "${y}"`)]);return m}function Zl(n){const t=n.value,i=n.styleSpec,s=i.terrain,h=n.style;let f=[];const m=Jt(t);if(t===void 0)return f;if(m!=="object")return f=f.concat([new ct("terrain",t,`object expected, ${m} found`)]),f;for(const y in t)f=f.concat(s[y]?n.validateSpec({key:y,value:t[y],valueSpec:s[y],validateSpec:n.validateSpec,style:h,styleSpec:i}):[new ct(y,t[y],`unknown property "${y}"`)]);return f}function Aa(n){let t=[];const i=n.value,s=n.key;if(Array.isArray(i)){const h=[],f=[];for(const m in i)i[m].id&&h.includes(i[m].id)&&t.push(new ct(s,i,`all the sprites' ids must be unique, but ${i[m].id} is duplicated`)),h.push(i[m].id),i[m].url&&f.includes(i[m].url)&&t.push(new ct(s,i,`all the sprites' URLs must be unique, but ${i[m].url} is duplicated`)),f.push(i[m].url),t=t.concat(Gi({key:`${s}[${m}]`,value:i[m],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return t}return Yi({key:s,value:i})}function zh(n){return t=n.value,t&&t.constructor===Object?[]:[new ct(n.key,n.value,`object expected, ${Jt(n.value)} found`)];var t}const za={"*":()=>[],array:Ia,boolean:function(n){const t=n.value,i=n.key,s=Jt(t);return s!=="boolean"?[new ct(i,t,`boolean expected, ${s} found`)]:[]},number:Mo,color:Nl,constants:Eh,enum:Io,filter:Ul,function:Fs,layer:Mi,object:Gi,source:Ih,light:Ah,sky:Vs,terrain:Zl,projection:function(n){const t=n.value,i=n.styleSpec,s=i.projection,h=n.style,f=Jt(t);if(t===void 0)return[];if(f!=="object")return[new ct("projection",t,`object expected, ${f} found`)];let m=[];for(const y in t)m=m.concat(s[y]?n.validateSpec({key:y,value:t[y],valueSpec:s[y],style:h,styleSpec:i}):[new ct(y,t[y],`unknown property "${y}"`)]);return m},projectionDefinition:function(n){const t=n.key;let i=n.value;i=i instanceof String?i.valueOf():i;const s=Jt(i);return s!=="array"||function(h){return Array.isArray(h)&&h.length===3&&typeof h[0]=="string"&&typeof h[1]=="string"&&typeof h[2]=="number"}(i)||function(h){return!!["interpolate","step","literal"].includes(h[0])}(i)?["array","string"].includes(s)?[]:[new ct(t,i,`projection expected, invalid type "${s}" found`)]:[new ct(t,i,`projection expected, invalid array ${JSON.stringify(i)} found`)]},string:Yi,formatted:function(n){return Yi(n).length===0?[]:Bs(n)},resolvedImage:function(n){return Yi(n).length===0?[]:Bs(n)},padding:function(n){const t=n.key,i=n.value;if(Jt(i)==="array"){if(i.length<1||i.length>4)return[new ct(t,i,`padding requires 1 to 4 values; ${i.length} values found`)];const s={type:"number"};let h=[];for(let f=0;f<i.length;f++)h=h.concat(n.validateSpec({key:`${t}[${f}]`,value:i[f],validateSpec:n.validateSpec,valueSpec:s}));return h}return Mo({key:t,value:i,valueSpec:{}})},numberArray:function(n){const t=n.key,i=n.value;if(Jt(i)==="array"){const s={type:"number"};if(i.length<1)return[new ct(t,i,"array length at least 1 expected, length 0 found")];let h=[];for(let f=0;f<i.length;f++)h=h.concat(n.validateSpec({key:`${t}[${f}]`,value:i[f],validateSpec:n.validateSpec,valueSpec:s}));return h}return Mo({key:t,value:i,valueSpec:{}})},colorArray:function(n){const t=n.key,i=n.value;if(Jt(i)==="array"){if(i.length<1)return[new ct(t,i,"array length at least 1 expected, length 0 found")];let s=[];for(let h=0;h<i.length;h++)s=s.concat(Nl({key:`${t}[${h}]`,value:i[h]}));return s}return Nl({key:t,value:i})},variableAnchorOffsetCollection:function(n){const t=n.key,i=n.value,s=Jt(i),h=n.styleSpec;if(s!=="array"||i.length<1||i.length%2!=0)return[new ct(t,i,"variableAnchorOffsetCollection requires a non-empty array of even length")];let f=[];for(let m=0;m<i.length;m+=2)f=f.concat(Io({key:`${t}[${m}]`,value:i[m],valueSpec:h.layout_symbol["text-anchor"]})),f=f.concat(Ia({key:`${t}[${m+1}]`,value:i[m+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:h}));return f},sprite:Aa,state:zh};function Da(n){const t=n.value,i=n.valueSpec,s=n.styleSpec;return n.validateSpec=Da,i.expression&&os(Rr(t))?Fs(n):i.expression&&Pa(Bn(t))?Bs(n):i.type&&za[i.type]?za[i.type](n):Gi(ai({},n,{valueSpec:i.type?s[i.type]:i}))}function Ns(n){const t=n.value,i=n.key,s=Yi(n);return s.length||(t.indexOf("{fontstack}")===-1&&s.push(new ct(i,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&s.push(new ct(i,t,'"glyphs" url must include a "{range}" token'))),s}function qi(n,t=ve){let i=[];return i=i.concat(Da({key:"",value:n,valueSpec:t.$root,styleSpec:t,style:n,validateSpec:Da,objectElementValidators:{glyphs:Ns,"*":()=>[]}})),n.constants&&(i=i.concat(Eh({key:"constants",value:n.constants}))),Dh(i)}function Ji(n){return function(t){return n({...t,validateSpec:Da})}}function Dh(n){return[].concat(n).sort((t,i)=>t.line-i.line)}function Ci(n){return function(...t){return Dh(n.apply(this,t))}}qi.source=Ci(Ji(Ih)),qi.sprite=Ci(Ji(Aa)),qi.glyphs=Ci(Ji(Ns)),qi.light=Ci(Ji(Ah)),qi.sky=Ci(Ji(Vs)),qi.terrain=Ci(Ji(Zl)),qi.state=Ci(Ji(zh)),qi.layer=Ci(Ji(Mi)),qi.filter=Ci(Ji(Ul)),qi.paintProperty=Ci(Ji(Os)),qi.layoutProperty=Ci(Ji(js));const Us=qi,$u=Us.light,Ra=Us.sky,Zu=Us.paintProperty,Gl=Us.layoutProperty;function Ao(n,t){let i=!1;if(t&&t.length)for(const s of t)n.fire(new Ie(new Error(s.message))),i=!0;return i}class $s{constructor(t,i,s){const h=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const m=new Int32Array(this.arrayBuffer);t=m[0],this.d=(i=m[1])+2*(s=m[2]);for(let x=0;x<this.d*this.d;x++){const T=m[3+x],E=m[3+x+1];h.push(T===E?null:m.subarray(T,E))}const y=m[3+h.length+1];this.keys=m.subarray(m[3+h.length],y),this.bboxes=m.subarray(y),this.insert=this._insertReadonly}else{this.d=i+2*s;for(let m=0;m<this.d*this.d;m++)h.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=t,this.padding=s,this.scale=i/t,this.uid=0;const f=s/i*t;this.min=-f,this.max=t+f}insert(t,i,s,h,f){this._forEachCell(i,s,h,f,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(i),this.bboxes.push(s),this.bboxes.push(h),this.bboxes.push(f)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,i,s,h,f,m){this.cells[f].push(m)}query(t,i,s,h,f){const m=this.min,y=this.max;if(t<=m&&i<=m&&y<=s&&y<=h&&!f)return Array.prototype.slice.call(this.keys);{const x=[];return this._forEachCell(t,i,s,h,this._queryCell,x,{},f),x}}_queryCell(t,i,s,h,f,m,y,x){const T=this.cells[f];if(T!==null){const E=this.keys,I=this.bboxes;for(let D=0;D<T.length;D++){const B=T[D];if(y[B]===void 0){const j=4*B;(x?x(I[j+0],I[j+1],I[j+2],I[j+3]):t<=I[j+2]&&i<=I[j+3]&&s>=I[j+0]&&h>=I[j+1])?(y[B]=!0,m.push(E[B])):y[B]=!1}}}}_forEachCell(t,i,s,h,f,m,y,x){const T=this._convertToCellCoord(t),E=this._convertToCellCoord(i),I=this._convertToCellCoord(s),D=this._convertToCellCoord(h);for(let B=T;B<=I;B++)for(let j=E;j<=D;j++){const U=this.d*j+B;if((!x||x(this._convertFromCellCoord(B),this._convertFromCellCoord(j),this._convertFromCellCoord(B+1),this._convertFromCellCoord(j+1)))&&f.call(this,t,i,s,h,U,m,y,x))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,i=3+this.cells.length+1+1;let s=0;for(let m=0;m<this.cells.length;m++)s+=this.cells[m].length;const h=new Int32Array(i+s+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;let f=i;for(let m=0;m<t.length;m++){const y=t[m];h[3+m]=f,h.set(y,f),f+=y.length}return h[3+t.length]=f,h.set(this.keys,f),f+=this.keys.length,h[3+t.length+1]=f,h.set(this.bboxes,f),f+=this.bboxes.length,h.buffer}static serialize(t,i){const s=t.toArrayBuffer();return i&&i.push(s),{buffer:s}}static deserialize(t){return new $s(t.buffer)}}const pn={};function vt(n,t,i={}){if(pn[n])throw new Error(`${n} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:n,writeable:!1}),pn[n]={klass:t,omit:i.omit||[],shallow:i.shallow||[]}}vt("Object",Object),vt("Set",Set),vt("TransferableGridIndex",$s),vt("Color",Yt),vt("Error",Error),vt("AJAXError",ce),vt("ResolvedImage",Ei),vt("StylePropertyFunction",So),vt("StyleExpression",Ca,{omit:["_evaluator"]}),vt("ZoomDependentExpression",Sa),vt("ZoomConstantExpression",To),vt("CompoundExpression",Zi,{omit:["_evaluate"]});for(const n in Is)Is[n]._classRegistryKey||vt(`Expression_${n}`,Is[n]);function ql(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function zo(n){return n.$name||n.constructor._classRegistryKey}function Wl(n){return!function(t){if(t===null||typeof t!="object")return!1;const i=zo(t);return!(!i||i==="Object")}(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||ql(n)||nt(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function Do(n,t){if(Wl(n))return(ql(n)||nt(n))&&t&&t.push(n),ArrayBuffer.isView(n)&&t&&t.push(n.buffer),n instanceof ImageData&&t&&t.push(n.data.buffer),n;if(Array.isArray(n)){const f=[];for(const m of n)f.push(Do(m,t));return f}if(typeof n!="object")throw new Error("can't serialize object of type "+typeof n);const i=zo(n);if(!i)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!pn[i])throw new Error(`${i} is not registered.`);const{klass:s}=pn[i],h=s.serialize?s.serialize(n,t):{};if(s.serialize){if(t&&h===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const f in n){if(!n.hasOwnProperty(f)||pn[i].omit.indexOf(f)>=0)continue;const m=n[f];h[f]=pn[i].shallow.indexOf(f)>=0?m:Do(m,t)}n instanceof Error&&(h.message=n.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return i!=="Object"&&(h.$name=i),h}function Zs(n){if(Wl(n))return n;if(Array.isArray(n))return n.map(Zs);if(typeof n!="object")throw new Error("can't deserialize object of type "+typeof n);const t=zo(n)||"Object";if(!pn[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:i}=pn[t];if(!i)throw new Error(`can't deserialize unregistered class ${t}`);if(i.deserialize)return i.deserialize(n);const s=Object.create(i.prototype);for(const h of Object.keys(n)){if(h==="$name")continue;const f=n[h];s[h]=pn[t].shallow.indexOf(h)>=0?f:Zs(f)}return s}class Hl{constructor(){this.first=!0}update(t,i){const s=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=i),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=s,!0))}}const Qt={"Latin-1 Supplement":n=>n>=128&&n<=255,"Hangul Jamo":n=>n>=4352&&n<=4607,Khmer:n=>n>=6016&&n<=6143,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Kanbun:n=>n>=12688&&n<=12703,"CJK Strokes":n=>n>=12736&&n<=12783,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Hangul Syllables":n=>n>=44032&&n<=55215,"Private Use Area":n=>n>=57344&&n<=63743,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function Xl(n){for(const t of n)if(Fa(t.charCodeAt(0)))return!0;return!1}function Rh(n){for(const t of n)if(!qu(t.charCodeAt(0)))return!1;return!0}function La(n){const t=n.map(i=>{try{return new RegExp(`\\p{sc=${i}}`,"u").source}catch{return null}}).filter(i=>i);return new RegExp(t.join("|"),"u")}const Gu=La(["Arab","Dupl","Mong","Ougr","Syrc"]);function qu(n){return!Gu.test(String.fromCodePoint(n))}const Kl=La(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Fa(n){return!(n!==746&&n!==747&&(n<4352||!(Qt["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||Qt["CJK Compatibility"](n)||Qt["CJK Strokes"](n)||!(!Qt["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||Qt["Enclosed CJK Letters and Months"](n)||Qt["Ideographic Description Characters"](n)||Qt.Kanbun(n)||Qt.Katakana(n)&&n!==12540||!(!Qt["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!Qt["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||Qt["Vertical Forms"](n)||Qt["Yijing Hexagram Symbols"](n)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(n))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(n))||Kl.test(String.fromCodePoint(n)))))}function Yl(n){return!(Fa(n)||function(t){return!!(Qt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Qt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Qt["Letterlike Symbols"](t)||Qt["Number Forms"](t)||Qt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Qt["Control Pictures"](t)&&t!==9251||Qt["Optical Character Recognition"](t)||Qt["Enclosed Alphanumerics"](t)||Qt["Geometric Shapes"](t)||Qt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Qt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Qt["CJK Symbols and Punctuation"](t)||Qt.Katakana(t)||Qt["Private Use Area"](t)||Qt["CJK Compatibility Forms"](t)||Qt["Small Form Variants"](t)||Qt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(n))}const Lh=La(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Ro(n){return Lh.test(String.fromCodePoint(n))}function Wu(n,t){return!(!t&&Ro(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||Qt.Khmer(n))}function Jl(n){for(const t of n)if(Ro(t.charCodeAt(0)))return!0;return!1}const On=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){if(On.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(n,t){return a(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(n.pluginStatus!=="loading")return this.setState(n),n;const i=n.pluginURL,s=new Promise(f=>{this.loadScriptResolve=f});t(i);const h=new Promise(f=>setTimeout(()=>f(),this.TIMEOUT));if(yield Promise.race([s,h]),this.isParsed()){const f={pluginStatus:"loaded",pluginURL:i};return this.setState(f),f}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${i}`)})}};class Cr{constructor(t,i){this.zoom=t,i?(this.now=i.now||0,this.fadeDuration=i.fadeDuration||0,this.zoomHistory=i.zoomHistory||new Hl,this.transition=i.transition||{},this.globalState=i.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Hl,this.transition={},this.globalState={})}isSupportedScript(t){return function(i,s){for(const h of i)if(!Wu(h.charCodeAt(0),s))return!1;return!0}(t,On.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,i=t-Math.floor(t),s=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*i}}}class Lo{constructor(t,i){this.property=t,this.value=i,this.expression=function(s,h){if(os(s))return new So(s,h);if(Pa(s)){const f=Ol(s,h);if(f.result==="error")throw new Error(f.value.map(m=>`${m.key}: ${m.message}`).join(", "));return f.value}{let f=s;return h.type==="color"&&typeof s=="string"?f=Yt.parse(s):h.type!=="padding"||typeof s!="number"&&!Array.isArray(s)?h.type!=="numberArray"||typeof s!="number"&&!Array.isArray(s)?h.type!=="colorArray"||typeof s!="string"&&!Array.isArray(s)?h.type==="variableAnchorOffsetCollection"&&Array.isArray(s)?f=ir.parse(s):h.type==="projectionDefinition"&&typeof s=="string"&&(f=Nt.parse(s)):f=Jr.parse(s):f=yi.parse(s):f=$r.parse(s),{globalStateRefs:new Set,kind:"constant",evaluate:()=>f}}}(i===void 0?t.specification.default:i,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(t,i,s){return this.property.possiblyEvaluate(this,t,i,s)}}class Ba{constructor(t){this.property=t,this.value=new Lo(t,void 0)}transitioned(t,i){return new Fh(this.property,this.value,i,or({},t.transition,this.transition),t.now)}untransitioned(){return new Fh(this.property,this.value,null,{},0)}}class Ql{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return Je(this._values[t].value.value)}setValue(t,i){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Ba(this._values[t].property)),this._values[t].value=new Lo(this._values[t].property,i===null?void 0:Je(i))}getTransition(t){return Je(this._values[t].transition)}setTransition(t,i){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Ba(this._values[t].property)),this._values[t].transition=Je(i)||void 0}serialize(){const t={};for(const i of Object.keys(this._values)){const s=this.getValue(i);s!==void 0&&(t[i]=s);const h=this.getTransition(i);h!==void 0&&(t[`${i}-transition`]=h)}return t}transitioned(t,i){const s=new Bh(this._properties);for(const h of Object.keys(this._values))s._values[h]=this._values[h].transitioned(t,i._values[h]);return s}untransitioned(){const t=new Bh(this._properties);for(const i of Object.keys(this._values))t._values[i]=this._values[i].untransitioned();return t}}class Fh{constructor(t,i,s,h,f){this.property=t,this.value=i,this.begin=f+h.delay||0,this.end=this.begin+h.duration||0,t.specification.transition&&(h.delay||h.duration)&&(this.prior=s)}possiblyEvaluate(t,i,s){const h=t.now||0,f=this.value.possiblyEvaluate(t,i,s),m=this.prior;if(m){if(h>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(h<this.begin)return m.possiblyEvaluate(t,i,s);{const y=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(t,i,s),f,fr(y))}}return f}}class Bh{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,i,s){const h=new Oa(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].possiblyEvaluate(t,i,s);return h}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Hu{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return Je(this._values[t].value)}setValue(t,i){this._values[t]=new Lo(this._values[t].property,i===null?void 0:Je(i))}serialize(){const t={};for(const i of Object.keys(this._values)){const s=this.getValue(i);s!==void 0&&(t[i]=s)}return t}possiblyEvaluate(t,i,s){const h=new Oa(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].possiblyEvaluate(t,i,s);return h}}class fn{constructor(t,i,s){this.property=t,this.value=i,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,i,s,h){return this.property.evaluate(this.value,this.parameters,t,i,s,h)}}class Oa{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Tt{constructor(t){this.specification=t}possiblyEvaluate(t,i){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(i)}interpolate(t,i,s){const h=Fi[this.specification.type];return h?h(t,i,s):t}}class Dt{constructor(t,i){this.specification=t,this.overrides=i}possiblyEvaluate(t,i,s,h){return new fn(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(i,null,{},s,h)}:t.expression,i)}interpolate(t,i,s){if(t.value.kind!=="constant"||i.value.kind!=="constant")return t;if(t.value.value===void 0||i.value.value===void 0)return new fn(this,{kind:"constant",value:void 0},t.parameters);const h=Fi[this.specification.type];if(h){const f=h(t.value.value,i.value.value,s);return new fn(this,{kind:"constant",value:f},t.parameters)}return t}evaluate(t,i,s,h,f,m){return t.kind==="constant"?t.value:t.evaluate(i,s,h,f,m)}}class ja extends Dt{possiblyEvaluate(t,i,s,h){if(t.value===void 0)return new fn(this,{kind:"constant",value:void 0},i);if(t.expression.kind==="constant"){const f=t.expression.evaluate(i,null,{},s,h),m=t.property.specification.type==="resolvedImage"&&typeof f!="string"?f.name:f,y=this._calculate(m,m,m,i);return new fn(this,{kind:"constant",value:y},i)}if(t.expression.kind==="camera"){const f=this._calculate(t.expression.evaluate({zoom:i.zoom-1}),t.expression.evaluate({zoom:i.zoom}),t.expression.evaluate({zoom:i.zoom+1}),i);return new fn(this,{kind:"constant",value:f},i)}return new fn(this,t.expression,i)}evaluate(t,i,s,h,f,m){if(t.kind==="source"){const y=t.evaluate(i,s,h,f,m);return this._calculate(y,y,y,i)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(i.zoom)-1},s,h),t.evaluate({zoom:Math.floor(i.zoom)},s,h),t.evaluate({zoom:Math.floor(i.zoom)+1},s,h),i):t.value}_calculate(t,i,s,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:i}:{from:s,to:i}}interpolate(t){return t}}class ec{constructor(t){this.specification=t}possiblyEvaluate(t,i,s,h){if(t.value!==void 0){if(t.expression.kind==="constant"){const f=t.expression.evaluate(i,null,{},s,h);return this._calculate(f,f,f,i)}return this._calculate(t.expression.evaluate(new Cr(Math.floor(i.zoom-1),i)),t.expression.evaluate(new Cr(Math.floor(i.zoom),i)),t.expression.evaluate(new Cr(Math.floor(i.zoom+1),i)),i)}}_calculate(t,i,s,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:i}:{from:s,to:i}}interpolate(t){return t}}class Fo{constructor(t){this.specification=t}possiblyEvaluate(t,i,s,h){return!!t.expression.evaluate(i,null,{},s,h)}interpolate(){return!1}}class Pi{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const i in t){const s=t[i];s.specification.overridable&&this.overridableProperties.push(i);const h=this.defaultPropertyValues[i]=new Lo(s,void 0),f=this.defaultTransitionablePropertyValues[i]=new Ba(s);this.defaultTransitioningPropertyValues[i]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=h.possiblyEvaluate({})}}}vt("DataDrivenProperty",Dt),vt("DataConstantProperty",Tt),vt("CrossFadedDataDrivenProperty",ja),vt("CrossFadedProperty",ec),vt("ColorRampProperty",Fo);const Oh="-transition";class li extends Ye{constructor(t,i){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter,this._featureFilter=Fn(t.filter)),i.layout&&(this._unevaluatedLayout=new Hu(i.layout)),i.paint)){this._transitionablePaint=new Ql(i.paint);for(const s in t.paint)this.setPaintProperty(s,t.paint[s],{validate:!1});for(const s in t.layout)this.setLayoutProperty(s,t.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Oa(i.paint)}}setFilter(t){this.filter=t,this._featureFilter=Fn(t)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}getLayoutAffectingGlobalStateRefs(){const t=new Set;if(this._unevaluatedLayout)for(const i in this._unevaluatedLayout._values){const s=this._unevaluatedLayout._values[i];for(const h of s.getGlobalStateRefs())t.add(h)}for(const i of this._featureFilter.getGlobalStateRefs())t.add(i);return t}setLayoutProperty(t,i,s={}){i!=null&&this._validate(Gl,`layers.${this.id}.layout.${t}`,t,i,s)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,i):this.visibility=i)}getPaintProperty(t){return t.endsWith(Oh)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,i,s={}){if(i!=null&&this._validate(Zu,`layers.${this.id}.paint.${t}`,t,i,s))return!1;if(t.endsWith(Oh))return this._transitionablePaint.setTransition(t.slice(0,-11),i||void 0),!1;{const h=this._transitionablePaint._values[t],f=h.property.specification["property-type"]==="cross-faded-data-driven",m=h.value.isDataDriven(),y=h.value;this._transitionablePaint.setValue(t,i),this._handleSpecialPaintPropertyUpdate(t);const x=this._transitionablePaint._values[t].value;return x.isDataDriven()||m||f||this._handleOverridablePaintPropertyUpdate(t,y,x)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,i,s){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,i){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,i)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),O(t,(i,s)=>!(i===void 0||s==="layout"&&!Object.keys(i).length||s==="paint"&&!Object.keys(i).length))}_validate(t,i,s,h,f={}){return(!f||f.validate!==!1)&&Ao(this,t.call(Us,{key:i,layerType:this.type,objectKey:s,value:h,styleSpec:ve,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const i=this.paint.get(t);if(i instanceof fn&&Ds(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}}const jh={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class as{constructor(t,i){this._structArray=t,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class kr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,i){return t._trim(),i&&(t.isTransferred=!0,i.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const i=Object.create(this.prototype);return i.arrayBuffer=t.arrayBuffer,i.length=t.length,i.capacity=t.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Lr(n,t=1){let i=0,s=0;return{members:n.map(h=>{const f=jh[h.type].BYTES_PER_ELEMENT,m=i=Vh(i,Math.max(t,f)),y=h.components||1;return s=Math.max(s,f),i+=f*y,{name:h.name,type:h.type,components:y,offset:m}}),size:Vh(i,Math.max(s,t)),alignment:t}}function Vh(n,t){return Math.ceil(n/t)*t}class jn extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i){const s=this.length;return this.resize(s+1),this.emplace(s,t,i)}emplace(t,i,s){const h=2*t;return this.int16[h+0]=i,this.int16[h+1]=s,t}}jn.prototype.bytesPerElement=4,vt("StructArrayLayout2i4",jn);class Vn extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,s){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,s)}emplace(t,i,s,h){const f=3*t;return this.int16[f+0]=i,this.int16[f+1]=s,this.int16[f+2]=h,t}}Vn.prototype.bytesPerElement=6,vt("StructArrayLayout3i6",Vn);class tc extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,s,h){const f=this.length;return this.resize(f+1),this.emplace(f,t,i,s,h)}emplace(t,i,s,h,f){const m=4*t;return this.int16[m+0]=i,this.int16[m+1]=s,this.int16[m+2]=h,this.int16[m+3]=f,t}}tc.prototype.bytesPerElement=8,vt("StructArrayLayout4i8",tc);class Va extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,s,h,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,i,s,h,f,m)}emplace(t,i,s,h,f,m,y){const x=6*t;return this.int16[x+0]=i,this.int16[x+1]=s,this.int16[x+2]=h,this.int16[x+3]=f,this.int16[x+4]=m,this.int16[x+5]=y,t}}Va.prototype.bytesPerElement=12,vt("StructArrayLayout2i4i12",Va);class ls extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,s,h,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,i,s,h,f,m)}emplace(t,i,s,h,f,m,y){const x=4*t,T=8*t;return this.int16[x+0]=i,this.int16[x+1]=s,this.uint8[T+4]=h,this.uint8[T+5]=f,this.uint8[T+6]=m,this.uint8[T+7]=y,t}}ls.prototype.bytesPerElement=8,vt("StructArrayLayout2i4ub8",ls);class Bo extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i){const s=this.length;return this.resize(s+1),this.emplace(s,t,i)}emplace(t,i,s){const h=2*t;return this.float32[h+0]=i,this.float32[h+1]=s,t}}Bo.prototype.bytesPerElement=8,vt("StructArrayLayout2f8",Bo);class rc extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,s,h,f,m,y,x,T,E){const I=this.length;return this.resize(I+1),this.emplace(I,t,i,s,h,f,m,y,x,T,E)}emplace(t,i,s,h,f,m,y,x,T,E,I){const D=10*t;return this.uint16[D+0]=i,this.uint16[D+1]=s,this.uint16[D+2]=h,this.uint16[D+3]=f,this.uint16[D+4]=m,this.uint16[D+5]=y,this.uint16[D+6]=x,this.uint16[D+7]=T,this.uint16[D+8]=E,this.uint16[D+9]=I,t}}rc.prototype.bytesPerElement=20,vt("StructArrayLayout10ui20",rc);class Na extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,s,h,f,m,y,x,T,E,I,D){const B=this.length;return this.resize(B+1),this.emplace(B,t,i,s,h,f,m,y,x,T,E,I,D)}emplace(t,i,s,h,f,m,y,x,T,E,I,D,B){const j=12*t;return this.int16[j+0]=i,this.int16[j+1]=s,this.int16[j+2]=h,this.int16[j+3]=f,this.uint16[j+4]=m,this.uint16[j+5]=y,this.uint16[j+6]=x,this.uint16[j+7]=T,this.int16[j+8]=E,this.int16[j+9]=I,this.int16[j+10]=D,this.int16[j+11]=B,t}}Na.prototype.bytesPerElement=24,vt("StructArrayLayout4i4ui4i24",Na);class ic extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,s){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,s)}emplace(t,i,s,h){const f=3*t;return this.float32[f+0]=i,this.float32[f+1]=s,this.float32[f+2]=h,t}}ic.prototype.bytesPerElement=12,vt("StructArrayLayout3f12",ic);class d extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint32[1*t+0]=i,t}}d.prototype.bytesPerElement=4,vt("StructArrayLayout1ul4",d);class e extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,s,h,f,m,y,x,T){const E=this.length;return this.resize(E+1),this.emplace(E,t,i,s,h,f,m,y,x,T)}emplace(t,i,s,h,f,m,y,x,T,E){const I=10*t,D=5*t;return this.int16[I+0]=i,this.int16[I+1]=s,this.int16[I+2]=h,this.int16[I+3]=f,this.int16[I+4]=m,this.int16[I+5]=y,this.uint32[D+3]=x,this.uint16[I+8]=T,this.uint16[I+9]=E,t}}e.prototype.bytesPerElement=20,vt("StructArrayLayout6i1ul2ui20",e);class r extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,s,h,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,i,s,h,f,m)}emplace(t,i,s,h,f,m,y){const x=6*t;return this.int16[x+0]=i,this.int16[x+1]=s,this.int16[x+2]=h,this.int16[x+3]=f,this.int16[x+4]=m,this.int16[x+5]=y,t}}r.prototype.bytesPerElement=12,vt("StructArrayLayout2i2i2i12",r);class l extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,s,h,f){const m=this.length;return this.resize(m+1),this.emplace(m,t,i,s,h,f)}emplace(t,i,s,h,f,m){const y=4*t,x=8*t;return this.float32[y+0]=i,this.float32[y+1]=s,this.float32[y+2]=h,this.int16[x+6]=f,this.int16[x+7]=m,t}}l.prototype.bytesPerElement=16,vt("StructArrayLayout2f1f2i16",l);class c extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,s,h,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,i,s,h,f,m)}emplace(t,i,s,h,f,m,y){const x=16*t,T=4*t,E=8*t;return this.uint8[x+0]=i,this.uint8[x+1]=s,this.float32[T+1]=h,this.float32[T+2]=f,this.int16[E+6]=m,this.int16[E+7]=y,t}}c.prototype.bytesPerElement=16,vt("StructArrayLayout2ub2f2i16",c);class p extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,s){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,s)}emplace(t,i,s,h){const f=3*t;return this.uint16[f+0]=i,this.uint16[f+1]=s,this.uint16[f+2]=h,t}}p.prototype.bytesPerElement=6,vt("StructArrayLayout3ui6",p);class g extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,s,h,f,m,y,x,T,E,I,D,B,j,U,X,re){const we=this.length;return this.resize(we+1),this.emplace(we,t,i,s,h,f,m,y,x,T,E,I,D,B,j,U,X,re)}emplace(t,i,s,h,f,m,y,x,T,E,I,D,B,j,U,X,re,we){const pe=24*t,F=12*t,W=48*t;return this.int16[pe+0]=i,this.int16[pe+1]=s,this.uint16[pe+2]=h,this.uint16[pe+3]=f,this.uint32[F+2]=m,this.uint32[F+3]=y,this.uint32[F+4]=x,this.uint16[pe+10]=T,this.uint16[pe+11]=E,this.uint16[pe+12]=I,this.float32[F+7]=D,this.float32[F+8]=B,this.uint8[W+36]=j,this.uint8[W+37]=U,this.uint8[W+38]=X,this.uint32[F+10]=re,this.int16[pe+22]=we,t}}g.prototype.bytesPerElement=48,vt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",g);class b extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,s,h,f,m,y,x,T,E,I,D,B,j,U,X,re,we,pe,F,W,me,Le,et,Ne,Ze,st,rt){const ot=this.length;return this.resize(ot+1),this.emplace(ot,t,i,s,h,f,m,y,x,T,E,I,D,B,j,U,X,re,we,pe,F,W,me,Le,et,Ne,Ze,st,rt)}emplace(t,i,s,h,f,m,y,x,T,E,I,D,B,j,U,X,re,we,pe,F,W,me,Le,et,Ne,Ze,st,rt,ot){const We=32*t,Pt=16*t;return this.int16[We+0]=i,this.int16[We+1]=s,this.int16[We+2]=h,this.int16[We+3]=f,this.int16[We+4]=m,this.int16[We+5]=y,this.int16[We+6]=x,this.int16[We+7]=T,this.uint16[We+8]=E,this.uint16[We+9]=I,this.uint16[We+10]=D,this.uint16[We+11]=B,this.uint16[We+12]=j,this.uint16[We+13]=U,this.uint16[We+14]=X,this.uint16[We+15]=re,this.uint16[We+16]=we,this.uint16[We+17]=pe,this.uint16[We+18]=F,this.uint16[We+19]=W,this.uint16[We+20]=me,this.uint16[We+21]=Le,this.uint16[We+22]=et,this.uint32[Pt+12]=Ne,this.float32[Pt+13]=Ze,this.float32[Pt+14]=st,this.uint16[We+30]=rt,this.uint16[We+31]=ot,t}}b.prototype.bytesPerElement=64,vt("StructArrayLayout8i15ui1ul2f2ui64",b);class C extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.float32[1*t+0]=i,t}}C.prototype.bytesPerElement=4,vt("StructArrayLayout1f4",C);class S extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,s){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,s)}emplace(t,i,s,h){const f=3*t;return this.uint16[6*t+0]=i,this.float32[f+1]=s,this.float32[f+2]=h,t}}S.prototype.bytesPerElement=12,vt("StructArrayLayout1ui2f12",S);class M extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,s){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,s)}emplace(t,i,s,h){const f=4*t;return this.uint32[2*t+0]=i,this.uint16[f+2]=s,this.uint16[f+3]=h,t}}M.prototype.bytesPerElement=8,vt("StructArrayLayout1ul2ui8",M);class z extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i){const s=this.length;return this.resize(s+1),this.emplace(s,t,i)}emplace(t,i,s){const h=2*t;return this.uint16[h+0]=i,this.uint16[h+1]=s,t}}z.prototype.bytesPerElement=4,vt("StructArrayLayout2ui4",z);class A extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint16[1*t+0]=i,t}}A.prototype.bytesPerElement=2,vt("StructArrayLayout1ui2",A);class R extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,s,h){const f=this.length;return this.resize(f+1),this.emplace(f,t,i,s,h)}emplace(t,i,s,h,f){const m=4*t;return this.float32[m+0]=i,this.float32[m+1]=s,this.float32[m+2]=h,this.float32[m+3]=f,t}}R.prototype.bytesPerElement=16,vt("StructArrayLayout4f16",R);class V extends as{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new H(this.anchorPointX,this.anchorPointY)}}V.prototype.size=20;class Q extends e{get(t){return new V(this,t)}}vt("CollisionBoxArray",Q);class J extends as{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}J.prototype.size=48;class ee extends g{get(t){return new J(this,t)}}vt("PlacedSymbolArray",ee);class se extends as{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}se.prototype.size=64;class fe extends b{get(t){return new se(this,t)}}vt("SymbolInstanceArray",fe);class he extends C{getoffsetX(t){return this.float32[1*t+0]}}vt("GlyphOffsetArray",he);class _e extends Vn{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}vt("SymbolLineVertexArray",_e);class ye extends as{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ye.prototype.size=12;class ue extends S{get(t){return new ye(this,t)}}vt("TextAnchorOffsetArray",ue);class Ce extends as{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Ce.prototype.size=8;class Be extends M{get(t){return new Ce(this,t)}}vt("FeatureIndexArray",Be);class De extends jn{}class Re extends jn{}class je extends jn{}class ft extends Va{}class ht extends ls{}class tt extends Bo{}class Ct extends rc{}class Zt extends Na{}class hr extends ic{}class Mr extends d{}class mr extends r{}class Ir extends c{}class gr extends p{}class _r extends z{}const yr=Lr([{name:"a_pos",components:2,type:"Int16"}],4),{members:ci}=yr;class nr{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,i,s,h){const f=this.segments[this.segments.length-1];return t>nr.MAX_VERTEX_ARRAY_LENGTH&&de(`Max vertices per segment is ${nr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${nr.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!f||f.vertexLength+t>nr.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==h?this.createNewSegment(i,s,h):f}createNewSegment(t,i,s){const h={vertexOffset:t.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0,vaos:{}};return s!==void 0&&(h.sortKey=s),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(h),h}getOrCreateLatestSegment(t,i,s){return this.prepareSegment(0,t,i,s)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const i in t.vaos)t.vaos[i].destroy()}static simpleSegment(t,i,s,h){return new nr([{vertexOffset:t,primitiveOffset:i,vertexLength:s,primitiveLength:h,vaos:{},sortKey:0}])}}function ei(n,t){return 256*(n=Vt(Math.floor(n),0,255))+Vt(Math.floor(t),0,255)}nr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,vt("SegmentVector",nr);const hi=Lr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Nn,Un,$n,mn={exports:{}},Oo={exports:{}},jo={exports:{}},Gs=function(){if($n)return mn.exports;$n=1;var n=(Nn||(Nn=1,Oo.exports=function(i,s){var h,f,m,y,x,T,E,I;for(f=i.length-(h=3&i.length),m=s,x=3432918353,T=461845907,I=0;I<f;)E=255&i.charCodeAt(I)|(255&i.charCodeAt(++I))<<8|(255&i.charCodeAt(++I))<<16|(255&i.charCodeAt(++I))<<24,++I,m=27492+(65535&(y=5*(65535&(m=(m^=E=(65535&(E=(E=(65535&E)*x+(((E>>>16)*x&65535)<<16)&4294967295)<<15|E>>>17))*T+(((E>>>16)*T&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(E=0,h){case 3:E^=(255&i.charCodeAt(I+2))<<16;case 2:E^=(255&i.charCodeAt(I+1))<<8;case 1:m^=E=(65535&(E=(E=(65535&(E^=255&i.charCodeAt(I)))*x+(((E>>>16)*x&65535)<<16)&4294967295)<<15|E>>>17))*T+(((E>>>16)*T&65535)<<16)&4294967295}return m^=i.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}),Oo.exports),t=(Un||(Un=1,jo.exports=function(i,s){for(var h,f=i.length,m=s^f,y=0;f>=4;)h=1540483477*(65535&(h=255&i.charCodeAt(y)|(255&i.charCodeAt(++y))<<8|(255&i.charCodeAt(++y))<<16|(255&i.charCodeAt(++y))<<24))+((1540483477*(h>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),f-=4,++y;switch(f){case 3:m^=(255&i.charCodeAt(y+2))<<16;case 2:m^=(255&i.charCodeAt(y+1))<<8;case 1:m=1540483477*(65535&(m^=255&i.charCodeAt(y)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}),jo.exports);return mn.exports=n,mn.exports.murmur3=n,mn.exports.murmur2=t,mn.exports}(),Ii=$(Gs);class Qi{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,i,s,h){this.ids.push(Zn(t)),this.positions.push(i,s,h)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const i=Zn(t);let s=0,h=this.ids.length-1;for(;s<h;){const m=s+h>>1;this.ids[m]>=i?h=m:s=m+1}const f=[];for(;this.ids[s]===i;)f.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return f}static serialize(t,i){const s=new Float64Array(t.ids),h=new Uint32Array(t.positions);return cs(s,h,0,s.length-1),i&&i.push(s.buffer,h.buffer),{ids:s,positions:h}}static deserialize(t){const i=new Qi;return i.ids=t.ids,i.positions=t.positions,i.indexed=!0,i}}function Zn(n){const t=+n;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Ii(String(n))}function cs(n,t,i,s){for(;i<s;){const h=n[i+s>>1];let f=i-1,m=s+1;for(;;){do f++;while(n[f]<h);do m--;while(n[m]>h);if(f>=m)break;Br(n,f,m),Br(t,3*f,3*m),Br(t,3*f+1,3*m+1),Br(t,3*f+2,3*m+2)}m-i<s-m?(cs(n,t,i,m),i=m+1):(cs(n,t,m+1,s),s=m)}}function Br(n,t,i){const s=n[t];n[t]=n[i],n[i]=s}vt("FeaturePositionMap",Qi);class xr{constructor(t,i){this.gl=t.gl,this.location=i}}class Ti extends xr{constructor(t,i){super(t,i),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Wr extends xr{constructor(t,i){super(t,i),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Nh extends xr{constructor(t,i){super(t,i),this.current=Yt.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Xu=new Float32Array(16);function nc(n){return[ei(255*n.r,255*n.g),ei(255*n.b,255*n.a)]}class Vo{constructor(t,i,s){this.value=t,this.uniformNames=i.map(h=>`u_${h}`),this.type=s}setUniform(t,i,s){t.set(s.constantOr(this.value))}getBinding(t,i,s){return this.type==="color"?new Nh(t,i):new Ti(t,i)}}class qs{constructor(t,i){this.uniformNames=i.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,i){this.pixelRatioFrom=i.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=i.tlbr,this.patternTo=t.tlbr}setUniform(t,i,s,h){const f=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;f&&t.set(f)}getBinding(t,i,s){return s.substr(0,9)==="u_pattern"?new Wr(t,i):new Ti(t,i)}}class Tn{constructor(t,i,s,h){this.expression=t,this.type=s,this.maxValue=0,this.paintVertexAttributes=i.map(f=>({name:`a_${f}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(t,i,s,h,f){const m=this.paintVertexArray.length,y=this.expression.evaluate(new Cr(0),i,{},h,[],f);this.paintVertexArray.resize(t),this._setPaintValue(m,t,y)}updatePaintArray(t,i,s,h){const f=this.expression.evaluate({zoom:0},s,h);this._setPaintValue(t,i,f)}_setPaintValue(t,i,s){if(this.type==="color"){const h=nc(s);for(let f=t;f<i;f++)this.paintVertexArray.emplace(f,h[0],h[1])}else{for(let h=t;h<i;h++)this.paintVertexArray.emplace(h,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ui{constructor(t,i,s,h,f,m){this.expression=t,this.uniformNames=i.map(y=>`u_${y}_t`),this.type=s,this.useIntegerZoom=h,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=i.map(y=>({name:`a_${y}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(t,i,s,h,f){const m=this.expression.evaluate(new Cr(this.zoom),i,{},h,[],f),y=this.expression.evaluate(new Cr(this.zoom+1),i,{},h,[],f),x=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(x,t,m,y)}updatePaintArray(t,i,s,h){const f=this.expression.evaluate({zoom:this.zoom},s,h),m=this.expression.evaluate({zoom:this.zoom+1},s,h);this._setPaintValue(t,i,f,m)}_setPaintValue(t,i,s,h){if(this.type==="color"){const f=nc(s),m=nc(h);for(let y=t;y<i;y++)this.paintVertexArray.emplace(y,f[0],f[1],m[0],m[1])}else{for(let f=t;f<i;f++)this.paintVertexArray.emplace(f,s,h);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,i){const s=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,h=Vt(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);t.set(h)}getBinding(t,i,s){return new Ti(t,i)}}class Sn{constructor(t,i,s,h,f,m){this.expression=t,this.type=i,this.useIntegerZoom=s,this.zoom=h,this.layerId=m,this.zoomInPaintVertexArray=new f,this.zoomOutPaintVertexArray=new f}populatePaintArray(t,i,s){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,i.patterns&&i.patterns[this.layerId],s)}updatePaintArray(t,i,s,h,f){this._setPaintValues(t,i,s.patterns&&s.patterns[this.layerId],f)}_setPaintValues(t,i,s,h){if(!h||!s)return;const{min:f,mid:m,max:y}=s,x=h[f],T=h[m],E=h[y];if(x&&T&&E)for(let I=t;I<i;I++)this.zoomInPaintVertexArray.emplace(I,T.tl[0],T.tl[1],T.br[0],T.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],T.pixelRatio,x.pixelRatio),this.zoomOutPaintVertexArray.emplace(I,T.tl[0],T.tl[1],T.br[0],T.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],T.pixelRatio,E.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,hi.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,hi.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class sc{constructor(t,i,s){this.binders={},this._buffers=[];const h=[];for(const f in t.paint._values){if(!s(f))continue;const m=t.paint.get(f);if(!(m instanceof fn&&Ds(m.property.specification)))continue;const y=oc(f,t.type),x=m.value,T=m.property.specification.type,E=m.property.useIntegerZoom,I=m.property.specification["property-type"],D=I==="cross-faded"||I==="cross-faded-data-driven";if(x.kind==="constant")this.binders[f]=D?new qs(x.value,y):new Vo(x.value,y,T),h.push(`/u_${f}`);else if(x.kind==="source"||D){const B=ac(f,T,"source");this.binders[f]=D?new Sn(x,T,E,i,B,t.id):new Tn(x,y,T,B),h.push(`/a_${f}`)}else{const B=ac(f,T,"composite");this.binders[f]=new ui(x,y,T,E,i,B),h.push(`/z_${f}`)}}this.cacheKey=h.sort().join("")}getMaxValue(t){const i=this.binders[t];return i instanceof Tn||i instanceof ui?i.maxValue:0}populatePaintArrays(t,i,s,h,f){for(const m in this.binders){const y=this.binders[m];(y instanceof Tn||y instanceof ui||y instanceof Sn)&&y.populatePaintArray(t,i,s,h,f)}}setConstantPatternPositions(t,i){for(const s in this.binders){const h=this.binders[s];h instanceof qs&&h.setConstantPatternPositions(t,i)}}updatePaintArrays(t,i,s,h,f){let m=!1;for(const y in t){const x=i.getPositions(y);for(const T of x){const E=s.feature(T.index);for(const I in this.binders){const D=this.binders[I];if((D instanceof Tn||D instanceof ui||D instanceof Sn)&&D.expression.isStateDependent===!0){const B=h.paint.get(I);D.expression=B.value,D.updatePaintArray(T.start,T.end,E,t[y],f),m=!0}}}}return m}defines(){const t=[];for(const i in this.binders){const s=this.binders[i];(s instanceof Vo||s instanceof qs)&&t.push(...s.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return t}getBinderAttributes(){const t=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof Tn||s instanceof ui)for(let h=0;h<s.paintVertexAttributes.length;h++)t.push(s.paintVertexAttributes[h].name);else if(s instanceof Sn)for(let h=0;h<hi.members.length;h++)t.push(hi.members[h].name)}return t}getBinderUniforms(){const t=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof Vo||s instanceof qs||s instanceof ui)for(const h of s.uniformNames)t.push(h)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,i){const s=[];for(const h in this.binders){const f=this.binders[h];if(f instanceof Vo||f instanceof qs||f instanceof ui){for(const m of f.uniformNames)if(i[m]){const y=f.getBinding(t,i[m],m);s.push({name:m,property:h,binding:y})}}}return s}setUniforms(t,i,s,h){for(const{name:f,property:m,binding:y}of i)this.binders[m].setUniform(y,h,s.get(m),f)}updatePaintBuffers(t){this._buffers=[];for(const i in this.binders){const s=this.binders[i];if(t&&s instanceof Sn){const h=t.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(s instanceof Tn||s instanceof ui)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(t){for(const i in this.binders){const s=this.binders[i];(s instanceof Tn||s instanceof ui||s instanceof Sn)&&s.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const i=this.binders[t];(i instanceof Tn||i instanceof ui||i instanceof Sn)&&i.destroy()}}}class Gn{constructor(t,i,s=()=>!0){this.programConfigurations={};for(const h of t)this.programConfigurations[h.id]=new sc(h,i,s);this.needsUpload=!1,this._featureMap=new Qi,this._bufferOffset=0}populatePaintArrays(t,i,s,h,f,m){for(const y in this.programConfigurations)this.programConfigurations[y].populatePaintArrays(t,i,h,f,m);i.id!==void 0&&this._featureMap.add(i.id,s,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,i,s,h){for(const f of s)this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(t,this._featureMap,i,f,h)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function oc(n,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${t}-`,"").replace(/-/g,"_")]}function ac(n,t,i){const s={color:{source:Bo,composite:R},number:{source:C,composite:Bo}},h=function(f){return{"line-pattern":{source:Ct,composite:Ct},"fill-pattern":{source:Ct,composite:Ct},"fill-extrusion-pattern":{source:Ct,composite:Ct}}[f]}(n);return h&&h[i]||s[t][i]}vt("ConstantBinder",Vo),vt("CrossFadedConstantBinder",qs),vt("SourceExpressionBinder",Tn),vt("CrossFadedCompositeBinder",Sn),vt("CompositeExpressionBinder",ui),vt("ProgramConfiguration",sc,{omit:["_buffers"]}),vt("ProgramConfigurationSet",Gn);const No=Math.pow(2,14)-1,Lp=-No-1;function Uo(n){const t=ze/n.extent,i=n.loadGeometry();for(let s=0;s<i.length;s++){const h=i[s];for(let f=0;f<h.length;f++){const m=h[f],y=Math.round(m.x*t),x=Math.round(m.y*t);m.x=Vt(y,Lp,No),m.y=Vt(x,Lp,No),(y<m.x||y>m.x+1||x<m.y||x>m.y+1)&&de("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function $o(n,t){return{type:n.type,id:n.id,properties:n.properties,geometry:t?Uo(n):[]}}const Fp=-32768;function pg(n,t,i,s,h){n.emplaceBack(Fp+8*t+s,Fp+8*i+h)}class Ku{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Re,this.indexArray=new gr,this.segments=new nr,this.programConfigurations=new Gn(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,s){const h=this.layers[0],f=[];let m=null,y=!1,x=h.type==="heatmap";if(h.type==="circle"){const E=h;m=E.layout.get("circle-sort-key"),y=!m.isConstant(),x=x||E.paint.get("circle-pitch-alignment")==="map"}const T=x?i.subdivisionGranularity.circle:1;for(const{feature:E,id:I,index:D,sourceLayerIndex:B}of t){const j=this.layers[0]._featureFilter.needGeometry,U=$o(E,j);if(!this.layers[0]._featureFilter.filter(new Cr(this.zoom,{globalState:this.globalState}),U,s))continue;const X=y?m.evaluate(U,{},s):void 0,re={id:I,properties:E.properties,type:E.type,sourceLayerIndex:B,index:D,geometry:j?U.geometry:Uo(E),patterns:{},sortKey:X};f.push(re)}y&&f.sort((E,I)=>E.sortKey-I.sortKey);for(const E of f){const{geometry:I,index:D,sourceLayerIndex:B}=E,j=t[D].feature;this.addFeature(E,I,D,s,T),i.featureIndex.insert(j,I,D,B,this.index)}}update(t,i,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ci),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,i,s,h,f=1){let m;switch(f){case 1:m=[0,7];break;case 3:m=[0,2,5,7];break;case 5:m=[0,1,3,4,6,7];break;case 7:m=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${f}; valid values are 1, 3, 5, 7.`)}const y=m.length;for(const x of i)for(const T of x){const E=T.x,I=T.y;if(E<0||E>=ze||I<0||I>=ze)continue;const D=this.segments.prepareSegment(y*y,this.layoutVertexArray,this.indexArray,t.sortKey),B=D.vertexLength;for(let j=0;j<y;j++)for(let U=0;U<y;U++)pg(this.layoutVertexArray,E,I,m[U],m[j]);for(let j=0;j<y-1;j++)for(let U=0;U<y-1;U++){const X=B+j*y+U,re=B+(j+1)*y+U;this.indexArray.emplaceBack(X,re+1,X+1),this.indexArray.emplaceBack(X,re,re+1)}D.vertexLength+=y*y,D.primitiveLength+=(y-1)*(y-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,{},h)}}function Bp(n,t){for(let i=0;i<n.length;i++)if(Ua(t,n[i]))return!0;for(let i=0;i<t.length;i++)if(Ua(n,t[i]))return!0;return!!Yu(n,t)}function fg(n,t,i){return!!Ua(n,t)||!!Ju(t,n,i)}function Op(n,t){if(n.length===1)return Vp(t,n[0]);for(let i=0;i<t.length;i++){const s=t[i];for(let h=0;h<s.length;h++)if(Ua(n,s[h]))return!0}for(let i=0;i<n.length;i++)if(Vp(t,n[i]))return!0;for(let i=0;i<t.length;i++)if(Yu(n,t[i]))return!0;return!1}function mg(n,t,i){if(n.length>1){if(Yu(n,t))return!0;for(let s=0;s<t.length;s++)if(Ju(t[s],n,i))return!0}for(let s=0;s<n.length;s++)if(Ju(n[s],t,i))return!0;return!1}function Yu(n,t){if(n.length===0||t.length===0)return!1;for(let i=0;i<n.length-1;i++){const s=n[i],h=n[i+1];for(let f=0;f<t.length-1;f++)if(_g(s,h,t[f],t[f+1]))return!0}return!1}function _g(n,t,i,s){return ae(n,i,s)!==ae(t,i,s)&&ae(n,t,i)!==ae(n,t,s)}function Ju(n,t,i){const s=i*i;if(t.length===1)return n.distSqr(t[0])<s;for(let h=1;h<t.length;h++)if(jp(n,t[h-1],t[h])<s)return!0;return!1}function jp(n,t,i){const s=t.distSqr(i);if(s===0)return n.distSqr(t);const h=((n.x-t.x)*(i.x-t.x)+(n.y-t.y)*(i.y-t.y))/s;return n.distSqr(h<0?t:h>1?i:i.sub(t)._mult(h)._add(t))}function Vp(n,t){let i,s,h,f=!1;for(let m=0;m<n.length;m++){i=n[m];for(let y=0,x=i.length-1;y<i.length;x=y++)s=i[y],h=i[x],s.y>t.y!=h.y>t.y&&t.x<(h.x-s.x)*(t.y-s.y)/(h.y-s.y)+s.x&&(f=!f)}return f}function Ua(n,t){let i=!1;for(let s=0,h=n.length-1;s<n.length;h=s++){const f=n[s],m=n[h];f.y>t.y!=m.y>t.y&&t.x<(m.x-f.x)*(t.y-f.y)/(m.y-f.y)+f.x&&(i=!i)}return i}function gg(n,t,i){const s=i[0],h=i[2];if(n.x<s.x&&t.x<s.x||n.x>h.x&&t.x>h.x||n.y<s.y&&t.y<s.y||n.y>h.y&&t.y>h.y)return!1;const f=ae(n,t,i[0]);return f!==ae(n,t,i[1])||f!==ae(n,t,i[2])||f!==ae(n,t,i[3])}function lc(n,t,i){const s=t.paint.get(n).value;return s.kind==="constant"?s.value:i.programConfigurations.get(t.id).getMaxValue(n)}function Uh(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function $h(n,t,i,s,h){if(!t[0]&&!t[1])return n;const f=H.convert(t)._mult(h);i==="viewport"&&f._rotate(-s);const m=[];for(let y=0;y<n.length;y++)m.push(n[y].sub(f));return m}let Np,Up;vt("CircleBucket",Ku,{omit:["layers"]});var yg={get paint(){return Up=Up||new Pi({"circle-radius":new Dt(ve.paint_circle["circle-radius"]),"circle-color":new Dt(ve.paint_circle["circle-color"]),"circle-blur":new Dt(ve.paint_circle["circle-blur"]),"circle-opacity":new Dt(ve.paint_circle["circle-opacity"]),"circle-translate":new Tt(ve.paint_circle["circle-translate"]),"circle-translate-anchor":new Tt(ve.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Tt(ve.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Tt(ve.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Dt(ve.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Dt(ve.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Dt(ve.paint_circle["circle-stroke-opacity"])})},get layout(){return Np=Np||new Pi({"circle-sort-key":new Dt(ve.layout_circle["circle-sort-key"])})}};class vg extends li{constructor(t){super(t,yg)}createBucket(t){return new Ku(t)}queryRadius(t){const i=t;return lc("circle-radius",this,i)+lc("circle-stroke-width",this,i)+Uh(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:i,featureState:s,geometry:h,transform:f,pixelsToTileUnits:m,unwrappedTileID:y,getElevation:x}){const T=$h(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-f.bearingInRadians,m),E=this.paint.get("circle-radius").evaluate(i,s)+this.paint.get("circle-stroke-width").evaluate(i,s),I=this.paint.get("circle-pitch-alignment")==="map",D=I?T:function(j,U,X,re){return j.map(we=>$p(we,U,X,re))}(T,f,y,x),B=I?E*m:E;for(const j of h)for(const U of j){const X=I?U:$p(U,f,y,x);let re=B;const we=f.projectTileCoordinates(U.x,U.y,y,x).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?re*=we/f.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(re*=f.cameraToCenterDistance/we),fg(D,X,re))return!0}return!1}}function $p(n,t,i,s){const h=t.projectTileCoordinates(n.x,n.y,i,s).point;return new H((.5*h.x+.5)*t.width,(.5*-h.y+.5)*t.height)}class Zp extends Ku{}let Gp;vt("HeatmapBucket",Zp,{omit:["layers"]});var bg={get paint(){return Gp=Gp||new Pi({"heatmap-radius":new Dt(ve.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Dt(ve.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Tt(ve.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Fo(ve.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Tt(ve.paint_heatmap["heatmap-opacity"])})}};function Qu(n,{width:t,height:i},s,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==t*i*s)throw new RangeError(`mismatched image size. expected: ${h.length} but got: ${t*i*s}`)}else h=new Uint8Array(t*i*s);return n.width=t,n.height=i,n.data=h,n}function qp(n,{width:t,height:i},s){if(t===n.width&&i===n.height)return;const h=Qu({},{width:t,height:i},s);ed(n,h,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,t),height:Math.min(n.height,i)},s),n.width=t,n.height=i,n.data=h.data}function ed(n,t,i,s,h,f){if(h.width===0||h.height===0)return t;if(h.width>n.width||h.height>n.height||i.x>n.width-h.width||i.y>n.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>t.width||h.height>t.height||s.x>t.width-h.width||s.y>t.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const m=n.data,y=t.data;if(m===y)throw new Error("srcData equals dstData, so image is already copied");for(let x=0;x<h.height;x++){const T=((i.y+x)*n.width+i.x)*f,E=((s.y+x)*t.width+s.x)*f;for(let I=0;I<h.width*f;I++)y[E+I]=m[T+I]}return t}class cc{constructor(t,i){Qu(this,t,1,i)}resize(t){qp(this,t,1)}clone(){return new cc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,s,h,f){ed(t,i,s,h,f,1)}}class Bi{constructor(t,i){Qu(this,t,4,i)}resize(t){qp(this,t,4)}replace(t,i){i?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Bi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,s,h,f){ed(t,i,s,h,f,4)}setPixel(t,i,s){const h=4*(t*this.width+i);this.data[h+0]=Math.round(255*s.r/s.a),this.data[h+1]=Math.round(255*s.g/s.a),this.data[h+2]=Math.round(255*s.b/s.a),this.data[h+3]=Math.round(255*s.a)}}function Wp(n){const t={},i=n.resolution||256,s=n.clips?n.clips.length:1,h=n.image||new Bi({width:i,height:s});if(Math.log(i)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${i}`);const f=(m,y,x)=>{t[n.evaluationKey]=x;const T=n.expression.evaluate(t);h.setPixel(m/4/i,y/4,T)};if(n.clips)for(let m=0,y=0;m<s;++m,y+=4*i)for(let x=0,T=0;x<i;x++,T+=4){const E=x/(i-1),{start:I,end:D}=n.clips[m];f(y,T,I*(1-E)+D*E)}else for(let m=0,y=0;m<i;m++,y+=4)f(0,y,m/(i-1));return h}vt("AlphaImage",cc),vt("RGBAImage",Bi);const td="big-fb";class xg extends li{createBucket(t){return new Zp(t)}constructor(t){super(t,bg),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Wp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(td)&&this.heatmapFbos.delete(td)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Hp;var wg={get paint(){return Hp=Hp||new Pi({"hillshade-illumination-direction":new Tt(ve.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Tt(ve.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Tt(ve.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Tt(ve.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Tt(ve.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Tt(ve.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Tt(ve.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Tt(ve.paint_hillshade["hillshade-method"])})}};class Cg extends li{constructor(t){super(t,wg),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,i=this.paint.get("hillshade-illumination-altitude").values,s=this.paint.get("hillshade-highlight-color").values,h=this.paint.get("hillshade-shadow-color").values;const f=Math.max(t.length,i.length,s.length,h.length);t=t.concat(Array(f-t.length).fill(t.at(-1))),i=i.concat(Array(f-i.length).fill(i.at(-1))),s=s.concat(Array(f-s.length).fill(s.at(-1))),h=h.concat(Array(f-h.length).fill(h.at(-1)));const m=i.map(Xt);return{directionRadians:t.map(Xt),altitudeRadians:m,shadowColor:h,highlightColor:s}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let Xp;var Pg={get paint(){return Xp=Xp||new Pi({"color-relief-opacity":new Tt(ve["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Fo(ve["paint_color-relief"]["color-relief-color"])})}};class rd{constructor(t,i,s,h){this.context=t,this.format=s,this.texture=t.gl.createTexture(),this.update(i,h)}update(t,i,s){const{width:h,height:f}=t,m=!(this.size&&this.size[0]===h&&this.size[1]===f||s),{context:y}=this,{gl:x}=y;if(this.useMipmap=!!(i&&i.useMipmap),x.bindTexture(x.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!i||i.premultiply!==!1)),m)this.size=[h,f],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||nt(t)?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,t):x.texImage2D(x.TEXTURE_2D,0,this.format,h,f,0,this.format,x.UNSIGNED_BYTE,t.data);else{const{x:T,y:E}=s||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||nt(t)?x.texSubImage2D(x.TEXTURE_2D,0,T,E,x.RGBA,x.UNSIGNED_BYTE,t):x.texSubImage2D(x.TEXTURE_2D,0,T,E,h,f,x.RGBA,x.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&x.generateMipmap(x.TEXTURE_2D),y.pixelStoreUnpackFlipY.setDefault(),y.pixelStoreUnpack.setDefault(),y.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(t,i,s){const{context:h}=this,{gl:f}=h;f.bindTexture(f.TEXTURE_2D,this.texture),s!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(s=f.LINEAR),t!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,t),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,s||t),this.filter=t),i!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,i),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Kp{constructor(t,i,s,h=1,f=1,m=1,y=0){if(this.uid=t,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(s&&!["mapbox","terrarium","custom"].includes(s))return void de(`"${s}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=i.height;const x=this.dim=i.height-2;switch(this.data=new Uint32Array(i.data.buffer),s){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=h,this.greenFactor=f,this.blueFactor=m,this.baseShift=y;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let T=0;T<x;T++)this.data[this._idx(-1,T)]=this.data[this._idx(0,T)],this.data[this._idx(x,T)]=this.data[this._idx(x-1,T)],this.data[this._idx(T,-1)]=this.data[this._idx(T,0)],this.data[this._idx(T,x)]=this.data[this._idx(T,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let T=0;T<x;T++)for(let E=0;E<x;E++){const I=this.get(T,E);I>this.max&&(this.max=I),I<this.min&&(this.min=I)}}get(t,i){const s=new Uint8Array(this.data.buffer),h=4*this._idx(t,i);return this.unpack(s[h],s[h+1],s[h+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,i){if(t<-1||t>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(t+1)}unpack(t,i,s){return t*this.redFactor+i*this.greenFactor+s*this.blueFactor-this.baseShift}pack(t){return Yp(t,this.getUnpackVector())}getPixels(){return new Bi({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,i,s){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let h=i*this.dim,f=i*this.dim+this.dim,m=s*this.dim,y=s*this.dim+this.dim;switch(i){case-1:h=f-1;break;case 1:f=h+1}switch(s){case-1:m=y-1;break;case 1:y=m+1}const x=-i*this.dim,T=-s*this.dim;for(let E=m;E<y;E++)for(let I=h;I<f;I++)this.data[this._idx(I,E)]=t.data[this._idx(I+x,E+T)]}}function Yp(n,t){const i=t[0],s=t[1],h=t[2],f=t[3],m=Math.min(i,s,h),y=Math.round((n+f)/m);return{r:Math.floor(y*m/i)%256,g:Math.floor(y*m/s)%256,b:Math.floor(y*m/h)%256}}vt("DEMData",Kp);class Tg extends li{constructor(t){super(t,Pg)}_createColorRamp(t){const i={elevationStops:[],colorStops:[]},s=this._transitionablePaint._values["color-relief-color"].value.expression;if(s instanceof To&&s._styleExpression.expression instanceof wi){this.colorRampExpression=s;const m=s._styleExpression.expression;i.elevationStops=m.labels,i.colorStops=[];for(const y of i.elevationStops)i.colorStops.push(m.evaluate({globals:{elevation:y}}))}if(i.elevationStops.length<1&&(i.elevationStops=[0],i.colorStops=[Yt.transparent]),i.elevationStops.length<2&&(i.elevationStops.push(i.elevationStops[0]+1),i.colorStops.push(i.colorStops[0])),i.elevationStops.length<=t)return i;const h={elevationStops:[],colorStops:[]},f=(i.elevationStops.length-1)/(t-1);for(let m=0;m<i.elevationStops.length-.5;m+=f)h.elevationStops.push(i.elevationStops[Math.round(m)]),h.colorStops.push(i.colorStops[Math.round(m)]);return de(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),h}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(t,i,s){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const h=this._createColorRamp(i),f=new Bi({width:h.colorStops.length,height:1}),m=new Bi({width:h.colorStops.length,height:1});for(let y=0;y<h.elevationStops.length;y++){const x=Yp(h.elevationStops[y],s);m.setPixel(0,y,new Yt(x.r/255,x.g/255,x.b/255,1)),f.setPixel(0,y,h.colorStops[y])}return this.colorRampTextures={elevationTexture:new rd(t,m,t.gl.RGBA),colorTexture:new rd(t,f,t.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const Sg=Lr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Eg}=Sg;function id(n,t,i){const s=i.patternDependencies;let h=!1;for(const f of t){const m=f.paint.get(`${n}-pattern`);m.isConstant()||(h=!0);const y=m.constantOr(null);y&&(h=!0,s[y.to]=!0,s[y.from]=!0)}return h}function nd(n,t,i,s,h){const f=h.patternDependencies;for(const m of t){const y=m.paint.get(`${n}-pattern`).value;if(y.kind!=="constant"){let x=y.evaluate({zoom:s-1},i,{},h.availableImages),T=y.evaluate({zoom:s},i,{},h.availableImages),E=y.evaluate({zoom:s+1},i,{},h.availableImages);x=x&&x.name?x.name:x,T=T&&T.name?T.name:T,E=E&&E.name?E.name:E,f[x]=!0,f[T]=!0,f[E]=!0,i.patterns[m.id]={min:x,mid:T,max:E}}}return i}function Jp(n,t,i,s,h){let f;if(h===function(m,y,x,T){let E=0;for(let I=y,D=x-T;I<x;I+=T)E+=(m[D]-m[I])*(m[I+1]+m[D+1]),D=I;return E}(n,t,i,s)>0)for(let m=t;m<i;m+=s)f=rf(m/s|0,n[m],n[m+1],f);else for(let m=i-s;m>=t;m-=s)f=rf(m/s|0,n[m],n[m+1],f);return f&&$a(f,f.next)&&(pc(f),f=f.next),f}function Zo(n,t){if(!n)return n;t||(t=n);let i,s=n;do if(i=!1,s.steiner||!$a(s,s.next)&&Vr(s.prev,s,s.next)!==0)s=s.next;else{if(pc(s),s=t=s.prev,s===s.next)break;i=!0}while(i||s!==t);return t}function hc(n,t,i,s,h,f,m){if(!n)return;!m&&f&&function(x,T,E,I){let D=x;do D.z===0&&(D.z=sd(D.x,D.y,T,E,I)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==x);D.prevZ.nextZ=null,D.prevZ=null,function(B){let j,U=1;do{let X,re=B;B=null;let we=null;for(j=0;re;){j++;let pe=re,F=0;for(let me=0;me<U&&(F++,pe=pe.nextZ,pe);me++);let W=U;for(;F>0||W>0&&pe;)F!==0&&(W===0||!pe||re.z<=pe.z)?(X=re,re=re.nextZ,F--):(X=pe,pe=pe.nextZ,W--),we?we.nextZ=X:B=X,X.prevZ=we,we=X;re=pe}we.nextZ=null,U*=2}while(j>1)}(D)}(n,s,h,f);let y=n;for(;n.prev!==n.next;){const x=n.prev,T=n.next;if(f?Mg(n,s,h,f):kg(n))t.push(x.i,n.i,T.i),pc(n),n=T.next,y=T.next;else if((n=T)===y){m?m===1?hc(n=Ig(Zo(n),t),t,i,s,h,f,2):m===2&&Ag(n,t,i,s,h,f):hc(Zo(n),t,i,s,h,f,1);break}}}function kg(n){const t=n.prev,i=n,s=n.next;if(Vr(t,i,s)>=0)return!1;const h=t.x,f=i.x,m=s.x,y=t.y,x=i.y,T=s.y,E=Math.min(h,f,m),I=Math.min(y,x,T),D=Math.max(h,f,m),B=Math.max(y,x,T);let j=s.next;for(;j!==t;){if(j.x>=E&&j.x<=D&&j.y>=I&&j.y<=B&&uc(h,y,f,x,m,T,j.x,j.y)&&Vr(j.prev,j,j.next)>=0)return!1;j=j.next}return!0}function Mg(n,t,i,s){const h=n.prev,f=n,m=n.next;if(Vr(h,f,m)>=0)return!1;const y=h.x,x=f.x,T=m.x,E=h.y,I=f.y,D=m.y,B=Math.min(y,x,T),j=Math.min(E,I,D),U=Math.max(y,x,T),X=Math.max(E,I,D),re=sd(B,j,t,i,s),we=sd(U,X,t,i,s);let pe=n.prevZ,F=n.nextZ;for(;pe&&pe.z>=re&&F&&F.z<=we;){if(pe.x>=B&&pe.x<=U&&pe.y>=j&&pe.y<=X&&pe!==h&&pe!==m&&uc(y,E,x,I,T,D,pe.x,pe.y)&&Vr(pe.prev,pe,pe.next)>=0||(pe=pe.prevZ,F.x>=B&&F.x<=U&&F.y>=j&&F.y<=X&&F!==h&&F!==m&&uc(y,E,x,I,T,D,F.x,F.y)&&Vr(F.prev,F,F.next)>=0))return!1;F=F.nextZ}for(;pe&&pe.z>=re;){if(pe.x>=B&&pe.x<=U&&pe.y>=j&&pe.y<=X&&pe!==h&&pe!==m&&uc(y,E,x,I,T,D,pe.x,pe.y)&&Vr(pe.prev,pe,pe.next)>=0)return!1;pe=pe.prevZ}for(;F&&F.z<=we;){if(F.x>=B&&F.x<=U&&F.y>=j&&F.y<=X&&F!==h&&F!==m&&uc(y,E,x,I,T,D,F.x,F.y)&&Vr(F.prev,F,F.next)>=0)return!1;F=F.nextZ}return!0}function Ig(n,t){let i=n;do{const s=i.prev,h=i.next.next;!$a(s,h)&&ef(s,i,i.next,h)&&dc(s,h)&&dc(h,s)&&(t.push(s.i,i.i,h.i),pc(i),pc(i.next),i=n=h),i=i.next}while(i!==n);return Zo(i)}function Ag(n,t,i,s,h,f){let m=n;do{let y=m.next.next;for(;y!==m.prev;){if(m.i!==y.i&&Fg(m,y)){let x=tf(m,y);return m=Zo(m,m.next),x=Zo(x,x.next),hc(m,t,i,s,h,f,0),void hc(x,t,i,s,h,f,0)}y=y.next}m=m.next}while(m!==n)}function zg(n,t){let i=n.x-t.x;return i===0&&(i=n.y-t.y,i===0)&&(i=(n.next.y-n.y)/(n.next.x-n.x)-(t.next.y-t.y)/(t.next.x-t.x)),i}function Dg(n,t){const i=function(h,f){let m=f;const y=h.x,x=h.y;let T,E=-1/0;if($a(h,m))return m;do{if($a(h,m.next))return m.next;if(x<=m.y&&x>=m.next.y&&m.next.y!==m.y){const U=m.x+(x-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(U<=y&&U>E&&(E=U,T=m.x<m.next.x?m:m.next,U===y))return T}m=m.next}while(m!==f);if(!T)return null;const I=T,D=T.x,B=T.y;let j=1/0;m=T;do{if(y>=m.x&&m.x>=D&&y!==m.x&&Qp(x<B?y:E,x,D,B,x<B?E:y,x,m.x,m.y)){const U=Math.abs(x-m.y)/(y-m.x);dc(m,h)&&(U<j||U===j&&(m.x>T.x||m.x===T.x&&Rg(T,m)))&&(T=m,j=U)}m=m.next}while(m!==I);return T}(n,t);if(!i)return t;const s=tf(i,n);return Zo(s,s.next),Zo(i,i.next)}function Rg(n,t){return Vr(n.prev,n,t.prev)<0&&Vr(t.next,n,n.next)<0}function sd(n,t,i,s,h){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*h|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-s)*h|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Lg(n){let t=n,i=n;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==n);return i}function Qp(n,t,i,s,h,f,m,y){return(h-m)*(t-y)>=(n-m)*(f-y)&&(n-m)*(s-y)>=(i-m)*(t-y)&&(i-m)*(f-y)>=(h-m)*(s-y)}function uc(n,t,i,s,h,f,m,y){return!(n===m&&t===y)&&Qp(n,t,i,s,h,f,m,y)}function Fg(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!function(i,s){let h=i;do{if(h.i!==i.i&&h.next.i!==i.i&&h.i!==s.i&&h.next.i!==s.i&&ef(h,h.next,i,s))return!0;h=h.next}while(h!==i);return!1}(n,t)&&(dc(n,t)&&dc(t,n)&&function(i,s){let h=i,f=!1;const m=(i.x+s.x)/2,y=(i.y+s.y)/2;do h.y>y!=h.next.y>y&&h.next.y!==h.y&&m<(h.next.x-h.x)*(y-h.y)/(h.next.y-h.y)+h.x&&(f=!f),h=h.next;while(h!==i);return f}(n,t)&&(Vr(n.prev,n,t.prev)||Vr(n,t.prev,t))||$a(n,t)&&Vr(n.prev,n,n.next)>0&&Vr(t.prev,t,t.next)>0)}function Vr(n,t,i){return(t.y-n.y)*(i.x-t.x)-(t.x-n.x)*(i.y-t.y)}function $a(n,t){return n.x===t.x&&n.y===t.y}function ef(n,t,i,s){const h=Gh(Vr(n,t,i)),f=Gh(Vr(n,t,s)),m=Gh(Vr(i,s,n)),y=Gh(Vr(i,s,t));return h!==f&&m!==y||!(h!==0||!Zh(n,i,t))||!(f!==0||!Zh(n,s,t))||!(m!==0||!Zh(i,n,s))||!(y!==0||!Zh(i,t,s))}function Zh(n,t,i){return t.x<=Math.max(n.x,i.x)&&t.x>=Math.min(n.x,i.x)&&t.y<=Math.max(n.y,i.y)&&t.y>=Math.min(n.y,i.y)}function Gh(n){return n>0?1:n<0?-1:0}function dc(n,t){return Vr(n.prev,n,n.next)<0?Vr(n,t,n.next)>=0&&Vr(n,n.prev,t)>=0:Vr(n,t,n.prev)<0||Vr(n,n.next,t)<0}function tf(n,t){const i=od(n.i,n.x,n.y),s=od(t.i,t.x,t.y),h=n.next,f=t.prev;return n.next=t,t.prev=n,i.next=h,h.prev=i,s.next=i,i.prev=s,f.next=s,s.prev=f,s}function rf(n,t,i,s){const h=od(n,t,i);return s?(h.next=s.next,h.prev=s,s.next.prev=h,s.next=h):(h.prev=h,h.next=h),h}function pc(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function od(n,t,i){return{i:n,x:t,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Za{constructor(t,i){if(i>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=i}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class qh{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}qh.noSubdivision=new qh({fill:new Za(0,0),line:new Za(0,0),tile:new Za(0,0),stencil:new Za(0,0),circle:1}),vt("SubdivisionGranularityExpression",Za),vt("SubdivisionGranularitySetting",qh);const Ga=-32768,fc=32767;class Bg{constructor(t,i){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=ze/t,this._canonical=i}_getKey(t,i){return(t+=32768)<<16|i+32768}_vertexToIndex(t,i){if(t<-32768||i<-32768||t>32767||i>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const s=0|Math.round(t),h=0|Math.round(i),f=this._getKey(s,h);if(this._vertexDictionary.has(f))return this._vertexDictionary.get(f);const m=this._vertexBuffer.length/2;return this._vertexDictionary.set(f,m),this._vertexBuffer.push(s,h),m}_subdivideTrianglesScanline(t){if(this._granularity<2)return function(h,f){const m=[];for(let y=0;y<f.length;y+=3){const x=f[y],T=f[y+1],E=f[y+2],I=h[2*x],D=h[2*x+1];(h[2*T]-I)*(h[2*E+1]-D)-(h[2*T+1]-D)*(h[2*E]-I)>0?(m.push(x),m.push(E),m.push(T)):(m.push(x),m.push(T),m.push(E))}return m}(this._vertexBuffer,t);const i=[],s=t.length;for(let h=0;h<s;h+=3){const f=[t[h+0],t[h+1],t[h+2]],m=[this._vertexBuffer[2*t[h+0]+0],this._vertexBuffer[2*t[h+0]+1],this._vertexBuffer[2*t[h+1]+0],this._vertexBuffer[2*t[h+1]+1],this._vertexBuffer[2*t[h+2]+0],this._vertexBuffer[2*t[h+2]+1]];let y=1/0,x=1/0,T=-1/0,E=-1/0;for(let U=0;U<3;U++){const X=m[2*U],re=m[2*U+1];y=Math.min(y,X),T=Math.max(T,X),x=Math.min(x,re),E=Math.max(E,re)}if(y===T||x===E)continue;const I=Math.floor(y/this._granularityCellSize),D=Math.ceil(T/this._granularityCellSize),B=Math.floor(x/this._granularityCellSize),j=Math.ceil(E/this._granularityCellSize);if(I!==D||B!==j)for(let U=B;U<j;U++){const X=this._scanlineGenerateVertexRingForCellRow(U,m,f);Og(this._vertexBuffer,X,i)}else i.push(...f)}return i}_scanlineGenerateVertexRingForCellRow(t,i,s){const h=t*this._granularityCellSize,f=h+this._granularityCellSize,m=[];for(let y=0;y<3;y++){const x=i[2*y],T=i[2*y+1],E=i[2*(y+1)%6],I=i[(2*(y+1)+1)%6],D=i[2*(y+2)%6],B=i[(2*(y+2)+1)%6],j=E-x,U=I-T,X=j===0,re=U===0,we=(h-T)/U,pe=(f-T)/U,F=Math.min(we,pe),W=Math.max(we,pe);if(!re&&(F>=1||W<=0)||re&&(T<h||T>f)){I>=h&&I<=f&&m.push(s[(y+1)%3]);continue}!re&&F>0&&m.push(this._vertexToIndex(x+j*F,T+U*F));const me=x+j*Math.max(F,0),Le=x+j*Math.min(W,1);X||this._generateIntraEdgeVertices(m,x,T,E,I,me,Le),!re&&W<1&&m.push(this._vertexToIndex(x+j*W,T+U*W)),(re||I>=h&&I<=f)&&m.push(s[(y+1)%3]),!re&&(I<=h||I>=f)&&this._generateInterEdgeVertices(m,x,T,E,I,D,B,Le,h,f)}return m}_generateIntraEdgeVertices(t,i,s,h,f,m,y){const x=h-i,T=f-s,E=T===0,I=E?Math.min(i,h):Math.min(m,y),D=E?Math.max(i,h):Math.max(m,y),B=Math.floor(I/this._granularityCellSize)+1,j=Math.ceil(D/this._granularityCellSize)-1;if(E?i<h:m<y)for(let U=B;U<=j;U++){const X=U*this._granularityCellSize;t.push(this._vertexToIndex(X,s+T*(X-i)/x))}else for(let U=j;U>=B;U--){const X=U*this._granularityCellSize;t.push(this._vertexToIndex(X,s+T*(X-i)/x))}}_generateInterEdgeVertices(t,i,s,h,f,m,y,x,T,E){const I=f-s,D=m-h,B=y-f,j=(T-f)/B,U=(E-f)/B,X=Math.min(j,U),re=Math.max(j,U),we=h+D*X;let pe=Math.floor(Math.min(we,x)/this._granularityCellSize)+1,F=Math.ceil(Math.max(we,x)/this._granularityCellSize)-1,W=x<we;const me=B===0;if(me&&(y===T||y===E))return;if(me||X>=1||re<=0){const et=s-y,Ne=m+(i-m)*Math.min((T-y)/et,(E-y)/et);pe=Math.floor(Math.min(Ne,x)/this._granularityCellSize)+1,F=Math.ceil(Math.max(Ne,x)/this._granularityCellSize)-1,W=x<Ne}const Le=I>0?E:T;if(W)for(let et=pe;et<=F;et++)t.push(this._vertexToIndex(et*this._granularityCellSize,Le));else for(let et=F;et>=pe;et--)t.push(this._vertexToIndex(et*this._granularityCellSize,Le))}_generateOutline(t){const i=[];for(const s of t){const h=Go(s,this._granularity,!0),f=this._pointArrayToIndices(h),m=[];for(let y=1;y<f.length;y++)m.push(f[y-1]),m.push(f[y]);i.push(m)}return i}_handlePoles(t){let i=!1,s=!1;this._canonical&&(this._canonical.y===0&&(i=!0),this._canonical.y===(1<<this._canonical.z)-1&&(s=!0)),(i||s)&&this._fillPoles(t,i,s)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let i=0;i<t.length;i+=2){const s=t[i+1];s===Ga&&(t[i+1]=-32767),s===fc&&(t[i+1]=32766)}}_generatePoleQuad(t,i,s,h,f,m){h>f!=(m===Ga)?(t.push(i),t.push(s),t.push(this._vertexToIndex(h,m)),t.push(s),t.push(this._vertexToIndex(f,m)),t.push(this._vertexToIndex(h,m))):(t.push(s),t.push(i),t.push(this._vertexToIndex(h,m)),t.push(this._vertexToIndex(f,m)),t.push(s),t.push(this._vertexToIndex(h,m)))}_fillPoles(t,i,s){const h=this._vertexBuffer,f=ze,m=t.length;for(let y=2;y<m;y+=3){const x=t[y-2],T=t[y-1],E=t[y],I=h[2*x],D=h[2*x+1],B=h[2*T],j=h[2*T+1],U=h[2*E],X=h[2*E+1];i&&(D===0&&j===0&&this._generatePoleQuad(t,x,T,I,B,Ga),j===0&&X===0&&this._generatePoleQuad(t,T,E,B,U,Ga),X===0&&D===0&&this._generatePoleQuad(t,E,x,U,I,Ga)),s&&(D===f&&j===f&&this._generatePoleQuad(t,x,T,I,B,fc),j===f&&X===f&&this._generatePoleQuad(t,T,E,B,U,fc),X===f&&D===f&&this._generatePoleQuad(t,E,x,U,I,fc))}}_initializeVertices(t){for(let i=0;i<t.length;i+=2)this._vertexToIndex(t[i],t[i+1])}subdividePolygonInternal(t,i){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:s,holeIndices:h}=function(y){const x=[],T=[];for(const E of y)if(E.length!==0){E!==y[0]&&x.push(T.length/2);for(let I=0;I<E.length;I++)T.push(E[I].x),T.push(E[I].y)}return{flattened:T,holeIndices:x}}(t);let f;this._initializeVertices(s);try{const y=function(T,E,I=2){const D=E&&E.length,B=D?E[0]*I:T.length;let j=Jp(T,0,B,I,!0);const U=[];if(!j||j.next===j.prev)return U;let X,re,we;if(D&&(j=function(pe,F,W,me){const Le=[];for(let et=0,Ne=F.length;et<Ne;et++){const Ze=Jp(pe,F[et]*me,et<Ne-1?F[et+1]*me:pe.length,me,!1);Ze===Ze.next&&(Ze.steiner=!0),Le.push(Lg(Ze))}Le.sort(zg);for(let et=0;et<Le.length;et++)W=Dg(Le[et],W);return W}(T,E,j,I)),T.length>80*I){X=1/0,re=1/0;let pe=-1/0,F=-1/0;for(let W=I;W<B;W+=I){const me=T[W],Le=T[W+1];me<X&&(X=me),Le<re&&(re=Le),me>pe&&(pe=me),Le>F&&(F=Le)}we=Math.max(pe-X,F-re),we=we!==0?32767/we:0}return hc(j,U,I,X,re,we,0),U}(s,h),x=this._convertIndices(s,y);f=this._subdivideTrianglesScanline(x)}catch(y){console.error(y)}let m=[];return i&&(m=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(f),{verticesFlattened:this._vertexBuffer,indicesTriangles:f,indicesLineList:m}}_convertIndices(t,i){const s=[];for(let h=0;h<i.length;h++)s.push(this._vertexToIndex(t[2*i[h]],t[2*i[h]+1]));return s}_pointArrayToIndices(t){const i=[];for(let s=0;s<t.length;s++){const h=t[s];i.push(this._vertexToIndex(h.x,h.y))}return i}}function nf(n,t,i,s=!0){return new Bg(i,t).subdividePolygonInternal(n,s)}function Go(n,t,i=!1){if(!n||n.length<1)return[];if(n.length<2)return[];const s=n[0],h=n[n.length-1],f=i&&(s.x!==h.x||s.y!==h.y);if(t<2)return f?[...n,n[0]]:[...n];const m=Math.floor(ze/t),y=[];y.push(new H(n[0].x,n[0].y));const x=n.length,T=f?x:x-1;for(let E=0;E<T;E++){const I=n[E],D=E<x-1?n[E+1]:n[0],B=I.x,j=I.y,U=D.x,X=D.y,re=B!==U,we=j!==X;if(!re&&!we)continue;const pe=U-B,F=X-j,W=Math.abs(pe),me=Math.abs(F);let Le=B,et=j;for(;;){const Ze=pe>0?(Math.floor(Le/m)+1)*m:(Math.ceil(Le/m)-1)*m,st=F>0?(Math.floor(et/m)+1)*m:(Math.ceil(et/m)-1)*m,rt=Math.abs(Le-Ze),ot=Math.abs(et-st),We=Math.abs(Le-U),Pt=Math.abs(et-X),zt=re?rt/W:Number.POSITIVE_INFINITY,At=we?ot/me:Number.POSITIVE_INFINITY;if((We<=rt||!re)&&(Pt<=ot||!we))break;if(zt<At&&re||!we){Le=Ze,et+=F*zt;const St=new H(Le,Math.round(et));y[y.length-1].x===St.x&&y[y.length-1].y===St.y||y.push(St)}else{Le+=pe*At,et=st;const St=new H(Math.round(Le),et);y[y.length-1].x===St.x&&y[y.length-1].y===St.y||y.push(St)}}const Ne=new H(U,X);y[y.length-1].x===Ne.x&&y[y.length-1].y===Ne.y||y.push(Ne)}return y}function Og(n,t,i){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let s=0,h=n[2*t[0]];for(let x=1;x<t.length;x++){const T=n[2*t[x]];T<h&&(h=T,s=x)}const f=t.length;let m=s,y=(m+1)%f;for(;;){const x=m-1>=0?m-1:f-1,T=(y+1)%f,E=n[2*t[x]],I=n[2*t[T]],D=n[2*t[m]],B=n[2*t[m]+1],j=n[2*t[y]+1];let U=!1;if(E<I)U=!0;else if(E>I)U=!1;else{const X=j-B,re=-(n[2*t[y]]-D),we=B<j?1:-1;((E-D)*X+(n[2*t[x]+1]-B)*re)*we>((I-D)*X+(n[2*t[T]+1]-B)*re)*we&&(U=!0)}if(U){const X=t[x],re=t[m],we=t[y];X!==re&&X!==we&&re!==we&&i.push(we,re,X),m--,m<0&&(m=f-1)}else{const X=t[T],re=t[m],we=t[y];X!==re&&X!==we&&re!==we&&i.push(we,re,X),y++,y>=f&&(y=0)}if(x===T)break}}function sf(n,t,i,s,h,f,m,y,x){const T=h.length/2,E=m&&y&&x;if(T<nr.MAX_VERTEX_ARRAY_LENGTH){const I=t.prepareSegment(T,i,s),D=I.vertexLength;for(let U=0;U<f.length;U+=3)s.emplaceBack(D+f[U],D+f[U+1],D+f[U+2]);let B,j;I.vertexLength+=T,I.primitiveLength+=f.length/3,E&&(j=m.prepareSegment(T,i,y),B=j.vertexLength,j.vertexLength+=T);for(let U=0;U<h.length;U+=2)n(h[U],h[U+1]);if(E)for(let U=0;U<x.length;U++){const X=x[U];for(let re=1;re<X.length;re+=2)y.emplaceBack(B+X[re-1],B+X[re]);j.primitiveLength+=X.length/2}}else(function(I,D,B,j,U,X){const re=[];for(let me=0;me<j.length/2;me++)re.push(-1);const we={count:0};let pe=0,F=I.getOrCreateLatestSegment(D,B),W=F.vertexLength;for(let me=2;me<U.length;me+=3){const Le=U[me-2],et=U[me-1],Ne=U[me];let Ze=re[Le]<pe,st=re[et]<pe,rt=re[Ne]<pe;F.vertexLength+((Ze?1:0)+(st?1:0)+(rt?1:0))>nr.MAX_VERTEX_ARRAY_LENGTH&&(F=I.createNewSegment(D,B),pe=we.count,Ze=!0,st=!0,rt=!0,W=0);const ot=mc(re,j,X,we,Le,Ze,F),We=mc(re,j,X,we,et,st,F),Pt=mc(re,j,X,we,Ne,rt,F);B.emplaceBack(W+ot-pe,W+We-pe,W+Pt-pe),F.primitiveLength++}})(t,i,s,h,f,n),E&&function(I,D,B,j,U,X){const re=[];for(let me=0;me<j.length/2;me++)re.push(-1);const we={count:0};let pe=0,F=I.getOrCreateLatestSegment(D,B),W=F.vertexLength;for(let me=0;me<U.length;me++){const Le=U[me];for(let et=1;et<U[me].length;et+=2){const Ne=Le[et-1],Ze=Le[et];let st=re[Ne]<pe,rt=re[Ze]<pe;F.vertexLength+((st?1:0)+(rt?1:0))>nr.MAX_VERTEX_ARRAY_LENGTH&&(F=I.createNewSegment(D,B),pe=we.count,st=!0,rt=!0,W=0);const ot=mc(re,j,X,we,Ne,st,F),We=mc(re,j,X,we,Ze,rt,F);B.emplaceBack(W+ot-pe,W+We-pe),F.primitiveLength++}}}(m,i,y,h,x,n),t.forceNewSegmentOnNextPrepare(),m==null||m.forceNewSegmentOnNextPrepare()}function mc(n,t,i,s,h,f,m){if(f){const y=s.count;return i(t[2*h],t[2*h+1]),n[h]=s.count,s.count++,m.vertexLength++,y}return n[h]}class ad{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new je,this.indexArray=new gr,this.indexArray2=new _r,this.programConfigurations=new Gn(t.layers,t.zoom),this.segments=new nr,this.segments2=new nr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,s){this.hasPattern=id("fill",this.layers,i);const h=this.layers[0].layout.get("fill-sort-key"),f=!h.isConstant(),m=[];for(const{feature:y,id:x,index:T,sourceLayerIndex:E}of t){const I=this.layers[0]._featureFilter.needGeometry,D=$o(y,I);if(!this.layers[0]._featureFilter.filter(new Cr(this.zoom,{globalState:this.globalState}),D,s))continue;const B=f?h.evaluate(D,{},s,i.availableImages):void 0,j={id:x,properties:y.properties,type:y.type,sourceLayerIndex:E,index:T,geometry:I?D.geometry:Uo(y),patterns:{},sortKey:B};m.push(j)}f&&m.sort((y,x)=>y.sortKey-x.sortKey);for(const y of m){const{geometry:x,index:T,sourceLayerIndex:E}=y;if(this.hasPattern){const I=nd("fill",this.layers,y,this.zoom,i);this.patternFeatures.push(I)}else this.addFeature(y,x,T,s,{},i.subdivisionGranularity);i.featureIndex.insert(t[T].feature,x,T,E,this.index)}}update(t,i,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,s)}addFeatures(t,i,s){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,i,s,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Eg),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,i,s,h,f,m){for(const y of _a(i,500)){const x=nf(y,h,m.fill.getGranularityForZoomLevel(h.z)),T=this.layoutVertexArray;sf((E,I)=>{T.emplaceBack(E,I)},this.segments,this.layoutVertexArray,this.indexArray,x.verticesFlattened,x.indicesTriangles,this.segments2,this.indexArray2,x.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,f,h)}}let of,af;vt("FillBucket",ad,{omit:["layers","patternFeatures"]});var jg={get paint(){return af=af||new Pi({"fill-antialias":new Tt(ve.paint_fill["fill-antialias"]),"fill-opacity":new Dt(ve.paint_fill["fill-opacity"]),"fill-color":new Dt(ve.paint_fill["fill-color"]),"fill-outline-color":new Dt(ve.paint_fill["fill-outline-color"]),"fill-translate":new Tt(ve.paint_fill["fill-translate"]),"fill-translate-anchor":new Tt(ve.paint_fill["fill-translate-anchor"]),"fill-pattern":new ja(ve.paint_fill["fill-pattern"])})},get layout(){return of=of||new Pi({"fill-sort-key":new Dt(ve.layout_fill["fill-sort-key"])})}};class Vg extends li{constructor(t){super(t,jg)}recalculate(t,i){super.recalculate(t,i);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new ad(t)}queryRadius(){return Uh(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:i,transform:s,pixelsToTileUnits:h}){return Op($h(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-s.bearingInRadians,h),i)}isTileClipped(){return!0}}const Ng=Lr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Ug=Lr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:$g}=Ng;var ld,lf,cd,cf,hd,hf,uf,Wh={};function df(){if(lf)return ld;lf=1;var n=te();function t(h,f,m,y,x){this.properties={},this.extent=m,this.type=0,this._pbf=h,this._geometry=-1,this._keys=y,this._values=x,h.readFields(i,this,f)}function i(h,f,m){h==1?f.id=m.readVarint():h==2?function(y,x){for(var T=y.readVarint()+y.pos;y.pos<T;){var E=x._keys[y.readVarint()],I=x._values[y.readVarint()];x.properties[E]=I}}(m,f):h==3?f.type=m.readVarint():h==4&&(f._geometry=m.pos)}function s(h){for(var f,m,y=0,x=0,T=h.length,E=T-1;x<T;E=x++)y+=((m=h[E]).x-(f=h[x]).x)*(f.y+m.y);return y}return ld=t,t.types=["Unknown","Point","LineString","Polygon"],t.prototype.loadGeometry=function(){var h=this._pbf;h.pos=this._geometry;for(var f,m=h.readVarint()+h.pos,y=1,x=0,T=0,E=0,I=[];h.pos<m;){if(x<=0){var D=h.readVarint();y=7&D,x=D>>3}if(x--,y===1||y===2)T+=h.readSVarint(),E+=h.readSVarint(),y===1&&(f&&I.push(f),f=[]),f.push(new n(T,E));else{if(y!==7)throw new Error("unknown command "+y);f&&f.push(f[0].clone())}}return f&&I.push(f),I},t.prototype.bbox=function(){var h=this._pbf;h.pos=this._geometry;for(var f=h.readVarint()+h.pos,m=1,y=0,x=0,T=0,E=1/0,I=-1/0,D=1/0,B=-1/0;h.pos<f;){if(y<=0){var j=h.readVarint();m=7&j,y=j>>3}if(y--,m===1||m===2)(x+=h.readSVarint())<E&&(E=x),x>I&&(I=x),(T+=h.readSVarint())<D&&(D=T),T>B&&(B=T);else if(m!==7)throw new Error("unknown command "+m)}return[E,D,I,B]},t.prototype.toGeoJSON=function(h,f,m){var y,x,T=this.extent*Math.pow(2,m),E=this.extent*h,I=this.extent*f,D=this.loadGeometry(),B=t.types[this.type];function j(re){for(var we=0;we<re.length;we++){var pe=re[we];re[we]=[360*(pe.x+E)/T-180,360/Math.PI*Math.atan(Math.exp((180-360*(pe.y+I)/T)*Math.PI/180))-90]}}switch(this.type){case 1:var U=[];for(y=0;y<D.length;y++)U[y]=D[y][0];j(D=U);break;case 2:for(y=0;y<D.length;y++)j(D[y]);break;case 3:for(D=function(re){var we=re.length;if(we<=1)return[re];for(var pe,F,W=[],me=0;me<we;me++){var Le=s(re[me]);Le!==0&&(F===void 0&&(F=Le<0),F===Le<0?(pe&&W.push(pe),pe=[re[me]]):pe.push(re[me]))}return pe&&W.push(pe),W}(D),y=0;y<D.length;y++)for(x=0;x<D[y].length;x++)j(D[y][x])}D.length===1?D=D[0]:B="Multi"+B;var X={type:"Feature",geometry:{type:B,coordinates:D},properties:this.properties};return"id"in this&&(X.id=this.id),X},ld}function pf(){if(cf)return cd;cf=1;var n=df();function t(s,h){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(i,this,h),this.length=this._features.length}function i(s,h,f){s===15?h.version=f.readVarint():s===1?h.name=f.readString():s===5?h.extent=f.readVarint():s===2?h._features.push(f.pos):s===3?h._keys.push(f.readString()):s===4&&h._values.push(function(m){for(var y=null,x=m.readVarint()+m.pos;m.pos<x;){var T=m.readVarint()>>3;y=T===1?m.readString():T===2?m.readFloat():T===3?m.readDouble():T===4?m.readVarint64():T===5?m.readVarint():T===6?m.readSVarint():T===7?m.readBoolean():null}return y}(f))}return cd=t,t.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var h=this._pbf.readVarint()+this._pbf.pos;return new n(this._pbf,h,this.extent,this._keys,this._values)},cd}function ff(){return uf||(uf=1,Wh.VectorTile=function(){if(hf)return hd;hf=1;var n=pf();function t(i,s,h){if(i===3){var f=new n(h,h.readVarint()+h.pos);f.length&&(s[f.name]=f)}}return hd=function(i,s){this.layers=i.readFields(t,{},s)},hd}(),Wh.VectorTileFeature=df(),Wh.VectorTileLayer=pf()),Wh}var _c=$(ff());const Zg=_c.VectorTileFeature.types,ud=Math.pow(2,13);function gc(n,t,i,s,h,f,m,y){n.emplaceBack(t,i,2*Math.floor(s*ud)+m,h*ud*2,f*ud*2,Math.round(y))}class dd{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ft,this.centroidVertexArray=new De,this.indexArray=new gr,this.programConfigurations=new Gn(t.layers,t.zoom),this.segments=new nr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,s){this.features=[],this.hasPattern=id("fill-extrusion",this.layers,i);for(const{feature:h,id:f,index:m,sourceLayerIndex:y}of t){const x=this.layers[0]._featureFilter.needGeometry,T=$o(h,x);if(!this.layers[0]._featureFilter.filter(new Cr(this.zoom,{globalState:this.globalState}),T,s))continue;const E={id:f,sourceLayerIndex:y,index:m,geometry:x?T.geometry:Uo(h),properties:h.properties,type:h.type,patterns:{}};this.hasPattern?this.features.push(nd("fill-extrusion",this.layers,E,this.zoom,i)):this.addFeature(E,E.geometry,m,s,{},i.subdivisionGranularity),i.featureIndex.insert(h,E.geometry,m,y,this.index,!0)}}addFeatures(t,i,s){for(const h of this.features){const{geometry:f}=h;this.addFeature(h,f,h.index,i,s,t.subdivisionGranularity)}}update(t,i,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,$g),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Ug.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,i,s,h,f,m){for(const y of _a(i,500)){const x={x:0,y:0,sampleCount:0},T=this.layoutVertexArray.length;this.processPolygon(x,h,t,y,m);const E=this.layoutVertexArray.length-T,I=Math.floor(x.x/x.sampleCount),D=Math.floor(x.y/x.sampleCount);for(let B=0;B<E;B++)this.centroidVertexArray.emplaceBack(I,D)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,f,h)}processPolygon(t,i,s,h,f){if(h.length<1||mf(h[0]))return;for(const I of h)I.length!==0&&Gg(t,I);const m={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},y=f.fill.getGranularityForZoomLevel(i.z),x=Zg[s.type]==="Polygon";for(const I of h){if(I.length===0||mf(I))continue;const D=Go(I,y,x);this._generateSideFaces(D,m)}if(!x)return;const T=nf(h,i,y,!1),E=this.layoutVertexArray;sf((I,D)=>{gc(E,I,D,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,T.verticesFlattened,T.indicesTriangles)}_generateSideFaces(t,i){let s=0;for(let h=1;h<t.length;h++){const f=t[h],m=t[h-1];if(qg(f,m))continue;i.segment.vertexLength+4>nr.MAX_VERTEX_ARRAY_LENGTH&&(i.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const y=f.sub(m)._perp()._unit(),x=m.dist(f);s+x>32768&&(s=0),gc(this.layoutVertexArray,f.x,f.y,y.x,y.y,0,0,s),gc(this.layoutVertexArray,f.x,f.y,y.x,y.y,0,1,s),s+=x,gc(this.layoutVertexArray,m.x,m.y,y.x,y.y,0,0,s),gc(this.layoutVertexArray,m.x,m.y,y.x,y.y,0,1,s);const T=i.segment.vertexLength;this.indexArray.emplaceBack(T,T+2,T+1),this.indexArray.emplaceBack(T+1,T+2,T+3),i.segment.vertexLength+=4,i.segment.primitiveLength+=2}}}function Gg(n,t){for(let i=0;i<t.length;i++){const s=t[i];i===t.length-1&&t[0].x===s.x&&t[0].y===s.y||(n.x+=s.x,n.y+=s.y,n.sampleCount++)}}function qg(n,t){return n.x===t.x&&(n.x<0||n.x>ze)||n.y===t.y&&(n.y<0||n.y>ze)}function mf(n){return n.every(t=>t.x<0)||n.every(t=>t.x>ze)||n.every(t=>t.y<0)||n.every(t=>t.y>ze)}let _f;vt("FillExtrusionBucket",dd,{omit:["layers","features"]});var Wg={get paint(){return _f=_f||new Pi({"fill-extrusion-opacity":new Tt(ve["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Dt(ve["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Tt(ve["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Tt(ve["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ja(ve["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Dt(ve["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Dt(ve["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Tt(ve["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Hg extends li{constructor(t){super(t,Wg)}createBucket(t){return new dd(t)}queryRadius(){return Uh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:i,featureState:s,geometry:h,transform:f,pixelsToTileUnits:m,pixelPosMatrix:y}){const x=$h(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-f.bearingInRadians,m),T=this.paint.get("fill-extrusion-height").evaluate(i,s),E=this.paint.get("fill-extrusion-base").evaluate(i,s),I=function(B,j){const U=[];for(const X of B){const re=[X.x,X.y,0,1];at(re,re,j),U.push(new H(re[0]/re[3],re[1]/re[3]))}return U}(x,y),D=function(B,j,U,X){const re=[],we=[],pe=X[8]*j,F=X[9]*j,W=X[10]*j,me=X[11]*j,Le=X[8]*U,et=X[9]*U,Ne=X[10]*U,Ze=X[11]*U;for(const st of B){const rt=[],ot=[];for(const We of st){const Pt=We.x,zt=We.y,At=X[0]*Pt+X[4]*zt+X[12],St=X[1]*Pt+X[5]*zt+X[13],tr=X[2]*Pt+X[6]*zt+X[14],Fr=X[3]*Pt+X[7]*zt+X[15],Hr=tr+W,bi=Fr+me,tn=At+Le,Oi=St+et,di=tr+Ne,Ar=Fr+Ze,ri=new H((At+pe)/bi,(St+F)/bi);ri.z=Hr/bi,rt.push(ri);const pi=new H(tn/Ar,Oi/Ar);pi.z=di/Ar,ot.push(pi)}re.push(rt),we.push(ot)}return[re,we]}(h,E,T,y);return function(B,j,U){let X=1/0;Op(U,j)&&(X=gf(U,j[0]));for(let re=0;re<j.length;re++){const we=j[re],pe=B[re];for(let F=0;F<we.length-1;F++){const W=we[F],me=[W,we[F+1],pe[F+1],pe[F],W];Bp(U,me)&&(X=Math.min(X,gf(U,me)))}}return X!==1/0&&X}(D[0],D[1],I)}}function yc(n,t){return n.x*t.x+n.y*t.y}function gf(n,t){if(n.length===1){let i=0;const s=t[i++];let h;for(;!h||s.equals(h);)if(h=t[i++],!h)return 1/0;for(;i<t.length;i++){const f=t[i],m=n[0],y=h.sub(s),x=f.sub(s),T=m.sub(s),E=yc(y,y),I=yc(y,x),D=yc(x,x),B=yc(T,y),j=yc(T,x),U=E*D-I*I,X=(D*B-I*j)/U,re=(E*j-I*B)/U,we=s.z*(1-X-re)+h.z*X+f.z*re;if(isFinite(we))return we}return 1/0}{let i=1/0;for(const s of t)i=Math.min(i,s.z);return i}}const Xg=Lr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Kg}=Xg,Yg=Lr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Jg}=Yg,Qg=_c.VectorTileFeature.types,ey=Math.cos(Math.PI/180*37.5),yf=Math.pow(2,14)/.5;class pd{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new ht,this.layoutVertexArray2=new tt,this.indexArray=new gr,this.programConfigurations=new Gn(t.layers,t.zoom),this.segments=new nr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,s){this.hasPattern=id("line",this.layers,i);const h=this.layers[0].layout.get("line-sort-key"),f=!h.isConstant(),m=[];for(const{feature:y,id:x,index:T,sourceLayerIndex:E}of t){const I=this.layers[0]._featureFilter.needGeometry,D=$o(y,I);if(!this.layers[0]._featureFilter.filter(new Cr(this.zoom,{globalState:this.globalState}),D,s))continue;const B=f?h.evaluate(D,{},s):void 0,j={id:x,properties:y.properties,type:y.type,sourceLayerIndex:E,index:T,geometry:I?D.geometry:Uo(y),patterns:{},sortKey:B};m.push(j)}f&&m.sort((y,x)=>y.sortKey-x.sortKey);for(const y of m){const{geometry:x,index:T,sourceLayerIndex:E}=y;if(this.hasPattern){const I=nd("line",this.layers,y,this.zoom,i);this.patternFeatures.push(I)}else this.addFeature(y,x,T,s,{},i.subdivisionGranularity);i.featureIndex.insert(t[T].feature,x,T,E,this.index)}}update(t,i,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,s)}addFeatures(t,i,s){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,i,s,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Jg)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Kg),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,i,s,h,f,m){const y=this.layers[0].layout,x=y.get("line-join").evaluate(t,{}),T=y.get("line-cap"),E=y.get("line-miter-limit"),I=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const D of i)this.addLine(D,t,x,T,E,I,h,m);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,f,h)}addLine(t,i,s,h,f,m,y,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=Go(t,y?x.line.getGranularityForZoomLevel(y.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let pe=0;pe<t.length-1;pe++)this.totalDistance+=t[pe].dist(t[pe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=Qg[i.type]==="Polygon";let E=t.length;for(;E>=2&&t[E-1].equals(t[E-2]);)E--;let I=0;for(;I<E-1&&t[I].equals(t[I+1]);)I++;if(E<(T?3:2))return;s==="bevel"&&(f=1.05);const D=this.overscaling<=16?122880/(512*this.overscaling):0,B=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let j,U,X,re,we;this.e1=this.e2=-1,T&&(j=t[E-2],we=t[I].sub(j)._unit()._perp());for(let pe=I;pe<E;pe++){if(X=pe===E-1?T?t[I+1]:void 0:t[pe+1],X&&t[pe].equals(X))continue;we&&(re=we),j&&(U=j),j=t[pe],we=X?X.sub(j)._unit()._perp():re,re=re||we;let F=re.add(we);F.x===0&&F.y===0||F._unit();const W=re.x*we.x+re.y*we.y,me=F.x*we.x+F.y*we.y,Le=me!==0?1/me:1/0,et=2*Math.sqrt(2-2*me),Ne=me<ey&&U&&X,Ze=re.x*we.y-re.y*we.x>0;if(Ne&&pe>I){const ot=j.dist(U);if(ot>2*D){const We=j.sub(j.sub(U)._mult(D/ot)._round());this.updateDistance(U,We),this.addCurrentVertex(We,re,0,0,B),U=We}}const st=U&&X;let rt=st?s:T?"butt":h;if(st&&rt==="round"&&(Le<m?rt="miter":Le<=2&&(rt="fakeround")),rt==="miter"&&Le>f&&(rt="bevel"),rt==="bevel"&&(Le>2&&(rt="flipbevel"),Le<f&&(rt="miter")),U&&this.updateDistance(U,j),rt==="miter")F._mult(Le),this.addCurrentVertex(j,F,0,0,B);else if(rt==="flipbevel"){if(Le>100)F=we.mult(-1);else{const ot=Le*re.add(we).mag()/re.sub(we).mag();F._perp()._mult(ot*(Ze?-1:1))}this.addCurrentVertex(j,F,0,0,B),this.addCurrentVertex(j,F.mult(-1),0,0,B)}else if(rt==="bevel"||rt==="fakeround"){const ot=-Math.sqrt(Le*Le-1),We=Ze?ot:0,Pt=Ze?0:ot;if(U&&this.addCurrentVertex(j,re,We,Pt,B),rt==="fakeround"){const zt=Math.round(180*et/Math.PI/20);for(let At=1;At<zt;At++){let St=At/zt;if(St!==.5){const Fr=St-.5;St+=St*Fr*(St-1)*((1.0904+W*(W*(3.55645-1.43519*W)-3.2452))*Fr*Fr+(.848013+W*(.215638*W-1.06021)))}const tr=we.sub(re)._mult(St)._add(re)._unit()._mult(Ze?-1:1);this.addHalfVertex(j,tr.x,tr.y,!1,Ze,0,B)}}X&&this.addCurrentVertex(j,we,-We,-Pt,B)}else if(rt==="butt")this.addCurrentVertex(j,F,0,0,B);else if(rt==="square"){const ot=U?1:-1;this.addCurrentVertex(j,F,ot,ot,B)}else rt==="round"&&(U&&(this.addCurrentVertex(j,re,0,0,B),this.addCurrentVertex(j,re,1,1,B,!0)),X&&(this.addCurrentVertex(j,we,-1,-1,B,!0),this.addCurrentVertex(j,we,0,0,B)));if(Ne&&pe<E-1){const ot=j.dist(X);if(ot>2*D){const We=j.add(X.sub(j)._mult(D/ot)._round());this.updateDistance(j,We),this.addCurrentVertex(We,we,0,0,B),j=We}}}}addCurrentVertex(t,i,s,h,f,m=!1){const y=i.y*h-i.x,x=-i.y-i.x*h;this.addHalfVertex(t,i.x+i.y*s,i.y-i.x*s,m,!1,s,f),this.addHalfVertex(t,y,x,m,!0,-h,f),this.distance>yf/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,i,s,h,f,m))}addHalfVertex({x:t,y:i},s,h,f,m,y,x){const T=.5*(this.lineClips?this.scaledDistance*(yf-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(f?1:0),(i<<1)+(m?1:0),Math.round(63*s)+128,Math.round(63*h)+128,1+(y===0?0:y<0?-1:1)|(63&T)<<2,T>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const E=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,E,this.e2),x.primitiveLength++),m?this.e2=E:this.e1=E}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,i){this.distance+=t.dist(i),this.updateScaledDistance()}}let vf,bf;vt("LineBucket",pd,{omit:["layers","patternFeatures"]});var xf={get paint(){return bf=bf||new Pi({"line-opacity":new Dt(ve.paint_line["line-opacity"]),"line-color":new Dt(ve.paint_line["line-color"]),"line-translate":new Tt(ve.paint_line["line-translate"]),"line-translate-anchor":new Tt(ve.paint_line["line-translate-anchor"]),"line-width":new Dt(ve.paint_line["line-width"]),"line-gap-width":new Dt(ve.paint_line["line-gap-width"]),"line-offset":new Dt(ve.paint_line["line-offset"]),"line-blur":new Dt(ve.paint_line["line-blur"]),"line-dasharray":new ec(ve.paint_line["line-dasharray"]),"line-pattern":new ja(ve.paint_line["line-pattern"]),"line-gradient":new Fo(ve.paint_line["line-gradient"])})},get layout(){return vf=vf||new Pi({"line-cap":new Tt(ve.layout_line["line-cap"]),"line-join":new Dt(ve.layout_line["line-join"]),"line-miter-limit":new Tt(ve.layout_line["line-miter-limit"]),"line-round-limit":new Tt(ve.layout_line["line-round-limit"]),"line-sort-key":new Dt(ve.layout_line["line-sort-key"])})}};class ty extends Dt{possiblyEvaluate(t,i){return i=new Cr(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),super.possiblyEvaluate(t,i)}evaluate(t,i,s,h){return i=or({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(t,i,s,h)}}let Hh;class ry extends li{constructor(t){super(t,xf),this.gradientVersion=0,Hh||(Hh=new ty(xf.paint.properties["line-width"].specification),Hh.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const i=this.gradientExpression();this.stepInterpolant=!!function(s){return s._styleExpression!==void 0}(i)&&i._styleExpression.expression instanceof Ts,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,i){super.recalculate(t,i),this.paint._values["line-floorwidth"]=Hh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new pd(t)}queryRadius(t){const i=t,s=wf(lc("line-width",this,i),lc("line-gap-width",this,i)),h=lc("line-offset",this,i);return s/2+Math.abs(h)+Uh(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:i,featureState:s,geometry:h,transform:f,pixelsToTileUnits:m}){const y=$h(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-f.bearingInRadians,m),x=m/2*wf(this.paint.get("line-width").evaluate(i,s),this.paint.get("line-gap-width").evaluate(i,s)),T=this.paint.get("line-offset").evaluate(i,s);return T&&(h=function(E,I){const D=[];for(let B=0;B<E.length;B++){const j=E[B],U=[];for(let X=0;X<j.length;X++){const re=j[X-1],we=j[X],pe=j[X+1],F=X===0?new H(0,0):we.sub(re)._unit()._perp(),W=X===j.length-1?new H(0,0):pe.sub(we)._unit()._perp(),me=F._add(W)._unit(),Le=me.x*W.x+me.y*W.y;Le!==0&&me._mult(1/Le),U.push(me._mult(I)._add(we))}D.push(U)}return D}(h,T*m)),function(E,I,D){for(let B=0;B<I.length;B++){const j=I[B];if(E.length>=3){for(let U=0;U<j.length;U++)if(Ua(E,j[U]))return!0}if(mg(E,j,D))return!0}return!1}(y,h,x)}isTileClipped(){return!0}}function wf(n,t){return t>0?t+2*n:n}const iy=Lr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),ny=Lr([{name:"a_projected_pos",components:3,type:"Float32"}],4);Lr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const sy=Lr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Lr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Cf=Lr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),oy=Lr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function ay(n,t,i){return n.sections.forEach(s=>{s.text=function(h,f,m){const y=f.layout.get("text-transform").evaluate(m,{});return y==="uppercase"?h=h.toLocaleUpperCase():y==="lowercase"&&(h=h.toLocaleLowerCase()),On.applyArabicShaping&&(h=On.applyArabicShaping(h)),h}(s.text,t,i)}),n}Lr([{name:"triangle",components:3,type:"Uint16"}]),Lr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Lr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Lr([{type:"Float32",name:"offsetX"}]),Lr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Lr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const vc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Pf,fd,Tf,ti=24,md={};function ly(){return Pf||(Pf=1,md.read=function(n,t,i,s,h){var f,m,y=8*h-s-1,x=(1<<y)-1,T=x>>1,E=-7,I=i?h-1:0,D=i?-1:1,B=n[t+I];for(I+=D,f=B&(1<<-E)-1,B>>=-E,E+=y;E>0;f=256*f+n[t+I],I+=D,E-=8);for(m=f&(1<<-E)-1,f>>=-E,E+=s;E>0;m=256*m+n[t+I],I+=D,E-=8);if(f===0)f=1-T;else{if(f===x)return m?NaN:1/0*(B?-1:1);m+=Math.pow(2,s),f-=T}return(B?-1:1)*m*Math.pow(2,f-s)},md.write=function(n,t,i,s,h,f){var m,y,x,T=8*f-h-1,E=(1<<T)-1,I=E>>1,D=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,B=s?0:f-1,j=s?1:-1,U=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(y=isNaN(t)?1:0,m=E):(m=Math.floor(Math.log(t)/Math.LN2),t*(x=Math.pow(2,-m))<1&&(m--,x*=2),(t+=m+I>=1?D/x:D*Math.pow(2,1-I))*x>=2&&(m++,x/=2),m+I>=E?(y=0,m=E):m+I>=1?(y=(t*x-1)*Math.pow(2,h),m+=I):(y=t*Math.pow(2,I-1)*Math.pow(2,h),m=0));h>=8;n[i+B]=255&y,B+=j,y/=256,h-=8);for(m=m<<h|y,T+=h;T>0;n[i+B]=255&m,B+=j,m/=256,T-=8);n[i+B-j]|=128*U}),md}function Sf(){if(Tf)return fd;Tf=1,fd=t;var n=ly();function t(F){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(F)?F:new Uint8Array(F||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var i=4294967296,s=1/i,h=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function f(F){return F.type===t.Bytes?F.readVarint()+F.pos:F.pos+1}function m(F,W,me){return me?4294967296*W+(F>>>0):4294967296*(W>>>0)+(F>>>0)}function y(F,W,me){var Le=W<=16383?1:W<=2097151?2:W<=268435455?3:Math.floor(Math.log(W)/(7*Math.LN2));me.realloc(Le);for(var et=me.pos-1;et>=F;et--)me.buf[et+Le]=me.buf[et]}function x(F,W){for(var me=0;me<F.length;me++)W.writeVarint(F[me])}function T(F,W){for(var me=0;me<F.length;me++)W.writeSVarint(F[me])}function E(F,W){for(var me=0;me<F.length;me++)W.writeFloat(F[me])}function I(F,W){for(var me=0;me<F.length;me++)W.writeDouble(F[me])}function D(F,W){for(var me=0;me<F.length;me++)W.writeBoolean(F[me])}function B(F,W){for(var me=0;me<F.length;me++)W.writeFixed32(F[me])}function j(F,W){for(var me=0;me<F.length;me++)W.writeSFixed32(F[me])}function U(F,W){for(var me=0;me<F.length;me++)W.writeFixed64(F[me])}function X(F,W){for(var me=0;me<F.length;me++)W.writeSFixed64(F[me])}function re(F,W){return(F[W]|F[W+1]<<8|F[W+2]<<16)+16777216*F[W+3]}function we(F,W,me){F[me]=W,F[me+1]=W>>>8,F[me+2]=W>>>16,F[me+3]=W>>>24}function pe(F,W){return(F[W]|F[W+1]<<8|F[W+2]<<16)+(F[W+3]<<24)}return t.prototype={destroy:function(){this.buf=null},readFields:function(F,W,me){for(me=me||this.length;this.pos<me;){var Le=this.readVarint(),et=Le>>3,Ne=this.pos;this.type=7&Le,F(et,W,this),this.pos===Ne&&this.skip(Le)}return W},readMessage:function(F,W){return this.readFields(F,W,this.readVarint()+this.pos)},readFixed32:function(){var F=re(this.buf,this.pos);return this.pos+=4,F},readSFixed32:function(){var F=pe(this.buf,this.pos);return this.pos+=4,F},readFixed64:function(){var F=re(this.buf,this.pos)+re(this.buf,this.pos+4)*i;return this.pos+=8,F},readSFixed64:function(){var F=re(this.buf,this.pos)+pe(this.buf,this.pos+4)*i;return this.pos+=8,F},readFloat:function(){var F=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,F},readDouble:function(){var F=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,F},readVarint:function(F){var W,me,Le=this.buf;return W=127&(me=Le[this.pos++]),me<128?W:(W|=(127&(me=Le[this.pos++]))<<7,me<128?W:(W|=(127&(me=Le[this.pos++]))<<14,me<128?W:(W|=(127&(me=Le[this.pos++]))<<21,me<128?W:function(et,Ne,Ze){var st,rt,ot=Ze.buf;if(st=(112&(rt=ot[Ze.pos++]))>>4,rt<128||(st|=(127&(rt=ot[Ze.pos++]))<<3,rt<128)||(st|=(127&(rt=ot[Ze.pos++]))<<10,rt<128)||(st|=(127&(rt=ot[Ze.pos++]))<<17,rt<128)||(st|=(127&(rt=ot[Ze.pos++]))<<24,rt<128)||(st|=(1&(rt=ot[Ze.pos++]))<<31,rt<128))return m(et,st,Ne);throw new Error("Expected varint not more than 10 bytes")}(W|=(15&(me=Le[this.pos]))<<28,F,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var F=this.readVarint();return F%2==1?(F+1)/-2:F/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var F=this.readVarint()+this.pos,W=this.pos;return this.pos=F,F-W>=12&&h?function(me,Le,et){return h.decode(me.subarray(Le,et))}(this.buf,W,F):function(me,Le,et){for(var Ne="",Ze=Le;Ze<et;){var st,rt,ot,We=me[Ze],Pt=null,zt=We>239?4:We>223?3:We>191?2:1;if(Ze+zt>et)break;zt===1?We<128&&(Pt=We):zt===2?(192&(st=me[Ze+1]))==128&&(Pt=(31&We)<<6|63&st)<=127&&(Pt=null):zt===3?(rt=me[Ze+2],(192&(st=me[Ze+1]))==128&&(192&rt)==128&&((Pt=(15&We)<<12|(63&st)<<6|63&rt)<=2047||Pt>=55296&&Pt<=57343)&&(Pt=null)):zt===4&&(rt=me[Ze+2],ot=me[Ze+3],(192&(st=me[Ze+1]))==128&&(192&rt)==128&&(192&ot)==128&&((Pt=(15&We)<<18|(63&st)<<12|(63&rt)<<6|63&ot)<=65535||Pt>=1114112)&&(Pt=null)),Pt===null?(Pt=65533,zt=1):Pt>65535&&(Pt-=65536,Ne+=String.fromCharCode(Pt>>>10&1023|55296),Pt=56320|1023&Pt),Ne+=String.fromCharCode(Pt),Ze+=zt}return Ne}(this.buf,W,F)},readBytes:function(){var F=this.readVarint()+this.pos,W=this.buf.subarray(this.pos,F);return this.pos=F,W},readPackedVarint:function(F,W){if(this.type!==t.Bytes)return F.push(this.readVarint(W));var me=f(this);for(F=F||[];this.pos<me;)F.push(this.readVarint(W));return F},readPackedSVarint:function(F){if(this.type!==t.Bytes)return F.push(this.readSVarint());var W=f(this);for(F=F||[];this.pos<W;)F.push(this.readSVarint());return F},readPackedBoolean:function(F){if(this.type!==t.Bytes)return F.push(this.readBoolean());var W=f(this);for(F=F||[];this.pos<W;)F.push(this.readBoolean());return F},readPackedFloat:function(F){if(this.type!==t.Bytes)return F.push(this.readFloat());var W=f(this);for(F=F||[];this.pos<W;)F.push(this.readFloat());return F},readPackedDouble:function(F){if(this.type!==t.Bytes)return F.push(this.readDouble());var W=f(this);for(F=F||[];this.pos<W;)F.push(this.readDouble());return F},readPackedFixed32:function(F){if(this.type!==t.Bytes)return F.push(this.readFixed32());var W=f(this);for(F=F||[];this.pos<W;)F.push(this.readFixed32());return F},readPackedSFixed32:function(F){if(this.type!==t.Bytes)return F.push(this.readSFixed32());var W=f(this);for(F=F||[];this.pos<W;)F.push(this.readSFixed32());return F},readPackedFixed64:function(F){if(this.type!==t.Bytes)return F.push(this.readFixed64());var W=f(this);for(F=F||[];this.pos<W;)F.push(this.readFixed64());return F},readPackedSFixed64:function(F){if(this.type!==t.Bytes)return F.push(this.readSFixed64());var W=f(this);for(F=F||[];this.pos<W;)F.push(this.readSFixed64());return F},skip:function(F){var W=7&F;if(W===t.Varint)for(;this.buf[this.pos++]>127;);else if(W===t.Bytes)this.pos=this.readVarint()+this.pos;else if(W===t.Fixed32)this.pos+=4;else{if(W!==t.Fixed64)throw new Error("Unimplemented type: "+W);this.pos+=8}},writeTag:function(F,W){this.writeVarint(F<<3|W)},realloc:function(F){for(var W=this.length||16;W<this.pos+F;)W*=2;if(W!==this.length){var me=new Uint8Array(W);me.set(this.buf),this.buf=me,this.length=W}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(F){this.realloc(4),we(this.buf,F,this.pos),this.pos+=4},writeSFixed32:function(F){this.realloc(4),we(this.buf,F,this.pos),this.pos+=4},writeFixed64:function(F){this.realloc(8),we(this.buf,-1&F,this.pos),we(this.buf,Math.floor(F*s),this.pos+4),this.pos+=8},writeSFixed64:function(F){this.realloc(8),we(this.buf,-1&F,this.pos),we(this.buf,Math.floor(F*s),this.pos+4),this.pos+=8},writeVarint:function(F){(F=+F||0)>268435455||F<0?function(W,me){var Le,et;if(W>=0?(Le=W%4294967296|0,et=W/4294967296|0):(et=~(-W/4294967296),4294967295^(Le=~(-W%4294967296))?Le=Le+1|0:(Le=0,et=et+1|0)),W>=18446744073709552e3||W<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");me.realloc(10),function(Ne,Ze,st){st.buf[st.pos++]=127&Ne|128,Ne>>>=7,st.buf[st.pos++]=127&Ne|128,Ne>>>=7,st.buf[st.pos++]=127&Ne|128,Ne>>>=7,st.buf[st.pos++]=127&Ne|128,st.buf[st.pos]=127&(Ne>>>=7)}(Le,0,me),function(Ne,Ze){var st=(7&Ne)<<4;Ze.buf[Ze.pos++]|=st|((Ne>>>=3)?128:0),Ne&&(Ze.buf[Ze.pos++]=127&Ne|((Ne>>>=7)?128:0),Ne&&(Ze.buf[Ze.pos++]=127&Ne|((Ne>>>=7)?128:0),Ne&&(Ze.buf[Ze.pos++]=127&Ne|((Ne>>>=7)?128:0),Ne&&(Ze.buf[Ze.pos++]=127&Ne|((Ne>>>=7)?128:0),Ne&&(Ze.buf[Ze.pos++]=127&Ne)))))}(et,me)}(F,this):(this.realloc(4),this.buf[this.pos++]=127&F|(F>127?128:0),F<=127||(this.buf[this.pos++]=127&(F>>>=7)|(F>127?128:0),F<=127||(this.buf[this.pos++]=127&(F>>>=7)|(F>127?128:0),F<=127||(this.buf[this.pos++]=F>>>7&127))))},writeSVarint:function(F){this.writeVarint(F<0?2*-F-1:2*F)},writeBoolean:function(F){this.writeVarint(!!F)},writeString:function(F){F=String(F),this.realloc(4*F.length),this.pos++;var W=this.pos;this.pos=function(Le,et,Ne){for(var Ze,st,rt=0;rt<et.length;rt++){if((Ze=et.charCodeAt(rt))>55295&&Ze<57344){if(!st){Ze>56319||rt+1===et.length?(Le[Ne++]=239,Le[Ne++]=191,Le[Ne++]=189):st=Ze;continue}if(Ze<56320){Le[Ne++]=239,Le[Ne++]=191,Le[Ne++]=189,st=Ze;continue}Ze=st-55296<<10|Ze-56320|65536,st=null}else st&&(Le[Ne++]=239,Le[Ne++]=191,Le[Ne++]=189,st=null);Ze<128?Le[Ne++]=Ze:(Ze<2048?Le[Ne++]=Ze>>6|192:(Ze<65536?Le[Ne++]=Ze>>12|224:(Le[Ne++]=Ze>>18|240,Le[Ne++]=Ze>>12&63|128),Le[Ne++]=Ze>>6&63|128),Le[Ne++]=63&Ze|128)}return Ne}(this.buf,F,this.pos);var me=this.pos-W;me>=128&&y(W,me,this),this.pos=W-1,this.writeVarint(me),this.pos+=me},writeFloat:function(F){this.realloc(4),n.write(this.buf,F,this.pos,!0,23,4),this.pos+=4},writeDouble:function(F){this.realloc(8),n.write(this.buf,F,this.pos,!0,52,8),this.pos+=8},writeBytes:function(F){var W=F.length;this.writeVarint(W),this.realloc(W);for(var me=0;me<W;me++)this.buf[this.pos++]=F[me]},writeRawMessage:function(F,W){this.pos++;var me=this.pos;F(W,this);var Le=this.pos-me;Le>=128&&y(me,Le,this),this.pos=me-1,this.writeVarint(Le),this.pos+=Le},writeMessage:function(F,W,me){this.writeTag(F,t.Bytes),this.writeRawMessage(W,me)},writePackedVarint:function(F,W){W.length&&this.writeMessage(F,x,W)},writePackedSVarint:function(F,W){W.length&&this.writeMessage(F,T,W)},writePackedBoolean:function(F,W){W.length&&this.writeMessage(F,D,W)},writePackedFloat:function(F,W){W.length&&this.writeMessage(F,E,W)},writePackedDouble:function(F,W){W.length&&this.writeMessage(F,I,W)},writePackedFixed32:function(F,W){W.length&&this.writeMessage(F,B,W)},writePackedSFixed32:function(F,W){W.length&&this.writeMessage(F,j,W)},writePackedFixed64:function(F,W){W.length&&this.writeMessage(F,U,W)},writePackedSFixed64:function(F,W){W.length&&this.writeMessage(F,X,W)},writeBytesField:function(F,W){this.writeTag(F,t.Bytes),this.writeBytes(W)},writeFixed32Field:function(F,W){this.writeTag(F,t.Fixed32),this.writeFixed32(W)},writeSFixed32Field:function(F,W){this.writeTag(F,t.Fixed32),this.writeSFixed32(W)},writeFixed64Field:function(F,W){this.writeTag(F,t.Fixed64),this.writeFixed64(W)},writeSFixed64Field:function(F,W){this.writeTag(F,t.Fixed64),this.writeSFixed64(W)},writeVarintField:function(F,W){this.writeTag(F,t.Varint),this.writeVarint(W)},writeSVarintField:function(F,W){this.writeTag(F,t.Varint),this.writeSVarint(W)},writeStringField:function(F,W){this.writeTag(F,t.Bytes),this.writeString(W)},writeFloatField:function(F,W){this.writeTag(F,t.Fixed32),this.writeFloat(W)},writeDoubleField:function(F,W){this.writeTag(F,t.Fixed64),this.writeDouble(W)},writeBooleanField:function(F,W){this.writeVarintField(F,!!W)}},fd}var Ws,_d=$(Sf());function cy(n,t,i){n===1&&i.readMessage(hy,t)}function hy(n,t,i){if(n===3){const{id:s,bitmap:h,width:f,height:m,left:y,top:x,advance:T}=i.readMessage(uy,{});t.push({id:s,bitmap:new cc({width:f+6,height:m+6},h),metrics:{width:f,height:m,left:y,top:x,advance:T}})}}function uy(n,t,i){n===1?t.id=i.readVarint():n===2?t.bitmap=i.readBytes():n===3?t.width=i.readVarint():n===4?t.height=i.readVarint():n===5?t.left=i.readSVarint():n===6?t.top=i.readSVarint():n===7&&(t.advance=i.readVarint())}function Ef(n){let t=0,i=0;for(const m of n)t+=m.w*m.h,i=Math.max(i,m.w);n.sort((m,y)=>y.h-m.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let h=0,f=0;for(const m of n)for(let y=s.length-1;y>=0;y--){const x=s[y];if(!(m.w>x.w||m.h>x.h)){if(m.x=x.x,m.y=x.y,f=Math.max(f,m.y+m.h),h=Math.max(h,m.x+m.w),m.w===x.w&&m.h===x.h){const T=s.pop();y<s.length&&(s[y]=T)}else m.h===x.h?(x.x+=m.w,x.w-=m.w):m.w===x.w?(x.y+=m.h,x.h-=m.h):(s.push({x:x.x+m.w,y:x.y,w:x.w-m.w,h:m.h}),x.y+=m.h,x.h-=m.h);break}}return{w:h,h:f,fill:t/(h*f)||0}}class gd{constructor(t,{pixelRatio:i,version:s,stretchX:h,stretchY:f,content:m,textFitWidth:y,textFitHeight:x}){this.paddedRect=t,this.pixelRatio=i,this.stretchX=h,this.stretchY=f,this.content=m,this.version=s,this.textFitWidth=y,this.textFitHeight=x}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class kf{constructor(t,i){const s={},h={};this.haveRenderCallbacks=[];const f=[];this.addImages(t,s,f),this.addImages(i,h,f);const{w:m,h:y}=Ef(f),x=new Bi({width:m||1,height:y||1});for(const T in t){const E=t[T],I=s[T].paddedRect;Bi.copy(E.data,x,{x:0,y:0},{x:I.x+1,y:I.y+1},E.data)}for(const T in i){const E=i[T],I=h[T].paddedRect,D=I.x+1,B=I.y+1,j=E.data.width,U=E.data.height;Bi.copy(E.data,x,{x:0,y:0},{x:D,y:B},E.data),Bi.copy(E.data,x,{x:0,y:U-1},{x:D,y:B-1},{width:j,height:1}),Bi.copy(E.data,x,{x:0,y:0},{x:D,y:B+U},{width:j,height:1}),Bi.copy(E.data,x,{x:j-1,y:0},{x:D-1,y:B},{width:1,height:U}),Bi.copy(E.data,x,{x:0,y:0},{x:D+j,y:B},{width:1,height:U})}this.image=x,this.iconPositions=s,this.patternPositions=h}addImages(t,i,s){for(const h in t){const f=t[h],m={x:0,y:0,w:f.data.width+2,h:f.data.height+2};s.push(m),i[h]=new gd(m,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(t,i){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in t.updatedImages)this.patchUpdatedImage(this.iconPositions[s],t.getImage(s),i),this.patchUpdatedImage(this.patternPositions[s],t.getImage(s),i)}patchUpdatedImage(t,i,s){if(!t||!i||t.version===i.version)return;t.version=i.version;const[h,f]=t.tl;s.update(i.data,void 0,{x:h,y:f})}}vt("ImagePosition",gd),vt("ImageAtlas",kf),w.an=void 0,(Ws=w.an||(w.an={}))[Ws.none=0]="none",Ws[Ws.horizontal=1]="horizontal",Ws[Ws.vertical=2]="vertical",Ws[Ws.horizontalOnly=3]="horizontalOnly";class bc{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,i,s){const h=new bc;return h.scale=t||1,h.fontStack=i,h.verticalAlign=s||"bottom",h}static forImage(t,i){const s=new bc;return s.imageName=t,s.verticalAlign=i||"bottom",s}}class qa{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,i){const s=new qa;for(let h=0;h<t.sections.length;h++){const f=t.sections[h];f.image?s.addImageSection(f):s.addTextSection(f,i)}return s}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let i="";for(let s=0;s<t.length;s++){const h=t.charCodeAt(s+1)||null,f=t.charCodeAt(s-1)||null;i+=h&&Yl(h)&&!vc[t[s+1]]||f&&Yl(f)&&!vc[t[s-1]]||!vc[t[s]]?t[s]:vc[t[s]]}return i}(this.text)}trim(){let t=0;for(let s=0;s<this.text.length&&Kh[this.text.charCodeAt(s)];s++)t++;let i=this.text.length;for(let s=this.text.length-1;s>=0&&s>=t&&Kh[this.text.charCodeAt(s)];s--)i--;this.text=this.text.substring(t,i),this.sectionIndex=this.sectionIndex.slice(t,i)}substring(t,i){const s=new qa;return s.text=this.text.substring(t,i),s.sectionIndex=this.sectionIndex.slice(t,i),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,i)=>Math.max(t,this.sections[i].scale),0)}getMaxImageSize(t){let i=0,s=0;for(let h=0;h<this.length();h++){const f=this.getSection(h);if(f.imageName){const m=t[f.imageName];if(!m)continue;const y=m.displaySize;i=Math.max(i,y[0]),s=Math.max(s,y[1])}}return{maxImageWidth:i,maxImageHeight:s}}addTextSection(t,i){this.text+=t.text,this.sections.push(bc.forText(t.scale,t.fontStack||i,t.verticalAlign));const s=this.sections.length-1;for(let h=0;h<t.text.length;++h)this.sectionIndex.push(s)}addImageSection(t){const i=t.image?t.image.name:"";if(i.length===0)return void de("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(bc.forImage(i,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):de("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Xh(n,t,i,s,h,f,m,y,x,T,E,I,D,B,j){const U=qa.fromFeature(n,h);let X;I===w.an.vertical&&U.verticalizePunctuation();const{processBidirectionalText:re,processStyledBidirectionalText:we}=On;if(re&&U.sections.length===1){X=[];const W=re(U.toString(),yd(U,T,f,t,s,B));for(const me of W){const Le=new qa;Le.text=me,Le.sections=U.sections;for(let et=0;et<me.length;et++)Le.sectionIndex.push(0);X.push(Le)}}else if(we){X=[];const W=we(U.text,U.sectionIndex,yd(U,T,f,t,s,B));for(const me of W){const Le=new qa;Le.text=me[0],Le.sectionIndex=me[1],Le.sections=U.sections,X.push(Le)}}else X=function(W,me){const Le=[],et=W.text;let Ne=0;for(const Ze of me)Le.push(W.substring(Ne,Ze)),Ne=Ze;return Ne<et.length&&Le.push(W.substring(Ne,et.length)),Le}(U,yd(U,T,f,t,s,B));const pe=[],F={positionedLines:pe,text:U.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:I,iconsInText:!1,verticalizable:!1};return function(W,me,Le,et,Ne,Ze,st,rt,ot,We,Pt,zt){let At=0,St=0,tr=0,Fr=0;const Hr=rt==="right"?1:rt==="left"?0:.5,bi=ti/zt;let tn=0;for(const Ar of Ne){Ar.trim();const ri=Ar.getMaxScale(),pi={positionedGlyphs:[],lineOffset:0};W.positionedLines[tn]=pi;const fi=pi.positionedGlyphs;let Ai=0;if(!Ar.length()){St+=Ze,++tn;continue}const rn=my(et,Ar,bi);for(let ji=0;ji<Ar.length();ji++){const Xr=Ar.getSection(ji),ni=Ar.getSectionIndex(ji),si=Ar.getCharCode(ji),Gr=_y(ot,Pt,si);let wr;if(Xr.imageName){if(W.iconsInText=!0,Xr.scale=Xr.scale*bi,wr=yy(Xr,Gr,ri,rn,et),!wr)continue;Ai=Math.max(Ai,wr.imageOffset)}else if(wr=gy(Xr,si,Gr,rn,me,Le),!wr)continue;const{rect:En,metrics:Ka,baselineOffset:kn}=wr;fi.push({glyph:si,imageName:Xr.imageName,x:At,y:St+kn+-17,vertical:Gr,scale:Xr.scale,fontStack:Xr.fontStack,sectionIndex:ni,metrics:Ka,rect:En}),Gr?(W.verticalizable=!0,At+=(Xr.imageName?Ka.advance:ti)*Xr.scale+We):At+=Ka.advance*Xr.scale+We}fi.length!==0&&(tr=Math.max(At-We,tr),vy(fi,0,fi.length-1,Hr)),At=0,pi.lineOffset=Math.max(Ai,(ri-1)*ti);const ii=Ze*ri+Ai;St+=ii,Fr=Math.max(ii,Fr),++tn}const{horizontalAlign:Oi,verticalAlign:di}=vd(st);(function(Ar,ri,pi,fi,Ai,rn,ii,ji,Xr){const ni=(ri-pi)*Ai;let si=0;si=rn!==ii?-ji*fi- -17:-fi*Xr*ii+.5*ii;for(const Gr of Ar)for(const wr of Gr.positionedGlyphs)wr.x+=ni,wr.y+=si})(W.positionedLines,Hr,Oi,di,tr,Fr,Ze,St,Ne.length),W.top+=-di*St,W.bottom=W.top+St,W.left+=-Oi*tr,W.right=W.left+tr}(F,t,i,s,X,m,y,x,I,T,D,j),!function(W){for(const me of W)if(me.positionedGlyphs.length!==0)return!1;return!0}(pe)&&F}const Kh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},dy={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},py={40:!0};function Mf(n,t,i,s,h,f){if(t.imageName){const m=s[t.imageName];return m?m.displaySize[0]*t.scale*ti/f+h:0}{const m=i[t.fontStack],y=m&&m[n];return y?y.metrics.advance*t.scale+h:0}}function If(n,t,i,s){const h=Math.pow(n-t,2);return s?n<t?h/2:2*h:h+Math.abs(i)*i}function fy(n,t,i){let s=0;return n===10&&(s-=1e4),i&&(s+=150),n!==40&&n!==65288||(s+=50),t!==41&&t!==65289||(s+=50),s}function Af(n,t,i,s,h,f){let m=null,y=If(t,i,h,f);for(const x of s){const T=If(t-x.x,i,h,f)+x.badness;T<=y&&(m=x,y=T)}return{index:n,x:t,priorBreak:m,badness:y}}function zf(n){return n?zf(n.priorBreak).concat(n.index):[]}function yd(n,t,i,s,h,f){if(!n)return[];const m=[],y=function(I,D,B,j,U,X){let re=0;for(let we=0;we<I.length();we++){const pe=I.getSection(we);re+=Mf(I.getCharCode(we),pe,j,U,D,X)}return re/Math.max(1,Math.ceil(re/B))}(n,t,i,s,h,f),x=n.text.indexOf("")>=0;let T=0;for(let I=0;I<n.length();I++){const D=n.getSection(I),B=n.getCharCode(I);if(Kh[B]||(T+=Mf(B,D,s,h,t,f)),I<n.length()-1){const j=!((E=B)<11904)&&(!!Qt["CJK Compatibility Forms"](E)||!!Qt["CJK Compatibility"](E)||!!Qt["CJK Strokes"](E)||!!Qt["CJK Symbols and Punctuation"](E)||!!Qt["Enclosed CJK Letters and Months"](E)||!!Qt["Halfwidth and Fullwidth Forms"](E)||!!Qt["Ideographic Description Characters"](E)||!!Qt["Vertical Forms"](E)||Kl.test(String.fromCodePoint(E)));(dy[B]||j||D.imageName||I!==n.length()-2&&py[n.getCharCode(I+1)])&&m.push(Af(I+1,T,y,m,fy(B,n.getCharCode(I+1),j&&x),!1))}}var E;return zf(Af(n.length(),T,y,m,0,!0))}function vd(n){let t=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function my(n,t,i){const s=t.getMaxScale()*ti,{maxImageWidth:h,maxImageHeight:f}=t.getMaxImageSize(n),m=Math.max(s,f*i);return{verticalLineContentWidth:Math.max(s,h*i),horizontalLineContentHeight:m}}function Df(n){switch(n){case"top":return 0;case"center":return .5;default:return 1}}function _y(n,t,i){return!(n===w.an.horizontal||!t&&!Fa(i)||t&&(Kh[i]||(s=i,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(s)))));var s}function gy(n,t,i,s,h,f){const m=f[n.fontStack],y=function(T,E,I,D){if(T&&T.rect)return T;const B=E[I.fontStack],j=B&&B[D];return j?{rect:null,metrics:j.metrics}:null}(m&&m[t],h,n,t);if(y===null)return null;let x;if(i)x=s.verticalLineContentWidth-n.scale*ti;else{const T=Df(n.verticalAlign);x=(s.horizontalLineContentHeight-n.scale*ti)*T}return{rect:y.rect,metrics:y.metrics,baselineOffset:x}}function yy(n,t,i,s,h){const f=h[n.imageName];if(!f)return null;const m=f.paddedRect,y=f.displaySize,x={width:y[0],height:y[1],left:1,top:-3,advance:t?y[1]:y[0]};let T;if(t)T=s.verticalLineContentWidth-y[1]*n.scale;else{const E=Df(n.verticalAlign);T=(s.horizontalLineContentHeight-y[1]*n.scale)*E}return{rect:m,metrics:x,baselineOffset:T,imageOffset:(t?y[0]:y[1])*n.scale-ti*i}}function vy(n,t,i,s){if(s===0)return;const h=n[i],f=(n[i].x+h.metrics.advance*h.scale)*s;for(let m=t;m<=i;m++)n[m].x-=f}function by(n,t,i){const{horizontalAlign:s,verticalAlign:h}=vd(i),f=t[0]-n.displaySize[0]*s,m=t[1]-n.displaySize[1]*h;return{image:n,top:m,bottom:m+n.displaySize[1],left:f,right:f+n.displaySize[0]}}function Rf(n){var t,i;let s=n.left,h=n.top,f=n.right-s,m=n.bottom-h;const y=(t=n.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",x=(i=n.image.textFitHeight)!==null&&i!==void 0?i:"stretchOrShrink",T=(n.image.content[2]-n.image.content[0])/(n.image.content[3]-n.image.content[1]);if(x==="proportional"){if(y==="stretchOnly"&&f/m<T||y==="proportional"){const E=Math.ceil(m*T);s*=E/f,f=E}}else if(y==="proportional"&&x==="stretchOnly"&&T!==0&&f/m>T){const E=Math.ceil(f/T);h*=E/m,m=E}return{x1:s,y1:h,x2:s+f,y2:h+m}}function Lf(n,t,i,s,h,f){const m=n.image;let y;if(m.content){const X=m.content,re=m.pixelRatio||1;y=[X[0]/re,X[1]/re,m.displaySize[0]-X[2]/re,m.displaySize[1]-X[3]/re]}const x=t.left*f,T=t.right*f;let E,I,D,B;i==="width"||i==="both"?(B=h[0]+x-s[3],I=h[0]+T+s[1]):(B=h[0]+(x+T-m.displaySize[0])/2,I=B+m.displaySize[0]);const j=t.top*f,U=t.bottom*f;return i==="height"||i==="both"?(E=h[1]+j-s[0],D=h[1]+U+s[2]):(E=h[1]+(j+U-m.displaySize[1])/2,D=E+m.displaySize[1]),{image:m,top:E,right:I,bottom:D,left:B,collisionPadding:y}}const hs=128,Hs=32640;function Ff(n,t){const{expression:i}=t;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new Cr(n+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:h}=i;let f=0;for(;f<s.length&&s[f]<=n;)f++;f=Math.max(0,f-1);let m=f;for(;m<s.length&&s[m]<n+1;)m++;m=Math.min(s.length-1,m);const y=s[f],x=s[m];return i.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:x,interpolationType:h}:{kind:"camera",minZoom:y,maxZoom:x,minSize:i.evaluate(new Cr(y)),maxSize:i.evaluate(new Cr(x)),interpolationType:h}}}function bd(n,t,i){let s="never";const h=n.get(t);return h?s=h:n.get(i)&&(s="always"),s}const xy=_c.VectorTileFeature.types,wy=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Yh(n,t,i,s,h,f,m,y,x,T,E,I,D){const B=y?Math.min(Hs,Math.round(y[0])):0,j=y?Math.min(Hs,Math.round(y[1])):0;n.emplaceBack(t,i,Math.round(32*s),Math.round(32*h),f,m,(B<<1)+(x?1:0),j,16*T,16*E,256*I,256*D)}function xd(n,t,i){n.emplaceBack(t.x,t.y,i),n.emplaceBack(t.x,t.y,i),n.emplaceBack(t.x,t.y,i),n.emplaceBack(t.x,t.y,i)}function Cy(n){for(const t of n.sections)if(Jl(t.text))return!0;return!1}class wd{constructor(t){this.layoutVertexArray=new Zt,this.indexArray=new gr,this.programConfigurations=t,this.segments=new nr,this.dynamicLayoutVertexArray=new hr,this.opacityVertexArray=new Mr,this.hasVisibleVertices=!1,this.placedSymbolArray=new ee}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,i,s,h){this.isEmpty()||(s&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,iy.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,ny.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,wy,!0),this.opacityVertexBuffer.itemSize=1),(s||h)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}vt("SymbolBuffers",wd);class Cd{constructor(t,i,s){this.layoutVertexArray=new t,this.layoutAttributes=i,this.indexArray=new s,this.segments=new nr,this.collisionVertexArray=new Ir}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,sy.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}vt("CollisionBuffers",Cd);class Wa{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(m=>m.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ff(this.zoom,i["text-size"]),this.iconSizeData=Ff(this.zoom,i["icon-size"]);const s=this.layers[0].layout,h=s.get("symbol-sort-key"),f=s.get("symbol-z-order");this.canOverlap=bd(s,"text-overlap","text-allow-overlap")!=="never"||bd(s,"icon-overlap","icon-allow-overlap")!=="never"||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&!h.isConstant(),this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(m=>w.an[m])),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=t.sourceID}createArrays(){this.text=new wd(new Gn(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new wd(new Gn(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new he,this.lineVertexArray=new _e,this.symbolInstances=new fe,this.textAnchorOffsets=new ue}calculateGlyphDependencies(t,i,s,h,f){for(let m=0;m<t.length;m++)if(i[t.charCodeAt(m)]=!0,(s||h)&&f){const y=vc[t.charAt(m)];y&&(i[y.charCodeAt(0)]=!0)}}populate(t,i,s){const h=this.layers[0],f=h.layout,m=f.get("text-font"),y=f.get("text-field"),x=f.get("icon-image"),T=(y.value.kind!=="constant"||y.value.value instanceof gi&&!y.value.value.isEmpty()||y.value.value.toString().length>0)&&(m.value.kind!=="constant"||m.value.value.length>0),E=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,I=f.get("symbol-sort-key");if(this.features=[],!T&&!E)return;const D=i.iconDependencies,B=i.glyphDependencies,j=i.availableImages,U=new Cr(this.zoom,{globalState:this.globalState});for(const{feature:X,id:re,index:we,sourceLayerIndex:pe}of t){const F=h._featureFilter.needGeometry,W=$o(X,F);if(!h._featureFilter.filter(U,W,s))continue;let me,Le;if(F||(W.geometry=Uo(X)),T){const Ne=h.getValueAndResolveTokens("text-field",W,s,j),Ze=gi.factory(Ne),st=this.hasRTLText=this.hasRTLText||Cy(Ze);(!st||On.getRTLTextPluginStatus()==="unavailable"||st&&On.isParsed())&&(me=ay(Ze,h,W))}if(E){const Ne=h.getValueAndResolveTokens("icon-image",W,s,j);Le=Ne instanceof Ei?Ne:Ei.fromString(Ne)}if(!me&&!Le)continue;const et=this.sortFeaturesByKey?I.evaluate(W,{},s):void 0;if(this.features.push({id:re,text:me,icon:Le,index:we,sourceLayerIndex:pe,geometry:W.geometry,properties:X.properties,type:xy[X.type],sortKey:et}),Le&&(D[Le.name]=!0),me){const Ne=m.evaluate(W,{},s).join(","),Ze=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(w.an.vertical)>=0;for(const st of me.sections)if(st.image)D[st.image.name]=!0;else{const rt=Xl(me.toString()),ot=st.fontStack||Ne,We=B[ot]=B[ot]||{};this.calculateGlyphDependencies(st.text,We,Ze,this.allowVerticalPlacement,rt)}}}f.get("symbol-placement")==="line"&&(this.features=function(X){const re={},we={},pe=[];let F=0;function W(Ne){pe.push(X[Ne]),F++}function me(Ne,Ze,st){const rt=we[Ne];return delete we[Ne],we[Ze]=rt,pe[rt].geometry[0].pop(),pe[rt].geometry[0]=pe[rt].geometry[0].concat(st[0]),rt}function Le(Ne,Ze,st){const rt=re[Ze];return delete re[Ze],re[Ne]=rt,pe[rt].geometry[0].shift(),pe[rt].geometry[0]=st[0].concat(pe[rt].geometry[0]),rt}function et(Ne,Ze,st){const rt=st?Ze[0][Ze[0].length-1]:Ze[0][0];return`${Ne}:${rt.x}:${rt.y}`}for(let Ne=0;Ne<X.length;Ne++){const Ze=X[Ne],st=Ze.geometry,rt=Ze.text?Ze.text.toString():null;if(!rt){W(Ne);continue}const ot=et(rt,st),We=et(rt,st,!0);if(ot in we&&We in re&&we[ot]!==re[We]){const Pt=Le(ot,We,st),zt=me(ot,We,pe[Pt].geometry);delete re[ot],delete we[We],we[et(rt,pe[zt].geometry,!0)]=zt,pe[Pt].geometry=null}else ot in we?me(ot,We,st):We in re?Le(ot,We,st):(W(Ne),re[ot]=F-1,we[We]=F-1)}return pe.filter(Ne=>Ne.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((X,re)=>X.sortKey-re.sortKey)}update(t,i,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,i,this.layers,s),this.icon.programConfigurations.updatePaintArrays(t,i,this.layers,s))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,i){const s=this.lineVertexArray.length;if(t.segment!==void 0){let h=t.dist(i[t.segment+1]),f=t.dist(i[t.segment]);const m={};for(let y=t.segment+1;y<i.length;y++)m[y]={x:i[y].x,y:i[y].y,tileUnitDistanceFromAnchor:h},y<i.length-1&&(h+=i[y+1].dist(i[y]));for(let y=t.segment||0;y>=0;y--)m[y]={x:i[y].x,y:i[y].y,tileUnitDistanceFromAnchor:f},y>0&&(f+=i[y-1].dist(i[y]));for(let y=0;y<i.length;y++){const x=m[y];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(t,i,s,h,f,m,y,x,T,E,I,D){const B=t.indexArray,j=t.layoutVertexArray,U=t.segments.prepareSegment(4*i.length,j,B,this.canOverlap?m.sortKey:void 0),X=this.glyphOffsetArray.length,re=U.vertexLength,we=this.allowVerticalPlacement&&y===w.an.vertical?Math.PI/2:0,pe=m.text&&m.text.sections;for(let F=0;F<i.length;F++){const{tl:W,tr:me,bl:Le,br:et,tex:Ne,pixelOffsetTL:Ze,pixelOffsetBR:st,minFontScaleX:rt,minFontScaleY:ot,glyphOffset:We,isSDF:Pt,sectionIndex:zt}=i[F],At=U.vertexLength,St=We[1];Yh(j,x.x,x.y,W.x,St+W.y,Ne.x,Ne.y,s,Pt,Ze.x,Ze.y,rt,ot),Yh(j,x.x,x.y,me.x,St+me.y,Ne.x+Ne.w,Ne.y,s,Pt,st.x,Ze.y,rt,ot),Yh(j,x.x,x.y,Le.x,St+Le.y,Ne.x,Ne.y+Ne.h,s,Pt,Ze.x,st.y,rt,ot),Yh(j,x.x,x.y,et.x,St+et.y,Ne.x+Ne.w,Ne.y+Ne.h,s,Pt,st.x,st.y,rt,ot),xd(t.dynamicLayoutVertexArray,x,we),B.emplaceBack(At,At+2,At+1),B.emplaceBack(At+1,At+2,At+3),U.vertexLength+=4,U.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(We[0]),F!==i.length-1&&zt===i[F+1].sectionIndex||t.programConfigurations.populatePaintArrays(j.length,m,m.index,{},D,pe&&pe[zt])}t.placedSymbolArray.emplaceBack(x.x,x.y,X,this.glyphOffsetArray.length-X,re,T,E,x.segment,s?s[0]:0,s?s[1]:0,h[0],h[1],y,0,!1,0,I)}_addCollisionDebugVertex(t,i,s,h,f,m){return i.emplaceBack(0,0),t.emplaceBack(s.x,s.y,h,f,Math.round(m.x),Math.round(m.y))}addCollisionDebugVertices(t,i,s,h,f,m,y){const x=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),T=x.vertexLength,E=f.layoutVertexArray,I=f.collisionVertexArray,D=y.anchorX,B=y.anchorY;this._addCollisionDebugVertex(E,I,m,D,B,new H(t,i)),this._addCollisionDebugVertex(E,I,m,D,B,new H(s,i)),this._addCollisionDebugVertex(E,I,m,D,B,new H(s,h)),this._addCollisionDebugVertex(E,I,m,D,B,new H(t,h)),x.vertexLength+=4;const j=f.indexArray;j.emplaceBack(T,T+1),j.emplaceBack(T+1,T+2),j.emplaceBack(T+2,T+3),j.emplaceBack(T+3,T),x.primitiveLength+=4}addDebugCollisionBoxes(t,i,s,h){for(let f=t;f<i;f++){const m=this.collisionBoxArray.get(f);this.addCollisionDebugVertices(m.x1,m.y1,m.x2,m.y2,h?this.textCollisionBox:this.iconCollisionBox,m.anchorPoint,s)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Cd(mr,Cf.members,_r),this.iconCollisionBox=new Cd(mr,Cf.members,_r);for(let t=0;t<this.symbolInstances.length;t++){const i=this.symbolInstances.get(t);this.addDebugCollisionBoxes(i.textBoxStartIndex,i.textBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.iconBoxStartIndex,i.iconBoxEndIndex,i,!1),this.addDebugCollisionBoxes(i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex,i,!1)}}_deserializeCollisionBoxesForSymbol(t,i,s,h,f,m,y,x,T){const E={};for(let I=i;I<s;I++){const D=t.get(I);E.textBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},E.textFeatureIndex=D.featureIndex;break}for(let I=h;I<f;I++){const D=t.get(I);E.verticalTextBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},E.verticalTextFeatureIndex=D.featureIndex;break}for(let I=m;I<y;I++){const D=t.get(I);E.iconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},E.iconFeatureIndex=D.featureIndex;break}for(let I=x;I<T;I++){const D=t.get(I);E.verticalIconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},E.verticalIconFeatureIndex=D.featureIndex;break}return E}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const s=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,i){const s=t.placedSymbolArray.get(i),h=s.vertexStartIndex+4*s.numGlyphs;for(let f=s.vertexStartIndex;f<h;f+=4)t.indexArray.emplaceBack(f,f+2,f+1),t.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(t),s=Math.cos(t),h=[],f=[],m=[];for(let y=0;y<this.symbolInstances.length;++y){m.push(y);const x=this.symbolInstances.get(y);h.push(0|Math.round(i*x.anchorX+s*x.anchorY)),f.push(x.featureIndex)}return m.sort((y,x)=>h[y]-h[x]||f[x]-f[y]),m}addToSortKeyRanges(t,i){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===i?s.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const s=this.symbolInstances.get(i);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((h,f,m)=>{h>=0&&m.indexOf(h)===f&&this.addIndicesForPlacedSymbol(this.text,h)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Bf,Of;vt("SymbolBucket",Wa,{omit:["layers","collisionBoxArray","features","compareText"]}),Wa.MAX_GLYPHS=65535,Wa.addDynamicAttributes=xd;var Pd={get paint(){return Of=Of||new Pi({"icon-opacity":new Dt(ve.paint_symbol["icon-opacity"]),"icon-color":new Dt(ve.paint_symbol["icon-color"]),"icon-halo-color":new Dt(ve.paint_symbol["icon-halo-color"]),"icon-halo-width":new Dt(ve.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Dt(ve.paint_symbol["icon-halo-blur"]),"icon-translate":new Tt(ve.paint_symbol["icon-translate"]),"icon-translate-anchor":new Tt(ve.paint_symbol["icon-translate-anchor"]),"text-opacity":new Dt(ve.paint_symbol["text-opacity"]),"text-color":new Dt(ve.paint_symbol["text-color"],{runtimeType:Ri,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new Dt(ve.paint_symbol["text-halo-color"]),"text-halo-width":new Dt(ve.paint_symbol["text-halo-width"]),"text-halo-blur":new Dt(ve.paint_symbol["text-halo-blur"]),"text-translate":new Tt(ve.paint_symbol["text-translate"]),"text-translate-anchor":new Tt(ve.paint_symbol["text-translate-anchor"])})},get layout(){return Bf=Bf||new Pi({"symbol-placement":new Tt(ve.layout_symbol["symbol-placement"]),"symbol-spacing":new Tt(ve.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Tt(ve.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Dt(ve.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Tt(ve.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Tt(ve.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Tt(ve.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Tt(ve.layout_symbol["icon-ignore-placement"]),"icon-optional":new Tt(ve.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Tt(ve.layout_symbol["icon-rotation-alignment"]),"icon-size":new Dt(ve.layout_symbol["icon-size"]),"icon-text-fit":new Tt(ve.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Tt(ve.layout_symbol["icon-text-fit-padding"]),"icon-image":new Dt(ve.layout_symbol["icon-image"]),"icon-rotate":new Dt(ve.layout_symbol["icon-rotate"]),"icon-padding":new Dt(ve.layout_symbol["icon-padding"]),"icon-keep-upright":new Tt(ve.layout_symbol["icon-keep-upright"]),"icon-offset":new Dt(ve.layout_symbol["icon-offset"]),"icon-anchor":new Dt(ve.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Tt(ve.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Tt(ve.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Tt(ve.layout_symbol["text-rotation-alignment"]),"text-field":new Dt(ve.layout_symbol["text-field"]),"text-font":new Dt(ve.layout_symbol["text-font"]),"text-size":new Dt(ve.layout_symbol["text-size"]),"text-max-width":new Dt(ve.layout_symbol["text-max-width"]),"text-line-height":new Tt(ve.layout_symbol["text-line-height"]),"text-letter-spacing":new Dt(ve.layout_symbol["text-letter-spacing"]),"text-justify":new Dt(ve.layout_symbol["text-justify"]),"text-radial-offset":new Dt(ve.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Tt(ve.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Dt(ve.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Dt(ve.layout_symbol["text-anchor"]),"text-max-angle":new Tt(ve.layout_symbol["text-max-angle"]),"text-writing-mode":new Tt(ve.layout_symbol["text-writing-mode"]),"text-rotate":new Dt(ve.layout_symbol["text-rotate"]),"text-padding":new Tt(ve.layout_symbol["text-padding"]),"text-keep-upright":new Tt(ve.layout_symbol["text-keep-upright"]),"text-transform":new Dt(ve.layout_symbol["text-transform"]),"text-offset":new Dt(ve.layout_symbol["text-offset"]),"text-allow-overlap":new Tt(ve.layout_symbol["text-allow-overlap"]),"text-overlap":new Tt(ve.layout_symbol["text-overlap"]),"text-ignore-placement":new Tt(ve.layout_symbol["text-ignore-placement"]),"text-optional":new Tt(ve.layout_symbol["text-optional"])})}};class jf{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Kn,this.defaultValue=t}evaluate(t){if(t.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(t.formattedSection))return i.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}vt("FormatSectionOverride",jf,{omit:["defaultValue"]});class Jh extends li{constructor(t){super(t,Pd)}recalculate(t,i){if(super.recalculate(t,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const s=this.layout.get("text-writing-mode");if(s){const h=[];for(const f of s)h.indexOf(f)<0&&h.push(f);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,i,s,h){const f=this.layout.get(t).evaluate(i,{},s,h),m=this._unevaluatedLayout._values[t];return m.isDataDriven()||Pa(m.value)||!f?f:function(y,x){return x.replace(/{([^{}]+)}/g,(T,E)=>y&&E in y?String(y[E]):"")}(i.properties,f)}createBucket(t){return new Wa(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of Pd.paint.overridableProperties){if(!Jh.hasPaintOverride(this.layout,t))continue;const i=this.paint.get(t),s=new jf(i),h=new Ca(s,i.property.specification);let f=null;f=i.value.kind==="constant"||i.value.kind==="source"?new To("source",h):new Sa("composite",h,i.value.zoomStops),this.paint._values[t]=new fn(i.property,f,i.parameters)}}_handleOverridablePaintPropertyUpdate(t,i,s){return!(!this.layout||i.isDataDriven()||s.isDataDriven())&&Jh.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,i){const s=t.get("text-field"),h=Pd.paint.properties[i];let f=!1;const m=y=>{for(const x of y)if(h.overrides&&h.overrides.hasOverride(x))return void(f=!0)};if(s.value.kind==="constant"&&s.value.value instanceof gi)m(s.value.value.sections);else if(s.value.kind==="source"){const y=T=>{f||(T instanceof xi&&Lt(T.value)===Yn?m(T.value.sections):T instanceof yo?m(T.sections):T.eachChild(y))},x=s.value;x._styleExpression&&y(x._styleExpression.expression)}return f}}let Vf;var Py={get paint(){return Vf=Vf||new Pi({"background-color":new Tt(ve.paint_background["background-color"]),"background-pattern":new ec(ve.paint_background["background-pattern"]),"background-opacity":new Tt(ve.paint_background["background-opacity"])})}};class Ty extends li{constructor(t){super(t,Py)}}let Nf;var Sy={get paint(){return Nf=Nf||new Pi({"raster-opacity":new Tt(ve.paint_raster["raster-opacity"]),"raster-hue-rotate":new Tt(ve.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Tt(ve.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Tt(ve.paint_raster["raster-brightness-max"]),"raster-saturation":new Tt(ve.paint_raster["raster-saturation"]),"raster-contrast":new Tt(ve.paint_raster["raster-contrast"]),"raster-resampling":new Tt(ve.paint_raster["raster-resampling"]),"raster-fade-duration":new Tt(ve.paint_raster["raster-fade-duration"])})}};class Ey extends li{constructor(t){super(t,Sy)}}class ky extends li{constructor(t){super(t,{}),this.onAdd=i=>{this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)},this.onRemove=i=>{this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class My{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Iy={once:!0},Td=63710088e-1;class Xs{constructor(t,i){if(isNaN(t)||isNaN(i))throw new Error(`Invalid LngLat object: (${t}, ${i})`);if(this.lng=+t,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Xs(Pr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const i=Math.PI/180,s=this.lat*i,h=t.lat*i,f=Math.sin(s)*Math.sin(h)+Math.cos(s)*Math.cos(h)*Math.cos((t.lng-this.lng)*i);return Td*Math.acos(Math.min(f,1))}static convert(t){if(t instanceof Xs)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Xs(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Xs(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Uf=2*Math.PI*Td;function $f(n){return Uf*Math.cos(n*Math.PI/180)}function Zf(n){return(180+n)/360}function Gf(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function qf(n,t){return n/$f(t)}function Sd(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Wf(n,t){return n*$f(Sd(t))}class xc{constructor(t,i,s=0){this.x=+t,this.y=+i,this.z=+s}static fromLngLat(t,i=0){const s=Xs.convert(t);return new xc(Zf(s.lng),Gf(s.lat),qf(i,s.lat))}toLngLat(){return new Xs(360*this.x-180,Sd(this.y))}toAltitude(){return Wf(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Uf*(t=Sd(this.y),1/Math.cos(t*Math.PI/180));var t}}function Hf(n,t,i){var s=2*Math.PI*6378137/256/Math.pow(2,i);return[n*s-2*Math.PI*6378137/2,t*s-2*Math.PI*6378137/2]}class Ed{constructor(t,i,s){if(!function(h,f,m){return!(h<0||h>25||m<0||m>=Math.pow(2,h)||f<0||f>=Math.pow(2,h))}(t,i,s))throw new Error(`x=${i}, y=${s}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=i,this.y=s,this.key=Ha(0,t,t,i,s)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,i,s){const h=(m=this.y,y=this.z,x=Hf(256*(f=this.x),256*(m=Math.pow(2,y)-m-1),y),T=Hf(256*(f+1),256*(m+1),y),x[0]+","+x[1]+","+T[0]+","+T[1]);var f,m,y,x,T;const E=function(I,D,B){let j,U="";for(let X=I;X>0;X--)j=1<<X-1,U+=(D&j?1:0)+(B&j?2:0);return U}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,i>1?"@2x":"").replace(/{quadkey}/g,E).replace(/{bbox-epsg-3857}/g,h)}isChildOf(t){const i=this.z-t.z;return i>0&&t.x===this.x>>i&&t.y===this.y>>i}getTilePoint(t){const i=Math.pow(2,this.z);return new H((t.x*i-this.x)*ze,(t.y*i-this.y)*ze)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Xf{constructor(t,i){this.wrap=t,this.canonical=i,this.key=Ha(t,i.z,i.z,i.x,i.y)}}class en{constructor(t,i,s,h,f){if(this.terrainRttPosMatrix32f=null,t<s)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${s}`);this.overscaledZ=t,this.wrap=i,this.canonical=new Ed(s,+h,+f),this.key=Ha(i,t,s,h,f)}clone(){return new en(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const i=this.canonical.z-t;return t>this.canonical.z?new en(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new en(t,this.wrap,t,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(t,i){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-t;return t>this.canonical.z?Ha(this.wrap*+i,t,this.canonical.z,this.canonical.x,this.canonical.y):Ha(this.wrap*+i,t,t,this.canonical.x>>s,this.canonical.y>>s)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const i=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>i&&t.canonical.y===this.canonical.y>>i}children(t){if(this.overscaledZ>=t)return[new en(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,s=2*this.canonical.x,h=2*this.canonical.y;return[new en(i,this.wrap,i,s,h),new en(i,this.wrap,i,s+1,h),new en(i,this.wrap,i,s,h+1),new en(i,this.wrap,i,s+1,h+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new en(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new en(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Xf(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new xc(t.x-this.wrap,t.y))}}function Ha(n,t,i,s,h){(n*=2)<0&&(n=-1*n-1);const f=1<<i;return(f*f*n+f*h+s).toString(36)+i.toString(36)+t.toString(36)}vt("CanonicalTileID",Ed),vt("OverscaledTileID",en,{omit:["terrainRttPosMatrix32f"]});class qo{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(t){return this.minX=Math.min(this.minX,t.x),this.minY=Math.min(this.minY,t.y),this.maxX=Math.max(this.maxX,t.x),this.maxY=Math.max(this.maxY,t.y),this}expandBy(t){return this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(t){return this.expandBy(-t)}map(t){const i=new qo;return i.extend(t(new H(this.minX,this.minY))),i.extend(t(new H(this.maxX,this.minY))),i.extend(t(new H(this.minX,this.maxY))),i.extend(t(new H(this.maxX,this.maxY))),i}static fromPoints(t){const i=new qo;for(const s of t)i.extend(s);return i}contains(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(t){return!this.empty()&&!t.empty()&&t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY}intersects(t){return!this.empty()&&!t.empty()&&t.minX<=this.maxX&&t.maxX>=this.minX&&t.minY<=this.maxY&&t.maxY>=this.minY}}class Kf{constructor(t){this._stringToNumber={},this._numberToString=[];for(let i=0;i<t.length;i++){const s=t[i];this._stringToNumber[s]=i,this._numberToString[i]=s}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Yf{constructor(t,i,s,h,f){this.type="Feature",this._vectorTileFeature=t,t._z=i,t._x=s,t._y=h,this.properties=t.properties,this.id=f}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const i in this)i!=="_geometry"&&i!=="_vectorTileFeature"&&(t[i]=this[i]);return t}}class Jf{constructor(t,i){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new $s(ze,16,0),this.grid3D=new $s(ze,16,0),this.featureIndexArray=new Be,this.promoteId=i}insert(t,i,s,h,f,m){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,h,f);const x=m?this.grid3D:this.grid;for(let T=0;T<i.length;T++){const E=i[T],I=[1/0,1/0,-1/0,-1/0];for(let D=0;D<E.length;D++){const B=E[D];I[0]=Math.min(I[0],B.x),I[1]=Math.min(I[1],B.y),I[2]=Math.max(I[2],B.x),I[3]=Math.max(I[3],B.y)}I[0]<ze&&I[1]<ze&&I[2]>=0&&I[3]>=0&&x.insert(y,I[0],I[1],I[2],I[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new _c.VectorTile(new _d(this.rawTileData)).layers,this.sourceLayerCoder=new Kf(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,i,s,h){this.loadVTLayers();const f=t.params,m=ze/t.tileSize/t.scale,y=Fn(f.filter),x=t.queryGeometry,T=t.queryPadding*m,E=qo.fromPoints(x),I=this.grid.query(E.minX-T,E.minY-T,E.maxX+T,E.maxY+T),D=qo.fromPoints(t.cameraQueryGeometry).expandBy(T),B=this.grid3D.query(D.minX,D.minY,D.maxX,D.maxY,(X,re,we,pe)=>function(F,W,me,Le,et){for(const Ze of F)if(W<=Ze.x&&me<=Ze.y&&Le>=Ze.x&&et>=Ze.y)return!0;const Ne=[new H(W,me),new H(W,et),new H(Le,et),new H(Le,me)];if(F.length>2){for(const Ze of Ne)if(Ua(F,Ze))return!0}for(let Ze=0;Ze<F.length-1;Ze++)if(gg(F[Ze],F[Ze+1],Ne))return!0;return!1}(t.cameraQueryGeometry,X-T,re-T,we+T,pe+T));for(const X of B)I.push(X);I.sort(Ay);const j={};let U;for(let X=0;X<I.length;X++){const re=I[X];if(re===U)continue;U=re;const we=this.featureIndexArray.get(re);let pe=null;this.loadMatchingFeature(j,we.bucketIndex,we.sourceLayerIndex,we.featureIndex,y,f.layers,f.availableImages,i,s,h,(F,W,me)=>(pe||(pe=Uo(F)),W.queryIntersectsFeature({queryGeometry:x,feature:F,featureState:me,geometry:pe,zoom:this.z,transform:t.transform,pixelsToTileUnits:m,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation})))}return j}loadMatchingFeature(t,i,s,h,f,m,y,x,T,E,I){const D=this.bucketLayerIDs[i];if(m&&!D.some(X=>m.has(X)))return;const B=this.sourceLayerCoder.decode(s),j=this.vtLayers[B].feature(h);if(f.needGeometry){const X=$o(j,!0);if(!f.filter(new Cr(this.tileID.overscaledZ),X,this.tileID.canonical))return}else if(!f.filter(new Cr(this.tileID.overscaledZ),j))return;const U=this.getId(j,B);for(let X=0;X<D.length;X++){const re=D[X];if(m&&!m.has(re))continue;const we=x[re];if(!we)continue;let pe={};U&&E&&(pe=E.getState(we.sourceLayer||"_geojsonTileLayer",U));const F=or({},T[re]);F.paint=Qf(F.paint,we.paint,j,pe,y),F.layout=Qf(F.layout,we.layout,j,pe,y);const W=!I||I(j,we,pe);if(!W)continue;const me=new Yf(j,this.z,this.x,this.y,U);me.layer=F;let Le=t[re];Le===void 0&&(Le=t[re]=[]),Le.push({featureIndex:h,feature:me,intersectionZ:W})}}lookupSymbolFeatures(t,i,s,h,f,m,y,x){const T={};this.loadVTLayers();const E=Fn(f);for(const I of t)this.loadMatchingFeature(T,s,h,I,E,m,y,x,i);return T}hasLayer(t){for(const i of this.bucketLayerIDs)for(const s of i)if(t===s)return!0;return!1}getId(t,i){var s;let h=t.id;return this.promoteId&&(h=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[i]],typeof h=="boolean"&&(h=Number(h)),h===void 0&&(!((s=t.properties)===null||s===void 0)&&s.cluster)&&this.promoteId&&(h=Number(t.properties.cluster_id))),h}}function Qf(n,t,i,s,h){return ar(n,(f,m)=>{const y=t instanceof Oa?t.get(m):null;return y&&y.evaluate?y.evaluate(i,s,h):y})}function Ay(n,t){return t-n}function em(n,t,i,s,h){const f=[];for(let m=0;m<n.length;m++){const y=n[m];let x;for(let T=0;T<y.length-1;T++){let E=y[T],I=y[T+1];E.x<t&&I.x<t||(E.x<t?E=new H(t,E.y+(t-E.x)/(I.x-E.x)*(I.y-E.y))._round():I.x<t&&(I=new H(t,E.y+(t-E.x)/(I.x-E.x)*(I.y-E.y))._round()),E.y<i&&I.y<i||(E.y<i?E=new H(E.x+(i-E.y)/(I.y-E.y)*(I.x-E.x),i)._round():I.y<i&&(I=new H(E.x+(i-E.y)/(I.y-E.y)*(I.x-E.x),i)._round()),E.x>=s&&I.x>=s||(E.x>=s?E=new H(s,E.y+(s-E.x)/(I.x-E.x)*(I.y-E.y))._round():I.x>=s&&(I=new H(s,E.y+(s-E.x)/(I.x-E.x)*(I.y-E.y))._round()),E.y>=h&&I.y>=h||(E.y>=h?E=new H(E.x+(h-E.y)/(I.y-E.y)*(I.x-E.x),h)._round():I.y>=h&&(I=new H(E.x+(h-E.y)/(I.y-E.y)*(I.x-E.x),h)._round()),x&&E.equals(x[x.length-1])||(x=[E],f.push(x)),x.push(I)))))}}return f}vt("FeatureIndex",Jf,{omit:["rawTileData","sourceLayerCoder"]});class Ks extends H{constructor(t,i,s,h){super(t,i),this.angle=s,h!==void 0&&(this.segment=h)}clone(){return new Ks(this.x,this.y,this.angle,this.segment)}}function tm(n,t,i,s,h){if(t.segment===void 0||i===0)return!0;let f=t,m=t.segment+1,y=0;for(;y>-i/2;){if(m--,m<0)return!1;y-=n[m].dist(f),f=n[m]}y+=n[m].dist(n[m+1]),m++;const x=[];let T=0;for(;y<i/2;){const E=n[m],I=n[m+1];if(!I)return!1;let D=n[m-1].angleTo(E)-E.angleTo(I);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:y,angleDelta:D}),T+=D;y-x[0].distance>s;)T-=x.shift().angleDelta;if(T>h)return!1;m++,y+=E.dist(I)}return!0}function rm(n){let t=0;for(let i=0;i<n.length-1;i++)t+=n[i].dist(n[i+1]);return t}function im(n,t,i){return n?.6*t*i:0}function nm(n,t){return Math.max(n?n.right-n.left:0,t?t.right-t.left:0)}function zy(n,t,i,s,h,f){const m=im(i,h,f),y=nm(i,s)*f;let x=0;const T=rm(n)/2;for(let E=0;E<n.length-1;E++){const I=n[E],D=n[E+1],B=I.dist(D);if(x+B>T){const j=(T-x)/B,U=Fi.number(I.x,D.x,j),X=Fi.number(I.y,D.y,j),re=new Ks(U,X,D.angleTo(I),E);return re._round(),!m||tm(n,re,y,m,t)?re:void 0}x+=B}}function Dy(n,t,i,s,h,f,m,y,x){const T=im(s,f,m),E=nm(s,h),I=E*m,D=n[0].x===0||n[0].x===x||n[0].y===0||n[0].y===x;return t-I<t/4&&(t=I+t/4),sm(n,D?t/2*y%t:(E/2+2*f)*m*y%t,t,T,i,I,D,!1,x)}function sm(n,t,i,s,h,f,m,y,x){const T=f/2,E=rm(n);let I=0,D=t-i,B=[];for(let j=0;j<n.length-1;j++){const U=n[j],X=n[j+1],re=U.dist(X),we=X.angleTo(U);for(;D+i<I+re;){D+=i;const pe=(D-I)/re,F=Fi.number(U.x,X.x,pe),W=Fi.number(U.y,X.y,pe);if(F>=0&&F<x&&W>=0&&W<x&&D-T>=0&&D+T<=E){const me=new Ks(F,W,we,j);me._round(),s&&!tm(n,me,f,s,h)||B.push(me)}}I+=re}return y||B.length||m||(B=sm(n,I/2,i,s,h,f,m,!0,x)),B}function om(n,t,i,s){const h=[],f=n.image,m=f.pixelRatio,y=f.paddedRect.w-2,x=f.paddedRect.h-2;let T={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom};const E=f.stretchX||[[0,y]],I=f.stretchY||[[0,x]],D=(We,Pt)=>We+Pt[1]-Pt[0],B=E.reduce(D,0),j=I.reduce(D,0),U=y-B,X=x-j;let re=0,we=B,pe=0,F=j,W=0,me=U,Le=0,et=X;if(f.content&&s){const We=f.content,Pt=We[2]-We[0],zt=We[3]-We[1];(f.textFitWidth||f.textFitHeight)&&(T=Rf(n)),re=Qh(E,0,We[0]),pe=Qh(I,0,We[1]),we=Qh(E,We[0],We[2]),F=Qh(I,We[1],We[3]),W=We[0]-re,Le=We[1]-pe,me=Pt-we,et=zt-F}const Ne=T.x1,Ze=T.y1,st=T.x2-Ne,rt=T.y2-Ze,ot=(We,Pt,zt,At)=>{const St=eu(We.stretch-re,we,st,Ne),tr=tu(We.fixed-W,me,We.stretch,B),Fr=eu(Pt.stretch-pe,F,rt,Ze),Hr=tu(Pt.fixed-Le,et,Pt.stretch,j),bi=eu(zt.stretch-re,we,st,Ne),tn=tu(zt.fixed-W,me,zt.stretch,B),Oi=eu(At.stretch-pe,F,rt,Ze),di=tu(At.fixed-Le,et,At.stretch,j),Ar=new H(St,Fr),ri=new H(bi,Fr),pi=new H(bi,Oi),fi=new H(St,Oi),Ai=new H(tr/m,Hr/m),rn=new H(tn/m,di/m),ii=t*Math.PI/180;if(ii){const ni=Math.sin(ii),si=Math.cos(ii),Gr=[si,-ni,ni,si];Ar._matMult(Gr),ri._matMult(Gr),fi._matMult(Gr),pi._matMult(Gr)}const ji=We.stretch+We.fixed,Xr=Pt.stretch+Pt.fixed;return{tl:Ar,tr:ri,bl:fi,br:pi,tex:{x:f.paddedRect.x+1+ji,y:f.paddedRect.y+1+Xr,w:zt.stretch+zt.fixed-ji,h:At.stretch+At.fixed-Xr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ai,pixelOffsetBR:rn,minFontScaleX:me/m/st,minFontScaleY:et/m/rt,isSDF:i}};if(s&&(f.stretchX||f.stretchY)){const We=am(E,U,B),Pt=am(I,X,j);for(let zt=0;zt<We.length-1;zt++){const At=We[zt],St=We[zt+1];for(let tr=0;tr<Pt.length-1;tr++)h.push(ot(At,Pt[tr],St,Pt[tr+1]))}}else h.push(ot({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:x+1}));return h}function Qh(n,t,i){let s=0;for(const h of n)s+=Math.max(t,Math.min(i,h[1]))-Math.max(t,Math.min(i,h[0]));return s}function am(n,t,i){const s=[{fixed:-1,stretch:0}];for(const[h,f]of n){const m=s[s.length-1];s.push({fixed:h-m.stretch,stretch:m.stretch}),s.push({fixed:h-m.stretch,stretch:m.stretch+(f-h)})}return s.push({fixed:t+1,stretch:i}),s}function eu(n,t,i,s){return n/t*i+s}function tu(n,t,i,s){return n-t*i/s}vt("Anchor",Ks);class ru{constructor(t,i,s,h,f,m,y,x,T,E){var I;if(this.boxStartIndex=t.length,T){let D=m.top,B=m.bottom;const j=m.collisionPadding;j&&(D-=j[1],B+=j[3]);let U=B-D;U>0&&(U=Math.max(10,U),this.circleDiameter=U)}else{const D=!((I=m.image)===null||I===void 0)&&I.content&&(m.image.textFitWidth||m.image.textFitHeight)?Rf(m):{x1:m.left,y1:m.top,x2:m.right,y2:m.bottom};D.y1=D.y1*y-x[0],D.y2=D.y2*y+x[2],D.x1=D.x1*y-x[3],D.x2=D.x2*y+x[1];const B=m.collisionPadding;if(B&&(D.x1-=B[0]*y,D.y1-=B[1]*y,D.x2+=B[2]*y,D.y2+=B[3]*y),E){const j=new H(D.x1,D.y1),U=new H(D.x2,D.y1),X=new H(D.x1,D.y2),re=new H(D.x2,D.y2),we=E*Math.PI/180;j._rotate(we),U._rotate(we),X._rotate(we),re._rotate(we),D.x1=Math.min(j.x,U.x,X.x,re.x),D.x2=Math.max(j.x,U.x,X.x,re.x),D.y1=Math.min(j.y,U.y,X.y,re.y),D.y2=Math.max(j.y,U.y,X.y,re.y)}t.emplaceBack(i.x,i.y,D.x1,D.y1,D.x2,D.y2,s,h,f)}this.boxEndIndex=t.length}}class Ry{constructor(t=[],i=(s,h)=>s<h?-1:s>h?1:0){if(this.data=t,this.length=this.data.length,this.compare=i,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:i,compare:s}=this,h=i[t];for(;t>0;){const f=t-1>>1,m=i[f];if(s(h,m)>=0)break;i[t]=m,t=f}i[t]=h}_down(t){const{data:i,compare:s}=this,h=this.length>>1,f=i[t];for(;t<h;){let m=1+(t<<1);const y=m+1;if(y<this.length&&s(i[y],i[m])<0&&(m=y),s(i[m],f)>=0)break;i[t]=i[m],t=m}i[t]=f}}function Ly(n,t=1,i=!1){const s=qo.fromPoints(n[0]),h=Math.min(s.width(),s.height());let f=h/2;const m=new Ry([],Fy),{minX:y,minY:x,maxX:T,maxY:E}=s;if(h===0)return new H(y,x);for(let B=y;B<T;B+=h)for(let j=x;j<E;j+=h)m.push(new Xa(B+f,j+f,f,n));let I=function(B){let j=0,U=0,X=0;const re=B[0];for(let we=0,pe=re.length,F=pe-1;we<pe;F=we++){const W=re[we],me=re[F],Le=W.x*me.y-me.x*W.y;U+=(W.x+me.x)*Le,X+=(W.y+me.y)*Le,j+=3*Le}return new Xa(U/j,X/j,0,B)}(n),D=m.length;for(;m.length;){const B=m.pop();(B.d>I.d||!I.d)&&(I=B,i&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,D)),B.max-I.d<=t||(f=B.h/2,m.push(new Xa(B.p.x-f,B.p.y-f,f,n)),m.push(new Xa(B.p.x+f,B.p.y-f,f,n)),m.push(new Xa(B.p.x-f,B.p.y+f,f,n)),m.push(new Xa(B.p.x+f,B.p.y+f,f,n)),D+=4)}return i&&(console.log(`num probes: ${D}`),console.log(`best distance: ${I.d}`)),I.p}function Fy(n,t){return t.max-n.max}function Xa(n,t,i,s){this.p=new H(n,t),this.h=i,this.d=function(h,f){let m=!1,y=1/0;for(let x=0;x<f.length;x++){const T=f[x];for(let E=0,I=T.length,D=I-1;E<I;D=E++){const B=T[E],j=T[D];B.y>h.y!=j.y>h.y&&h.x<(j.x-B.x)*(h.y-B.y)/(j.y-B.y)+B.x&&(m=!m),y=Math.min(y,jp(h,B,j))}}return(m?1:-1)*Math.sqrt(y)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}var vi;w.aD=void 0,(vi=w.aD||(w.aD={}))[vi.center=1]="center",vi[vi.left=2]="left",vi[vi.right=3]="right",vi[vi.top=4]="top",vi[vi.bottom=5]="bottom",vi[vi["top-left"]=6]="top-left",vi[vi["top-right"]=7]="top-right",vi[vi["bottom-left"]=8]="bottom-left",vi[vi["bottom-right"]=9]="bottom-right";const kd=Number.POSITIVE_INFINITY;function lm(n,t){return t[1]!==kd?function(i,s,h){let f=0,m=0;switch(s=Math.abs(s),h=Math.abs(h),i){case"top-right":case"top-left":case"top":m=h-7;break;case"bottom-right":case"bottom-left":case"bottom":m=7-h}switch(i){case"top-right":case"bottom-right":case"right":f=-s;break;case"top-left":case"bottom-left":case"left":f=s}return[f,m]}(n,t[0],t[1]):function(i,s){let h=0,f=0;s<0&&(s=0);const m=s/Math.SQRT2;switch(i){case"top-right":case"top-left":f=m-7;break;case"bottom-right":case"bottom-left":f=7-m;break;case"bottom":f=7-s;break;case"top":f=s-7}switch(i){case"top-right":case"bottom-right":h=-m;break;case"top-left":case"bottom-left":h=m;break;case"left":h=s;break;case"right":h=-s}return[h,f]}(n,t[0])}function cm(n,t,i){var s;const h=n.layout,f=(s=h.get("text-variable-anchor-offset"))===null||s===void 0?void 0:s.evaluate(t,{},i);if(f){const y=f.values,x=[];for(let T=0;T<y.length;T+=2){const E=x[T]=y[T],I=y[T+1].map(D=>D*ti);E.startsWith("top")?I[1]-=7:E.startsWith("bottom")&&(I[1]+=7),x[T+1]=I}return new ir(x)}const m=h.get("text-variable-anchor");if(m){let y;y=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[h.get("text-radial-offset").evaluate(t,{},i)*ti,kd]:h.get("text-offset").evaluate(t,{},i).map(T=>T*ti);const x=[];for(const T of m)x.push(T,lm(T,y));return new ir(x)}return null}function Md(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function By(n,t,i,s,h,f,m,y,x,T,E,I){let D=f.textMaxSize.evaluate(t,{});D===void 0&&(D=m);const B=n.layers[0].layout,j=B.get("icon-offset").evaluate(t,{},E),U=um(i.horizontal),X=m/24,re=n.tilePixelRatio*X,we=n.tilePixelRatio*D/24,pe=n.tilePixelRatio*y,F=n.tilePixelRatio*B.get("symbol-spacing"),W=B.get("text-padding")*n.tilePixelRatio,me=function(zt,At,St,tr=1){const Fr=zt.get("icon-padding").evaluate(At,{},St),Hr=Fr&&Fr.values;return[Hr[0]*tr,Hr[1]*tr,Hr[2]*tr,Hr[3]*tr]}(B,t,E,n.tilePixelRatio),Le=B.get("text-max-angle")/180*Math.PI,et=B.get("text-rotation-alignment")!=="viewport"&&B.get("symbol-placement")!=="point",Ne=B.get("icon-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",Ze=B.get("symbol-placement"),st=F/2,rt=B.get("icon-text-fit");let ot;s&&rt!=="none"&&(n.allowVerticalPlacement&&i.vertical&&(ot=Lf(s,i.vertical,rt,B.get("icon-text-fit-padding"),j,X)),U&&(s=Lf(s,U,rt,B.get("icon-text-fit-padding"),j,X)));const We=E?I.line.getGranularityForZoomLevel(E.z):1,Pt=(zt,At)=>{At.x<0||At.x>=ze||At.y<0||At.y>=ze||function(St,tr,Fr,Hr,bi,tn,Oi,di,Ar,ri,pi,fi,Ai,rn,ii,ji,Xr,ni,si,Gr,wr,En,Ka,kn,Vy){const Ya=St.addToLineVertexArray(tr,Fr);let Wo,Ja,Qa,el,mm=0,_m=0,gm=0,ym=0,Bd=-1,Od=-1;const us={};let vm=Ii("");if(St.allowVerticalPlacement&&Hr.vertical){const Si=di.layout.get("text-rotate").evaluate(wr,{},kn)+90;Qa=new ru(Ar,tr,ri,pi,fi,Hr.vertical,Ai,rn,ii,Si),Oi&&(el=new ru(Ar,tr,ri,pi,fi,Oi,Xr,ni,ii,Si))}if(bi){const Si=di.layout.get("icon-rotate").evaluate(wr,{}),nn=di.layout.get("icon-text-fit")!=="none",Ho=om(bi,Si,Ka,nn),In=Oi?om(Oi,Si,Ka,nn):void 0;Ja=new ru(Ar,tr,ri,pi,fi,bi,Xr,ni,!1,Si),mm=4*Ho.length;const Xo=St.iconSizeData;let qn=null;Xo.kind==="source"?(qn=[hs*di.layout.get("icon-size").evaluate(wr,{})],qn[0]>Hs&&de(`${St.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Xo.kind==="composite"&&(qn=[hs*En.compositeIconSizes[0].evaluate(wr,{},kn),hs*En.compositeIconSizes[1].evaluate(wr,{},kn)],(qn[0]>Hs||qn[1]>Hs)&&de(`${St.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),St.addSymbols(St.icon,Ho,qn,Gr,si,wr,w.an.none,tr,Ya.lineStartIndex,Ya.lineLength,-1,kn),Bd=St.icon.placedSymbolArray.length-1,In&&(_m=4*In.length,St.addSymbols(St.icon,In,qn,Gr,si,wr,w.an.vertical,tr,Ya.lineStartIndex,Ya.lineLength,-1,kn),Od=St.icon.placedSymbolArray.length-1)}const bm=Object.keys(Hr.horizontal);for(const Si of bm){const nn=Hr.horizontal[Si];if(!Wo){vm=Ii(nn.text);const In=di.layout.get("text-rotate").evaluate(wr,{},kn);Wo=new ru(Ar,tr,ri,pi,fi,nn,Ai,rn,ii,In)}const Ho=nn.positionedLines.length===1;if(gm+=hm(St,tr,nn,tn,di,ii,wr,ji,Ya,Hr.vertical?w.an.horizontal:w.an.horizontalOnly,Ho?bm:[Si],us,Bd,En,kn),Ho)break}Hr.vertical&&(ym+=hm(St,tr,Hr.vertical,tn,di,ii,wr,ji,Ya,w.an.vertical,["vertical"],us,Od,En,kn));const Ny=Wo?Wo.boxStartIndex:St.collisionBoxArray.length,Uy=Wo?Wo.boxEndIndex:St.collisionBoxArray.length,$y=Qa?Qa.boxStartIndex:St.collisionBoxArray.length,Zy=Qa?Qa.boxEndIndex:St.collisionBoxArray.length,Gy=Ja?Ja.boxStartIndex:St.collisionBoxArray.length,qy=Ja?Ja.boxEndIndex:St.collisionBoxArray.length,Wy=el?el.boxStartIndex:St.collisionBoxArray.length,Hy=el?el.boxEndIndex:St.collisionBoxArray.length;let Mn=-1;const nu=(Si,nn)=>Si&&Si.circleDiameter?Math.max(Si.circleDiameter,nn):nn;Mn=nu(Wo,Mn),Mn=nu(Qa,Mn),Mn=nu(Ja,Mn),Mn=nu(el,Mn);const xm=Mn>-1?1:0;xm&&(Mn*=Vy/ti),St.glyphOffsetArray.length>=Wa.MAX_GLYPHS&&de("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),wr.sortKey!==void 0&&St.addToSortKeyRanges(St.symbolInstances.length,wr.sortKey);const Xy=cm(di,wr,kn),[Ky,Yy]=function(Si,nn){const Ho=Si.length,In=nn==null?void 0:nn.values;if((In==null?void 0:In.length)>0)for(let Xo=0;Xo<In.length;Xo+=2){const qn=In[Xo+1];Si.emplaceBack(w.aD[In[Xo]],qn[0],qn[1])}return[Ho,Si.length]}(St.textAnchorOffsets,Xy);St.symbolInstances.emplaceBack(tr.x,tr.y,us.right>=0?us.right:-1,us.center>=0?us.center:-1,us.left>=0?us.left:-1,us.vertical||-1,Bd,Od,vm,Ny,Uy,$y,Zy,Gy,qy,Wy,Hy,ri,gm,ym,mm,_m,xm,0,Ai,Mn,Ky,Yy)}(n,At,zt,i,s,h,ot,n.layers[0],n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,re,[W,W,W,W],et,x,pe,me,Ne,j,t,f,T,E,m)};if(Ze==="line")for(const zt of em(t.geometry,0,0,ze,ze)){const At=Go(zt,We),St=Dy(At,F,Le,i.vertical||U,s,24,we,n.overscaling,ze);for(const tr of St)U&&Oy(n,U.text,st,tr)||Pt(At,tr)}else if(Ze==="line-center"){for(const zt of t.geometry)if(zt.length>1){const At=Go(zt,We),St=zy(At,Le,i.vertical||U,s,24,we);St&&Pt(At,St)}}else if(t.type==="Polygon")for(const zt of _a(t.geometry,0)){const At=Ly(zt,16);Pt(Go(zt[0],We,!0),new Ks(At.x,At.y,0))}else if(t.type==="LineString")for(const zt of t.geometry){const At=Go(zt,We);Pt(At,new Ks(At[0].x,At[0].y,0))}else if(t.type==="Point")for(const zt of t.geometry)for(const At of zt)Pt([At],new Ks(At.x,At.y,0))}function hm(n,t,i,s,h,f,m,y,x,T,E,I,D,B,j){const U=function(we,pe,F,W,me,Le,et,Ne){const Ze=W.layout.get("text-rotate").evaluate(Le,{})*Math.PI/180,st=[];for(const rt of pe.positionedLines)for(const ot of rt.positionedGlyphs){if(!ot.rect)continue;const We=ot.rect||{};let Pt=4,zt=!0,At=1,St=0;const tr=(me||Ne)&&ot.vertical,Fr=ot.metrics.advance*ot.scale/2;if(Ne&&pe.verticalizable&&(St=rt.lineOffset/2-(ot.imageName?-(ti-ot.metrics.width*ot.scale)/2:(ot.scale-1)*ti)),ot.imageName){const ni=et[ot.imageName];zt=ni.sdf,At=ni.pixelRatio,Pt=1/At}const Hr=me?[ot.x+Fr,ot.y]:[0,0];let bi=me?[0,0]:[ot.x+Fr+F[0],ot.y+F[1]-St],tn=[0,0];tr&&(tn=bi,bi=[0,0]);const Oi=ot.metrics.isDoubleResolution?2:1,di=(ot.metrics.left-Pt)*ot.scale-Fr+bi[0],Ar=(-ot.metrics.top-Pt)*ot.scale+bi[1],ri=di+We.w/Oi*ot.scale/At,pi=Ar+We.h/Oi*ot.scale/At,fi=new H(di,Ar),Ai=new H(ri,Ar),rn=new H(di,pi),ii=new H(ri,pi);if(tr){const ni=new H(-Fr,Fr- -17),si=-Math.PI/2,Gr=12-Fr,wr=new H(22-Gr,-(ot.imageName?Gr:0)),En=new H(...tn);fi._rotateAround(si,ni)._add(wr)._add(En),Ai._rotateAround(si,ni)._add(wr)._add(En),rn._rotateAround(si,ni)._add(wr)._add(En),ii._rotateAround(si,ni)._add(wr)._add(En)}if(Ze){const ni=Math.sin(Ze),si=Math.cos(Ze),Gr=[si,-ni,ni,si];fi._matMult(Gr),Ai._matMult(Gr),rn._matMult(Gr),ii._matMult(Gr)}const ji=new H(0,0),Xr=new H(0,0);st.push({tl:fi,tr:Ai,bl:rn,br:ii,tex:We,writingMode:pe.writingMode,glyphOffset:Hr,sectionIndex:ot.sectionIndex,isSDF:zt,pixelOffsetTL:ji,pixelOffsetBR:Xr,minFontScaleX:0,minFontScaleY:0})}return st}(0,i,y,h,f,m,s,n.allowVerticalPlacement),X=n.textSizeData;let re=null;X.kind==="source"?(re=[hs*h.layout.get("text-size").evaluate(m,{})],re[0]>Hs&&de(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):X.kind==="composite"&&(re=[hs*B.compositeTextSizes[0].evaluate(m,{},j),hs*B.compositeTextSizes[1].evaluate(m,{},j)],(re[0]>Hs||re[1]>Hs)&&de(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,U,re,y,f,m,T,t,x.lineStartIndex,x.lineLength,D,j);for(const we of E)I[we]=n.text.placedSymbolArray.length-1;return 4*U.length}function um(n){for(const t in n)return n[t];return null}function Oy(n,t,i,s){const h=n.compareText;if(t in h){const f=h[t];for(let m=f.length-1;m>=0;m--)if(s.dist(f[m])<i)return!0}else h[t]=[];return h[t].push(s),!1}const dm=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Id{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,s]=new Uint8Array(t,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=s>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const f=dm[15&s];if(!f)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(t,2,1),[y]=new Uint32Array(t,4,1);return new Id(y,m,f,t)}constructor(t,i=64,s=Float64Array,h){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=s,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const f=dm.indexOf(this.ArrayType),m=2*t*this.ArrayType.BYTES_PER_ELEMENT,y=t*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-y%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${s}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+y+x,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+m+y+x),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+y+x,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=t)}add(t,i){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=t,this.coords[this._pos++]=i,s}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Ad(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,i,s,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:m,nodeSize:y}=this,x=[0,f.length-1,0],T=[];for(;x.length;){const E=x.pop()||0,I=x.pop()||0,D=x.pop()||0;if(I-D<=y){for(let X=D;X<=I;X++){const re=m[2*X],we=m[2*X+1];re>=t&&re<=s&&we>=i&&we<=h&&T.push(f[X])}continue}const B=D+I>>1,j=m[2*B],U=m[2*B+1];j>=t&&j<=s&&U>=i&&U<=h&&T.push(f[B]),(E===0?t<=j:i<=U)&&(x.push(D),x.push(B-1),x.push(1-E)),(E===0?s>=j:h>=U)&&(x.push(B+1),x.push(I),x.push(1-E))}return T}within(t,i,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:f,nodeSize:m}=this,y=[0,h.length-1,0],x=[],T=s*s;for(;y.length;){const E=y.pop()||0,I=y.pop()||0,D=y.pop()||0;if(I-D<=m){for(let X=D;X<=I;X++)fm(f[2*X],f[2*X+1],t,i)<=T&&x.push(h[X]);continue}const B=D+I>>1,j=f[2*B],U=f[2*B+1];fm(j,U,t,i)<=T&&x.push(h[B]),(E===0?t-s<=j:i-s<=U)&&(y.push(D),y.push(B-1),y.push(1-E)),(E===0?t+s>=j:i+s>=U)&&(y.push(B+1),y.push(I),y.push(1-E))}return x}}function Ad(n,t,i,s,h,f){if(h-s<=i)return;const m=s+h>>1;pm(n,t,m,s,h,f),Ad(n,t,i,s,m-1,1-f),Ad(n,t,i,m+1,h,1-f)}function pm(n,t,i,s,h,f){for(;h>s;){if(h-s>600){const T=h-s+1,E=i-s+1,I=Math.log(T),D=.5*Math.exp(2*I/3),B=.5*Math.sqrt(I*D*(T-D)/T)*(E-T/2<0?-1:1);pm(n,t,i,Math.max(s,Math.floor(i-E*D/T+B)),Math.min(h,Math.floor(i+(T-E)*D/T+B)),f)}const m=t[2*i+f];let y=s,x=h;for(wc(n,t,s,i),t[2*h+f]>m&&wc(n,t,s,h);y<x;){for(wc(n,t,y,x),y++,x--;t[2*y+f]<m;)y++;for(;t[2*x+f]>m;)x--}t[2*s+f]===m?wc(n,t,s,x):(x++,wc(n,t,x,h)),x<=i&&(s=x+1),i<=x&&(h=x-1)}}function wc(n,t,i,s){zd(n,i,s),zd(t,2*i,2*s),zd(t,2*i+1,2*s+1)}function zd(n,t,i){const s=n[t];n[t]=n[i],n[i]=s}function fm(n,t,i,s){const h=n-i,f=t-s;return h*h+f*f}var Dd;w.cw=void 0,(Dd=w.cw||(w.cw={})).create="create",Dd.load="load",Dd.fullLoad="fullLoad";let iu=null,Cc=[];const Rd=1e3/60,Ld="loadTime",Fd="fullLoadTime",jy={mark(n){performance.mark(n)},frame(n){const t=n;iu!=null&&Cc.push(t-iu),iu=t},clearMetrics(){iu=null,Cc=[],performance.clearMeasures(Ld),performance.clearMeasures(Fd);for(const n in w.cw)performance.clearMarks(w.cw[n])},getPerformanceMetrics(){performance.measure(Ld,w.cw.create,w.cw.load),performance.measure(Fd,w.cw.create,w.cw.fullLoad);const n=performance.getEntriesByName(Ld)[0].duration,t=performance.getEntriesByName(Fd)[0].duration,i=Cc.length,s=1/(Cc.reduce((f,m)=>f+m,0)/i/1e3),h=Cc.filter(f=>f>Rd).reduce((f,m)=>f+(m-Rd)/Rd,0);return{loadTime:n,fullLoadTime:t,fps:s,percentDroppedFrames:h/(i+h)*100,totalFrames:i}}};w.$=ze,w.A=qe,w.B=function([n,t,i]){return t+=90,t*=Math.PI/180,i*=Math.PI/180,{x:n*Math.cos(t)*Math.sin(i),y:n*Math.sin(t)*Math.sin(i),z:n*Math.cos(i)}},w.C=Fi,w.D=Tt,w.E=Ye,w.F=Cr,w.G=Ra,w.H=function(n){if(it==null){const t=n.navigator?n.navigator.userAgent:null;it=!!n.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return it},w.I=gd,w.J=class{constructor(n,t){this.target=n,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new My(()=>this.process()),this.subscription=kt(this.target,"message",i=>this.receive(i),!1),this.globalScope=ke(self)?n:window}registerMessageHandler(n,t){this.messageHandlers[n]=t}sendAsync(n,t){return new Promise((i,s)=>{const h=Math.round(1e18*Math.random()).toString(36).substring(0,10),f=t?kt(t.signal,"abort",()=>{f==null||f.unsubscribe(),delete this.resolveRejects[h];const x={id:h,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(x)},Iy):null;this.resolveRejects[h]={resolve:x=>{f==null||f.unsubscribe(),i(x)},reject:x=>{f==null||f.unsubscribe(),s(x)}};const m=[],y=Object.assign(Object.assign({},n),{id:h,sourceMapId:this.mapId,origin:location.origin,data:Do(n.data,m)});this.target.postMessage(y,{transfer:m})})}receive(n){const t=n.data,i=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[i];const s=this.abortControllers[i];return delete this.abortControllers[i],void(s&&s.abort())}if(ke(self)||t.mustQueue)return this.tasks[i]=t,this.taskQueue.push(i),void this.invoker.trigger();this.processTask(i,t)}}process(){if(this.taskQueue.length===0)return;const n=this.taskQueue.shift(),t=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(n,t)}processTask(n,t){return a(this,void 0,void 0,function*(){if(t.type==="<response>"){const h=this.resolveRejects[n];return delete this.resolveRejects[n],h?void(t.error?h.reject(Zs(t.error)):h.resolve(Zs(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const i=Zs(t.data),s=new AbortController;this.abortControllers[n]=s;try{const h=yield this.messageHandlers[t.type](t.sourceMapId,i,s);this.completeTask(n,null,h)}catch(h){this.completeTask(n,h)}})}completeTask(n,t,i){const s=[];delete this.abortControllers[n];const h={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Do(t):null,data:Do(i,s)};this.target.postMessage(h,{transfer:s})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},w.K=Y,w.L=function(){var n=new qe(16);return qe!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},w.M=function(n,t,i){var s,h,f,m,y,x,T,E,I,D,B,j,U=i[0],X=i[1],re=i[2];return t===n?(n[12]=t[0]*U+t[4]*X+t[8]*re+t[12],n[13]=t[1]*U+t[5]*X+t[9]*re+t[13],n[14]=t[2]*U+t[6]*X+t[10]*re+t[14],n[15]=t[3]*U+t[7]*X+t[11]*re+t[15]):(h=t[1],f=t[2],m=t[3],y=t[4],x=t[5],T=t[6],E=t[7],I=t[8],D=t[9],B=t[10],j=t[11],n[0]=s=t[0],n[1]=h,n[2]=f,n[3]=m,n[4]=y,n[5]=x,n[6]=T,n[7]=E,n[8]=I,n[9]=D,n[10]=B,n[11]=j,n[12]=s*U+y*X+I*re+t[12],n[13]=h*U+x*X+D*re+t[13],n[14]=f*U+T*X+B*re+t[14],n[15]=m*U+E*X+j*re+t[15]),n},w.N=function(n,t,i){var s=i[0],h=i[1],f=i[2];return n[0]=t[0]*s,n[1]=t[1]*s,n[2]=t[2]*s,n[3]=t[3]*s,n[4]=t[4]*h,n[5]=t[5]*h,n[6]=t[6]*h,n[7]=t[7]*h,n[8]=t[8]*f,n[9]=t[9]*f,n[10]=t[10]*f,n[11]=t[11]*f,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},w.O=function(n,t,i){var s=t[0],h=t[1],f=t[2],m=t[3],y=t[4],x=t[5],T=t[6],E=t[7],I=t[8],D=t[9],B=t[10],j=t[11],U=t[12],X=t[13],re=t[14],we=t[15],pe=i[0],F=i[1],W=i[2],me=i[3];return n[0]=pe*s+F*y+W*I+me*U,n[1]=pe*h+F*x+W*D+me*X,n[2]=pe*f+F*T+W*B+me*re,n[3]=pe*m+F*E+W*j+me*we,n[4]=(pe=i[4])*s+(F=i[5])*y+(W=i[6])*I+(me=i[7])*U,n[5]=pe*h+F*x+W*D+me*X,n[6]=pe*f+F*T+W*B+me*re,n[7]=pe*m+F*E+W*j+me*we,n[8]=(pe=i[8])*s+(F=i[9])*y+(W=i[10])*I+(me=i[11])*U,n[9]=pe*h+F*x+W*D+me*X,n[10]=pe*f+F*T+W*B+me*re,n[11]=pe*m+F*E+W*j+me*we,n[12]=(pe=i[12])*s+(F=i[13])*y+(W=i[14])*I+(me=i[15])*U,n[13]=pe*h+F*x+W*D+me*X,n[14]=pe*f+F*T+W*B+me*re,n[15]=pe*m+F*E+W*j+me*we,n},w.P=H,w.Q=function(n,t){const i={};for(let s=0;s<t.length;s++){const h=t[s];h in n&&(i[h]=n[h])}return i},w.R=Bi,w.S=Xs,w.T=rd,w.U=Gf,w.V=Zf,w.W=Te,w.X=Ae,w.Y=pt,w.Z=en,w._=a,w.a=N,w.a$=function(n,t,i){return n[0]=t[0]*i,n[1]=t[1]*i,n[2]=t[2]*i,n[3]=t[3]*i,n},w.a0=xc,w.a1=qo,w.a2=25,w.a3=Ed,w.a4=n=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(i=>{t.onloadstart=()=>{i(t)};for(const s of n){const h=window.document.createElement("source");Fe(s)||(t.crossOrigin="Anonymous"),h.src=s,t.appendChild(h)}})},w.a5=ct,w.a6=function(){return _i++},w.a7=Q,w.a8=Wa,w.a9=Fn,w.aA=ti,w.aB=Et,w.aC=function(n,t,i,s,h=!1){if(!i[0]&&!i[1])return[0,0];const f=h?s==="map"?-n.bearingInRadians:0:s==="viewport"?n.bearingInRadians:0;if(f){const m=Math.sin(f),y=Math.cos(f);i=[i[0]*y-i[1]*m,i[0]*m+i[1]*y]}return[h?i[0]:Et(t,i[0],n.zoom),h?i[1]:Et(t,i[1],n.zoom)]},w.aE=bd,w.aF=Md,w.aG=vd,w.aH=Id,w.aI=Lr,w.aJ=qh,w.aK=De,w.aL=nr,w.aM=gr,w.aN=Pr,w.aO=Ut,w.aP=Wf,w.aQ=Xe,w.aR=be,w.aS=function(n){var t=new qe(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t},w.aT=function(n,t,i){return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],n},w.aU=function(n,t){var i=t[0],s=t[1],h=t[2],f=i*i+s*s+h*h;return f>0&&(f=1/Math.sqrt(f)),n[0]=t[0]*f,n[1]=t[1]*f,n[2]=t[2]*f,n},w.aV=Z,w.aW=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]},w.aX=function(n,t,i){return n[0]=t[0]*i[0],n[1]=t[1]*i[1],n[2]=t[2]*i[2],n[3]=t[3]*i[3],n},w.aY=ut,w.aZ=function(n,t,i){const s=t[0]*i[0]+t[1]*i[1]+t[2]*i[2];return s===0?null:(-(n[0]*i[0]+n[1]*i[1]+n[2]*i[2])-i[3])/s},w.a_=jt,w.aa=$o,w.ab=Yf,w.ac=function(n){const t={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,s,h,f)=>{const m=h||f;return t[s]=!m||m.toLowerCase(),""}),t["max-age"]){const i=parseInt(t["max-age"],10);isNaN(i)?delete t["max-age"]:t["max-age"]=i}return t},w.ad=Xt,w.ae=function(n){return Math.pow(2,n)},w.af=lt,w.ag=Vt,w.ah=85.051129,w.ai=qf,w.aj=function(n){return Math.log(n)/Math.LN2},w.ak=function(n){var t=n[0],i=n[1];return t*t+i*i},w.al=function(n,t){const i=[];for(const s in n)s in t||i.push(s);return i},w.am=function(n,t){let i=0,s=0;if(n.kind==="constant")s=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:h,minZoom:f,maxZoom:m}=n,y=h?Vt(wi.interpolationFactor(h,t,f,m),0,1):0;n.kind==="camera"?s=Fi.number(n.minSize,n.maxSize,y):i=y}return{uSizeT:i,uSize:s}},w.ao=function(n,{uSize:t,uSizeT:i},{lowerSize:s,upperSize:h}){return n.kind==="source"?s/hs:n.kind==="composite"?Fi.number(s/hs,h/hs,i):t},w.ap=function(n,t){var i=t[0],s=t[1],h=t[2],f=t[3],m=t[4],y=t[5],x=t[6],T=t[7],E=t[8],I=t[9],D=t[10],B=t[11],j=t[12],U=t[13],X=t[14],re=t[15],we=i*y-s*m,pe=i*x-h*m,F=i*T-f*m,W=s*x-h*y,me=s*T-f*y,Le=h*T-f*x,et=E*U-I*j,Ne=E*X-D*j,Ze=E*re-B*j,st=I*X-D*U,rt=I*re-B*U,ot=D*re-B*X,We=we*ot-pe*rt+F*st+W*Ze-me*Ne+Le*et;return We?(n[0]=(y*ot-x*rt+T*st)*(We=1/We),n[1]=(h*rt-s*ot-f*st)*We,n[2]=(U*Le-X*me+re*W)*We,n[3]=(D*me-I*Le-B*W)*We,n[4]=(x*Ze-m*ot-T*Ne)*We,n[5]=(i*ot-h*Ze+f*Ne)*We,n[6]=(X*F-j*Le-re*pe)*We,n[7]=(E*Le-D*F+B*pe)*We,n[8]=(m*rt-y*Ze+T*et)*We,n[9]=(s*Ze-i*rt-f*et)*We,n[10]=(j*me-U*F+re*we)*We,n[11]=(I*F-E*me-B*we)*We,n[12]=(y*Ne-m*st-x*et)*We,n[13]=(i*st-s*Ne+h*et)*We,n[14]=(U*pe-j*W-X*we)*We,n[15]=(E*W-I*pe+D*we)*We,n):null},w.aq=Ft,w.ar=function(n){return Math.hypot(n[0],n[1])},w.as=function(n){return n[0]=0,n[1]=0,n},w.at=function(n,t,i){return n[0]=t[0]*i,n[1]=t[1]*i,n},w.au=xd,w.av=at,w.aw=function(n,t,i,s){const h=t.y-n.y,f=t.x-n.x,m=s.y-i.y,y=s.x-i.x,x=m*f-y*h;if(x===0)return null;const T=(y*(n.y-i.y)-m*(n.x-i.x))/x;return new H(n.x+T*f,n.y+T*h)},w.ax=em,w.ay=Bp,w.az=function(n){let t=1/0,i=1/0,s=-1/0,h=-1/0;for(const f of n)t=Math.min(t,f.x),i=Math.min(i,f.y),s=Math.max(s,f.x),h=Math.max(h,f.y);return[t,i,s,h]},w.b=nt,w.b$=oy,w.b0=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]},w.b1=Xf,w.b2=Ha,w.b3=function(n,t,i,s,h){var f,m=1/Math.tan(t/2);return n[0]=m/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=m,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,h!=null&&h!==1/0?(n[10]=(h+s)*(f=1/(s-h)),n[14]=2*h*s*f):(n[10]=-1,n[14]=-2*s),n},w.b4=function(n){var t=new qe(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},w.b5=function(n,t,i){var s=Math.sin(i),h=Math.cos(i),f=t[0],m=t[1],y=t[2],x=t[3],T=t[4],E=t[5],I=t[6],D=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=f*h+T*s,n[1]=m*h+E*s,n[2]=y*h+I*s,n[3]=x*h+D*s,n[4]=T*h-f*s,n[5]=E*h-m*s,n[6]=I*h-y*s,n[7]=D*h-x*s,n},w.b6=function(n,t,i){var s=Math.sin(i),h=Math.cos(i),f=t[4],m=t[5],y=t[6],x=t[7],T=t[8],E=t[9],I=t[10],D=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=f*h+T*s,n[5]=m*h+E*s,n[6]=y*h+I*s,n[7]=x*h+D*s,n[8]=T*h-f*s,n[9]=E*h-m*s,n[10]=I*h-y*s,n[11]=D*h-x*s,n},w.b7=function(){const n=new Float32Array(16);return lt(n),n},w.b8=function(){const n=new Float64Array(16);return lt(n),n},w.b9=function(){return new Float64Array(16)},w.bA=function(n){return n[0]=0,n[1]=0,n[2]=0,n},w.bB=function(n,t,i,s){const h=Math.sqrt(n*n+t*t),f=Math.sqrt(i*i+s*s);n/=h,t/=h,i/=f,s/=f;const m=Math.acos(n*i+t*s);return-t*i+n*s>0?m:-m},w.bC=function(n,t){const i=bt(n,2*Math.PI),s=bt(t,2*Math.PI);return Math.min(Math.abs(i-s),Math.abs(i-s+2*Math.PI),Math.abs(i-s-2*Math.PI))},w.bD=function(){const n={},t=ve.$version;for(const i in ve.$root){const s=ve.$root[i];if(s.required){let h=null;h=i==="version"?t:s.type==="array"?[]:{},h!=null&&(n[i]=h)}}return n},w.bE=Hl,w.bF=xe,w.bG=function n(t,i){if(Array.isArray(t)){if(!Array.isArray(i)||t.length!==i.length)return!1;for(let s=0;s<t.length;s++)if(!n(t[s],i[s]))return!1;return!0}if(typeof t=="object"&&t!==null&&i!==null){if(typeof i!="object"||Object.keys(t).length!==Object.keys(i).length)return!1;for(const s in t)if(!n(t[s],i[s]))return!1;return!0}return t===i},w.bH=function(n){n=n.slice();const t=Object.create(null);for(let i=0;i<n.length;i++)t[n[i].id]=n[i];for(let i=0;i<n.length;i++)"ref"in n[i]&&(n[i]=Rt(n[i],t[n[i].ref]));return n},w.bI=function(n){if(n.type==="custom")return new ky(n);switch(n.type){case"background":return new Ty(n);case"circle":return new vg(n);case"color-relief":return new Tg(n);case"fill":return new Vg(n);case"fill-extrusion":return new Hg(n);case"heatmap":return new xg(n);case"hillshade":return new Cg(n);case"line":return new ry(n);case"raster":return new Ey(n);case"symbol":return new Jh(n)}},w.bJ=Je,w.bK=function(n,t){if(!n)return[{command:"setStyle",args:[t]}];let i=[];try{if(!xt(n.version,t.version))return[{command:"setStyle",args:[t]}];xt(n.center,t.center)||i.push({command:"setCenter",args:[t.center]}),xt(n.state,t.state)||i.push({command:"setGlobalState",args:[t.state]}),xt(n.centerAltitude,t.centerAltitude)||i.push({command:"setCenterAltitude",args:[t.centerAltitude]}),xt(n.zoom,t.zoom)||i.push({command:"setZoom",args:[t.zoom]}),xt(n.bearing,t.bearing)||i.push({command:"setBearing",args:[t.bearing]}),xt(n.pitch,t.pitch)||i.push({command:"setPitch",args:[t.pitch]}),xt(n.roll,t.roll)||i.push({command:"setRoll",args:[t.roll]}),xt(n.sprite,t.sprite)||i.push({command:"setSprite",args:[t.sprite]}),xt(n.glyphs,t.glyphs)||i.push({command:"setGlyphs",args:[t.glyphs]}),xt(n.transition,t.transition)||i.push({command:"setTransition",args:[t.transition]}),xt(n.light,t.light)||i.push({command:"setLight",args:[t.light]}),xt(n.terrain,t.terrain)||i.push({command:"setTerrain",args:[t.terrain]}),xt(n.sky,t.sky)||i.push({command:"setSky",args:[t.sky]}),xt(n.projection,t.projection)||i.push({command:"setProjection",args:[t.projection]});const s={},h=[];(function(m,y,x,T){let E;for(E in y=y||{},m=m||{})Object.prototype.hasOwnProperty.call(m,E)&&(Object.prototype.hasOwnProperty.call(y,E)||br(E,x,T));for(E in y)Object.prototype.hasOwnProperty.call(y,E)&&(Object.prototype.hasOwnProperty.call(m,E)?xt(m[E],y[E])||(m[E].type==="geojson"&&y[E].type==="geojson"&&lr(m,y,E)?Mt(x,{command:"setGeoJSONSourceData",args:[E,y[E].data]}):ur(E,y,x,T)):Ot(E,y,x))})(n.sources,t.sources,h,s);const f=[];n.layers&&n.layers.forEach(m=>{"source"in m&&s[m.source]?i.push({command:"removeLayer",args:[m.id]}):f.push(m)}),i=i.concat(h),function(m,y,x){y=y||[];const T=(m=m||[]).map(rr),E=y.map(rr),I=m.reduce(Yr,{}),D=y.reduce(Yr,{}),B=T.slice(),j=Object.create(null);let U,X,re,we,pe;for(let F=0,W=0;F<T.length;F++)U=T[F],Object.prototype.hasOwnProperty.call(D,U)?W++:(Mt(x,{command:"removeLayer",args:[U]}),B.splice(B.indexOf(U,W),1));for(let F=0,W=0;F<E.length;F++)U=E[E.length-1-F],B[B.length-1-F]!==U&&(Object.prototype.hasOwnProperty.call(I,U)?(Mt(x,{command:"removeLayer",args:[U]}),B.splice(B.lastIndexOf(U,B.length-W),1)):W++,we=B[B.length-F],Mt(x,{command:"addLayer",args:[D[U],we]}),B.splice(B.length-F,0,U),j[U]=!0);for(let F=0;F<E.length;F++)if(U=E[F],X=I[U],re=D[U],!j[U]&&!xt(X,re))if(xt(X.source,re.source)&&xt(X["source-layer"],re["source-layer"])&&xt(X.type,re.type)){for(pe in Bt(X.layout,re.layout,x,U,null,"setLayoutProperty"),Bt(X.paint,re.paint,x,U,null,"setPaintProperty"),xt(X.filter,re.filter)||Mt(x,{command:"setFilter",args:[U,re.filter]}),xt(X.minzoom,re.minzoom)&&xt(X.maxzoom,re.maxzoom)||Mt(x,{command:"setLayerZoomRange",args:[U,re.minzoom,re.maxzoom]}),X)Object.prototype.hasOwnProperty.call(X,pe)&&pe!=="layout"&&pe!=="paint"&&pe!=="filter"&&pe!=="metadata"&&pe!=="minzoom"&&pe!=="maxzoom"&&(pe.indexOf("paint.")===0?Bt(X[pe],re[pe],x,U,pe.slice(6),"setPaintProperty"):xt(X[pe],re[pe])||Mt(x,{command:"setLayerProperty",args:[U,pe,re[pe]]}));for(pe in re)Object.prototype.hasOwnProperty.call(re,pe)&&!Object.prototype.hasOwnProperty.call(X,pe)&&pe!=="layout"&&pe!=="paint"&&pe!=="filter"&&pe!=="metadata"&&pe!=="minzoom"&&pe!=="maxzoom"&&(pe.indexOf("paint.")===0?Bt(X[pe],re[pe],x,U,pe.slice(6),"setPaintProperty"):xt(X[pe],re[pe])||Mt(x,{command:"setLayerProperty",args:[U,pe,re[pe]]}))}else Mt(x,{command:"removeLayer",args:[U]}),we=B[B.lastIndexOf(U)+1],Mt(x,{command:"addLayer",args:[re,we]})}(f,t.layers,i)}catch(s){console.warn("Unable to compute style diff:",s),i=[{command:"setStyle",args:[t]}]}return i},w.bL=function(n){const t=[],i=n.id;return i===void 0&&t.push({message:`layers.${i}: missing required property "id"`}),n.render===void 0&&t.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&t.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),t},w.bM=ar,w.bN=O,w.bO=class extends xr{constructor(n,t){super(n,t),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},w.bP=Nh,w.bQ=class extends xr{constructor(n,t){super(n,t),this.current=Xu}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let t=1;t<16;t++)if(n[t]!==this.current[t]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},w.bR=Wr,w.bS=class extends xr{constructor(n,t){super(n,t),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},w.bT=class extends xr{constructor(n,t){super(n,t),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},w.bU=He,w.bV=function(n,t){var i=Math.sin(t),s=Math.cos(t);return n[0]=s,n[1]=i,n[2]=0,n[3]=-i,n[4]=s,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},w.bW=function(n,t,i){var s=t[0],h=t[1],f=t[2];return n[0]=s*i[0]+h*i[3]+f*i[6],n[1]=s*i[1]+h*i[4]+f*i[7],n[2]=s*i[2]+h*i[5]+f*i[8],n},w.bX=function(n,t,i,s,h,f,m){var y=1/(t-i),x=1/(s-h),T=1/(f-m);return n[0]=-2*y,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*x,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*T,n[11]=0,n[12]=(t+i)*y,n[13]=(h+s)*x,n[14]=(m+f)*T,n[15]=1,n},w.bY=class extends xr{constructor(n,t){super(n,t),this.current=new Array}set(n){if(n!=this.current){this.current=n;const t=new Float32Array(4*n.length);for(let i=0;i<n.length;i++)t[4*i]=n[i].r,t[4*i+1]=n[i].g,t[4*i+2]=n[i].b,t[4*i+3]=n[i].a;this.gl.uniform4fv(this.location,t)}}},w.bZ=class extends xr{constructor(n,t){super(n,t),this.current=new Array}set(n){if(n!=this.current){this.current=n;const t=new Float32Array(n);this.gl.uniform1fv(this.location,t)}}},w.b_=class extends l{},w.ba=function(n,t,i){const s=new Float64Array(4);return dt(s,n,t-90,i),s},w.bb=function(n,t,i,s){var h,f,m,y,x,T=t[0],E=t[1],I=t[2],D=t[3],B=i[0],j=i[1],U=i[2],X=i[3];return(f=T*B+E*j+I*U+D*X)<0&&(f=-f,B=-B,j=-j,U=-U,X=-X),1-f>Me?(h=Math.acos(f),m=Math.sin(h),y=Math.sin((1-s)*h)/m,x=Math.sin(s*h)/m):(y=1-s,x=s),n[0]=y*T+x*B,n[1]=y*E+x*j,n[2]=y*I+x*U,n[3]=y*D+x*X,n},w.bc=function(n){const t=new Float64Array(9);var i,s,h,f,m,y,x,T,E,I,D,B,j,U,X,re,we,pe;I=(h=(s=n)[0])*(x=h+h),D=(f=s[1])*x,j=(m=s[2])*x,U=m*(T=f+f),re=(y=s[3])*x,we=y*T,pe=y*(E=m+m),(i=t)[0]=1-(B=f*T)-(X=m*E),i[3]=D-pe,i[6]=j+we,i[1]=D+pe,i[4]=1-I-X,i[7]=U-re,i[2]=j-we,i[5]=U+re,i[8]=1-I-B;const F=Ut(-Math.asin(Vt(t[2],-1,1)));let W,me;return Math.hypot(t[5],t[8])<.001?(W=0,me=-Ut(Math.atan2(t[3],t[4]))):(W=Ut(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),me=Ut(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:W,pitch:F+90,bearing:me}},w.bd=function(n,t){return n.roll==t.roll&&n.pitch==t.pitch&&n.bearing==t.bearing},w.be=Yt,w.bf=Ti,w.bg=Ga,w.bh=fc,w.bi=Za,w.bj=gt,w.bk=fr,w.bl=Nt,w.bm=function(n,t,i,s,h){return gt(s,h,Vt((n-t)/(i-t),0,1))},w.bn=bt,w.bo=function(){return new Float64Array(3)},w.bp=function(n,t,i,s){return n[0]=t[0]+i[0]*s,n[1]=t[1]+i[1]*s,n[2]=t[2]+i[2]*s,n},w.bq=dt,w.br=function(n,t,i){var s=i[0],h=i[1],f=i[2],m=t[0],y=t[1],x=t[2],T=h*x-f*y,E=f*m-s*x,I=s*y-h*m,D=h*I-f*E,B=f*T-s*I,j=s*E-h*T,U=2*i[3];return E*=U,I*=U,B*=2,j*=2,n[0]=m+(T*=U)+(D*=2),n[1]=y+E+B,n[2]=x+I+j,n},w.bs=function(n,t,i){const s=(h=[n[0],n[1],n[2],t[0],t[1],t[2],i[0],i[1],i[2]])[0]*((E=h[8])*(m=h[4])-(y=h[5])*(T=h[7]))+h[1]*(-E*(f=h[3])+y*(x=h[6]))+h[2]*(T*f-m*x);var h,f,m,y,x,T,E;if(s===0)return null;const I=Z([],[t[0],t[1],t[2]],[i[0],i[1],i[2]]),D=Z([],[i[0],i[1],i[2]],[n[0],n[1],n[2]]),B=Z([],[n[0],n[1],n[2]],[t[0],t[1],t[2]]),j=Xe([],I,-n[3]);return be(j,j,Xe([],D,-t[3])),be(j,j,Xe([],B,-i[3])),Xe(j,j,1/s),j},w.bt=Td,w.bu=function(){return new Float64Array(4)},w.bv=function(n,t,i,s){var h=[],f=[];return h[0]=t[0]-i[0],h[1]=t[1]-i[1],h[2]=t[2]-i[2],f[0]=h[0]*Math.cos(s)-h[1]*Math.sin(s),f[1]=h[0]*Math.sin(s)+h[1]*Math.cos(s),f[2]=h[2],n[0]=f[0]+i[0],n[1]=f[1]+i[1],n[2]=f[2]+i[2],n},w.bw=function(n,t,i,s){var h=[],f=[];return h[0]=t[0]-i[0],h[1]=t[1]-i[1],h[2]=t[2]-i[2],f[0]=h[0],f[1]=h[1]*Math.cos(s)-h[2]*Math.sin(s),f[2]=h[1]*Math.sin(s)+h[2]*Math.cos(s),n[0]=f[0]+i[0],n[1]=f[1]+i[1],n[2]=f[2]+i[2],n},w.bx=function(n,t,i,s){var h=[],f=[];return h[0]=t[0]-i[0],h[1]=t[1]-i[1],h[2]=t[2]-i[2],f[0]=h[2]*Math.sin(s)+h[0]*Math.cos(s),f[1]=h[1],f[2]=h[2]*Math.cos(s)-h[0]*Math.sin(s),n[0]=f[0]+i[0],n[1]=f[1]+i[1],n[2]=f[2]+i[2],n},w.by=function(n,t,i){var s=Math.sin(i),h=Math.cos(i),f=t[0],m=t[1],y=t[2],x=t[3],T=t[8],E=t[9],I=t[10],D=t[11];return t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=f*h-T*s,n[1]=m*h-E*s,n[2]=y*h-I*s,n[3]=x*h-D*s,n[8]=f*s+T*h,n[9]=m*s+E*h,n[10]=y*s+I*h,n[11]=x*s+D*h,n},w.bz=function(n,t){const i=bt(n,360),s=bt(t,360),h=s-i,f=s>i?h-360:h+360;return Math.abs(h)<Math.abs(f)?h:f},w.c=Se,w.c0=class extends p{},w.c1=td,w.c2=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},w.c3=Wp,w.c4=function(n,t,i){var s=t[0],h=t[1],f=t[2],m=i[3]*s+i[7]*h+i[11]*f+i[15];return n[0]=(i[0]*s+i[4]*h+i[8]*f+i[12])/(m=m||1),n[1]=(i[1]*s+i[5]*h+i[9]*f+i[13])/m,n[2]=(i[2]*s+i[6]*h+i[10]*f+i[14])/m,n},w.c5=class extends tc{},w.c6=class extends A{},w.c7=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]&&n[9]===t[9]&&n[10]===t[10]&&n[11]===t[11]&&n[12]===t[12]&&n[13]===t[13]&&n[14]===t[14]&&n[15]===t[15]},w.c8=function(n,t){var i=n[0],s=n[1],h=n[2],f=n[3],m=n[4],y=n[5],x=n[6],T=n[7],E=n[8],I=n[9],D=n[10],B=n[11],j=n[12],U=n[13],X=n[14],re=n[15],we=t[0],pe=t[1],F=t[2],W=t[3],me=t[4],Le=t[5],et=t[6],Ne=t[7],Ze=t[8],st=t[9],rt=t[10],ot=t[11],We=t[12],Pt=t[13],zt=t[14],At=t[15];return Math.abs(i-we)<=Me*Math.max(1,Math.abs(i),Math.abs(we))&&Math.abs(s-pe)<=Me*Math.max(1,Math.abs(s),Math.abs(pe))&&Math.abs(h-F)<=Me*Math.max(1,Math.abs(h),Math.abs(F))&&Math.abs(f-W)<=Me*Math.max(1,Math.abs(f),Math.abs(W))&&Math.abs(m-me)<=Me*Math.max(1,Math.abs(m),Math.abs(me))&&Math.abs(y-Le)<=Me*Math.max(1,Math.abs(y),Math.abs(Le))&&Math.abs(x-et)<=Me*Math.max(1,Math.abs(x),Math.abs(et))&&Math.abs(T-Ne)<=Me*Math.max(1,Math.abs(T),Math.abs(Ne))&&Math.abs(E-Ze)<=Me*Math.max(1,Math.abs(E),Math.abs(Ze))&&Math.abs(I-st)<=Me*Math.max(1,Math.abs(I),Math.abs(st))&&Math.abs(D-rt)<=Me*Math.max(1,Math.abs(D),Math.abs(rt))&&Math.abs(B-ot)<=Me*Math.max(1,Math.abs(B),Math.abs(ot))&&Math.abs(j-We)<=Me*Math.max(1,Math.abs(j),Math.abs(We))&&Math.abs(U-Pt)<=Me*Math.max(1,Math.abs(U),Math.abs(Pt))&&Math.abs(X-zt)<=Me*Math.max(1,Math.abs(X),Math.abs(zt))&&Math.abs(re-At)<=Me*Math.max(1,Math.abs(re),Math.abs(At))},w.c9=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},w.cA=function(n){delete N.REGISTERED_PROTOCOLS[n]},w.cB=function(n,t){const i={};for(let h=0;h<n.length;h++){const f=t&&t[n[h].id]||Ma(n[h]);t&&(t[n[h].id]=f);let m=i[f];m||(m=i[f]=[]),m.push(n[h])}const s=[];for(const h in i)s.push(i[h]);return s},w.cC=vt,w.cD=Kf,w.cE=Jf,w.cF=kf,w.cG=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=ze/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const t=n.bucket.layers[0],i=t.layout,s=t._unevaluatedLayout._values,h={layoutIconSize:s["icon-size"].possiblyEvaluate(new Cr(n.bucket.zoom+1),n.canonical),layoutTextSize:s["text-size"].possiblyEvaluate(new Cr(n.bucket.zoom+1),n.canonical),textMaxSize:s["text-size"].possiblyEvaluate(new Cr(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:T,maxZoom:E}=n.bucket.textSizeData;h.compositeTextSizes=[s["text-size"].possiblyEvaluate(new Cr(T),n.canonical),s["text-size"].possiblyEvaluate(new Cr(E),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:T,maxZoom:E}=n.bucket.iconSizeData;h.compositeIconSizes=[s["icon-size"].possiblyEvaluate(new Cr(T),n.canonical),s["icon-size"].possiblyEvaluate(new Cr(E),n.canonical)]}const f=i.get("text-line-height")*ti,m=i.get("text-rotation-alignment")!=="viewport"&&i.get("symbol-placement")!=="point",y=i.get("text-keep-upright"),x=i.get("text-size");for(const T of n.bucket.features){const E=i.get("text-font").evaluate(T,{},n.canonical).join(","),I=x.evaluate(T,{},n.canonical),D=h.layoutTextSize.evaluate(T,{},n.canonical),B=h.layoutIconSize.evaluate(T,{},n.canonical),j={horizontal:{},vertical:void 0},U=T.text;let X,re=[0,0];if(U){const F=U.toString(),W=i.get("text-letter-spacing").evaluate(T,{},n.canonical)*ti,me=Rh(F)?W:0,Le=i.get("text-anchor").evaluate(T,{},n.canonical),et=cm(t,T,n.canonical);if(!et){const rt=i.get("text-radial-offset").evaluate(T,{},n.canonical);re=rt?lm(Le,[rt*ti,kd]):i.get("text-offset").evaluate(T,{},n.canonical).map(ot=>ot*ti)}let Ne=m?"center":i.get("text-justify").evaluate(T,{},n.canonical);const Ze=i.get("symbol-placement")==="point"?i.get("text-max-width").evaluate(T,{},n.canonical)*ti:1/0,st=()=>{n.bucket.allowVerticalPlacement&&Xl(F)&&(j.vertical=Xh(U,n.glyphMap,n.glyphPositions,n.imagePositions,E,Ze,f,Le,"left",me,re,w.an.vertical,!0,D,I))};if(!m&&et){const rt=new Set;if(Ne==="auto")for(let We=0;We<et.values.length;We+=2)rt.add(Md(et.values[We]));else rt.add(Ne);let ot=!1;for(const We of rt)if(!j.horizontal[We])if(ot)j.horizontal[We]=j.horizontal[0];else{const Pt=Xh(U,n.glyphMap,n.glyphPositions,n.imagePositions,E,Ze,f,"center",We,me,re,w.an.horizontal,!1,D,I);Pt&&(j.horizontal[We]=Pt,ot=Pt.positionedLines.length===1)}st()}else{Ne==="auto"&&(Ne=Md(Le));const rt=Xh(U,n.glyphMap,n.glyphPositions,n.imagePositions,E,Ze,f,Le,Ne,me,re,w.an.horizontal,!1,D,I);rt&&(j.horizontal[Ne]=rt),st(),Xl(F)&&m&&y&&(j.vertical=Xh(U,n.glyphMap,n.glyphPositions,n.imagePositions,E,Ze,f,Le,Ne,me,re,w.an.vertical,!1,D,I))}}let we=!1;if(T.icon&&T.icon.name){const F=n.imageMap[T.icon.name];F&&(X=by(n.imagePositions[T.icon.name],i.get("icon-offset").evaluate(T,{},n.canonical),i.get("icon-anchor").evaluate(T,{},n.canonical)),we=!!F.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=we:n.bucket.sdfIcons!==we&&de("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(F.pixelRatio!==n.bucket.pixelRatio||i.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const pe=um(j.horizontal)||j.vertical;n.bucket.iconsInText=!!pe&&pe.iconsInText,(pe||X)&&By(n.bucket,T,j,X,n.imageMap,h,D,B,re,we,n.canonical,n.subdivisionGranularity)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},w.cH=pd,w.cI=ad,w.cJ=dd,w.cK=_c,w.cL=_d,w.cM=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},w.cN=function(n,t,i,s,h){return a(this,void 0,void 0,function*(){if(Ae())try{return yield pt(n,t,i,s,h)}catch{}return function(f,m,y,x,T){const E=f.width,I=f.height;wt&&_t||(wt=new OffscreenCanvas(E,I),_t=wt.getContext("2d",{willReadFrequently:!0})),wt.width=E,wt.height=I,_t.drawImage(f,0,0,E,I);const D=_t.getImageData(m,y,x,T);return _t.clearRect(0,0,E,I),D.data}(n,t,i,s,h)})},w.cO=Kp,w.cP=$,w.cQ=te,w.cR=ff,w.cS=Sf,w.cT=Ta,w.cU=On,w.ca=n=>n.type==="symbol",w.cb=n=>n.type==="circle",w.cc=n=>n.type==="heatmap",w.cd=n=>n.type==="line",w.ce=n=>n.type==="fill",w.cf=n=>n.type==="fill-extrusion",w.cg=n=>n.type==="hillshade",w.ch=n=>n.type==="color-relief",w.ci=n=>n.type==="raster",w.cj=n=>n.type==="background",w.ck=n=>n.type==="custom",w.cl=Dr,w.cm=function(n,t,i){const s=Ue(t.x-i.x,t.y-i.y),h=Ue(n.x-i.x,n.y-i.y);var f,m;return Ut(Math.atan2(s[0]*h[1]-s[1]*h[0],(f=s)[0]*(m=h)[0]+f[1]*m[1]))},w.cn=er,w.co=function(n,t){return ln[t]&&(n instanceof MouseEvent||n instanceof WheelEvent)},w.cp=function(n,t){return Kr[t]&&"touches"in n},w.cq=function(n){return Kr[n]||ln[n]},w.cr=function(n,t,i){var s=t[0],h=t[1];return n[0]=i[0]*s+i[4]*h+i[12],n[1]=i[1]*s+i[5]*h+i[13],n},w.cs=function(n,t){const{x:i,y:s}=xc.fromLngLat(t);return!(n<0||n>25||s<0||s>=1||i<0||i>=1)},w.ct=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},w.cu=class extends Vn{},w.cv=jy,w.cx=function(n){return n.message===Ur},w.cy=ce,w.cz=function(n,t){N.REGISTERED_PROTOCOLS[n]=t},w.d=Fe,w.e=or,w.f=n=>a(void 0,void 0,void 0,function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(t)}catch(i){throw new Error(`Could not load image because of ${i.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),w.g=G,w.h=n=>new Promise((t,i)=>{const s=new Image;s.onload=()=>{t(s),URL.revokeObjectURL(s.src),s.onload=null,window.requestAnimationFrame(()=>{s.src=Oe})},s.onerror=()=>i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const h=new Blob([new Uint8Array(n)],{type:"image/png"});s.src=n.byteLength?URL.createObjectURL(h):Oe}),w.i=ke,w.j=(n,t)=>Ee(or(n,{type:"json"}),t),w.k=Ie,w.l=Ve,w.m=Ee,w.n=(n,t)=>Ee(or(n,{type:"arrayBuffer"}),t),w.o=function(n){return new _d(n).readFields(cy,[])},w.p=Ef,w.q=cc,w.r=Pi,w.s=kt,w.t=Ql,w.u=Qt,w.v=ve,w.w=de,w.x=$u,w.y=Ao,w.z=Us}),P("worker",["./shared"],function(w){class a{constructor(N){this.keyCache={},N&&this.replace(N)}replace(N){this._layerConfigs={},this._layers={},this.update(N,[])}update(N,G){for(const ce of N){this._layerConfigs[ce.id]=ce;const xe=this._layers[ce.id]=w.bI(ce);xe._featureFilter=w.a9(xe.filter),this.keyCache[ce.id]&&delete this.keyCache[ce.id]}for(const ce of G)delete this.keyCache[ce],delete this._layerConfigs[ce],delete this._layers[ce];this.familiesBySource={};const Y=w.cB(Object.values(this._layerConfigs),this.keyCache);for(const ce of Y){const xe=ce.map(Ie=>this._layers[Ie.id]),Ee=xe[0];if(Ee.visibility==="none")continue;const Fe=Ee.source||"";let Pe=this.familiesBySource[Fe];Pe||(Pe=this.familiesBySource[Fe]={});const $e=Ee.sourceLayer||"_geojsonTileLayer";let Ve=Pe[$e];Ve||(Ve=Pe[$e]=[]),Ve.push(xe)}}}class ${constructor(N){const G={},Y=[];for(const Fe in N){const Pe=N[Fe],$e=G[Fe]={};for(const Ve in Pe){const Ie=Pe[+Ve];if(!Ie||Ie.bitmap.width===0||Ie.bitmap.height===0)continue;const Ye={x:0,y:0,w:Ie.bitmap.width+2,h:Ie.bitmap.height+2};Y.push(Ye),$e[Ve]={rect:Ye,metrics:Ie.metrics}}}const{w:ce,h:xe}=w.p(Y),Ee=new w.q({width:ce||1,height:xe||1});for(const Fe in N){const Pe=N[Fe];for(const $e in Pe){const Ve=Pe[+$e];if(!Ve||Ve.bitmap.width===0||Ve.bitmap.height===0)continue;const Ie=G[Fe][$e].rect;w.q.copy(Ve.bitmap,Ee,{x:0,y:0},{x:Ie.x+1,y:Ie.y+1},Ve.bitmap)}}this.image=Ee,this.positions=G}}w.cC("GlyphAtlas",$);class K{constructor(N){this.tileID=new w.Z(N.tileID.overscaledZ,N.tileID.wrap,N.tileID.canonical.z,N.tileID.canonical.x,N.tileID.canonical.y),this.uid=N.uid,this.zoom=N.zoom,this.pixelRatio=N.pixelRatio,this.tileSize=N.tileSize,this.source=N.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=N.showCollisionBoxes,this.collectResourceTiming=!!N.collectResourceTiming,this.returnDependencies=!!N.returnDependencies,this.promoteId=N.promoteId,this.inFlightDependencies=[],this.globalState=N.globalState}parse(N,G,Y,ce,xe){return w._(this,void 0,void 0,function*(){this.status="parsing",this.data=N,this.collisionBoxArray=new w.a7;const Ee=new w.cD(Object.keys(N.layers).sort()),Fe=new w.cE(this.tileID,this.promoteId);Fe.bucketLayerIDs=[];const Pe={},$e={featureIndex:Fe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Y,subdivisionGranularity:xe},Ve=G.familiesBySource[this.source];for(const Bt in Ve){const rr=N.layers[Bt];if(!rr)continue;rr.version===1&&w.w(`Vector tile source "${this.source}" layer "${Bt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Yr=Ee.encode(Bt),ct=[];for(let ai=0;ai<rr.length;ai++){const Tr=rr.feature(ai),Dn=Fe.getId(Tr,Bt);ct.push({feature:Tr,id:Dn,index:ai,sourceLayerIndex:Yr})}for(const ai of Ve[Bt]){const Tr=ai[0];Tr.source!==this.source&&w.w(`layer.source = ${Tr.source} does not equal this.source = ${this.source}`),Tr.minzoom&&this.zoom<Math.floor(Tr.minzoom)||Tr.maxzoom&&this.zoom>=Tr.maxzoom||Tr.visibility!=="none"&&(ne(ai,this.zoom,Y),(Pe[Tr.id]=Tr.createBucket({index:Fe.bucketLayerIDs.length,layers:ai,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Yr,sourceID:this.source,globalState:this.globalState})).populate(ct,$e,this.tileID.canonical),Fe.bucketLayerIDs.push(ai.map(Dn=>Dn.id)))}}const Ie=w.bM($e.glyphDependencies,Bt=>Object.keys(Bt).map(Number));this.inFlightDependencies.forEach(Bt=>Bt==null?void 0:Bt.abort()),this.inFlightDependencies=[];let Ye=Promise.resolve({});if(Object.keys(Ie).length){const Bt=new AbortController;this.inFlightDependencies.push(Bt),Ye=ce.sendAsync({type:"GG",data:{stacks:Ie,source:this.source,tileID:this.tileID,type:"glyphs"}},Bt)}const ve=Object.keys($e.iconDependencies);let yt=Promise.resolve({});if(ve.length){const Bt=new AbortController;this.inFlightDependencies.push(Bt),yt=ce.sendAsync({type:"GI",data:{icons:ve,source:this.source,tileID:this.tileID,type:"icons"}},Bt)}const Rt=Object.keys($e.patternDependencies);let xt=Promise.resolve({});if(Rt.length){const Bt=new AbortController;this.inFlightDependencies.push(Bt),xt=ce.sendAsync({type:"GI",data:{icons:Rt,source:this.source,tileID:this.tileID,type:"patterns"}},Bt)}const[Mt,Ot,br]=yield Promise.all([Ye,yt,xt]),ur=new $(Mt),lr=new w.cF(Ot,br);for(const Bt in Pe){const rr=Pe[Bt];rr instanceof w.a8?(ne(rr.layers,this.zoom,Y),w.cG({bucket:rr,glyphMap:Mt,glyphPositions:ur.positions,imageMap:Ot,imagePositions:lr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:$e.subdivisionGranularity})):rr.hasPattern&&(rr instanceof w.cH||rr instanceof w.cI||rr instanceof w.cJ)&&(ne(rr.layers,this.zoom,Y),rr.addFeatures($e,this.tileID.canonical,lr.patternPositions))}return this.status="done",{buckets:Object.values(Pe).filter(Bt=>!Bt.isEmpty()),featureIndex:Fe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ur.image,imageAtlas:lr,glyphMap:this.returnDependencies?Mt:null,iconMap:this.returnDependencies?Ot:null,glyphPositions:this.returnDependencies?ur.positions:null}})}}function ne(Se,N,G){const Y=new w.F(N);for(const ce of Se)ce.recalculate(Y,G)}class te{constructor(N,G,Y){this.actor=N,this.layerIndex=G,this.availableImages=Y,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(N,G){return w._(this,void 0,void 0,function*(){const Y=yield w.n(N.request,G);try{return{vectorTile:new w.cK.VectorTile(new w.cL(Y.data)),rawData:Y.data,cacheControl:Y.cacheControl,expires:Y.expires}}catch(ce){const xe=new Uint8Array(Y.data);let Ee=`Unable to parse the tile at ${N.request.url}, `;throw Ee+=xe[0]===31&&xe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ce.message}`,new Error(Ee)}})}loadTile(N){return w._(this,void 0,void 0,function*(){const G=N.uid,Y=!!(N&&N.request&&N.request.collectResourceTiming)&&new w.cM(N.request),ce=new K(N);this.loading[G]=ce;const xe=new AbortController;ce.abort=xe;try{const Ee=yield this.loadVectorTile(N,xe);if(delete this.loading[G],!Ee)return null;const Fe=Ee.rawData,Pe={};Ee.expires&&(Pe.expires=Ee.expires),Ee.cacheControl&&(Pe.cacheControl=Ee.cacheControl);const $e={};if(Y){const Ie=Y.finish();Ie&&($e.resourceTiming=JSON.parse(JSON.stringify(Ie)))}ce.vectorTile=Ee.vectorTile;const Ve=ce.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.actor,N.subdivisionGranularity);this.loaded[G]=ce,this.fetching[G]={rawTileData:Fe,cacheControl:Pe,resourceTiming:$e};try{const Ie=yield Ve;return w.e({rawTileData:Fe.slice(0)},Ie,Pe,$e)}finally{delete this.fetching[G]}}catch(Ee){throw delete this.loading[G],ce.status="done",this.loaded[G]=ce,Ee}})}reloadTile(N){return w._(this,void 0,void 0,function*(){const G=N.uid;if(!this.loaded||!this.loaded[G])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const Y=this.loaded[G];if(Y.showCollisionBoxes=N.showCollisionBoxes,Y.globalState=N.globalState,Y.status==="parsing"){const ce=yield Y.parse(Y.vectorTile,this.layerIndex,this.availableImages,this.actor,N.subdivisionGranularity);let xe;if(this.fetching[G]){const{rawTileData:Ee,cacheControl:Fe,resourceTiming:Pe}=this.fetching[G];delete this.fetching[G],xe=w.e({rawTileData:Ee.slice(0)},ce,Fe,Pe)}else xe=ce;return xe}if(Y.status==="done"&&Y.vectorTile)return Y.parse(Y.vectorTile,this.layerIndex,this.availableImages,this.actor,N.subdivisionGranularity)})}abortTile(N){return w._(this,void 0,void 0,function*(){const G=this.loading,Y=N.uid;G&&G[Y]&&G[Y].abort&&(G[Y].abort.abort(),delete G[Y])})}removeTile(N){return w._(this,void 0,void 0,function*(){this.loaded&&this.loaded[N.uid]&&delete this.loaded[N.uid]})}}class oe{constructor(){this.loaded={}}loadTile(N){return w._(this,void 0,void 0,function*(){const{uid:G,encoding:Y,rawImageData:ce,redFactor:xe,greenFactor:Ee,blueFactor:Fe,baseShift:Pe}=N,$e=ce.width+2,Ve=ce.height+2,Ie=w.b(ce)?new w.R({width:$e,height:Ve},yield w.cN(ce,-1,-1,$e,Ve)):ce,Ye=new w.cO(G,Ie,Y,xe,Ee,Fe,Pe);return this.loaded=this.loaded||{},this.loaded[G]=Ye,Ye})}removeTile(N){const G=this.loaded,Y=N.uid;G&&G[Y]&&delete G[Y]}}var L,H,q=function(){if(H)return L;function Se(G,Y){if(G.length!==0){N(G[0],Y);for(var ce=1;ce<G.length;ce++)N(G[ce],!Y)}}function N(G,Y){for(var ce=0,xe=0,Ee=0,Fe=G.length,Pe=Fe-1;Ee<Fe;Pe=Ee++){var $e=(G[Ee][0]-G[Pe][0])*(G[Pe][1]+G[Ee][1]),Ve=ce+$e;xe+=Math.abs(ce)>=Math.abs($e)?ce-Ve+$e:$e-Ve+ce,ce=Ve}ce+xe>=0!=!!Y&&G.reverse()}return H=1,L=function G(Y,ce){var xe,Ee=Y&&Y.type;if(Ee==="FeatureCollection")for(xe=0;xe<Y.features.length;xe++)G(Y.features[xe],ce);else if(Ee==="GeometryCollection")for(xe=0;xe<Y.geometries.length;xe++)G(Y.geometries[xe],ce);else if(Ee==="Feature")G(Y.geometry,ce);else if(Ee==="Polygon")Se(Y.coordinates,ce);else if(Ee==="MultiPolygon")for(xe=0;xe<Y.coordinates.length;xe++)Se(Y.coordinates[xe],ce);return Y}}(),le=w.cP(q);const ie=w.cK.VectorTileFeature.prototype.toGeoJSON;class ge{constructor(N){this._feature=N,this.extent=w.$,this.type=N.type,this.properties=N.tags,"id"in N&&!isNaN(N.id)&&(this.id=parseInt(N.id,10))}loadGeometry(){if(this._feature.type===1){const N=[];for(const G of this._feature.geometry)N.push([new w.P(G[0],G[1])]);return N}{const N=[];for(const G of this._feature.geometry){const Y=[];for(const ce of G)Y.push(new w.P(ce[0],ce[1]));N.push(Y)}return N}}toGeoJSON(N,G,Y){return ie.call(this,N,G,Y)}}class Te{constructor(N){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=w.$,this.length=N.length,this._features=N}feature(N){return new ge(this._features[N])}}var Ae,Me,qe,He={exports:{}},lt=function(){if(qe)return He.exports;qe=1;var Se=w.cS(),N=function(){if(Me)return Ae;Me=1;var Ve=w.cQ(),Ie=w.cR().VectorTileFeature;function Ye(yt,Rt){this.options=Rt||{},this.features=yt,this.length=yt.length}function ve(yt,Rt){this.id=typeof yt.id=="number"?yt.id:void 0,this.type=yt.type,this.rawGeometry=yt.type===1?[yt.geometry]:yt.geometry,this.properties=yt.tags,this.extent=Rt||4096}return Ae=Ye,Ye.prototype.feature=function(yt){return new ve(this.features[yt],this.options.extent)},ve.prototype.loadGeometry=function(){var yt=this.rawGeometry;this.geometry=[];for(var Rt=0;Rt<yt.length;Rt++){for(var xt=yt[Rt],Mt=[],Ot=0;Ot<xt.length;Ot++)Mt.push(new Ve(xt[Ot][0],xt[Ot][1]));this.geometry.push(Mt)}return this.geometry},ve.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var yt=this.geometry,Rt=1/0,xt=-1/0,Mt=1/0,Ot=-1/0,br=0;br<yt.length;br++)for(var ur=yt[br],lr=0;lr<ur.length;lr++){var Bt=ur[lr];Rt=Math.min(Rt,Bt.x),xt=Math.max(xt,Bt.x),Mt=Math.min(Mt,Bt.y),Ot=Math.max(Ot,Bt.y)}return[Rt,Mt,xt,Ot]},ve.prototype.toGeoJSON=Ie.prototype.toGeoJSON,Ae}();function G(Ve){var Ie=new Se;return function(Ye,ve){for(var yt in Ye.layers)ve.writeMessage(3,Y,Ye.layers[yt])}(Ve,Ie),Ie.finish()}function Y(Ve,Ie){var Ye;Ie.writeVarintField(15,Ve.version||1),Ie.writeStringField(1,Ve.name||""),Ie.writeVarintField(5,Ve.extent||4096);var ve={keys:[],values:[],keycache:{},valuecache:{}};for(Ye=0;Ye<Ve.length;Ye++)ve.feature=Ve.feature(Ye),Ie.writeMessage(2,ce,ve);var yt=ve.keys;for(Ye=0;Ye<yt.length;Ye++)Ie.writeStringField(3,yt[Ye]);var Rt=ve.values;for(Ye=0;Ye<Rt.length;Ye++)Ie.writeMessage(4,$e,Rt[Ye])}function ce(Ve,Ie){var Ye=Ve.feature;Ye.id!==void 0&&Ie.writeVarintField(1,Ye.id),Ie.writeMessage(2,xe,Ve),Ie.writeVarintField(3,Ye.type),Ie.writeMessage(4,Pe,Ye)}function xe(Ve,Ie){var Ye=Ve.feature,ve=Ve.keys,yt=Ve.values,Rt=Ve.keycache,xt=Ve.valuecache;for(var Mt in Ye.properties){var Ot=Ye.properties[Mt],br=Rt[Mt];if(Ot!==null){br===void 0&&(ve.push(Mt),Rt[Mt]=br=ve.length-1),Ie.writeVarint(br);var ur=typeof Ot;ur!=="string"&&ur!=="boolean"&&ur!=="number"&&(Ot=JSON.stringify(Ot));var lr=ur+":"+Ot,Bt=xt[lr];Bt===void 0&&(yt.push(Ot),xt[lr]=Bt=yt.length-1),Ie.writeVarint(Bt)}}}function Ee(Ve,Ie){return(Ie<<3)+(7&Ve)}function Fe(Ve){return Ve<<1^Ve>>31}function Pe(Ve,Ie){for(var Ye=Ve.loadGeometry(),ve=Ve.type,yt=0,Rt=0,xt=Ye.length,Mt=0;Mt<xt;Mt++){var Ot=Ye[Mt],br=1;ve===1&&(br=Ot.length),Ie.writeVarint(Ee(1,br));for(var ur=ve===3?Ot.length-1:Ot.length,lr=0;lr<ur;lr++){lr===1&&ve!==1&&Ie.writeVarint(Ee(2,ur-1));var Bt=Ot[lr].x-yt,rr=Ot[lr].y-Rt;Ie.writeVarint(Fe(Bt)),Ie.writeVarint(Fe(rr)),yt+=Bt,Rt+=rr}ve===3&&Ie.writeVarint(Ee(7,1))}}function $e(Ve,Ie){var Ye=typeof Ve;Ye==="string"?Ie.writeStringField(1,Ve):Ye==="boolean"?Ie.writeBooleanField(7,Ve):Ye==="number"&&(Ve%1!=0?Ie.writeDoubleField(3,Ve):Ve<0?Ie.writeSVarintField(6,Ve):Ie.writeVarintField(5,Ve))}return He.exports=G,He.exports.fromVectorTileJs=G,He.exports.fromGeojsonVt=function(Ve,Ie){Ie=Ie||{};var Ye={};for(var ve in Ve)Ye[ve]=new N(Ve[ve].features,Ie),Ye[ve].name=ve,Ye[ve].version=Ie.version,Ye[ve].extent=Ie.extent;return G({layers:Ye})},He.exports.GeoJSONWrapper=N,He.exports}(),Ke=w.cP(lt);const ut={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Se=>Se},It=Math.fround||(be=new Float32Array(1),Se=>(be[0]=+Se,be[0]));var be;class Xe{constructor(N){this.options=Object.assign(Object.create(ut),N),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(N){const{log:G,minZoom:Y,maxZoom:ce}=this.options;G&&console.time("total time");const xe=`prepare ${N.length} points`;G&&console.time(xe),this.points=N;const Ee=[];for(let Pe=0;Pe<N.length;Pe++){const $e=N[Pe];if(!$e.geometry)continue;const[Ve,Ie]=$e.geometry.coordinates,Ye=It(jt(Ve)),ve=It(at(Ie));Ee.push(Ye,ve,1/0,Pe,-1,1),this.options.reduce&&Ee.push(0)}let Fe=this.trees[ce+1]=this._createTree(Ee);G&&console.timeEnd(xe);for(let Pe=ce;Pe>=Y;Pe--){const $e=+Date.now();Fe=this.trees[Pe]=this._createTree(this._cluster(Fe,Pe)),G&&console.log("z%d: %d clusters in %dms",Pe,Fe.numItems,+Date.now()-$e)}return G&&console.timeEnd("total time"),this}getClusters(N,G){let Y=((N[0]+180)%360+360)%360-180;const ce=Math.max(-90,Math.min(90,N[1]));let xe=N[2]===180?180:((N[2]+180)%360+360)%360-180;const Ee=Math.max(-90,Math.min(90,N[3]));if(N[2]-N[0]>=360)Y=-180,xe=180;else if(Y>xe){const Ie=this.getClusters([Y,ce,180,Ee],G),Ye=this.getClusters([-180,ce,xe,Ee],G);return Ie.concat(Ye)}const Fe=this.trees[this._limitZoom(G)],Pe=Fe.range(jt(Y),at(Ee),jt(xe),at(ce)),$e=Fe.data,Ve=[];for(const Ie of Pe){const Ye=this.stride*Ie;Ve.push($e[Ye+5]>1?Z($e,Ye,this.clusterProps):this.points[$e[Ye+3]])}return Ve}getChildren(N){const G=this._getOriginId(N),Y=this._getOriginZoom(N),ce="No cluster with the specified id.",xe=this.trees[Y];if(!xe)throw new Error(ce);const Ee=xe.data;if(G*this.stride>=Ee.length)throw new Error(ce);const Fe=this.options.radius/(this.options.extent*Math.pow(2,Y-1)),Pe=xe.within(Ee[G*this.stride],Ee[G*this.stride+1],Fe),$e=[];for(const Ve of Pe){const Ie=Ve*this.stride;Ee[Ie+4]===N&&$e.push(Ee[Ie+5]>1?Z(Ee,Ie,this.clusterProps):this.points[Ee[Ie+3]])}if($e.length===0)throw new Error(ce);return $e}getLeaves(N,G,Y){const ce=[];return this._appendLeaves(ce,N,G=G||10,Y=Y||0,0),ce}getTile(N,G,Y){const ce=this.trees[this._limitZoom(N)],xe=Math.pow(2,N),{extent:Ee,radius:Fe}=this.options,Pe=Fe/Ee,$e=(Y-Pe)/xe,Ve=(Y+1+Pe)/xe,Ie={features:[]};return this._addTileFeatures(ce.range((G-Pe)/xe,$e,(G+1+Pe)/xe,Ve),ce.data,G,Y,xe,Ie),G===0&&this._addTileFeatures(ce.range(1-Pe/xe,$e,1,Ve),ce.data,xe,Y,xe,Ie),G===xe-1&&this._addTileFeatures(ce.range(0,$e,Pe/xe,Ve),ce.data,-1,Y,xe,Ie),Ie.features.length?Ie:null}getClusterExpansionZoom(N){let G=this._getOriginZoom(N)-1;for(;G<=this.options.maxZoom;){const Y=this.getChildren(N);if(G++,Y.length!==1)break;N=Y[0].properties.cluster_id}return G}_appendLeaves(N,G,Y,ce,xe){const Ee=this.getChildren(G);for(const Fe of Ee){const Pe=Fe.properties;if(Pe&&Pe.cluster?xe+Pe.point_count<=ce?xe+=Pe.point_count:xe=this._appendLeaves(N,Pe.cluster_id,Y,ce,xe):xe<ce?xe++:N.push(Fe),N.length===Y)break}return xe}_createTree(N){const G=new w.aH(N.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Y=0;Y<N.length;Y+=this.stride)G.add(N[Y],N[Y+1]);return G.finish(),G.data=N,G}_addTileFeatures(N,G,Y,ce,xe,Ee){for(const Fe of N){const Pe=Fe*this.stride,$e=G[Pe+5]>1;let Ve,Ie,Ye;if($e)Ve=Qe(G,Pe,this.clusterProps),Ie=G[Pe],Ye=G[Pe+1];else{const Rt=this.points[G[Pe+3]];Ve=Rt.properties;const[xt,Mt]=Rt.geometry.coordinates;Ie=jt(xt),Ye=at(Mt)}const ve={type:1,geometry:[[Math.round(this.options.extent*(Ie*xe-Y)),Math.round(this.options.extent*(Ye*xe-ce))]],tags:Ve};let yt;yt=$e||this.options.generateId?G[Pe+3]:this.points[G[Pe+3]].id,yt!==void 0&&(ve.id=yt),Ee.features.push(ve)}}_limitZoom(N){return Math.max(this.options.minZoom,Math.min(Math.floor(+N),this.options.maxZoom+1))}_cluster(N,G){const{radius:Y,extent:ce,reduce:xe,minPoints:Ee}=this.options,Fe=Y/(ce*Math.pow(2,G)),Pe=N.data,$e=[],Ve=this.stride;for(let Ie=0;Ie<Pe.length;Ie+=Ve){if(Pe[Ie+2]<=G)continue;Pe[Ie+2]=G;const Ye=Pe[Ie],ve=Pe[Ie+1],yt=N.within(Pe[Ie],Pe[Ie+1],Fe),Rt=Pe[Ie+5];let xt=Rt;for(const Mt of yt){const Ot=Mt*Ve;Pe[Ot+2]>G&&(xt+=Pe[Ot+5])}if(xt>Rt&&xt>=Ee){let Mt,Ot=Ye*Rt,br=ve*Rt,ur=-1;const lr=(Ie/Ve<<5)+(G+1)+this.points.length;for(const Bt of yt){const rr=Bt*Ve;if(Pe[rr+2]<=G)continue;Pe[rr+2]=G;const Yr=Pe[rr+5];Ot+=Pe[rr]*Yr,br+=Pe[rr+1]*Yr,Pe[rr+4]=lr,xe&&(Mt||(Mt=this._map(Pe,Ie,!0),ur=this.clusterProps.length,this.clusterProps.push(Mt)),xe(Mt,this._map(Pe,rr)))}Pe[Ie+4]=lr,$e.push(Ot/xt,br/xt,1/0,lr,-1,xt),xe&&$e.push(ur)}else{for(let Mt=0;Mt<Ve;Mt++)$e.push(Pe[Ie+Mt]);if(xt>1)for(const Mt of yt){const Ot=Mt*Ve;if(!(Pe[Ot+2]<=G)){Pe[Ot+2]=G;for(let br=0;br<Ve;br++)$e.push(Pe[Ot+br])}}}}return $e}_getOriginId(N){return N-this.points.length>>5}_getOriginZoom(N){return(N-this.points.length)%32}_map(N,G,Y){if(N[G+5]>1){const Ee=this.clusterProps[N[G+6]];return Y?Object.assign({},Ee):Ee}const ce=this.points[N[G+3]].properties,xe=this.options.map(ce);return Y&&xe===ce?Object.assign({},xe):xe}}function Z(Se,N,G){return{type:"Feature",id:Se[N+3],properties:Qe(Se,N,G),geometry:{type:"Point",coordinates:[(Y=Se[N],360*(Y-.5)),Gt(Se[N+1])]}};var Y}function Qe(Se,N,G){const Y=Se[N+5],ce=Y>=1e4?`${Math.round(Y/1e3)}k`:Y>=1e3?Math.round(Y/100)/10+"k":Y,xe=Se[N+6],Ee=xe===-1?{}:Object.assign({},G[xe]);return Object.assign(Ee,{cluster:!0,cluster_id:Se[N+3],point_count:Y,point_count_abbreviated:ce})}function jt(Se){return Se/360+.5}function at(Se){const N=Math.sin(Se*Math.PI/180),G=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return G<0?0:G>1?1:G}function Gt(Se){const N=(180-360*Se)*Math.PI/180;return 360*Math.atan(Math.exp(N))/Math.PI-90}function dt(Se,N,G,Y){let ce=Y;const xe=N+(G-N>>1);let Ee,Fe=G-N;const Pe=Se[N],$e=Se[N+1],Ve=Se[G],Ie=Se[G+1];for(let Ye=N+3;Ye<G;Ye+=3){const ve=Ft(Se[Ye],Se[Ye+1],Pe,$e,Ve,Ie);if(ve>ce)Ee=Ye,ce=ve;else if(ve===ce){const yt=Math.abs(Ye-xe);yt<Fe&&(Ee=Ye,Fe=yt)}}ce>Y&&(Ee-N>3&&dt(Se,N,Ee,Y),Se[Ee+2]=ce,G-Ee>3&&dt(Se,Ee,G,Y))}function Ft(Se,N,G,Y,ce,xe){let Ee=ce-G,Fe=xe-Y;if(Ee!==0||Fe!==0){const Pe=((Se-G)*Ee+(N-Y)*Fe)/(Ee*Ee+Fe*Fe);Pe>1?(G=ce,Y=xe):Pe>0&&(G+=Ee*Pe,Y+=Fe*Pe)}return Ee=Se-G,Fe=N-Y,Ee*Ee+Fe*Fe}function Ue(Se,N,G,Y){const ce={id:Se??null,type:N,geometry:G,tags:Y,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(N==="Point"||N==="MultiPoint"||N==="LineString")ze(ce,G);else if(N==="Polygon")ze(ce,G[0]);else if(N==="MultiLineString")for(const xe of G)ze(ce,xe);else if(N==="MultiPolygon")for(const xe of G)ze(ce,xe[0]);return ce}function ze(Se,N){for(let G=0;G<N.length;G+=3)Se.minX=Math.min(Se.minX,N[G]),Se.minY=Math.min(Se.minY,N[G+1]),Se.maxX=Math.max(Se.maxX,N[G]),Se.maxY=Math.max(Se.maxY,N[G+1])}function Et(Se,N,G,Y){if(!N.geometry)return;const ce=N.geometry.coordinates;if(ce&&ce.length===0)return;const xe=N.geometry.type,Ee=Math.pow(G.tolerance/((1<<G.maxZoom)*G.extent),2);let Fe=[],Pe=N.id;if(G.promoteId?Pe=N.properties[G.promoteId]:G.generateId&&(Pe=Y||0),xe==="Point")bt(ce,Fe);else if(xe==="MultiPoint")for(const $e of ce)bt($e,Fe);else if(xe==="LineString")gt(ce,Fe,Ee,!1);else if(xe==="MultiLineString"){if(G.lineMetrics){for(const $e of ce)Fe=[],gt($e,Fe,Ee,!1),Se.push(Ue(Pe,"LineString",Fe,N.properties));return}fr(ce,Fe,Ee,!1)}else if(xe==="Polygon")fr(ce,Fe,Ee,!0);else{if(xe!=="MultiPolygon"){if(xe==="GeometryCollection"){for(const $e of N.geometry.geometries)Et(Se,{id:Pe,geometry:$e,properties:N.properties},G,Y);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const $e of ce){const Ve=[];fr($e,Ve,Ee,!0),Fe.push(Ve)}}Se.push(Ue(Pe,xe,Fe,N.properties))}function bt(Se,N){N.push(Dr(Se[0]),er(Se[1]),0)}function gt(Se,N,G,Y){let ce,xe,Ee=0;for(let Pe=0;Pe<Se.length;Pe++){const $e=Dr(Se[Pe][0]),Ve=er(Se[Pe][1]);N.push($e,Ve,0),Pe>0&&(Ee+=Y?(ce*Ve-$e*xe)/2:Math.sqrt(Math.pow($e-ce,2)+Math.pow(Ve-xe,2))),ce=$e,xe=Ve}const Fe=N.length-3;N[2]=1,dt(N,0,Fe,G),N[Fe+2]=1,N.size=Math.abs(Ee),N.start=0,N.end=N.size}function fr(Se,N,G,Y){for(let ce=0;ce<Se.length;ce++){const xe=[];gt(Se[ce],xe,G,Y),N.push(xe)}}function Dr(Se){return Se/360+.5}function er(Se){const N=Math.sin(Se*Math.PI/180),G=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return G<0?0:G>1?1:G}function Vt(Se,N,G,Y,ce,xe,Ee,Fe){if(Y/=N,xe>=(G/=N)&&Ee<Y)return Se;if(Ee<G||xe>=Y)return null;const Pe=[];for(const $e of Se){const Ve=$e.geometry;let Ie=$e.type;const Ye=ce===0?$e.minX:$e.minY,ve=ce===0?$e.maxX:$e.maxY;if(Ye>=G&&ve<Y){Pe.push($e);continue}if(ve<G||Ye>=Y)continue;let yt=[];if(Ie==="Point"||Ie==="MultiPoint")Pr(Ve,yt,G,Y,ce);else if(Ie==="LineString")or(Ve,yt,G,Y,ce,!1,Fe.lineMetrics);else if(Ie==="MultiLineString")ar(Ve,yt,G,Y,ce,!1);else if(Ie==="Polygon")ar(Ve,yt,G,Y,ce,!0);else if(Ie==="MultiPolygon")for(const Rt of Ve){const xt=[];ar(Rt,xt,G,Y,ce,!0),xt.length&&yt.push(xt)}if(yt.length){if(Fe.lineMetrics&&Ie==="LineString"){for(const Rt of yt)Pe.push(Ue($e.id,Ie,Rt,$e.tags));continue}Ie!=="LineString"&&Ie!=="MultiLineString"||(yt.length===1?(Ie="LineString",yt=yt[0]):Ie="MultiLineString"),Ie!=="Point"&&Ie!=="MultiPoint"||(Ie=yt.length===3?"Point":"MultiPoint"),Pe.push(Ue($e.id,Ie,yt,$e.tags))}}return Pe.length?Pe:null}function Pr(Se,N,G,Y,ce){for(let xe=0;xe<Se.length;xe+=3){const Ee=Se[xe+ce];Ee>=G&&Ee<=Y&&O(N,Se[xe],Se[xe+1],Se[xe+2])}}function or(Se,N,G,Y,ce,xe,Ee){let Fe=_i(Se);const Pe=ce===0?Je:Ge;let $e,Ve,Ie=Se.start;for(let xt=0;xt<Se.length-3;xt+=3){const Mt=Se[xt],Ot=Se[xt+1],br=Se[xt+2],ur=Se[xt+3],lr=Se[xt+4],Bt=ce===0?Mt:Ot,rr=ce===0?ur:lr;let Yr=!1;Ee&&($e=Math.sqrt(Math.pow(Mt-ur,2)+Math.pow(Ot-lr,2))),Bt<G?rr>G&&(Ve=Pe(Fe,Mt,Ot,ur,lr,G),Ee&&(Fe.start=Ie+$e*Ve)):Bt>Y?rr<Y&&(Ve=Pe(Fe,Mt,Ot,ur,lr,Y),Ee&&(Fe.start=Ie+$e*Ve)):O(Fe,Mt,Ot,br),rr<G&&Bt>=G&&(Ve=Pe(Fe,Mt,Ot,ur,lr,G),Yr=!0),rr>Y&&Bt<=Y&&(Ve=Pe(Fe,Mt,Ot,ur,lr,Y),Yr=!0),!xe&&Yr&&(Ee&&(Fe.end=Ie+$e*Ve),N.push(Fe),Fe=_i(Se)),Ee&&(Ie+=$e)}let Ye=Se.length-3;const ve=Se[Ye],yt=Se[Ye+1],Rt=ce===0?ve:yt;Rt>=G&&Rt<=Y&&O(Fe,ve,yt,Se[Ye+2]),Ye=Fe.length-3,xe&&Ye>=3&&(Fe[Ye]!==Fe[0]||Fe[Ye+1]!==Fe[1])&&O(Fe,Fe[0],Fe[1],Fe[2]),Fe.length&&N.push(Fe)}function _i(Se){const N=[];return N.size=Se.size,N.start=Se.start,N.end=Se.end,N}function ar(Se,N,G,Y,ce,xe){for(const Ee of Se)or(Ee,N,G,Y,ce,xe,!1)}function O(Se,N,G,Y){Se.push(N,G,Y)}function Je(Se,N,G,Y,ce,xe){const Ee=(xe-N)/(Y-N);return O(Se,xe,G+(ce-G)*Ee,1),Ee}function Ge(Se,N,G,Y,ce,xe){const Ee=(xe-G)/(ce-G);return O(Se,N+(Y-N)*Ee,xe,1),Ee}function de(Se,N){const G=[];for(let Y=0;Y<Se.length;Y++){const ce=Se[Y],xe=ce.type;let Ee;if(xe==="Point"||xe==="MultiPoint"||xe==="LineString")Ee=ae(ce.geometry,N);else if(xe==="MultiLineString"||xe==="Polygon"){Ee=[];for(const Fe of ce.geometry)Ee.push(ae(Fe,N))}else if(xe==="MultiPolygon"){Ee=[];for(const Fe of ce.geometry){const Pe=[];for(const $e of Fe)Pe.push(ae($e,N));Ee.push(Pe)}}G.push(Ue(ce.id,xe,Ee,ce.tags))}return G}function ae(Se,N){const G=[];G.size=Se.size,Se.start!==void 0&&(G.start=Se.start,G.end=Se.end);for(let Y=0;Y<Se.length;Y+=3)G.push(Se[Y]+N,Se[Y+1],Se[Y+2]);return G}function ke(Se,N){if(Se.transformed)return Se;const G=1<<Se.z,Y=Se.x,ce=Se.y;for(const xe of Se.features){const Ee=xe.geometry,Fe=xe.type;if(xe.geometry=[],Fe===1)for(let Pe=0;Pe<Ee.length;Pe+=2)xe.geometry.push(it(Ee[Pe],Ee[Pe+1],N,G,Y,ce));else for(let Pe=0;Pe<Ee.length;Pe++){const $e=[];for(let Ve=0;Ve<Ee[Pe].length;Ve+=2)$e.push(it(Ee[Pe][Ve],Ee[Pe][Ve+1],N,G,Y,ce));xe.geometry.push($e)}}return Se.transformed=!0,Se}function it(Se,N,G,Y,ce,xe){return[Math.round(G*(Se*Y-ce)),Math.round(G*(N*Y-xe))]}function nt(Se,N,G,Y,ce){const xe=N===ce.maxZoom?0:ce.tolerance/((1<<N)*ce.extent),Ee={features:[],numPoints:0,numSimplified:0,numFeatures:Se.length,source:null,x:G,y:Y,z:N,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Fe of Se)Oe(Ee,Fe,xe,ce);return Ee}function Oe(Se,N,G,Y){const ce=N.geometry,xe=N.type,Ee=[];if(Se.minX=Math.min(Se.minX,N.minX),Se.minY=Math.min(Se.minY,N.minY),Se.maxX=Math.max(Se.maxX,N.maxX),Se.maxY=Math.max(Se.maxY,N.maxY),xe==="Point"||xe==="MultiPoint")for(let Fe=0;Fe<ce.length;Fe+=3)Ee.push(ce[Fe],ce[Fe+1]),Se.numPoints++,Se.numSimplified++;else if(xe==="LineString")pt(Ee,ce,Se,G,!1,!1);else if(xe==="MultiLineString"||xe==="Polygon")for(let Fe=0;Fe<ce.length;Fe++)pt(Ee,ce[Fe],Se,G,xe==="Polygon",Fe===0);else if(xe==="MultiPolygon")for(let Fe=0;Fe<ce.length;Fe++){const Pe=ce[Fe];for(let $e=0;$e<Pe.length;$e++)pt(Ee,Pe[$e],Se,G,!0,$e===0)}if(Ee.length){let Fe=N.tags||null;if(xe==="LineString"&&Y.lineMetrics){Fe={};for(const $e in N.tags)Fe[$e]=N.tags[$e];Fe.mapbox_clip_start=ce.start/ce.size,Fe.mapbox_clip_end=ce.end/ce.size}const Pe={geometry:Ee,type:xe==="Polygon"||xe==="MultiPolygon"?3:xe==="LineString"||xe==="MultiLineString"?2:1,tags:Fe};N.id!==null&&(Pe.id=N.id),Se.features.push(Pe)}}function pt(Se,N,G,Y,ce,xe){const Ee=Y*Y;if(Y>0&&N.size<(ce?Ee:Y))return void(G.numPoints+=N.length/3);const Fe=[];for(let Pe=0;Pe<N.length;Pe+=3)(Y===0||N[Pe+2]>Ee)&&(G.numSimplified++,Fe.push(N[Pe],N[Pe+1])),G.numPoints++;ce&&function(Pe,$e){let Ve=0;for(let Ie=0,Ye=Pe.length,ve=Ye-2;Ie<Ye;ve=Ie,Ie+=2)Ve+=(Pe[Ie]-Pe[ve])*(Pe[Ie+1]+Pe[ve+1]);if(Ve>0===$e)for(let Ie=0,Ye=Pe.length;Ie<Ye/2;Ie+=2){const ve=Pe[Ie],yt=Pe[Ie+1];Pe[Ie]=Pe[Ye-2-Ie],Pe[Ie+1]=Pe[Ye-1-Ie],Pe[Ye-2-Ie]=ve,Pe[Ye-1-Ie]=yt}}(Fe,xe),Se.push(Fe)}const wt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class _t{constructor(N,G){const Y=(G=this.options=function(xe,Ee){for(const Fe in Ee)xe[Fe]=Ee[Fe];return xe}(Object.create(wt),G)).debug;if(Y&&console.time("preprocess data"),G.maxZoom<0||G.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(G.promoteId&&G.generateId)throw new Error("promoteId and generateId cannot be used together.");let ce=function(xe,Ee){const Fe=[];if(xe.type==="FeatureCollection")for(let Pe=0;Pe<xe.features.length;Pe++)Et(Fe,xe.features[Pe],Ee,Pe);else Et(Fe,xe.type==="Feature"?xe:{geometry:xe},Ee);return Fe}(N,G);this.tiles={},this.tileCoords=[],Y&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",G.indexMaxZoom,G.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ce=function(xe,Ee){const Fe=Ee.buffer/Ee.extent;let Pe=xe;const $e=Vt(xe,1,-1-Fe,Fe,0,-1,2,Ee),Ve=Vt(xe,1,1-Fe,2+Fe,0,-1,2,Ee);return($e||Ve)&&(Pe=Vt(xe,1,-Fe,1+Fe,0,-1,2,Ee)||[],$e&&(Pe=de($e,1).concat(Pe)),Ve&&(Pe=Pe.concat(de(Ve,-1)))),Pe}(ce,G),ce.length&&this.splitTile(ce,0,0,0),Y&&(ce.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(N,G,Y,ce,xe,Ee,Fe){const Pe=[N,G,Y,ce],$e=this.options,Ve=$e.debug;for(;Pe.length;){ce=Pe.pop(),Y=Pe.pop(),G=Pe.pop(),N=Pe.pop();const Ie=1<<G,Ye=kt(G,Y,ce);let ve=this.tiles[Ye];if(!ve&&(Ve>1&&console.time("creation"),ve=this.tiles[Ye]=nt(N,G,Y,ce,$e),this.tileCoords.push({z:G,x:Y,y:ce}),Ve)){Ve>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",G,Y,ce,ve.numFeatures,ve.numPoints,ve.numSimplified),console.timeEnd("creation"));const Yr=`z${G}`;this.stats[Yr]=(this.stats[Yr]||0)+1,this.total++}if(ve.source=N,xe==null){if(G===$e.indexMaxZoom||ve.numPoints<=$e.indexMaxPoints)continue}else{if(G===$e.maxZoom||G===xe)continue;if(xe!=null){const Yr=xe-G;if(Y!==Ee>>Yr||ce!==Fe>>Yr)continue}}if(ve.source=null,N.length===0)continue;Ve>1&&console.time("clipping");const yt=.5*$e.buffer/$e.extent,Rt=.5-yt,xt=.5+yt,Mt=1+yt;let Ot=null,br=null,ur=null,lr=null,Bt=Vt(N,Ie,Y-yt,Y+xt,0,ve.minX,ve.maxX,$e),rr=Vt(N,Ie,Y+Rt,Y+Mt,0,ve.minX,ve.maxX,$e);N=null,Bt&&(Ot=Vt(Bt,Ie,ce-yt,ce+xt,1,ve.minY,ve.maxY,$e),br=Vt(Bt,Ie,ce+Rt,ce+Mt,1,ve.minY,ve.maxY,$e),Bt=null),rr&&(ur=Vt(rr,Ie,ce-yt,ce+xt,1,ve.minY,ve.maxY,$e),lr=Vt(rr,Ie,ce+Rt,ce+Mt,1,ve.minY,ve.maxY,$e),rr=null),Ve>1&&console.timeEnd("clipping"),Pe.push(Ot||[],G+1,2*Y,2*ce),Pe.push(br||[],G+1,2*Y,2*ce+1),Pe.push(ur||[],G+1,2*Y+1,2*ce),Pe.push(lr||[],G+1,2*Y+1,2*ce+1)}}getTile(N,G,Y){N=+N,G=+G,Y=+Y;const ce=this.options,{extent:xe,debug:Ee}=ce;if(N<0||N>24)return null;const Fe=1<<N,Pe=kt(N,G=G+Fe&Fe-1,Y);if(this.tiles[Pe])return ke(this.tiles[Pe],xe);Ee>1&&console.log("drilling down to z%d-%d-%d",N,G,Y);let $e,Ve=N,Ie=G,Ye=Y;for(;!$e&&Ve>0;)Ve--,Ie>>=1,Ye>>=1,$e=this.tiles[kt(Ve,Ie,Ye)];return $e&&$e.source?(Ee>1&&(console.log("found parent tile z%d-%d-%d",Ve,Ie,Ye),console.time("drilling down")),this.splitTile($e.source,Ve,Ie,Ye,N,G,Y),Ee>1&&console.timeEnd("drilling down"),this.tiles[Pe]?ke(this.tiles[Pe],xe):null):null}}function kt(Se,N,G){return 32*((1<<Se)*G+N)+Se}function Xt(Se,N){return N?Se.properties[N]:Se.id}function Ut(Se,N){if(Se==null)return!0;if(Se.type==="Feature")return Xt(Se,N)!=null;if(Se.type==="FeatureCollection"){const G=new Set;for(const Y of Se.features){const ce=Xt(Y,N);if(ce==null||G.has(ce))return!1;G.add(ce)}return!0}return!1}function Kr(Se,N){const G=new Map;if(Se!=null)if(Se.type==="Feature")G.set(Xt(Se,N),Se);else for(const Y of Se.features)G.set(Xt(Y,N),Y);return G}class ln extends te{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(N,G){return w._(this,void 0,void 0,function*(){const Y=N.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ce=this._geoJSONIndex.getTile(Y.z,Y.x,Y.y);if(!ce)return null;const xe=new Te(ce.features);let Ee=Ke(xe);return Ee.byteOffset===0&&Ee.byteLength===Ee.buffer.byteLength||(Ee=new Uint8Array(Ee)),{vectorTile:xe,rawData:Ee.buffer}})}loadData(N){return w._(this,void 0,void 0,function*(){var G;(G=this._pendingRequest)===null||G===void 0||G.abort();const Y=!!(N&&N.request&&N.request.collectResourceTiming)&&new w.cM(N.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(N,this._pendingRequest),this._geoJSONIndex=N.cluster?new Xe(function({superclusterOptions:Ee,clusterProperties:Fe}){if(!Fe||!Ee)return Ee;const Pe={},$e={},Ve={accumulated:null,zoom:0},Ie={properties:null},Ye=Object.keys(Fe);for(const ve of Ye){const[yt,Rt]=Fe[ve],xt=w.cT(Rt),Mt=w.cT(typeof yt=="string"?[yt,["accumulated"],["get",ve]]:yt);Pe[ve]=xt.value,$e[ve]=Mt.value}return Ee.map=ve=>{Ie.properties=ve;const yt={};for(const Rt of Ye)yt[Rt]=Pe[Rt].evaluate(Ve,Ie);return yt},Ee.reduce=(ve,yt)=>{Ie.properties=yt;for(const Rt of Ye)Ve.accumulated=ve[Rt],ve[Rt]=$e[Rt].evaluate(Ve,Ie)},Ee}(N)).load((yield this._pendingData).features):(ce=yield this._pendingData,new _t(ce,N.geojsonVtOptions)),this.loaded={};const xe={};if(Y){const Ee=Y.finish();Ee&&(xe.resourceTiming={},xe.resourceTiming[N.source]=JSON.parse(JSON.stringify(Ee)))}return xe}catch(xe){if(delete this._pendingRequest,w.cx(xe))return{abandoned:!0};throw xe}var ce})}getData(){return w._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(N){const G=this.loaded;return G&&G[N.uid]?super.reloadTile(N):this.loadTile(N)}loadAndProcessGeoJSON(N,G){return w._(this,void 0,void 0,function*(){let Y=yield this.loadGeoJSON(N,G);if(delete this._pendingRequest,typeof Y!="object")throw new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`);if(le(Y,!0),N.filter){const ce=w.cT(N.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ce.result==="error")throw new Error(ce.value.map(Ee=>`${Ee.key}: ${Ee.message}`).join(", "));Y={type:"FeatureCollection",features:Y.features.filter(Ee=>ce.value.evaluate({zoom:0},Ee))}}return Y})}loadGeoJSON(N,G){return w._(this,void 0,void 0,function*(){const{promoteId:Y}=N;if(N.request){const ce=yield w.j(N.request,G);return this._dataUpdateable=Ut(ce.data,Y)?Kr(ce.data,Y):void 0,ce.data}if(typeof N.data=="string")try{const ce=JSON.parse(N.data);return this._dataUpdateable=Ut(ce,Y)?Kr(ce,Y):void 0,ce}catch{throw new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`)}if(!N.dataDiff)throw new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${N.source}`);return function(ce,xe,Ee){var Fe,Pe,$e,Ve;if(xe.removeAll&&ce.clear(),xe.remove)for(const Ie of xe.remove)ce.delete(Ie);if(xe.add)for(const Ie of xe.add){const Ye=Xt(Ie,Ee);Ye!=null&&ce.set(Ye,Ie)}if(xe.update)for(const Ie of xe.update){let Ye=ce.get(Ie.id);if(Ye==null)continue;const ve=!Ie.removeAllProperties&&(((Fe=Ie.removeProperties)===null||Fe===void 0?void 0:Fe.length)>0||((Pe=Ie.addOrUpdateProperties)===null||Pe===void 0?void 0:Pe.length)>0);if((Ie.newGeometry||Ie.removeAllProperties||ve)&&(Ye=Object.assign({},Ye),ce.set(Ie.id,Ye),ve&&(Ye.properties=Object.assign({},Ye.properties))),Ie.newGeometry&&(Ye.geometry=Ie.newGeometry),Ie.removeAllProperties)Ye.properties={};else if((($e=Ie.removeProperties)===null||$e===void 0?void 0:$e.length)>0)for(const yt of Ie.removeProperties)Object.prototype.hasOwnProperty.call(Ye.properties,yt)&&delete Ye.properties[yt];if(((Ve=Ie.addOrUpdateProperties)===null||Ve===void 0?void 0:Ve.length)>0)for(const{key:yt,value:Rt}of Ie.addOrUpdateProperties)Ye.properties[yt]=Rt}}(this._dataUpdateable,N.dataDiff,Y),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(N){return w._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(N){return this._geoJSONIndex.getClusterExpansionZoom(N.clusterId)}getClusterChildren(N){return this._geoJSONIndex.getChildren(N.clusterId)}getClusterLeaves(N){return this._geoJSONIndex.getLeaves(N.clusterId,N.limit,N.offset)}}class Ur{constructor(N){this.self=N,this.actor=new w.J(N),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(G,Y)=>{if(this.externalWorkerSourceTypes[G])throw new Error(`Worker source with name "${G}" already registered.`);this.externalWorkerSourceTypes[G]=Y},this.self.addProtocol=w.cz,this.self.removeProtocol=w.cA,this.self.registerRTLTextPlugin=G=>{w.cU.setMethods(G)},this.actor.registerMessageHandler("LDT",(G,Y)=>this._getDEMWorkerSource(G,Y.source).loadTile(Y)),this.actor.registerMessageHandler("RDT",(G,Y)=>w._(this,void 0,void 0,function*(){this._getDEMWorkerSource(G,Y.source).removeTile(Y)})),this.actor.registerMessageHandler("GCEZ",(G,Y)=>w._(this,void 0,void 0,function*(){return this._getWorkerSource(G,Y.type,Y.source).getClusterExpansionZoom(Y)})),this.actor.registerMessageHandler("GCC",(G,Y)=>w._(this,void 0,void 0,function*(){return this._getWorkerSource(G,Y.type,Y.source).getClusterChildren(Y)})),this.actor.registerMessageHandler("GCL",(G,Y)=>w._(this,void 0,void 0,function*(){return this._getWorkerSource(G,Y.type,Y.source).getClusterLeaves(Y)})),this.actor.registerMessageHandler("LD",(G,Y)=>this._getWorkerSource(G,Y.type,Y.source).loadData(Y)),this.actor.registerMessageHandler("GD",(G,Y)=>this._getWorkerSource(G,Y.type,Y.source).getData()),this.actor.registerMessageHandler("LT",(G,Y)=>this._getWorkerSource(G,Y.type,Y.source).loadTile(Y)),this.actor.registerMessageHandler("RT",(G,Y)=>this._getWorkerSource(G,Y.type,Y.source).reloadTile(Y)),this.actor.registerMessageHandler("AT",(G,Y)=>this._getWorkerSource(G,Y.type,Y.source).abortTile(Y)),this.actor.registerMessageHandler("RMT",(G,Y)=>this._getWorkerSource(G,Y.type,Y.source).removeTile(Y)),this.actor.registerMessageHandler("RS",(G,Y)=>w._(this,void 0,void 0,function*(){if(!this.workerSources[G]||!this.workerSources[G][Y.type]||!this.workerSources[G][Y.type][Y.source])return;const ce=this.workerSources[G][Y.type][Y.source];delete this.workerSources[G][Y.type][Y.source],ce.removeSource!==void 0&&ce.removeSource(Y)})),this.actor.registerMessageHandler("RM",G=>w._(this,void 0,void 0,function*(){delete this.layerIndexes[G],delete this.availableImages[G],delete this.workerSources[G],delete this.demWorkerSources[G]})),this.actor.registerMessageHandler("SR",(G,Y)=>w._(this,void 0,void 0,function*(){this.referrer=Y})),this.actor.registerMessageHandler("SRPS",(G,Y)=>this._syncRTLPluginState(G,Y)),this.actor.registerMessageHandler("IS",(G,Y)=>w._(this,void 0,void 0,function*(){this.self.importScripts(Y)})),this.actor.registerMessageHandler("SI",(G,Y)=>this._setImages(G,Y)),this.actor.registerMessageHandler("UL",(G,Y)=>w._(this,void 0,void 0,function*(){this._getLayerIndex(G).update(Y.layers,Y.removedIds)})),this.actor.registerMessageHandler("SL",(G,Y)=>w._(this,void 0,void 0,function*(){this._getLayerIndex(G).replace(Y)}))}_setImages(N,G){return w._(this,void 0,void 0,function*(){this.availableImages[N]=G;for(const Y in this.workerSources[N]){const ce=this.workerSources[N][Y];for(const xe in ce)ce[xe].availableImages=G}})}_syncRTLPluginState(N,G){return w._(this,void 0,void 0,function*(){return yield w.cU.syncState(G,this.self.importScripts)})}_getAvailableImages(N){let G=this.availableImages[N];return G||(G=[]),G}_getLayerIndex(N){let G=this.layerIndexes[N];return G||(G=this.layerIndexes[N]=new a),G}_getWorkerSource(N,G,Y){if(this.workerSources[N]||(this.workerSources[N]={}),this.workerSources[N][G]||(this.workerSources[N][G]={}),!this.workerSources[N][G][Y]){const ce={sendAsync:(xe,Ee)=>(xe.targetMapId=N,this.actor.sendAsync(xe,Ee))};switch(G){case"vector":this.workerSources[N][G][Y]=new te(ce,this._getLayerIndex(N),this._getAvailableImages(N));break;case"geojson":this.workerSources[N][G][Y]=new ln(ce,this._getLayerIndex(N),this._getAvailableImages(N));break;default:this.workerSources[N][G][Y]=new this.externalWorkerSourceTypes[G](ce,this._getLayerIndex(N),this._getAvailableImages(N))}}return this.workerSources[N][G][Y]}_getDEMWorkerSource(N,G){return this.demWorkerSources[N]||(this.demWorkerSources[N]={}),this.demWorkerSources[N][G]||(this.demWorkerSources[N][G]=new oe),this.demWorkerSources[N][G]}}return w.i(self)&&(self.worker=new Ur(self)),Ur}),P("index",["exports","./shared"],function(w,a){var $="5.6.0";function K(){var d=new a.A(4);return a.A!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d}let ne,te;const oe={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(d,e,r){const l=requestAnimationFrame(p=>{c(),e(p)}),{unsubscribe:c}=a.s(d.signal,"abort",()=>{c(),cancelAnimationFrame(l),r(a.c())},!1)},frameAsync(d){return new Promise((e,r)=>{this.frame(d,e,r)})},getImageData(d,e=0){return this.getImageCanvasContext(d).getImageData(-e,-e,d.width+2*e,d.height+2*e)},getImageCanvasContext(d){const e=window.document.createElement("canvas"),r=e.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return e.width=d.width,e.height=d.height,r.drawImage(d,0,0,d.width,d.height),r},resolveURL:d=>(ne||(ne=document.createElement("a")),ne.href=d,ne.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(te==null&&(te=matchMedia("(prefers-reduced-motion: reduce)")),te.matches)}};class L{static testProp(e){if(!L.docStyle)return e[0];for(let r=0;r<e.length;r++)if(e[r]in L.docStyle)return e[r];return e[0]}static create(e,r,l){const c=window.document.createElement(e);return r!==void 0&&(c.className=r),l&&l.appendChild(c),c}static createNS(e,r){return window.document.createElementNS(e,r)}static disableDrag(){L.docStyle&&L.selectProp&&(L.userSelect=L.docStyle[L.selectProp],L.docStyle[L.selectProp]="none")}static enableDrag(){L.docStyle&&L.selectProp&&(L.docStyle[L.selectProp]=L.userSelect)}static setTransform(e,r){e.style[L.transformProp]=r}static addEventListener(e,r,l,c={}){e.addEventListener(r,l,"passive"in c?c:c.capture)}static removeEventListener(e,r,l,c={}){e.removeEventListener(r,l,"passive"in c?c:c.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",L.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",L.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",L.suppressClickInternal,!0)},0)}static getScale(e){const r=e.getBoundingClientRect();return{x:r.width/e.offsetWidth||1,y:r.height/e.offsetHeight||1,boundingClientRect:r}}static getPoint(e,r,l){const c=r.boundingClientRect;return new a.P((l.clientX-c.left)/r.x-e.clientLeft,(l.clientY-c.top)/r.y-e.clientTop)}static mousePos(e,r){const l=L.getScale(e);return L.getPoint(e,l,r)}static touchPos(e,r){const l=[],c=L.getScale(e);for(let p=0;p<r.length;p++)l.push(L.getPoint(e,c,r[p]));return l}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const r=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),l=r.querySelectorAll("script");for(const c of l)c.remove();return L.clean(r),r.innerHTML}static isPossiblyDangerous(e,r){const l=r.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!l.includes("javascript:")&&!l.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const r=e.children;for(const l of r)L.removeAttributes(l),L.clean(l)}static removeAttributes(e){for(const{name:r,value:l}of e.attributes)L.isPossiblyDangerous(r,l)&&e.removeAttribute(r)}}L.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,L.selectProp=L.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),L.transformProp=L.testProp(["transform","WebkitTransform"]);const H={supported:!1,testSupport:function(d){!ie&&le&&(ge?Te(d):q=d)}};let q,le,ie=!1,ge=!1;function Te(d){const e=d.createTexture();d.bindTexture(d.TEXTURE_2D,e);try{if(d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,le),d.isContextLost())return;H.supported=!0}catch{}d.deleteTexture(e),ie=!0}var Ae;typeof document<"u"&&(le=document.createElement("img"),le.onload=()=>{q&&Te(q),q=null,ge=!0},le.onerror=()=>{ie=!0,q=null},le.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(d){let e,r,l,c;d.resetRequestQueue=()=>{e=[],r=0,l=0,c={}},d.addThrottleControl=C=>{const S=l++;return c[S]=C,S},d.removeThrottleControl=C=>{delete c[C],g()},d.getImage=(C,S,M=!0)=>new Promise((z,A)=>{H.supported&&(C.headers||(C.headers={}),C.headers.accept="image/webp,*/*"),a.e(C,{type:"image"}),e.push({abortController:S,requestParameters:C,supportImageRefresh:M,state:"queued",onError:R=>{A(R)},onSuccess:R=>{z(R)}}),g()});const p=C=>a._(this,void 0,void 0,function*(){C.state="running";const{requestParameters:S,supportImageRefresh:M,onError:z,onSuccess:A,abortController:R}=C,V=M===!1&&!a.i(self)&&!a.g(S.url)&&(!S.headers||Object.keys(S.headers).reduce((ee,se)=>ee&&se==="accept",!0));r++;const Q=V?b(S,R):a.m(S,R);try{const ee=yield Q;delete C.abortController,C.state="completed",ee.data instanceof HTMLImageElement||a.b(ee.data)?A(ee):ee.data&&A({data:yield(J=ee.data,typeof createImageBitmap=="function"?a.f(J):a.h(J)),cacheControl:ee.cacheControl,expires:ee.expires})}catch(ee){delete C.abortController,z(ee)}finally{r--,g()}var J}),g=()=>{const C=(()=>{for(const S of Object.keys(c))if(c[S]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let S=r;S<C&&e.length>0;S++){const M=e.shift();M.abortController.signal.aborted?S--:p(M)}},b=(C,S)=>new Promise((M,z)=>{const A=new Image,R=C.url,V=C.credentials;V&&V==="include"?A.crossOrigin="use-credentials":(V&&V==="same-origin"||!a.d(R))&&(A.crossOrigin="anonymous"),S.signal.addEventListener("abort",()=>{A.src="",z(a.c())}),A.fetchPriority="high",A.onload=()=>{A.onerror=A.onload=null,M({data:A})},A.onerror=()=>{A.onerror=A.onload=null,S.signal.aborted||z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},A.src=R})}(Ae||(Ae={})),Ae.resetRequestQueue();class Me{constructor(e){this._transformRequestFn=e}transformRequest(e,r){return this._transformRequestFn&&this._transformRequestFn(e,r)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function qe(d){const e=[];if(typeof d=="string")e.push({id:"default",url:d});else if(d&&d.length>0){const r=[];for(const{id:l,url:c}of d){const p=`${l}${c}`;r.indexOf(p)===-1&&(r.push(p),e.push({id:l,url:c}))}}return e}function He(d,e,r){try{const l=new URL(d);return l.pathname+=`${e}${r}`,l.toString()}catch{throw new Error(`Invalid sprite URL "${d}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function lt(d){const{userImage:e}=d;return!!(e&&e.render&&e.render())&&(d.data.replace(new Uint8Array(e.data.buffer)),!0)}class Ke extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:r,promiseResolve:l}of this.requestors)l(this._getImagesForIds(r));this.requestors=[]}}getImage(e){const r=this.images[e];if(r&&!r.data&&r.spriteData){const l=r.spriteData;r.data=new a.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),r.spriteData=null}return r}addImage(e,r){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,r)&&(this.images[e]=r)}_validate(e,r){let l=!0;const c=r.data||r.spriteData;return this._validateStretch(r.stretchX,c&&c.width)||(this.fire(new a.k(new Error(`Image "${e}" has invalid "stretchX" value`))),l=!1),this._validateStretch(r.stretchY,c&&c.height)||(this.fire(new a.k(new Error(`Image "${e}" has invalid "stretchY" value`))),l=!1),this._validateContent(r.content,r)||(this.fire(new a.k(new Error(`Image "${e}" has invalid "content" value`))),l=!1),l}_validateStretch(e,r){if(!e)return!0;let l=0;for(const c of e){if(c[0]<l||c[1]<c[0]||r<c[1])return!1;l=c[1]}return!0}_validateContent(e,r){if(!e)return!0;if(e.length!==4)return!1;const l=r.spriteData,c=l&&l.width||r.data.width,p=l&&l.height||r.data.height;return!(e[0]<0||c<e[0]||e[1]<0||p<e[1]||e[2]<0||c<e[2]||e[3]<0||p<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,r,l=!0){const c=this.getImage(e);if(l&&(c.data.width!==r.data.width||c.data.height!==r.data.height))throw new Error(`size mismatch between old image (${c.data.width}x${c.data.height}) and new image (${r.data.width}x${r.data.height}).`);r.version=c.version+1,this.images[e]=r,this.updatedImages[e]=!0}removeImage(e){const r=this.images[e];delete this.images[e],delete this.patterns[e],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((r,l)=>{let c=!0;if(!this.isLoaded())for(const p of e)this.images[p]||(c=!1);this.isLoaded()||c?r(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:r})})}_getImagesForIds(e){const r={};for(const l of e){let c=this.getImage(l);c||(this.fire(new a.l("styleimagemissing",{id:l})),c=this.getImage(l)),c?r[l]={data:c.data.clone(),pixelRatio:c.pixelRatio,sdf:c.sdf,version:c.version,stretchX:c.stretchX,stretchY:c.stretchY,content:c.content,textFitWidth:c.textFitWidth,textFitHeight:c.textFitHeight,hasRenderCallback:!!(c.userImage&&c.userImage.render)}:a.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return r}getPixelSize(){const{width:e,height:r}=this.atlasImage;return{width:e,height:r}}getPattern(e){const r=this.patterns[e],l=this.getImage(e);if(!l)return null;if(r&&r.position.version===l.version)return r.position;if(r)r.position.version=l.version;else{const c={w:l.data.width+2,h:l.data.height+2,x:0,y:0},p=new a.I(c,l);this.patterns[e]={bin:c,position:p}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const r=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new a.T(e,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const p in this.patterns)e.push(this.patterns[p].bin);const{w:r,h:l}=a.p(e),c=this.atlasImage;c.resize({width:r||1,height:l||1});for(const p in this.patterns){const{bin:g}=this.patterns[p],b=g.x+1,C=g.y+1,S=this.getImage(p).data,M=S.width,z=S.height;a.R.copy(S,c,{x:0,y:0},{x:b,y:C},{width:M,height:z}),a.R.copy(S,c,{x:0,y:z-1},{x:b,y:C-1},{width:M,height:1}),a.R.copy(S,c,{x:0,y:0},{x:b,y:C+z},{width:M,height:1}),a.R.copy(S,c,{x:M-1,y:0},{x:b-1,y:C},{width:1,height:z}),a.R.copy(S,c,{x:0,y:0},{x:b+M,y:C},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const r of e){if(this.callbackDispatchedThisFrame[r])continue;this.callbackDispatchedThisFrame[r]=!0;const l=this.getImage(r);l||a.w(`Image with ID: "${r}" was not found`),lt(l)&&this.updateImage(r,l)}}}const ut=1e20;function It(d,e,r,l,c,p,g,b,C){for(let S=e;S<e+l;S++)be(d,r*p+S,p,c,g,b,C);for(let S=r;S<r+c;S++)be(d,S*p+e,1,l,g,b,C)}function be(d,e,r,l,c,p,g){p[0]=0,g[0]=-1e20,g[1]=ut,c[0]=d[e];for(let b=1,C=0,S=0;b<l;b++){c[b]=d[e+b*r];const M=b*b;do{const z=p[C];S=(c[b]-c[z]+M-z*z)/(b-z)/2}while(S<=g[C]&&--C>-1);C++,p[C]=b,g[C]=S,g[C+1]=ut}for(let b=0,C=0;b<l;b++){for(;g[C+1]<b;)C++;const S=p[C],M=b-S;d[e+b*r]=c[S]+M*M}}class Xe{constructor(e,r){this.requestManager=e,this.localIdeographFontFamily=r,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return a._(this,void 0,void 0,function*(){const r=[];for(const p in e)for(const g of e[p])r.push(this._getAndCacheGlyphsPromise(p,g));const l=yield Promise.all(r),c={};for(const{stack:p,id:g,glyph:b}of l)c[p]||(c[p]={}),c[p][g]=b&&{id:b.id,bitmap:b.bitmap.clone(),metrics:b.metrics};return c})}_getAndCacheGlyphsPromise(e,r){return a._(this,void 0,void 0,function*(){let l=this.entries[e];l||(l=this.entries[e]={glyphs:{},requests:{},ranges:{}});let c=l.glyphs[r];if(c!==void 0)return{stack:e,id:r,glyph:c};if(c=this._tinySDF(l,e,r),c)return l.glyphs[r]=c,{stack:e,id:r,glyph:c};const p=Math.floor(r/256);if(256*p>65535)throw new Error("glyphs > 65535 not supported");if(l.ranges[p])return{stack:e,id:r,glyph:c};if(!this.url)throw new Error("glyphsUrl is not set");if(!l.requests[p]){const b=Xe.loadGlyphRange(e,p,this.url,this.requestManager);l.requests[p]=b}const g=yield l.requests[p];for(const b in g)this._doesCharSupportLocalGlyph(+b)||(l.glyphs[+b]=g[+b]);return l.ranges[p]=!0,{stack:e,id:r,glyph:g[r]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))||a.u["CJK Unified Ideographs"](e)||a.u["Hangul Syllables"](e)||a.u.Hiragana(e)||a.u.Katakana(e)||a.u["CJK Symbols and Punctuation"](e)||a.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,r,l){const c=this.localIdeographFontFamily;if(!c||!this._doesCharSupportLocalGlyph(l))return;let p=e.tinySDF;if(!p){let b="400";/bold/i.test(r)?b="900":/medium/i.test(r)?b="500":/light/i.test(r)&&(b="200"),p=e.tinySDF=new Xe.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:b})}const g=p.draw(String.fromCharCode(l));return{id:l,bitmap:new a.q({width:g.width||60,height:g.height||60},g.data),metrics:{width:g.glyphWidth/2||24,height:g.glyphHeight/2||24,left:g.glyphLeft/2+.5||0,top:g.glyphTop/2-27.5||-8,advance:g.glyphAdvance/2||24,isDoubleResolution:!0}}}}Xe.loadGlyphRange=function(d,e,r,l){return a._(this,void 0,void 0,function*(){const c=256*e,p=c+255,g=l.transformRequest(r.replace("{fontstack}",d).replace("{range}",`${c}-${p}`),"Glyphs"),b=yield a.n(g,new AbortController);if(!b||!b.data)throw new Error(`Could not load glyph range. range: ${e}, ${c}-${p}`);const C={};for(const S of a.o(b.data))C[S.id]=S;return C})},Xe.TinySDF=class{constructor({fontSize:d=24,buffer:e=3,radius:r=8,cutoff:l=.25,fontFamily:c="sans-serif",fontWeight:p="normal",fontStyle:g="normal"}={}){this.buffer=e,this.cutoff=l,this.radius=r;const b=this.size=d+4*e,C=this._createCanvas(b),S=this.ctx=C.getContext("2d",{willReadFrequently:!0});S.font=`${g} ${p} ${d}px ${c}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(d){const e=document.createElement("canvas");return e.width=e.height=d,e}draw(d){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:l,actualBoundingBoxLeft:c,actualBoundingBoxRight:p}=this.ctx.measureText(d),g=Math.ceil(r),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-c))),C=Math.min(this.size-this.buffer,g+Math.ceil(l)),S=b+2*this.buffer,M=C+2*this.buffer,z=Math.max(S*M,0),A=new Uint8ClampedArray(z),R={data:A,width:S,height:M,glyphWidth:b,glyphHeight:C,glyphTop:g,glyphLeft:0,glyphAdvance:e};if(b===0||C===0)return R;const{ctx:V,buffer:Q,gridInner:J,gridOuter:ee}=this;V.clearRect(Q,Q,b,C),V.fillText(d,Q,Q+g);const se=V.getImageData(Q,Q,b,C);ee.fill(ut,0,z),J.fill(0,0,z);for(let fe=0;fe<C;fe++)for(let he=0;he<b;he++){const _e=se.data[4*(fe*b+he)+3]/255;if(_e===0)continue;const ye=(fe+Q)*S+he+Q;if(_e===1)ee[ye]=0,J[ye]=ut;else{const ue=.5-_e;ee[ye]=ue>0?ue*ue:0,J[ye]=ue<0?ue*ue:0}}It(ee,0,0,S,M,S,this.f,this.v,this.z),It(J,Q,Q,b,C,S,this.f,this.v,this.z);for(let fe=0;fe<z;fe++){const he=Math.sqrt(ee[fe])-Math.sqrt(J[fe]);A[fe]=Math.round(255-255*(he/this.radius+this.cutoff))}return R}};class Z{constructor(){this.specification=a.v.light.position}possiblyEvaluate(e,r){return a.B(e.expression.evaluate(r))}interpolate(e,r,l){return{x:a.C.number(e.x,r.x,l),y:a.C.number(e.y,r.y,l),z:a.C.number(e.z,r.z,l)}}}let Qe;class jt extends a.E{constructor(e){super(),Qe=Qe||new a.r({anchor:new a.D(a.v.light.anchor),position:new Z,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.t(Qe),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,r={}){if(!this._validate(a.x,e,r))for(const l in e){const c=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),c):this._transitionable.setValue(l,c)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,r,l){return(!l||l.validate!==!1)&&a.y(this,e.call(a.z,{value:r,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}const at=new a.r({"sky-color":new a.D(a.v.sky["sky-color"]),"horizon-color":new a.D(a.v.sky["horizon-color"]),"fog-color":new a.D(a.v.sky["fog-color"]),"fog-ground-blend":new a.D(a.v.sky["fog-ground-blend"]),"horizon-fog-blend":new a.D(a.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new a.D(a.v.sky["sky-horizon-blend"]),"atmosphere-blend":new a.D(a.v.sky["atmosphere-blend"])});class Gt extends a.E{constructor(e){super(),this._transitionable=new a.t(at),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.F(0))}setSky(e,r={}){if(!this._validate(a.G,e,r)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in e){const c=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),c):this._transitionable.setValue(l,c)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,r,l={}){return(l==null?void 0:l.validate)!==!1&&a.y(this,e.call(a.z,a.e({value:r,style:{glyphs:!0,sprite:!0},styleSpec:a.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class dt{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,r){const l=e.join(",")+String(r);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(e,r)),this.dashEntry[l]}getDashRanges(e,r,l){const c=[];let p=e.length%2==1?-e[e.length-1]*l:0,g=e[0]*l,b=!0;c.push({left:p,right:g,isDash:b,zeroLength:e[0]===0});let C=e[0];for(let S=1;S<e.length;S++){b=!b;const M=e[S];p=C*l,C+=M,g=C*l,c.push({left:p,right:g,isDash:b,zeroLength:M===0})}return c}addRoundDash(e,r,l){const c=r/2;for(let p=-l;p<=l;p++){const g=this.width*(this.nextRow+l+p);let b=0,C=e[b];for(let S=0;S<this.width;S++){S/C.right>1&&(C=e[++b]);const M=Math.abs(S-C.left),z=Math.abs(S-C.right),A=Math.min(M,z);let R;const V=p/l*(c+1);if(C.isDash){const Q=c-Math.abs(V);R=Math.sqrt(A*A+Q*Q)}else R=c-Math.sqrt(A*A+V*V);this.data[g+S]=Math.max(0,Math.min(255,R+128))}}}addRegularDash(e){for(let b=e.length-1;b>=0;--b){const C=e[b],S=e[b+1];C.zeroLength?e.splice(b,1):S&&S.isDash===C.isDash&&(S.left=C.left,e.splice(b,1))}const r=e[0],l=e[e.length-1];r.isDash===l.isDash&&(r.left=l.left-this.width,l.right=r.right+this.width);const c=this.width*this.nextRow;let p=0,g=e[p];for(let b=0;b<this.width;b++){b/g.right>1&&(g=e[++p]);const C=Math.abs(b-g.left),S=Math.abs(b-g.right),M=Math.min(C,S);this.data[c+b]=Math.max(0,Math.min(255,(g.isDash?M:-M)+128))}}addDash(e,r){const l=r?7:0,c=2*l+1;if(this.nextRow+c>this.height)return a.w("LineAtlas out of space"),null;let p=0;for(let b=0;b<e.length;b++)p+=e[b];if(p!==0){const b=this.width/p,C=this.getDashRanges(e,this.width,b);r?this.addRoundDash(C,b,l):this.addRegularDash(C)}const g={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:p};return this.nextRow+=c,this.dirty=!0,g}bind(e){const r=e.gl;this.texture?(r.bindTexture(r.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,r.texSubImage2D(r.TEXTURE_2D,0,0,0,this.width,this.height,r.ALPHA,r.UNSIGNED_BYTE,this.data))):(this.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,this.width,this.height,0,r.ALPHA,r.UNSIGNED_BYTE,this.data))}}const Ft="maplibre_preloaded_worker_pool";class Ue{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Ue.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ft]}numActive(){return Object.keys(this.active).length}}const ze=Math.floor(oe.hardwareConcurrency/2);let Et,bt;function gt(){return Et||(Et=new Ue),Et}Ue.workerCount=a.H(globalThis)?Math.max(Math.min(ze,3),1):1;class fr{constructor(e,r){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=r;const l=this.workerPool.acquire(r);for(let c=0;c<l.length;c++){const p=new a.J(l[c],r);p.name=`Worker ${c}`,this.actors.push(p)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,r){const l=[];for(const c of this.actors)l.push(c.sendAsync({type:e,data:r}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(r=>{r.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,r){for(const l of this.actors)l.registerMessageHandler(e,r)}}function Dr(){return bt||(bt=new fr(gt(),a.K),bt.registerMessageHandler("GR",(d,e,r)=>a.m(e,r))),bt}function er(d,e){const r=a.L();return a.M(r,r,[1,1,0]),a.N(r,r,[.5*d.width,.5*d.height,1]),d.calculatePosMatrix?a.O(r,r,d.calculatePosMatrix(e.toUnwrapped())):r}function Vt(d,e,r,l,c,p,g){var b;const C=function(A,R,V){if(A)for(const Q of A){const J=R[Q];if(J&&J.source===V&&J.type==="fill-extrusion")return!0}else for(const Q in R){const J=R[Q];if(J.source===V&&J.type==="fill-extrusion")return!0}return!1}((b=c==null?void 0:c.layers)!==null&&b!==void 0?b:null,e,d.id),S=p.maxPitchScaleFactor(),M=d.tilesIn(l,S,C);M.sort(Pr);const z=[];for(const A of M)z.push({wrappedTileID:A.tileID.wrapped().key,queryResults:A.tile.queryRenderedFeatures(e,r,d._state,A.queryGeometry,A.cameraQueryGeometry,A.scale,c,p,S,er(d.transform,A.tileID),g?(R,V)=>g(A.tileID,R,V):void 0)});return function(A,R){for(const V in A)for(const Q of A[V])or(Q,R);return A}(function(A){const R={},V={};for(const Q of A){const J=Q.queryResults,ee=Q.wrappedTileID,se=V[ee]=V[ee]||{};for(const fe in J){const he=J[fe],_e=se[fe]=se[fe]||{},ye=R[fe]=R[fe]||[];for(const ue of he)_e[ue.featureIndex]||(_e[ue.featureIndex]=!0,ye.push(ue))}}return R}(z),d)}function Pr(d,e){const r=d.tileID,l=e.tileID;return r.overscaledZ-l.overscaledZ||r.canonical.y-l.canonical.y||r.wrap-l.wrap||r.canonical.x-l.canonical.x}function or(d,e){const r=d.feature,l=e.getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=l}function _i(d,e,r){return a._(this,void 0,void 0,function*(){let l=d;if(d.url?l=(yield a.j(e.transformRequest(d.url,"Source"),r)).data:yield oe.frameAsync(r),!l)return null;const c=a.Q(a.e(l,d),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(c.vectorLayerIds=l.vector_layers.map(p=>p.id)),c})}class ar{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof a.S?new a.S(e.lng,e.lat):a.S.convert(e),this}setSouthWest(e){return this._sw=e instanceof a.S?new a.S(e.lng,e.lat):a.S.convert(e),this}extend(e){const r=this._sw,l=this._ne;let c,p;if(e instanceof a.S)c=e,p=e;else{if(!(e instanceof ar))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ar.convert(e)):this.extend(a.S.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(a.S.convert(e)):this;if(c=e._sw,p=e._ne,!c||!p)return this}return r||l?(r.lng=Math.min(c.lng,r.lng),r.lat=Math.min(c.lat,r.lat),l.lng=Math.max(p.lng,l.lng),l.lat=Math.max(p.lat,l.lat)):(this._sw=new a.S(c.lng,c.lat),this._ne=new a.S(p.lng,p.lat)),this}getCenter(){return new a.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.S(this.getWest(),this.getNorth())}getSouthEast(){return new a.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:l}=a.S.convert(e);let c=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&c}static convert(e){return e instanceof ar?e:e&&new ar(e)}static fromLngLat(e,r=0){const l=360*r/40075017,c=l/Math.cos(Math.PI/180*e.lat);return new ar(new a.S(e.lng-c,e.lat-l),new a.S(e.lng+c,e.lat+l))}adjustAntiMeridian(){const e=new a.S(this._sw.lng,this._sw.lat),r=new a.S(this._ne.lng,this._ne.lat);return new ar(e,e.lng>r.lng?new a.S(r.lng+360,r.lat):r)}}class O{constructor(e,r,l){this.bounds=ar.convert(this.validateBounds(e)),this.minzoom=r||0,this.maxzoom=l||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const r=Math.pow(2,e.z),l=Math.floor(a.V(this.bounds.getWest())*r),c=Math.floor(a.U(this.bounds.getNorth())*r),p=Math.ceil(a.V(this.bounds.getEast())*r),g=Math.ceil(a.U(this.bounds.getSouth())*r);return e.x>=l&&e.x<p&&e.y>=c&&e.y<g}}class Je extends a.E{constructor(e,r,l,c){if(super(),this.id=e,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.Q(r,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(c)}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield _i(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(a.e(this,e),e.bounds&&(this.tileBounds=new O(e.bounds,this.minzoom,this.maxzoom)),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new a.k(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(e){return a._(this,void 0,void 0,function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(r,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};l.request.collectResourceTiming=this._collectResourceTiming;let c="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((p,g)=>{e.reloadPromise={resolve:p,reject:g}})}else e.actor=this.dispatcher.getActor(),c="LT";e.abortController=new AbortController;try{const p=yield e.actor.sendAsync({type:c,data:l},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,p)}catch(p){if(delete e.abortController,e.aborted)return;if(p&&p.status!==404)throw p;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,r){if(r&&r.resourceTiming&&(e.resourceTiming=r.resourceTiming),r&&this.map._refreshExpiredTiles&&e.setExpiryData(r),e.loadVectorData(r,this.map.painter),e.reloadPromise){const l=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(l.resolve).catch(l.reject)}}abortTile(e){return a._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return a._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Ge extends a.E{constructor(e,r,l,c){super(),this.id=e,this.dispatcher=l,this.setEventedParent(c),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},r),a.e(this,a.Q(r,["url","scheme","tileSize"]))}load(){return a._(this,arguments,void 0,function*(e=!1){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const r=yield _i(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,r&&(a.e(this,r),r.bounds&&(this.tileBounds=new O(r.bounds,this.minzoom,this.maxzoom)),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(r){this._tileJSONRequest=null,this.fire(new a.k(r))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return a.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return a._(this,void 0,void 0,function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const l=yield Ae.getImage(this.map._requestManager.transformRequest(r,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&(l.cacheControl||l.expires)&&e.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const c=this.map.painter.context,p=c.gl,g=l.data;e.texture=this.map.painter.getTileTexture(g.width),e.texture?e.texture.update(g,{useMipmap:!0}):(e.texture=new a.T(c,g,p.RGBA,{useMipmap:!0}),e.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE,p.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(l){if(delete e.abortController,e.aborted)e.state="unloaded";else if(l)throw e.state="errored",l}})}abortTile(e){return a._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return a._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class de extends Ge{constructor(e,r,l,c){super(e,r,l,c),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox",this.redFactor=r.redFactor,this.greenFactor=r.greenFactor,this.blueFactor=r.blueFactor,this.baseShift=r.baseShift}loadTile(e){return a._(this,void 0,void 0,function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(r,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const c=yield Ae.getImage(l,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(c&&c.data){const p=c.data;this.map._refreshExpiredTiles&&(c.cacheControl||c.expires)&&e.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const g=a.b(p)&&a.W()?p:yield this.readImageNow(p),b={type:this.type,uid:e.uid,source:this.id,rawImageData:g,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const C=yield e.actor.sendAsync({type:"LDT",data:b});e.dem=C,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(c){if(delete e.abortController,e.aborted)e.state="unloaded";else if(c)throw e.state="errored",c}})}readImageNow(e){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.X()){const r=e.width+2,l=e.height+2;try{return new a.R({width:r,height:l},yield a.Y(e,-1,-1,r,l))}catch{}}return oe.getImageData(e,1)})}_getNeighboringTiles(e){const r=e.canonical,l=Math.pow(2,r.z),c=(r.x-1+l)%l,p=r.x===0?e.wrap-1:e.wrap,g=(r.x+1+l)%l,b=r.x+1===l?e.wrap+1:e.wrap,C={};return C[new a.Z(e.overscaledZ,p,r.z,c,r.y).key]={backfilled:!1},C[new a.Z(e.overscaledZ,b,r.z,g,r.y).key]={backfilled:!1},r.y>0&&(C[new a.Z(e.overscaledZ,p,r.z,c,r.y-1).key]={backfilled:!1},C[new a.Z(e.overscaledZ,e.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},C[new a.Z(e.overscaledZ,b,r.z,g,r.y-1).key]={backfilled:!1}),r.y+1<l&&(C[new a.Z(e.overscaledZ,p,r.z,c,r.y+1).key]={backfilled:!1},C[new a.Z(e.overscaledZ,e.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},C[new a.Z(e.overscaledZ,b,r.z,g,r.y+1).key]={backfilled:!1}),C}unloadTile(e){return a._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class ae extends a.E{constructor(e,r,l,c){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=l.getActor(),this.setEventedParent(c),this._data=r.data,this._options=a.e({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId,r.clusterMaxZoom!==void 0&&this.maxzoom<=r.clusterMaxZoom&&a.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${r.clusterMaxZoom}".`),this.workerOptions=a.e({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(r.buffer!==void 0?r.buffer:128),tolerance:this._pixelsToTileUnits(r.tolerance!==void 0?r.tolerance:.375),extent:a.$,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(r.clusterMaxZoom),minPoints:Math.max(2,r.clusterMinPoints||2),extent:a.$,radius:this._pixelsToTileUnits(r.clusterRadius||50),log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(a.$/this.tileSize)}_getClusterMaxZoom(e){const r=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||e===void 0||a.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${r}"`),r}load(){return a._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return a._(this,void 0,void 0,function*(){const e=a.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}getCoordinatesFromGeometry(e){return e.type==="GeometryCollection"?e.geometries.map(r=>r.coordinates).flat(1/0):e.coordinates.flat(1/0)}getBounds(){return a._(this,void 0,void 0,function*(){const e=new ar,r=yield this.getData();let l;switch(r.type){case"FeatureCollection":l=r.features.map(c=>this.getCoordinatesFromGeometry(c.geometry)).flat(1/0);break;case"Feature":l=this.getCoordinatesFromGeometry(r.geometry);break;default:l=this.getCoordinatesFromGeometry(r)}if(l.length==0)return e;for(let c=0;c<l.length-1;c+=2)e.extend([l[c],l[c+1]]);return e})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,r,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:r,offset:l}})}_updateWorkerData(e){return a._(this,void 0,void 0,function*(){const r=a.e({type:this.type},this.workerOptions);e?r.dataDiff=e:typeof this._data=="string"?(r.request=this.map._requestManager.transformRequest(oe.resolveURL(this._data),"Source"),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.l("dataloading",{dataType:"source"}));try{const l=yield this.actor.sendAsync({type:"LD",data:r});if(this._pendingLoads--,this._removed||l.abandoned)return void this.fire(new a.l("dataabort",{dataType:"source"}));let c=null;l.resourceTiming&&l.resourceTiming[this.id]&&(c=l.resourceTiming[this.id].slice(0));const p={dataType:"source"};this._collectResourceTiming&&c&&c.length>0&&a.e(p,{resourceTiming:c}),this.fire(new a.l("data",Object.assign(Object.assign({},p),{sourceDataType:"metadata"}))),this.fire(new a.l("data",Object.assign(Object.assign({},p),{sourceDataType:"content"})))}catch(l){if(this._pendingLoads--,this._removed)return void this.fire(new a.l("dataabort",{dataType:"source"}));this.fire(new a.k(l))}})}loaded(){return this._pendingLoads===0}loadTile(e){return a._(this,void 0,void 0,function*(){const r=e.actor?"RT":"LT";e.actor=this.actor;const l={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};e.abortController=new AbortController;const c=yield this.actor.sendAsync({type:r,data:l},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(c,this.map.painter,r==="RT")})}abortTile(e){return a._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return a._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class ke extends a.E{constructor(e,r,l,c){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=l,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(c),this.options=r}load(e){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const r=yield Ae.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,r&&r.data&&(this.image=r.data,e&&(this.coordinates=e),this._finishLoading())}catch(r){this._request=null,this._loaded=!0,this.fire(new a.k(r))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const r=e.map(a.a0.fromLngLat);var l;return this.tileID=function(c){const p=a.a1.fromPoints(c),g=p.width(),b=p.height(),C=Math.max(g,b),S=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),M=Math.pow(2,S);return new a.a3(S,Math.floor((p.minX+p.maxX)/2*M),Math.floor((p.minY+p.maxY)/2*M))}(r),this.terrainTileRanges=this._getOverlappingTileRanges(r),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=r.map(c=>this.tileID.getTilePoint(c)._round()),this.flippedWindingOrder=((l=this.tileCoords)[1].x-l[0].x)*(l[2].y-l[0].y)-(l[1].y-l[0].y)*(l[2].x-l[0].x)<0,this.fire(new a.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,r=e.gl;this.texture||(this.texture=new a.T(e,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let l=!1;for(const c in this.tiles){const p=this.tiles[c];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,l=!0)}l&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return a._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){const{minX:r,minY:l,maxX:c,maxY:p}=a.a1.fromPoints(e),g={};for(let b=0;b<=a.a2;b++){const C=Math.pow(2,b),S=Math.floor(r*C),M=Math.floor(l*C),z=Math.floor(c*C),A=Math.floor(p*C);g[b]={minTileX:S,minTileY:M,maxTileX:z,maxTileY:A}}return g}}class it extends ke{constructor(e,r,l,c){super(e,r,l,c),this.roundZoom=!0,this.type="video",this.options=r}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const r of e.urls)this.urls.push(this.map._requestManager.transformRequest(r,"Source").url);try{const r=yield a.a4(this.urls);if(this._loaded=!0,!r)return;this.video=r,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(r){this.fire(new a.k(r))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const r=this.video.seekable;e<r.start(0)||e>r.end(0)?this.fire(new a.k(new a.a5(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,r=e.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new a.T(e,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let l=!1;for(const c in this.tiles){const p=this.tiles[c];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,l=!0)}l&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class nt extends ke{constructor(e,r,l,c){super(e,r,l,c),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(g=>typeof g!="number"))||this.fire(new a.k(new a.a5(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.k(new a.a5(`sources.${e}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new a.k(new a.a5(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new a.k(new a.a5(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.k(new a.a5(`sources.${e}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){return a._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context,l=r.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.T(r,this.canvas,l.RGBA,{premultiply:!0});let c=!1;for(const p in this.tiles){const g=this.tiles[p];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,c=!0)}c&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Oe={},pt=d=>{switch(d){case"geojson":return ae;case"image":return ke;case"raster":return Ge;case"raster-dem":return de;case"vector":return Je;case"video":return it;case"canvas":return nt}return Oe[d]},wt="RTLPluginLoaded";class _t extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Dr()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(r=>{throw this.status="error",r})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return a._(this,arguments,void 0,function*(r,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=oe.resolveURL(r),!this.url)throw new Error(`requested url ${r} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return a._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.l(wt))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let kt=null;function Xt(){return kt||(kt=new _t),kt}class Ut{constructor(e,r){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=a.a6(),this.uses=0,this.tileSize=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const r=e+this.timeAdded;r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,r,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,p){const g={};if(!p)return g;for(const b of c){const C=b.layerIds.map(S=>p.getLayer(S)).filter(Boolean);if(C.length!==0){b.layers=C,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(S=>C.filter(M=>M.id===S)[0]));for(const S of C)g[S.id]=b}}return g}(e.buckets,r==null?void 0:r.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const p=this.buckets[c];if(p instanceof a.a8){if(this.hasSymbolBuckets=!0,!l)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const p=this.buckets[c];if(p instanceof a.a8&&p.hasRTLText){this.hasRTLText=!0,Xt().lazyLoad();break}}this.queryPadding=0;for(const c in this.buckets){const p=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(c).queryRadius(p))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new a.a7}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const c=this.buckets[l];c.uploadPending()&&c.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new a.T(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new a.T(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,l,c,p,g,b,C,S,M,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:c,cameraQueryGeometry:p,scale:g,tileSize:this.tileSize,pixelPosMatrix:M,transform:C,params:b,queryPadding:this.queryPadding*S,getElevation:z},e,r,l):{}}querySourceFeatures(e,r){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const c=l.loadVTLayers(),p=r&&r.sourceLayer?r.sourceLayer:"",g=c._geojsonTileLayer||c[p];if(!g)return;const b=a.a9(r&&r.filter),{z:C,x:S,y:M}=this.tileID.canonical,z={z:C,x:S,y:M};for(let A=0;A<g.length;A++){const R=g.feature(A);if(b.needGeometry){const J=a.aa(R,!0);if(!b.filter(new a.F(this.tileID.overscaledZ),J,this.tileID.canonical))continue}else if(!b.filter(new a.F(this.tileID.overscaledZ),R))continue;const V=l.getId(R,p),Q=new a.ab(R,C,S,M,V);Q.tile=z,e.push(Q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const l=a.ac(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let c=!1;if(this.expirationTime>l)c=!1;else if(r)if(this.expirationTime<r)c=!0;else{const p=this.expirationTime-r;p?this.expirationTime=l+Math.max(p,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const c in this.buckets){if(!r.style.hasLayer(c))continue;const p=this.buckets[c],g=p.layers[0].sourceLayer||"_geojsonTileLayer",b=l[g],C=e[g];if(!b||!C||Object.keys(C).length===0)continue;p.update(C,b,this.imageAtlas&&this.imageAtlas.patternPositions||{});const S=r&&r.style&&r.style.getLayer(c);S&&(this.queryPadding=Math.max(this.queryPadding,S.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<oe.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=oe.now()+e}setDependencies(e,r){const l={};for(const c of r)l[c]=!0;this.dependencies[e]=l}hasDependency(e,r){for(const l of e){const c=this.dependencies[l];if(c){for(const p of r)if(c[p])return!0}}return!1}}class Kr{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,l){const c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const p={value:r,timeout:void 0};if(l!==void 0&&(p.timeout=setTimeout(()=>{this.remove(e,p)},l)),this.data[c].push(p),this.order.push(c),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const l=e.wrapped().key,c=r===void 0?0:this.data[l].indexOf(r),p=this.data[l][c];return this.data[l].splice(c,1),p.timeout&&clearTimeout(p.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(p.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const l in this.data)for(const c of this.data[l])e(c.value)||r.push(c);for(const l of r)this.remove(l.value.tileID,l)}}class ln{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,l){const c=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},a.e(this.stateChanges[e][c],l),this.deletedStates[e]===null){this.deletedStates[e]={};for(const p in this.state[e])p!==c&&(this.deletedStates[e][p]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(const p in this.state[e][c])l[p]||(this.deletedStates[e][c][p]=null)}else for(const p in l)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][p]===null&&delete this.deletedStates[e][c][p]}removeFeatureState(e,r,l){if(this.deletedStates[e]===null)return;const c=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&r!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][l]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(l in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][l]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,r){const l=String(r),c=a.e({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const p=this.deletedStates[e][r];if(p===null)return{};for(const g in p)delete c[g]}return c}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const l={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const p={};for(const g in this.stateChanges[c])this.state[c][g]||(this.state[c][g]={}),a.e(this.state[c][g],this.stateChanges[c][g]),p[g]=this.state[c][g];l[c]=p}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const p={};if(this.deletedStates[c]===null)for(const g in this.state[c])p[g]={},this.state[c][g]={};else for(const g in this.deletedStates[c]){if(this.deletedStates[c][g]===null)this.state[c][g]={};else for(const b of Object.keys(this.deletedStates[c][g]))delete this.state[c][g][b];p[g]=this.state[c][g]}l[c]=l[c]||{},a.e(l[c],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const c in e)e[c].setFeatureState(l,r)}}const Ur=89.25;function Se(d,e){const r=a.ag(e.lat,-85.051129,a.ah);return new a.P(a.V(e.lng)*d,a.U(r)*d)}function N(d,e){return new a.a0(e.x/d,e.y/d).toLngLat()}function G(d){return d.cameraToCenterDistance*Math.min(.85*Math.tan(a.ad(90-d.pitch)),Math.tan(a.ad(Ur-d.pitch)))}function Y(d,e){const r=d.canonical,l=e/a.ae(r.z),c=r.x+Math.pow(2,r.z)*d.wrap,p=a.af(new Float64Array(16));return a.M(p,p,[c*l,r.y*l,0]),a.N(p,p,[l/a.$,l/a.$,1]),p}function ce(d,e,r,l,c){const p=a.a0.fromLngLat(d,e),g=c*a.ai(1,d.lat),b=g*Math.cos(a.ad(r)),C=Math.sqrt(g*g-b*b),S=C*Math.sin(a.ad(-l)),M=C*Math.cos(a.ad(-l));return new a.a0(p.x+S,p.y+M,p.z+b)}function xe(d,e,r){const l=e.intersectsFrustum(d);if(!r||l===0)return l;const c=e.intersectsPlane(r);return c===0?0:l===2&&c===2?2:1}function Ee(d,e,r){let l=0;const c=(r-e)/10;for(let p=0;p<10;p++)l+=c*Math.pow(Math.cos(e+(p+.5)/10*(r-e)),d);return l}function Fe(d,e){return function(r,l,c,p,g){const b=2*((d-1)/a.aj(Math.cos(a.ad(Ur-g))/Math.cos(a.ad(Ur)))-1),C=Math.acos(c/p),S=2*Ee(b-1,0,a.ad(g/2)),M=Math.min(a.ad(Ur),C+a.ad(g/2)),z=Ee(b-1,Math.min(M,C-a.ad(g/2)),M),A=Math.atan(l/c),R=Math.hypot(l,c);let V=r;return V+=a.aj(p/R/Math.max(.5,Math.cos(a.ad(g/2)))),V+=b*a.aj(Math.cos(A))/2,V-=a.aj(Math.max(1,z/S/e))/2,V}}const Pe=Fe(9.314,3);function $e(d,e){const r=(e.roundZoom?Math.round:Math.floor)(d.zoom+a.aj(d.tileSize/e.tileSize));return Math.max(0,r)}function Ve(d,e){const r=d.getCameraFrustum(),l=d.getClippingPlane(),c=d.screenPointToMercatorCoordinate(d.getCameraPoint()),p=a.a0.fromLngLat(d.center,d.elevation);c.z=p.z+Math.cos(d.pitchInRadians)*d.cameraToCenterDistance/d.worldSize;const g=d.getCoveringTilesDetailsProvider(),b=g.allowVariableZoom(d,e),C=$e(d,e),S=e.minzoom||0,M=e.maxzoom!==void 0?e.maxzoom:d.maxZoom,z=Math.min(Math.max(0,C),M),A=Math.pow(2,z),R=[A*c.x,A*c.y,0],V=[A*p.x,A*p.y,0],Q=Math.hypot(p.x-c.x,p.y-c.y),J=Math.abs(p.z-c.z),ee=Math.hypot(Q,J),se=_e=>({zoom:0,x:0,y:0,wrap:_e,fullyVisible:!1}),fe=[],he=[];if(d.renderWorldCopies&&g.allowWorldCopies())for(let _e=1;_e<=3;_e++)fe.push(se(-_e)),fe.push(se(_e));for(fe.push(se(0));fe.length>0;){const _e=fe.pop(),ye=_e.x,ue=_e.y;let Ce=_e.fullyVisible;const Be={x:ye,y:ue,z:_e.zoom},De=g.getTileBoundingVolume(Be,_e.wrap,d.elevation,e);if(!Ce){const ht=xe(r,De,l);if(ht===0)continue;Ce=ht===2}const Re=g.distanceToTile2d(c.x,c.y,Be,De);let je=C;b&&(je=(e.calculateTileZoom||Pe)(d.zoom+a.aj(d.tileSize/e.tileSize),Re,J,ee,d.fov)),je=(e.roundZoom?Math.round:Math.floor)(je),je=Math.max(0,je);const ft=Math.min(je,M);if(_e.wrap=g.getWrap(p,Be,_e.wrap),_e.zoom>=ft){if(_e.zoom<S)continue;const ht=z-_e.zoom,tt=R[0]-.5-(ye<<ht),Ct=R[1]-.5-(ue<<ht),Zt=e.reparseOverscaled?Math.max(_e.zoom,je):_e.zoom;he.push({tileID:new a.Z(_e.zoom===M?Zt:_e.zoom,_e.wrap,_e.zoom,ye,ue),distanceSq:a.ak([V[0]-.5-ye,V[1]-.5-ue]),tileDistanceToCamera:Math.sqrt(tt*tt+Ct*Ct)})}else for(let ht=0;ht<4;ht++)fe.push({zoom:_e.zoom+1,x:(ye<<1)+ht%2,y:(ue<<1)+(ht>>1),wrap:_e.wrap,fullyVisible:Ce})}return he.sort((_e,ye)=>_e.distanceSq-ye.distanceSq).map(_e=>_e.tileID)}const Ie=a.a1.fromPoints([new a.P(0,0),new a.P(a.$,a.$)]);class Ye extends a.E{constructor(e,r,l){super(),this.id=e,this.dispatcher=l,this.on("data",c=>this._dataHandler(c)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((c,p,g,b)=>{const C=new(pt(p.type))(c,p,g,b);if(C.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${C.id}`);return C})(e,r,l,this),this._tiles={},this._cache=new Kr(0,c=>this._unloadTile(c)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ln,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,r,l){return a._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,r,l)}catch(c){e.state="errored",c.status!==404?this._source.fire(new a.k(c,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new a.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const l=this._tiles[r];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(ve).map(e=>e.key)}getRenderableIds(e){const r=[];for(const l in this._tiles)this._isIdRenderable(l,e)&&r.push(this._tiles[l]);return e?r.sort((l,c)=>{const p=l.tileID,g=c.tileID,b=new a.P(p.canonical.x,p.canonical.y)._rotate(-this.transform.bearingInRadians),C=new a.P(g.canonical.x,g.canonical.y)._rotate(-this.transform.bearingInRadians);return p.overscaledZ-g.overscaledZ||C.y-b.y||C.x-b.x}).map(l=>l.tileID.key):r.map(l=>l.tileID).sort(ve).map(l=>l.key)}hasRenderableParent(e){const r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)e?this._reloadTile(r,"expired"):this._tiles[r].state!=="errored"&&this._reloadTile(r,"reloading")}}_reloadTile(e,r){return a._(this,void 0,void 0,function*(){const l=this._tiles[e];l&&(l.state!=="loading"&&(l.state=r),yield this._loadTile(l,e,r))})}_tileLoaded(e,r,l){e.timeAdded=oe.now(),l==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new a.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const r=this.getRenderableIds();for(let c=0;c<r.length;c++){const p=r[c];if(e.neighboringTiles&&e.neighboringTiles[p]){const g=this.getTileByID(p);l(e,g),l(g,e)}}function l(c,p){c.needsHillshadePrepare=!0,c.needsTerrainPrepare=!0;let g=p.tileID.canonical.x-c.tileID.canonical.x;const b=p.tileID.canonical.y-c.tileID.canonical.y,C=Math.pow(2,c.tileID.canonical.z),S=p.tileID.key;g===0&&b===0||Math.abs(b)>1||(Math.abs(g)>1&&(Math.abs(g+C)===1?g+=C:Math.abs(g-C)===1&&(g-=C)),p.dem&&c.dem&&(c.dem.backfillBorder(p.dem,g,b),c.neighboringTiles&&c.neighboringTiles[S]&&(c.neighboringTiles[S].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,l,c){for(const p in this._tiles){let g=this._tiles[p];if(c[p]||!g.hasData()||g.tileID.overscaledZ<=r||g.tileID.overscaledZ>l)continue;let b=g.tileID;for(;g&&g.tileID.overscaledZ>r+1;){const S=g.tileID.scaledTo(g.tileID.overscaledZ-1);g=this._tiles[S.key],g&&g.hasData()&&(b=S)}let C=b;for(;C.overscaledZ>r;)if(C=C.scaledTo(C.overscaledZ-1),e[C.key]||e[C.canonical.key]){c[b.key]=b;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){const l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=r?l:null}for(let l=e.overscaledZ-1;l>=r;l--){const c=e.scaledTo(l),p=this._getLoadedTile(c);if(p)return p}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const r=Math.ceil(e.width/this._source.tileSize)+1,l=Math.ceil(e.height/this._source.tileSize)+1,c=Math.floor(r*l*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),p=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,c):c;this._cache.setMaxSize(p)}handleWrapJump(e){const r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){const l={};for(const c in this._tiles){const p=this._tiles[c];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+r),l[p.tileID.key]=p}this._tiles=l;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(c,this._tiles[c])}}_updateCoveredAndRetainedTiles(e,r,l,c,p,g){const b={},C={},S=Object.keys(e),M=oe.now();for(const z of S){const A=e[z],R=this._tiles[z];if(!R||R.fadeEndTime!==0&&R.fadeEndTime<=M)continue;const V=this.findLoadedParent(A,r),Q=this.findLoadedSibling(A),J=V||Q||null;J&&(this._addTile(J.tileID),b[J.tileID.key]=J.tileID),C[z]=A}this._retainLoadedChildren(C,c,l,e);for(const z in b)e[z]||(this._coveredTiles[z]=!0,e[z]=b[z]);if(g){const z={},A={};for(const R of p)this._tiles[R.key].hasData()?z[R.key]=R:A[R.key]=R;for(const R in A){const V=A[R].children(this._source.maxzoom);this._tiles[V[0].key]&&this._tiles[V[1].key]&&this._tiles[V[2].key]&&this._tiles[V[3].key]&&(z[V[0].key]=e[V[0].key]=V[0],z[V[1].key]=e[V[1].key]=V[1],z[V[2].key]=e[V[2].key]=V[2],z[V[3].key]=e[V[3].key]=V[3],delete A[R])}for(const R in A){const V=A[R],Q=this.findLoadedParent(V,this._source.minzoom),J=this.findLoadedSibling(V),ee=Q||J||null;if(ee){z[ee.tileID.key]=e[ee.tileID.key]=ee.tileID;for(const se in z)z[se].isChildOf(ee.tileID)&&delete z[se]}}for(const R in this._tiles)z[R]||(this._coveredTiles[R]=!0)}}update(e,r){if(!this._sourceLoaded||this._paused)return;let l;this.transform=e,this.terrain=r,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new a.Z(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y)):(l=Ve(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:r,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(l=l.filter(M=>this._source.hasTile(M)))):l=[];const c=$e(e,this._source),p=Math.max(c-Ye.maxOverzooming,this._source.minzoom),g=Math.max(c+Ye.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const M={};for(const z of l)if(z.canonical.z>this._source.minzoom){const A=z.scaledTo(z.canonical.z-1);M[A.key]=A;const R=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));M[R.key]=R}l=l.concat(Object.values(M))}const b=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,b&&this.fire(new a.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const C=this._updateRetainedTiles(l,c);yt(this._source.type)&&this._updateCoveredAndRetainedTiles(C,p,g,c,l,r);for(const M in C)this._tiles[M].clearFadeHold();const S=a.al(this._tiles,C);for(const M of S){const z=this._tiles[M];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(M)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,r){var l;const c={},p={},g=Math.max(r-Ye.maxOverzooming,this._source.minzoom),b=Math.max(r+Ye.maxUnderzooming,this._source.minzoom),C={};for(const S of e){const M=this._addTile(S);c[S.key]=S,M.hasData()||r<this._source.maxzoom&&(C[S.key]=S)}this._retainLoadedChildren(C,r,b,c);for(const S of e){let M=this._tiles[S.key];if(M.hasData())continue;if(r+1>this._source.maxzoom){const A=S.children(this._source.maxzoom)[0],R=this.getTile(A);if(R&&R.hasData()){c[A.key]=A;continue}}else{const A=S.children(this._source.maxzoom);if(c[A[0].key]&&c[A[1].key]&&c[A[2].key]&&c[A[3].key])continue}let z=M.wasRequested();for(let A=S.overscaledZ-1;A>=g;--A){const R=S.scaledTo(A);if(p[R.key])break;if(p[R.key]=!0,M=this.getTile(R),!M&&z&&(M=this._addTile(R)),M){const V=M.hasData();if((V||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||z)&&(c[R.key]=R),z=M.wasRequested(),V)break}}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const r=[];let l,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){l=this._loadedParentTiles[c.key];break}r.push(c.key);const p=c.scaledTo(c.overscaledZ-1);if(l=this._getLoadedTile(p),l)break;c=p}for(const p of r)this._loadedParentTiles[p]=l}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const r=this._tiles[e].tileID,l=this._getLoadedTile(r);this._loadedSiblingTiles[r.key]=l}}_addTile(e){let r=this._tiles[e.key];if(r)return r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const l=r;return r||(r=new Ut(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(r,e.key,r.state)),r.uses++,this._tiles[e.key]=r,l||this._source.fire(new a.l("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const l=r.getExpiryTimeout();l&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},l))}refreshTiles(e){for(const r in this._tiles)(this._isIdRenderable(r)||this._tiles[r].state=="errored")&&e.some(l=>l.equals(this._tiles[r].tileID.canonical))&&this._reloadTile(r,"expired")}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}_dataHandler(e){const r=e.sourceDataType;e.dataType==="source"&&r==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&r==="content"&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,r,l){const c=[],p=this.transform;if(!p)return c;const g=p.getCoveringTilesDetailsProvider().allowWorldCopies(),b=l?p.getCameraQueryGeometry(e):e,C=R=>p.screenPointToMercatorCoordinate(R,this.terrain),S=this.transformBbox(e,C,!g),M=this.transformBbox(b,C,!g),z=this.getIds(),A=a.a1.fromPoints(M);for(let R=0;R<z.length;R++){const V=this._tiles[z[R]];if(V.holdingForFade())continue;const Q=g?[V.tileID]:[V.tileID.unwrapTo(-1),V.tileID.unwrapTo(0)],J=Math.pow(2,p.zoom-V.tileID.overscaledZ),ee=r*V.queryPadding*a.$/V.tileSize/J;for(const se of Q){const fe=A.map(he=>se.getTilePoint(new a.a0(he.x,he.y)));if(fe.expandBy(ee),fe.intersects(Ie)){const he=S.map(ye=>se.getTilePoint(ye)),_e=M.map(ye=>se.getTilePoint(ye));c.push({tile:V,tileID:g?se:se.unwrapTo(0),queryGeometry:he,cameraQueryGeometry:_e,scale:J})}}}return c}transformBbox(e,r,l){let c=e.map(r);if(l){const p=a.a1.fromPoints(e);p.shrinkBy(.001*Math.min(p.width(),p.height()));const g=p.map(r);a.a1.fromPoints(c).covers(g)||(c=c.map(b=>b.x>.5?new a.a0(b.x-1,b.y,b.z):b))}return c}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map(l=>this._tiles[l].tileID);return this.transform&&this.transform.populateCache(r),r}hasTransition(){if(this._source.hasTransition())return!0;if(yt(this._source.type)){const e=oe.now();for(const r in this._tiles)if(this._tiles[r].fadeEndTime>=e)return!0}return!1}setFeatureState(e,r,l){this._state.updateState(e=e||"_geojsonTileLayer",r,l)}removeFeatureState(e,r,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,l)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,l){const c=this._tiles[e];c&&c.setDependencies(r,l)}reloadTilesForDependencies(e,r){for(const l in this._tiles)this._tiles[l].hasDependency(e,r)&&this._reloadTile(l,"reloading");this._cache.filter(l=>!l.hasDependency(e,r))}}function ve(d,e){const r=Math.abs(2*d.wrap)-+(d.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return d.overscaledZ-e.overscaledZ||l-r||e.canonical.y-d.canonical.y||e.canonical.x-d.canonical.x}function yt(d){return d==="raster"||d==="image"||d==="video"}Ye.maxOverzooming=10,Ye.maxUnderzooming=3;class Rt{constructor(e,r){this.reset(e,r)}reset(e,r){this.points=e||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=a.ag(e,0,1);let r=1,l=this._distances[r];const c=e*this.paddedLength+this.padding;for(;l<c&&r<this._distances.length;)l=this._distances[++r];const p=r-1,g=this._distances[p],b=l-g,C=b>0?(c-g)/b:0;return this.points[p].mult(1-C).add(this.points[r].mult(C))}}function xt(d,e){let r=!0;return d==="always"||d!=="never"&&e!=="never"||(r=!1),r}class Mt{constructor(e,r,l){const c=this.boxCells=[],p=this.circleCells=[];this.xCellCount=Math.ceil(e/l),this.yCellCount=Math.ceil(r/l);for(let g=0;g<this.xCellCount*this.yCellCount;g++)c.push([]),p.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=r,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,r,l,c,p){this._forEachCell(r,l,c,p,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(r),this.bboxes.push(l),this.bboxes.push(c),this.bboxes.push(p)}insertCircle(e,r,l,c){this._forEachCell(r-c,l-c,r+c,l+c,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(r),this.circles.push(l),this.circles.push(c)}_insertBoxCell(e,r,l,c,p,g){this.boxCells[p].push(g)}_insertCircleCell(e,r,l,c,p,g){this.circleCells[p].push(g)}_query(e,r,l,c,p,g,b){if(l<0||e>this.width||c<0||r>this.height)return[];const C=[];if(e<=0&&r<=0&&this.width<=l&&this.height<=c){if(p)return[{key:null,x1:e,y1:r,x2:l,y2:c}];for(let S=0;S<this.boxKeys.length;S++)C.push({key:this.boxKeys[S],x1:this.bboxes[4*S],y1:this.bboxes[4*S+1],x2:this.bboxes[4*S+2],y2:this.bboxes[4*S+3]});for(let S=0;S<this.circleKeys.length;S++){const M=this.circles[3*S],z=this.circles[3*S+1],A=this.circles[3*S+2];C.push({key:this.circleKeys[S],x1:M-A,y1:z-A,x2:M+A,y2:z+A})}}else this._forEachCell(e,r,l,c,this._queryCell,C,{hitTest:p,overlapMode:g,seenUids:{box:{},circle:{}}},b);return C}query(e,r,l,c){return this._query(e,r,l,c,!1,null)}hitTest(e,r,l,c,p,g){return this._query(e,r,l,c,!0,p,g).length>0}hitTestCircle(e,r,l,c,p){const g=e-l,b=e+l,C=r-l,S=r+l;if(b<0||g>this.width||S<0||C>this.height)return!1;const M=[];return this._forEachCell(g,C,b,S,this._queryCellCircle,M,{hitTest:!0,overlapMode:c,circle:{x:e,y:r,radius:l},seenUids:{box:{},circle:{}}},p),M.length>0}_queryCell(e,r,l,c,p,g,b,C){const{seenUids:S,hitTest:M,overlapMode:z}=b,A=this.boxCells[p];if(A!==null){const V=this.bboxes;for(const Q of A)if(!S.box[Q]){S.box[Q]=!0;const J=4*Q,ee=this.boxKeys[Q];if(e<=V[J+2]&&r<=V[J+3]&&l>=V[J+0]&&c>=V[J+1]&&(!C||C(ee))&&(!M||!xt(z,ee.overlapMode))&&(g.push({key:ee,x1:V[J],y1:V[J+1],x2:V[J+2],y2:V[J+3]}),M))return!0}}const R=this.circleCells[p];if(R!==null){const V=this.circles;for(const Q of R)if(!S.circle[Q]){S.circle[Q]=!0;const J=3*Q,ee=this.circleKeys[Q];if(this._circleAndRectCollide(V[J],V[J+1],V[J+2],e,r,l,c)&&(!C||C(ee))&&(!M||!xt(z,ee.overlapMode))){const se=V[J],fe=V[J+1],he=V[J+2];if(g.push({key:ee,x1:se-he,y1:fe-he,x2:se+he,y2:fe+he}),M)return!0}}}return!1}_queryCellCircle(e,r,l,c,p,g,b,C){const{circle:S,seenUids:M,overlapMode:z}=b,A=this.boxCells[p];if(A!==null){const V=this.bboxes;for(const Q of A)if(!M.box[Q]){M.box[Q]=!0;const J=4*Q,ee=this.boxKeys[Q];if(this._circleAndRectCollide(S.x,S.y,S.radius,V[J+0],V[J+1],V[J+2],V[J+3])&&(!C||C(ee))&&!xt(z,ee.overlapMode))return g.push(!0),!0}}const R=this.circleCells[p];if(R!==null){const V=this.circles;for(const Q of R)if(!M.circle[Q]){M.circle[Q]=!0;const J=3*Q,ee=this.circleKeys[Q];if(this._circlesCollide(V[J],V[J+1],V[J+2],S.x,S.y,S.radius)&&(!C||C(ee))&&!xt(z,ee.overlapMode))return g.push(!0),!0}}}_forEachCell(e,r,l,c,p,g,b,C){const S=this._convertToXCellCoord(e),M=this._convertToYCellCoord(r),z=this._convertToXCellCoord(l),A=this._convertToYCellCoord(c);for(let R=S;R<=z;R++)for(let V=M;V<=A;V++)if(p.call(this,e,r,l,c,this.xCellCount*V+R,g,b,C))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,r,l,c,p,g){const b=c-e,C=p-r,S=l+g;return S*S>b*b+C*C}_circleAndRectCollide(e,r,l,c,p,g,b){const C=(g-c)/2,S=Math.abs(e-(c+C));if(S>C+l)return!1;const M=(b-p)/2,z=Math.abs(r-(p+M));if(z>M+l)return!1;if(S<=C||z<=M)return!0;const A=S-C,R=z-M;return A*A+R*R<=l*l}}function Ot(d,e,r){const l=a.L();if(!d){const{vecSouth:z,vecEast:A}=ur(e),R=K();R[0]=A[0],R[1]=A[1],R[2]=z[0],R[3]=z[1],c=R,(M=(g=(p=R)[0])*(S=p[3])-(C=p[2])*(b=p[1]))&&(c[0]=S*(M=1/M),c[1]=-b*M,c[2]=-C*M,c[3]=g*M),l[0]=R[0],l[1]=R[1],l[4]=R[2],l[5]=R[3]}var c,p,g,b,C,S,M;return a.N(l,l,[1/r,1/r,1]),l}function br(d,e,r,l){if(d){const c=a.L();if(!e){const{vecSouth:p,vecEast:g}=ur(r);c[0]=g[0],c[1]=g[1],c[4]=p[0],c[5]=p[1]}return a.N(c,c,[l,l,1]),c}return r.pixelsToClipSpaceMatrix}function ur(d){const e=Math.cos(d.rollInRadians),r=Math.sin(d.rollInRadians),l=Math.cos(d.pitchInRadians),c=Math.cos(d.bearingInRadians),p=Math.sin(d.bearingInRadians),g=a.aq();g[0]=-c*l*r-p*e,g[1]=-p*l*r+c*e;const b=a.ar(g);b<1e-9?a.as(g):a.at(g,g,1/b);const C=a.aq();C[0]=c*l*e-p*r,C[1]=p*l*e+c*r;const S=a.ar(C);return S<1e-9?a.as(C):a.at(C,C,1/S),{vecEast:C,vecSouth:g}}function lr(d,e,r,l){let c;l?(c=[d,e,l(d,e),1],a.av(c,c,r)):(c=[d,e,0,1],Yn(c,c,r));const p=c[3];return{point:new a.P(c[0]/p,c[1]/p),signedDistanceFromCamera:p,isOccluded:!1}}function Bt(d,e){return .5+d/e*.5}function rr(d,e){return d.x>=-e[0]&&d.x<=e[0]&&d.y>=-e[1]&&d.y<=e[1]}function Yr(d,e,r,l,c,p,g,b,C,S,M,z,A){const R=r?d.textSizeData:d.iconSizeData,V=a.am(R,e.transform.zoom),Q=[256/e.width*2+1,256/e.height*2+1],J=r?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;J.clear();const ee=d.lineVertexArray,se=r?d.text.placedSymbolArray:d.icon.placedSymbolArray,fe=e.transform.width/e.transform.height;let he=!1;for(let _e=0;_e<se.length;_e++){const ye=se.get(_e);if(ye.hidden||ye.writingMode===a.an.vertical&&!he){vn(ye.numGlyphs,J);continue}he=!1;const ue=new a.P(ye.anchorX,ye.anchorY),Ce={getElevation:A,pitchedLabelPlaneMatrix:l,lineVertexArray:ee,pitchWithMap:p,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:ue,unwrappedTileID:C,width:S,height:M,translation:z},Be=Wt(ye.anchorX,ye.anchorY,Ce);if(!rr(Be.point,Q)){vn(ye.numGlyphs,J);continue}const De=Bt(e.transform.cameraToCenterDistance,Be.signedDistanceFromCamera),Re=a.ao(R,V,ye),je=p?Re*e.transform.getPitchedTextCorrection(ye.anchorX,ye.anchorY,C)/De:Re*De,ft=Tr({projectionContext:Ce,pitchedLabelPlaneMatrixInverse:c,symbol:ye,fontSize:je,flip:!1,keepUpright:g,glyphOffsetArray:d.glyphOffsetArray,dynamicLayoutVertexArray:J,aspectRatio:fe,rotateToLine:b});he=ft.useVertical,(ft.notEnoughRoom||he||ft.needsFlipping&&Tr({projectionContext:Ce,pitchedLabelPlaneMatrixInverse:c,symbol:ye,fontSize:je,flip:!0,keepUpright:g,glyphOffsetArray:d.glyphOffsetArray,dynamicLayoutVertexArray:J,aspectRatio:fe,rotateToLine:b}).notEnoughRoom)&&vn(ye.numGlyphs,J)}r?d.text.dynamicLayoutVertexBuffer.updateData(J):d.icon.dynamicLayoutVertexBuffer.updateData(J)}function ct(d,e,r,l,c,p,g,b){const C=p.glyphStartIndex+p.numGlyphs,S=p.lineStartIndex,M=p.lineStartIndex+p.lineLength,z=e.getoffsetX(p.glyphStartIndex),A=e.getoffsetX(C-1),R=cn(d*z,r,l,c,p.segment,S,M,b,g);if(!R)return null;const V=cn(d*A,r,l,c,p.segment,S,M,b,g);return V?b.projectionCache.anyProjectionOccluded?null:{first:R,last:V}:null}function ai(d,e,r,l){return d===a.an.horizontal&&Math.abs(r.y-e.y)>Math.abs(r.x-e.x)*l?{useVertical:!0}:(d===a.an.vertical?e.y<r.y:e.x>r.x)?{needsFlipping:!0}:null}function Tr(d){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:r,symbol:l,fontSize:c,flip:p,keepUpright:g,glyphOffsetArray:b,dynamicLayoutVertexArray:C,aspectRatio:S,rotateToLine:M}=d,z=c/24,A=l.lineOffsetX*z,R=l.lineOffsetY*z;let V;if(l.numGlyphs>1){const Q=l.glyphStartIndex+l.numGlyphs,J=l.lineStartIndex,ee=l.lineStartIndex+l.lineLength,se=ct(z,b,A,R,p,l,M,e);if(!se)return{notEnoughRoom:!0};const fe=qt(se.first.point.x,se.first.point.y,e,r),he=qt(se.last.point.x,se.last.point.y,e,r);if(g&&!p){const _e=ai(l.writingMode,fe,he,S);if(_e)return _e}V=[se.first];for(let _e=l.glyphStartIndex+1;_e<Q-1;_e++){const ye=cn(z*b.getoffsetX(_e),A,R,p,l.segment,J,ee,e,M);if(!ye)return{notEnoughRoom:!0};V.push(ye)}V.push(se.last)}else{if(g&&!p){const J=mt(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,ee=l.lineStartIndex+l.segment+1,se=new a.P(e.lineVertexArray.getx(ee),e.lineVertexArray.gety(ee)),fe=mt(se.x,se.y,e),he=fe.signedDistanceFromCamera>0?fe.point:Dn(e.tileAnchorPoint,se,J,1,e),_e=qt(J.x,J.y,e,r),ye=qt(he.x,he.y,e,r),ue=ai(l.writingMode,_e,ye,S);if(ue)return ue}const Q=cn(z*b.getoffsetX(l.glyphStartIndex),A,R,p,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,e,M);if(!Q||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};V=[Q]}for(const Q of V)a.au(C,Q.point,Q.angle);return{}}function Dn(d,e,r,l,c){const p=d.add(d.sub(e)._unit()),g=mt(p.x,p.y,c).point,b=r.sub(g);return r.add(b._mult(l/b.mag()))}function Kn(d,e,r){const l=e.projectionCache;if(l.projections[d])return l.projections[d];const c=new a.P(e.lineVertexArray.getx(d),e.lineVertexArray.gety(d)),p=mt(c.x,c.y,e);if(p.signedDistanceFromCamera>0)return l.projections[d]=p.point,l.anyProjectionOccluded=l.anyProjectionOccluded||p.isOccluded,p.point;const g=d-r.direction;return Dn(r.distanceFromAnchor===0?e.tileAnchorPoint:new a.P(e.lineVertexArray.getx(g),e.lineVertexArray.gety(g)),c,r.previousVertex,r.absOffsetX-r.distanceFromAnchor+1,e)}function mt(d,e,r){const l=d+r.translation[0],c=e+r.translation[1];let p;return r.pitchWithMap?(p=lr(l,c,r.pitchedLabelPlaneMatrix,r.getElevation),p.isOccluded=!1):(p=r.transform.projectTileCoordinates(l,c,r.unwrappedTileID,r.getElevation),p.point.x=(.5*p.point.x+.5)*r.width,p.point.y=(.5*-p.point.y+.5)*r.height),p}function qt(d,e,r,l){if(r.pitchWithMap){const c=[d,e,0,1];return a.av(c,c,l),r.transform.projectTileCoordinates(c[0]/c[3],c[1]/c[3],r.unwrappedTileID,r.getElevation).point}return{x:d/r.width*2-1,y:e/r.height*2-1}}function Wt(d,e,r){return r.transform.projectTileCoordinates(d,e,r.unwrappedTileID,r.getElevation)}function Ri(d,e,r){return d._unit()._perp()._mult(e*r)}function sa(d,e,r,l,c,p,g,b,C){if(b.projectionCache.offsets[d])return b.projectionCache.offsets[d];const S=r.add(e);if(d+C.direction<l||d+C.direction>=c)return b.projectionCache.offsets[d]=S,S;const M=Kn(d+C.direction,b,C),z=Ri(M.sub(r),g,C.direction),A=r.add(z),R=M.add(z);return b.projectionCache.offsets[d]=a.aw(p,S,A,R)||S,b.projectionCache.offsets[d]}function cn(d,e,r,l,c,p,g,b,C){const S=l?d-e:d+e;let M=S>0?1:-1,z=0;l&&(M*=-1,z=Math.PI),M<0&&(z+=Math.PI);let A,R=M>0?p+c:p+c+1;b.projectionCache.cachedAnchorPoint?A=b.projectionCache.cachedAnchorPoint:(A=mt(b.tileAnchorPoint.x,b.tileAnchorPoint.y,b).point,b.projectionCache.cachedAnchorPoint=A);let V,Q,J=A,ee=A,se=0,fe=0;const he=Math.abs(S),_e=[];let ye;for(;se+fe<=he;){if(R+=M,R<p||R>=g)return null;se+=fe,ee=J,Q=V;const Be={absOffsetX:he,direction:M,distanceFromAnchor:se,previousVertex:ee};if(J=Kn(R,b,Be),r===0)_e.push(ee),ye=J.sub(ee);else{let De;const Re=J.sub(ee);De=Re.mag()===0?Ri(Kn(R+M,b,Be).sub(J),r,M):Ri(Re,r,M),Q||(Q=ee.add(De)),V=sa(R,De,J,p,g,Q,r,b,Be),_e.push(Q),ye=V.sub(Q)}fe=ye.mag()}const ue=ye._mult((he-se)/fe)._add(Q||ee),Ce=z+Math.atan2(J.y-ee.y,J.x-ee.x);return _e.push(ue),{point:ue,angle:C?Ce:0,path:_e}}const Ht=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function vn(d,e){for(let r=0;r<d;r++){const l=e.length;e.resize(l+4),e.float32.set(Ht,3*l)}}function Yn(d,e,r){const l=e[0],c=e[1];return d[0]=r[0]*l+r[4]*c+r[12],d[1]=r[1]*l+r[5]*c+r[13],d[3]=r[3]*l+r[7]*c+r[15],d}const jr=100;class so{constructor(e,r=new Mt(e.width+200,e.height+200,25),l=new Mt(e.width+200,e.height+200,25)){this.transform=e,this.grid=r,this.ignoredGrid=l,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+jr,this.screenBottomBoundary=e.height+jr,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,r,l,c,p,g,b,C,S,M,z,A){const R=this.projectAndGetPerspectiveRatio(e.anchorPointX+C[0],e.anchorPointY+C[1],p,M,A),V=l*R.perspectiveRatio;let Q;if(g||b)Q=this._projectCollisionBox(e,V,c,p,g,b,C,R,M,z,A);else{const ye=R.x+(z?z.x*V:0),ue=R.y+(z?z.y*V:0);Q={allPointsOccluded:!1,box:[ye+e.x1*V,ue+e.y1*V,ye+e.x2*V,ue+e.y2*V]}}const[J,ee,se,fe]=Q.box,he=g?Q.allPointsOccluded:R.isOccluded;let _e=he;return _e||(_e=R.perspectiveRatio<this.perspectiveRatioCutoff),_e||(_e=!this.isInsideGrid(J,ee,se,fe)),_e||r!=="always"&&this.grid.hitTest(J,ee,se,fe,r,S)?{box:[J,ee,se,fe],placeable:!1,offscreen:!1,occluded:he}:{box:[J,ee,se,fe],placeable:!0,offscreen:this.isOffscreen(J,ee,se,fe),occluded:he}}placeCollisionCircles(e,r,l,c,p,g,b,C,S,M,z,A,R,V){const Q=[],J=new a.P(r.anchorX,r.anchorY),ee=this.getPerspectiveRatio(J.x,J.y,g,V),se=(S?p*this.transform.getPitchedTextCorrection(r.anchorX,r.anchorY,g)/ee:p*ee)/a.aA,fe={getElevation:V,pitchedLabelPlaneMatrix:b,lineVertexArray:l,pitchWithMap:S,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:J,unwrappedTileID:g,width:this.transform.width,height:this.transform.height,translation:R},he=ct(se,c,r.lineOffsetX*se,r.lineOffsetY*se,!1,r,!1,fe);let _e=!1,ye=!1,ue=!0;if(he){const Ce=.5*z*ee+A,Be=new a.P(-100,-100),De=new a.P(this.screenRightBoundary,this.screenBottomBoundary),Re=new Rt,je=he.first,ft=he.last;let ht=[];for(let Zt=je.path.length-1;Zt>=1;Zt--)ht.push(je.path[Zt]);for(let Zt=1;Zt<ft.path.length;Zt++)ht.push(ft.path[Zt]);const tt=2.5*Ce;if(S){const Zt=this.projectPathToScreenSpace(ht,fe);ht=Zt.some(hr=>hr.signedDistanceFromCamera<=0)?[]:Zt.map(hr=>hr.point)}let Ct=[];if(ht.length>0){const Zt=ht[0].clone(),hr=ht[0].clone();for(let Mr=1;Mr<ht.length;Mr++)Zt.x=Math.min(Zt.x,ht[Mr].x),Zt.y=Math.min(Zt.y,ht[Mr].y),hr.x=Math.max(hr.x,ht[Mr].x),hr.y=Math.max(hr.y,ht[Mr].y);Ct=Zt.x>=Be.x&&hr.x<=De.x&&Zt.y>=Be.y&&hr.y<=De.y?[ht]:hr.x<Be.x||Zt.x>De.x||hr.y<Be.y||Zt.y>De.y?[]:a.ax([ht],Be.x,Be.y,De.x,De.y)}for(const Zt of Ct){Re.reset(Zt,.25*Ce);let hr=0;hr=Re.length<=.5*Ce?1:Math.ceil(Re.paddedLength/tt)+1;for(let Mr=0;Mr<hr;Mr++){const mr=Mr/Math.max(hr-1,1),Ir=Re.lerp(mr),gr=Ir.x+jr,_r=Ir.y+jr;Q.push(gr,_r,Ce,0);const yr=gr-Ce,ci=_r-Ce,nr=gr+Ce,ei=_r+Ce;if(ue=ue&&this.isOffscreen(yr,ci,nr,ei),ye=ye||this.isInsideGrid(yr,ci,nr,ei),e!=="always"&&this.grid.hitTestCircle(gr,_r,Ce,e,M)&&(_e=!0,!C))return{circles:[],offscreen:!1,collisionDetected:_e}}}}return{circles:!C&&_e||!ye||ee<this.perspectiveRatioCutoff?[]:Q,offscreen:ue,collisionDetected:_e}}projectPathToScreenSpace(e,r){const l=function(c,p){const g=a.L();return a.ap(g,p.pitchedLabelPlaneMatrix),c.map(b=>{const C=lr(b.x,b.y,g,p.getElevation),S=p.transform.projectTileCoordinates(C.point.x,C.point.y,p.unwrappedTileID,p.getElevation);return S.point.x=(.5*S.point.x+.5)*p.width,S.point.y=(.5*-S.point.y+.5)*p.height,S})}(e,r);return function(c){let p=0,g=0,b=0,C=0;for(let S=0;S<c.length;S++)c[S].isOccluded?(b=S+1,C=0):(C++,C>g&&(g=C,p=b));return c.slice(p,p+g)}(l)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[],l=new a.a1;for(const z of e){const A=new a.P(z.x+jr,z.y+jr);l.extend(A),r.push(A)}const{minX:c,minY:p,maxX:g,maxY:b}=l,C=this.grid.query(c,p,g,b).concat(this.ignoredGrid.query(c,p,g,b)),S={},M={};for(const z of C){const A=z.key;if(S[A.bucketInstanceId]===void 0&&(S[A.bucketInstanceId]={}),S[A.bucketInstanceId][A.featureIndex])continue;const R=[new a.P(z.x1,z.y1),new a.P(z.x2,z.y1),new a.P(z.x2,z.y2),new a.P(z.x1,z.y2)];a.ay(r,R)&&(S[A.bucketInstanceId][A.featureIndex]=!0,M[A.bucketInstanceId]===void 0&&(M[A.bucketInstanceId]=[]),M[A.bucketInstanceId].push(A.featureIndex))}return M}insertCollisionBox(e,r,l,c,p,g){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:p,collisionGroupID:g,overlapMode:r},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,r,l,c,p,g){const b=l?this.ignoredGrid:this.grid,C={bucketInstanceId:c,featureIndex:p,collisionGroupID:g,overlapMode:r};for(let S=0;S<e.length;S+=4)b.insertCircle(C,e[S],e[S+1],e[S+2])}projectAndGetPerspectiveRatio(e,r,l,c,p){if(p){let g;c?(g=[e,r,c(e,r),1],a.av(g,g,p)):(g=[e,r,0,1],Yn(g,g,p));const b=g[3];return{x:(g[0]/b+1)/2*this.transform.width+jr,y:(-g[1]/b+1)/2*this.transform.height+jr,perspectiveRatio:.5+this.transform.cameraToCenterDistance/b*.5,isOccluded:!1,signedDistanceFromCamera:b}}{const g=this.transform.projectTileCoordinates(e,r,l,c);return{x:(g.point.x+1)/2*this.transform.width+jr,y:(1-g.point.y)/2*this.transform.height+jr,perspectiveRatio:.5+this.transform.cameraToCenterDistance/g.signedDistanceFromCamera*.5,isOccluded:g.isOccluded,signedDistanceFromCamera:g.signedDistanceFromCamera}}}getPerspectiveRatio(e,r,l,c){const p=this.transform.projectTileCoordinates(e,r,l,c);return .5+this.transform.cameraToCenterDistance/p.signedDistanceFromCamera*.5}isOffscreen(e,r,l,c){return l<jr||e>=this.screenRightBoundary||c<jr||r>this.screenBottomBoundary}isInsideGrid(e,r,l,c){return l>=0&&e<this.gridRightBoundary&&c>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const e=a.af([]);return a.M(e,e,[-100,-100,0]),e}_projectCollisionBox(e,r,l,c,p,g,b,C,S,M,z){let A=1,R=0,V=0,Q=1;const J=e.anchorPointX+b[0],ee=e.anchorPointY+b[1];if(g&&!p){const ht=this.projectAndGetPerspectiveRatio(J+1,ee,c,S,z),tt=ht.x-C.x,Ct=Math.atan((ht.y-C.y)/tt)+(tt<0?Math.PI:0),Zt=Math.sin(Ct),hr=Math.cos(Ct);A=hr,R=Zt,V=-Zt,Q=hr}else if(!g&&p){const ht=ur(this.transform);A=ht.vecEast[0],R=ht.vecEast[1],V=ht.vecSouth[0],Q=ht.vecSouth[1]}let se=C.x,fe=C.y,he=r;p&&(se=J,fe=ee,he=Math.pow(2,-(this.transform.zoom-l.overscaledZ)),he*=this.transform.getPitchedTextCorrection(J,ee,c),M||(he*=a.ag(.5+C.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),M&&(se+=A*M.x*he+V*M.y*he,fe+=R*M.x*he+Q*M.y*he);const _e=e.x1*he,ye=e.x2*he,ue=(_e+ye)/2,Ce=e.y1*he,Be=e.y2*he,De=(Ce+Be)/2,Re=[{offsetX:_e,offsetY:Ce},{offsetX:ue,offsetY:Ce},{offsetX:ye,offsetY:Ce},{offsetX:ye,offsetY:De},{offsetX:ye,offsetY:Be},{offsetX:ue,offsetY:Be},{offsetX:_e,offsetY:Be},{offsetX:_e,offsetY:De}];let je=[];for(const{offsetX:ht,offsetY:tt}of Re)je.push(new a.P(se+A*ht+V*tt,fe+R*ht+Q*tt));let ft=!1;if(p){const ht=je.map(tt=>this.projectAndGetPerspectiveRatio(tt.x,tt.y,c,S,z));ft=ht.some(tt=>!tt.isOccluded),je=ht.map(tt=>new a.P(tt.x,tt.y))}else ft=!0;return{box:a.az(je),allPointsOccluded:!ft}}}class oo{constructor(e,r,l,c){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?r:-r))):c&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class bn{constructor(e,r,l,c,p){this.text=new oo(e?e.text:null,r,l,p),this.icon=new oo(e?e.icon:null,r,c,p)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ao{constructor(e,r,l){this.text=e,this.icon=r,this.skipFade=l}}class Li{constructor(e,r,l,c,p){this.bucketInstanceId=e,this.featureIndex=r,this.sourceLayerIndex=l,this.bucketIndex=c,this.tileID=p}}class Sr{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const r=++this.maxGroupID;this.collisionGroups[e]={ID:r,predicate:l=>l.collisionGroupID===r}}return this.collisionGroups[e]}}function Hc(d,e,r,l,c){const{horizontalAlign:p,verticalAlign:g}=a.aG(d);return new a.P(-(p-.5)*e+l[0]*c,-(g-.5)*r+l[1]*c)}class lo{constructor(e,r,l,c,p){this.transform=e.clone(),this.terrain=r,this.collisionIndex=new so(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new Sr(c),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=p,p&&(p.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const r=this.terrain;return r?(l,c)=>r.getElevation(e,l,c):null}getBucketParts(e,r,l,c){const p=l.getBucket(r),g=l.latestFeatureIndex;if(!p||!g||r.id!==p.layerIds[0])return;const b=l.collisionBoxArray,C=p.layers[0].layout,S=p.layers[0].paint,M=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),z=l.tileSize/a.$,A=l.tileID.toUnwrapped(),R=C.get("text-rotation-alignment")==="map",V=a.aB(l,1,this.transform.zoom),Q=a.aC(this.collisionIndex.transform,l,S.get("text-translate"),S.get("text-translate-anchor")),J=a.aC(this.collisionIndex.transform,l,S.get("icon-translate"),S.get("icon-translate-anchor")),ee=Ot(R,this.transform,V);this.retainedQueryData[p.bucketInstanceId]=new Li(p.bucketInstanceId,g,p.sourceLayerIndex,p.index,l.tileID);const se={bucket:p,layout:C,translationText:Q,translationIcon:J,unwrappedTileID:A,pitchedLabelPlaneMatrix:ee,scale:M,textPixelRatio:z,holdingForFade:l.holdingForFade(),collisionBoxArray:b,partiallyEvaluatedTextSize:a.am(p.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(p.sourceID)};if(c)for(const fe of p.sortKeyRanges){const{sortKey:he,symbolInstanceStart:_e,symbolInstanceEnd:ye}=fe;e.push({sortKey:he,symbolInstanceStart:_e,symbolInstanceEnd:ye,parameters:se})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:p.symbolInstances.length,parameters:se})}attemptAnchorPlacement(e,r,l,c,p,g,b,C,S,M,z,A,R,V,Q,J,ee,se,fe,he){const _e=a.aD[e.textAnchor],ye=[e.textOffset0,e.textOffset1],ue=Hc(_e,l,c,ye,p),Ce=this.collisionIndex.placeCollisionBox(r,A,C,S,M,b,g,J,z.predicate,fe,ue,he);if((!se||this.collisionIndex.placeCollisionBox(se,A,C,S,M,b,g,ee,z.predicate,fe,ue,he).placeable)&&Ce.placeable){let Be;if(this.prevPlacement&&this.prevPlacement.variableOffsets[R.crossTileID]&&this.prevPlacement.placements[R.crossTileID]&&this.prevPlacement.placements[R.crossTileID].text&&(Be=this.prevPlacement.variableOffsets[R.crossTileID].anchor),R.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[R.crossTileID]={textOffset:ye,width:l,height:c,anchor:_e,textBoxScale:p,prevAnchor:Be},this.markUsedJustification(V,_e,R,Q),V.allowVerticalPlacement&&(this.markUsedOrientation(V,Q,R),this.placedOrientations[R.crossTileID]=Q),{shift:ue,placedGlyphBoxes:Ce}}}placeLayerBucketPart(e,r,l){const{bucket:c,layout:p,translationText:g,translationIcon:b,unwrappedTileID:C,pitchedLabelPlaneMatrix:S,textPixelRatio:M,holdingForFade:z,collisionBoxArray:A,partiallyEvaluatedTextSize:R,collisionGroup:V}=e.parameters,Q=p.get("text-optional"),J=p.get("icon-optional"),ee=a.aE(p,"text-overlap","text-allow-overlap"),se=ee==="always",fe=a.aE(p,"icon-overlap","icon-allow-overlap"),he=fe==="always",_e=p.get("text-rotation-alignment")==="map",ye=p.get("text-pitch-alignment")==="map",ue=p.get("icon-text-fit")!=="none",Ce=p.get("symbol-z-order")==="viewport-y",Be=se&&(he||!c.hasIconData()||J),De=he&&(se||!c.hasTextData()||Q);!c.collisionArrays&&A&&c.deserializeCollisionBoxes(A);const Re=this.retainedQueryData[c.bucketInstanceId].tileID,je=this._getTerrainElevationFunc(Re),ft=this.transform.getFastPathSimpleProjectionMatrix(Re),ht=(tt,Ct,Zt)=>{var hr,Mr;if(r[tt.crossTileID])return;if(z)return void(this.placements[tt.crossTileID]=new ao(!1,!1,!1));let mr=!1,Ir=!1,gr=!0,_r=null,yr={box:null,placeable:!1,offscreen:null,occluded:!1},ci={placeable:!1},nr=null,ei=null,hi=null,Nn=0,Un=0,$n=0;Ct.textFeatureIndex?Nn=Ct.textFeatureIndex:tt.useRuntimeCollisionCircles&&(Nn=tt.featureIndex),Ct.verticalTextFeatureIndex&&(Un=Ct.verticalTextFeatureIndex);const mn=Ct.textBox;if(mn){const Ii=Br=>{let xr=a.an.horizontal;if(c.allowVerticalPlacement&&!Br&&this.prevPlacement){const Ti=this.prevPlacement.placedOrientations[tt.crossTileID];Ti&&(this.placedOrientations[tt.crossTileID]=Ti,xr=Ti,this.markUsedOrientation(c,xr,tt))}return xr},Qi=(Br,xr)=>{if(c.allowVerticalPlacement&&tt.numVerticalGlyphVertices>0&&Ct.verticalTextBox){for(const Ti of c.writingModes)if(Ti===a.an.vertical?(yr=xr(),ci=yr):yr=Br(),yr&&yr.placeable)break}else yr=Br()},Zn=tt.textAnchorOffsetStartIndex,cs=tt.textAnchorOffsetEndIndex;if(cs===Zn){const Br=(xr,Ti)=>{const Wr=this.collisionIndex.placeCollisionBox(xr,ee,M,Re,C,ye,_e,g,V.predicate,je,void 0,ft);return Wr&&Wr.placeable&&(this.markUsedOrientation(c,Ti,tt),this.placedOrientations[tt.crossTileID]=Ti),Wr};Qi(()=>Br(mn,a.an.horizontal),()=>{const xr=Ct.verticalTextBox;return c.allowVerticalPlacement&&tt.numVerticalGlyphVertices>0&&xr?Br(xr,a.an.vertical):{box:null,offscreen:null}}),Ii(yr&&yr.placeable)}else{let Br=a.aD[(Mr=(hr=this.prevPlacement)===null||hr===void 0?void 0:hr.variableOffsets[tt.crossTileID])===null||Mr===void 0?void 0:Mr.anchor];const xr=(Wr,Nh,Xu)=>{const nc=Wr.x2-Wr.x1,Vo=Wr.y2-Wr.y1,qs=tt.textBoxScale,Tn=ue&&fe==="never"?Nh:null;let ui=null,Sn=ee==="never"?1:2,sc="never";Br&&Sn++;for(let Gn=0;Gn<Sn;Gn++){for(let oc=Zn;oc<cs;oc++){const ac=c.textAnchorOffsets.get(oc);if(Br&&ac.textAnchor!==Br)continue;const No=this.attemptAnchorPlacement(ac,Wr,nc,Vo,qs,_e,ye,M,Re,C,V,sc,tt,c,Xu,g,b,Tn,je);if(No&&(ui=No.placedGlyphBoxes,ui&&ui.placeable))return mr=!0,_r=No.shift,ui}Br?Br=null:sc=ee}return l&&!ui&&(ui={box:this.collisionIndex.placeCollisionBox(mn,"always",M,Re,C,ye,_e,g,V.predicate,je,void 0,ft).box,offscreen:!1,placeable:!1,occluded:!1}),ui};Qi(()=>xr(mn,Ct.iconBox,a.an.horizontal),()=>{const Wr=Ct.verticalTextBox;return c.allowVerticalPlacement&&(!yr||!yr.placeable)&&tt.numVerticalGlyphVertices>0&&Wr?xr(Wr,Ct.verticalIconBox,a.an.vertical):{box:null,occluded:!0,offscreen:null}}),yr&&(mr=yr.placeable,gr=yr.offscreen);const Ti=Ii(yr&&yr.placeable);if(!mr&&this.prevPlacement){const Wr=this.prevPlacement.variableOffsets[tt.crossTileID];Wr&&(this.variableOffsets[tt.crossTileID]=Wr,this.markUsedJustification(c,Wr.anchor,tt,Ti))}}}if(nr=yr,mr=nr&&nr.placeable,gr=nr&&nr.offscreen,tt.useRuntimeCollisionCircles){const Ii=c.text.placedSymbolArray.get(tt.centerJustifiedTextSymbolIndex),Qi=a.ao(c.textSizeData,R,Ii),Zn=p.get("text-padding");ei=this.collisionIndex.placeCollisionCircles(ee,Ii,c.lineVertexArray,c.glyphOffsetArray,Qi,C,S,l,ye,V.predicate,tt.collisionCircleDiameter,Zn,g,je),ei.circles.length&&ei.collisionDetected&&!l&&a.w("Collisions detected, but collision boxes are not shown"),mr=se||ei.circles.length>0&&!ei.collisionDetected,gr=gr&&ei.offscreen}if(Ct.iconFeatureIndex&&($n=Ct.iconFeatureIndex),Ct.iconBox){const Ii=Qi=>this.collisionIndex.placeCollisionBox(Qi,fe,M,Re,C,ye,_e,b,V.predicate,je,ue&&_r?_r:void 0,ft);ci&&ci.placeable&&Ct.verticalIconBox?(hi=Ii(Ct.verticalIconBox),Ir=hi.placeable):(hi=Ii(Ct.iconBox),Ir=hi.placeable),gr=gr&&hi.offscreen}const Oo=Q||tt.numHorizontalGlyphVertices===0&&tt.numVerticalGlyphVertices===0,jo=J||tt.numIconVertices===0;Oo||jo?jo?Oo||(Ir=Ir&&mr):mr=Ir&&mr:Ir=mr=Ir&&mr;const Gs=Ir&&hi.placeable;if(mr&&nr.placeable&&this.collisionIndex.insertCollisionBox(nr.box,ee,p.get("text-ignore-placement"),c.bucketInstanceId,ci&&ci.placeable&&Un?Un:Nn,V.ID),Gs&&this.collisionIndex.insertCollisionBox(hi.box,fe,p.get("icon-ignore-placement"),c.bucketInstanceId,$n,V.ID),ei&&mr&&this.collisionIndex.insertCollisionCircles(ei.circles,ee,p.get("text-ignore-placement"),c.bucketInstanceId,Nn,V.ID),l&&this.storeCollisionData(c.bucketInstanceId,Zt,Ct,nr,hi,ei),tt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(c.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[tt.crossTileID]=new ao((mr||Be)&&!(nr!=null&&nr.occluded),(Ir||De)&&!(hi!=null&&hi.occluded),gr||c.justReloaded),r[tt.crossTileID]=!0};if(Ce){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const tt=c.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Ct=tt.length-1;Ct>=0;--Ct){const Zt=tt[Ct];ht(c.symbolInstances.get(Zt),c.collisionArrays[Zt],Zt)}}else for(let tt=e.symbolInstanceStart;tt<e.symbolInstanceEnd;tt++)ht(c.symbolInstances.get(tt),c.collisionArrays[tt],tt);c.justReloaded=!1}storeCollisionData(e,r,l,c,p,g){if(l.textBox||l.iconBox){let b,C;this.collisionBoxArrays.has(e)?b=this.collisionBoxArrays.get(e):(b=new Map,this.collisionBoxArrays.set(e,b)),b.has(r)?C=b.get(r):(C={text:null,icon:null},b.set(r,C)),l.textBox&&(C.text=c.box),l.iconBox&&(C.icon=p.box)}if(g){let b=this.collisionCircleArrays[e];b===void 0&&(b=this.collisionCircleArrays[e]=[]);for(let C=0;C<g.circles.length;C+=4)b.push(g.circles[C+0]-jr),b.push(g.circles[C+1]-jr),b.push(g.circles[C+2]),b.push(g.collisionDetected?1:0)}}markUsedJustification(e,r,l,c){let p;p=c===a.an.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[a.aF(r)];const g=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const b of g)b>=0&&(e.text.placedSymbolArray.get(b).crossTileID=p>=0&&b!==p?0:l.crossTileID)}markUsedOrientation(e,r,l){const c=r===a.an.horizontal||r===a.an.horizontalOnly?r:0,p=r===a.an.vertical?r:0,g=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const b of g)e.text.placedSymbolArray.get(b).placedOrientation=c;l.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=p)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let l=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const c=r?r.symbolFadeChange(e):1,p=r?r.opacities:{},g=r?r.variableOffsets:{},b=r?r.placedOrientations:{};for(const C in this.placements){const S=this.placements[C],M=p[C];M?(this.opacities[C]=new bn(M,c,S.text,S.icon),l=l||S.text!==M.text.placed||S.icon!==M.icon.placed):(this.opacities[C]=new bn(null,c,S.text,S.icon,S.skipFade),l=l||S.text||S.icon)}for(const C in p){const S=p[C];if(!this.opacities[C]){const M=new bn(S,c,!1,!1);M.isHidden()||(this.opacities[C]=M,l=l||S.text.placed||S.icon.placed)}}for(const C in g)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=g[C]);for(const C in b)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=b[C]);if(r&&r.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:e)}updateLayerOpacities(e,r){const l={};for(const c of r){const p=c.getBucket(e);p&&c.latestFeatureIndex&&e.id===p.layerIds[0]&&this.updateBucketOpacities(p,c.tileID,l,c.collisionBoxArray)}}updateBucketOpacities(e,r,l,c){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const p=e.layers[0],g=p.layout,b=new bn(null,0,!1,!1,!0),C=g.get("text-allow-overlap"),S=g.get("icon-allow-overlap"),M=p._unevaluatedLayout.hasValue("text-variable-anchor")||p._unevaluatedLayout.hasValue("text-variable-anchor-offset"),z=g.get("text-rotation-alignment")==="map",A=g.get("text-pitch-alignment")==="map",R=g.get("icon-text-fit")!=="none",V=new bn(null,0,C&&(S||!e.hasIconData()||g.get("icon-optional")),S&&(C||!e.hasTextData()||g.get("text-optional")),!0);!e.collisionArrays&&c&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(c);const Q=(ee,se,fe)=>{for(let he=0;he<se/4;he++)ee.opacityVertexArray.emplaceBack(fe);ee.hasVisibleVertices=ee.hasVisibleVertices||fe!==co},J=this.collisionBoxArrays.get(e.bucketInstanceId);for(let ee=0;ee<e.symbolInstances.length;ee++){const se=e.symbolInstances.get(ee),{numHorizontalGlyphVertices:fe,numVerticalGlyphVertices:he,crossTileID:_e}=se;let ye=this.opacities[_e];l[_e]?ye=b:ye||(ye=V,this.opacities[_e]=ye),l[_e]=!0;const ue=se.numIconVertices>0,Ce=this.placedOrientations[se.crossTileID],Be=Ce===a.an.vertical,De=Ce===a.an.horizontal||Ce===a.an.horizontalOnly;if(fe>0||he>0){const je=Qc(ye.text);Q(e.text,fe,Be?co:je),Q(e.text,he,De?co:je);const ft=ye.text.isHidden();[se.rightJustifiedTextSymbolIndex,se.centerJustifiedTextSymbolIndex,se.leftJustifiedTextSymbolIndex].forEach(Ct=>{Ct>=0&&(e.text.placedSymbolArray.get(Ct).hidden=ft||Be?1:0)}),se.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(se.verticalPlacedTextSymbolIndex).hidden=ft||De?1:0);const ht=this.variableOffsets[se.crossTileID];ht&&this.markUsedJustification(e,ht.anchor,se,Ce);const tt=this.placedOrientations[se.crossTileID];tt&&(this.markUsedJustification(e,"left",se,tt),this.markUsedOrientation(e,tt,se))}if(ue){const je=Qc(ye.icon),ft=!(R&&se.verticalPlacedIconSymbolIndex&&Be);se.placedIconSymbolIndex>=0&&(Q(e.icon,se.numIconVertices,ft?je:co),e.icon.placedSymbolArray.get(se.placedIconSymbolIndex).hidden=ye.icon.isHidden()),se.verticalPlacedIconSymbolIndex>=0&&(Q(e.icon,se.numVerticalIconVertices,ft?co:je),e.icon.placedSymbolArray.get(se.verticalPlacedIconSymbolIndex).hidden=ye.icon.isHidden())}const Re=J&&J.has(ee)?J.get(ee):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const je=e.collisionArrays[ee];if(je){let ft=new a.P(0,0);if(je.textBox||je.verticalTextBox){let ht=!0;if(M){const tt=this.variableOffsets[_e];tt?(ft=Hc(tt.anchor,tt.width,tt.height,tt.textOffset,tt.textBoxScale),z&&ft._rotate(A?-this.transform.bearingInRadians:this.transform.bearingInRadians)):ht=!1}if(je.textBox||je.verticalTextBox){let tt;je.textBox&&(tt=Be),je.verticalTextBox&&(tt=De),oa(e.textCollisionBox.collisionVertexArray,ye.text.placed,!ht||tt,Re.text,ft.x,ft.y)}}if(je.iconBox||je.verticalIconBox){const ht=!!(!De&&je.verticalIconBox);let tt;je.iconBox&&(tt=ht),je.verticalIconBox&&(tt=!ht),oa(e.iconCollisionBox.collisionVertexArray,ye.icon.placed,tt,Re.icon,R?ft.x:0,R?ft.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,r){const l=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*l>e}setStale(){this.stale=!0}}function oa(d,e,r,l,c,p){l&&l.length!==0||(l=[0,0,0,0]);const g=l[0]-jr,b=l[1]-jr,C=l[2]-jr,S=l[3]-jr;d.emplaceBack(e?1:0,r?1:0,c||0,p||0,g,b),d.emplaceBack(e?1:0,r?1:0,c||0,p||0,C,b),d.emplaceBack(e?1:0,r?1:0,c||0,p||0,C,S),d.emplaceBack(e?1:0,r?1:0,c||0,p||0,g,S)}const Jn=Math.pow(2,25),Rn=Math.pow(2,24),Xc=Math.pow(2,17),Kc=Math.pow(2,16),Yc=Math.pow(2,9),vs=Math.pow(2,8),Jc=Math.pow(2,1);function Qc(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const e=d.placed?1:0,r=Math.floor(127*d.opacity);return r*Jn+e*Rn+r*Xc+e*Kc+r*Yc+e*vs+r*Jc+e}const co=0;class Cu{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,r,l,c,p){const g=this._bucketParts;for(;this._currentTileIndex<e.length;)if(r.getBucketParts(g,c,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,p())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,g.sort((b,C)=>b.sortKey-C.sortKey));this._currentPartIndex<g.length;)if(r.placeLayerBucketPart(g[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,p())return!0;return!1}}class eh{constructor(e,r,l,c,p,g,b,C){this.placement=new lo(e,r,g,b,C),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(e,r,l){const c=oe.now(),p=()=>!this._forceFullPlacement&&oe.now()-c>2;for(;this._currentPlacementIndex>=0;){const g=r[e[this._currentPlacementIndex]],b=this.placement.collisionIndex.transform.zoom;if(g.type==="symbol"&&(!g.minzoom||g.minzoom<=b)&&(!g.maxzoom||g.maxzoom>b)){if(this._inProgressLayer||(this._inProgressLayer=new Cu(g)),this._inProgressLayer.continuePlacement(l[g.source],this.placement,this._showCollisionBoxes,g,p))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const bs=512/a.$/2;class pl{constructor(e,r,l){this.tileID=e,this.bucketInstanceId=l,this._symbolsByKey={};const c=new Map;for(let p=0;p<r.length;p++){const g=r.get(p),b=g.key,C=c.get(b);C?C.push(g):c.set(b,[g])}for(const[p,g]of c){const b={positions:g.map(C=>({x:Math.floor(C.anchorX*bs),y:Math.floor(C.anchorY*bs)})),crossTileIDs:g.map(C=>C.crossTileID)};if(b.positions.length>128){const C=new a.aH(b.positions.length,16,Uint16Array);for(const{x:S,y:M}of b.positions)C.add(S,M);C.finish(),delete b.positions,b.index=C}this._symbolsByKey[p]=b}}getScaledCoordinates(e,r){const{x:l,y:c,z:p}=this.tileID.canonical,{x:g,y:b,z:C}=r.canonical,S=bs/Math.pow(2,C-p),M=(b*a.$+e.anchorY)*S,z=c*a.$*bs;return{x:Math.floor((g*a.$+e.anchorX)*S-l*a.$*bs),y:Math.floor(M-z)}}findMatches(e,r,l){const c=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z);for(let p=0;p<e.length;p++){const g=e.get(p);if(g.crossTileID)continue;const b=this._symbolsByKey[g.key];if(!b)continue;const C=this.getScaledCoordinates(g,r);if(b.index){const S=b.index.range(C.x-c,C.y-c,C.x+c,C.y+c).sort();for(const M of S){const z=b.crossTileIDs[M];if(!l[z]){l[z]=!0,g.crossTileID=z;break}}}else if(b.positions)for(let S=0;S<b.positions.length;S++){const M=b.positions[S],z=b.crossTileIDs[S];if(Math.abs(M.x-C.x)<=c&&Math.abs(M.y-C.y)<=c&&!l[z]){l[z]=!0,g.crossTileID=z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class fl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class th{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const r=Math.round((e-this.lng)/360);if(r!==0)for(const l in this.indexes){const c=this.indexes[l],p={};for(const g in c){const b=c[g];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+r),p[b.tileID.key]=b}this.indexes[l]=p}this.lng=e}addBucket(e,r,l){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let p=0;p<r.symbolInstances.length;p++)r.symbolInstances.get(p).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const c=this.usedCrossTileIDs[e.overscaledZ];for(const p in this.indexes){const g=this.indexes[p];if(Number(p)>e.overscaledZ)for(const b in g){const C=g[b];C.tileID.isChildOf(e)&&C.findMatches(r.symbolInstances,e,c)}else{const b=g[e.scaledTo(Number(p)).key];b&&b.findMatches(r.symbolInstances,e,c)}}for(let p=0;p<r.symbolInstances.length;p++){const g=r.symbolInstances.get(p);g.crossTileID||(g.crossTileID=l.generate(),c[g.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new pl(e,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(e,r){for(const l of r.getCrossTileIDsLists())for(const c of l)delete this.usedCrossTileIDs[e][c]}removeStaleBuckets(e){let r=!1;for(const l in this.indexes){const c=this.indexes[l];for(const p in c)e[c[p].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,c[p]),delete c[p],r=!0)}return r}}class aa{constructor(){this.layerIndexes={},this.crossTileIDs=new fl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,r,l){let c=this.layerIndexes[e.id];c===void 0&&(c=this.layerIndexes[e.id]=new th);let p=!1;const g={};c.handleWrapJump(l);for(const b of r){const C=b.getBucket(e);C&&e.id===C.layerIds[0]&&(C.bucketInstanceId||(C.bucketInstanceId=++this.maxBucketInstanceId),c.addBucket(b.tileID,C,this.crossTileIDs)&&(p=!0),g[C.bucketInstanceId]=!0)}return c.removeStaleBuckets(g)&&(p=!0),p}pruneUnusedLayers(e){const r={};e.forEach(l=>{r[l]=!0});for(const l in this.layerIndexes)r[l]||delete this.layerIndexes[l]}}var la="void main() {fragColor=vec4(1.0);}";const hn={prelude:Kt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Kt("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Kt("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Kt(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Kt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Kt(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Kt(la,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Kt(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Kt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Kt("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Kt("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:Kt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(textureSize(u_elevation_stops,0)[0]);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int num_elevation_stops=textureSize(u_elevation_stops,0)[0];int r=(num_elevation_stops-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(textureSize(u_color_stops,0)[0]);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:Kt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Kt(la,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Kt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Kt(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Kt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Kt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Kt(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Kt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Kt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Kt(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;switch(u_method){case BASIC:
basic_hillshade(deriv);break;case COMBINED:
combined_hillshade(deriv);break;case IGOR:
igor_hillshade(deriv);break;case MULTIDIRECTIONAL:
multidirectional_hillshade(deriv);break;case STANDARD:
default:
standard_hillshade(deriv);break;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Kt(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Kt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Kt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Kt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Kt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Kt(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Kt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Kt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Kt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Kt("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Kt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Kt("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Kt(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Kt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Kt(d,e){const r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=e.match(/in ([\w]+) ([\w]+)/g),c=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),p=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=p?p.concat(c):c,b={};return{fragmentSource:d=d.replace(r,(C,S,M,z,A)=>(b[A]=!0,S==="define"?`
#ifndef HAS_UNIFORM_u_${A}
in ${M} ${z} ${A};
#else
uniform ${M} ${z} u_${A};
#endif
`:`
#ifdef HAS_UNIFORM_u_${A}
    ${M} ${z} ${A} = u_${A};
#endif
`)),vertexSource:e=e.replace(r,(C,S,M,z,A)=>{const R=z==="float"?"vec2":"vec4",V=A.match(/color/)?"color":R;return b[A]?S==="define"?`
#ifndef HAS_UNIFORM_u_${A}
uniform lowp float u_${A}_t;
in ${M} ${R} a_${A};
out ${M} ${z} ${A};
#else
uniform ${M} ${z} u_${A};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${A}
    ${A} = a_${A};
#else
    ${M} ${z} ${A} = u_${A};
#endif
`:`
#ifndef HAS_UNIFORM_u_${A}
    ${A} = unpack_mix_${V}(a_${A}, u_${A}_t);
#else
    ${M} ${z} ${A} = u_${A};
#endif
`:S==="define"?`
#ifndef HAS_UNIFORM_u_${A}
uniform lowp float u_${A}_t;
in ${M} ${R} a_${A};
#else
uniform ${M} ${z} u_${A};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${A}
    ${M} ${z} ${A} = a_${A};
#else
    ${M} ${z} ${A} = u_${A};
#endif
`:`
#ifndef HAS_UNIFORM_u_${A}
    ${M} ${z} ${A} = unpack_mix_${V}(a_${A}, u_${A}_t);
#else
    ${M} ${z} ${A} = u_${A};
#endif
`}),staticAttributes:l,staticUniforms:g}}class xn{constructor(e,r,l){this.vertexBuffer=e,this.indexBuffer=r,this.segments=l}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var wn=a.aI([{name:"a_pos",type:"Int16",components:2}]);const Qn="#define PROJECTION_MERCATOR",ml="mercator";class _l{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return ml}get shaderDefine(){return Qn}get shaderPreludeCode(){return hn.projectionMercator}get vertexShaderPreludeCode(){return hn.projectionMercator.vertexSource}get subdivisionGranularity(){return a.aJ.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,r,l,c,p){if(this._cachedMesh)return this._cachedMesh;const g=new a.aK;g.emplaceBack(0,0),g.emplaceBack(a.$,0),g.emplaceBack(0,a.$),g.emplaceBack(a.$,a.$);const b=e.createVertexBuffer(g,wn.members),C=a.aL.simpleSegment(0,0,4,2),S=new a.aM;S.emplaceBack(1,0,2),S.emplaceBack(1,2,3);const M=e.createIndexBuffer(S);return this._cachedMesh=new xn(b,M,C),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class Ui{constructor(e=0,r=0,l=0,c=0){if(isNaN(e)||e<0||isNaN(r)||r<0||isNaN(l)||l<0||isNaN(c)||c<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=r,this.left=l,this.right=c}interpolate(e,r,l){return r.top!=null&&e.top!=null&&(this.top=a.C.number(e.top,r.top,l)),r.bottom!=null&&e.bottom!=null&&(this.bottom=a.C.number(e.bottom,r.bottom,l)),r.left!=null&&e.left!=null&&(this.left=a.C.number(e.left,r.left,l)),r.right!=null&&e.right!=null&&(this.right=a.C.number(e.right,r.right,l)),this}getCenter(e,r){const l=a.ag((this.left+e-this.right)/2,0,e),c=a.ag((this.top+r-this.bottom)/2,0,r);return new a.P(l,c)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Ui(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Cn(d,e){if(!d.renderWorldCopies||d.lngRange)return;const r=e.lng-d.center.lng;e.lng+=r>180?-360:r<-180?360:0}function Yt(d){return Math.max(0,Math.floor(d))}class ho{constructor(e,r,l,c,p,g){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=g===void 0||!!g,this._minZoom=r||0,this._maxZoom=l||22,this._minPitch=c??0,this._maxPitch=p??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new a.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Yt(this._zoom),this._scale=a.ae(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Ui,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,r,l){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=Yt(this._zoom),this._scale=a.ae(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new Ui(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!l&&e.autoCalculateNearFarZ,r&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const r=a.aN(e,-180,180)*Math.PI/180;var l,c,p,g,b,C,S,M,z;this._bearingInRadians!==r&&(this._unmodified=!1,this._bearingInRadians=r,this._calcMatrices(),this._rotationMatrix=K(),l=this._rotationMatrix,p=-this._bearingInRadians,g=(c=this._rotationMatrix)[0],b=c[1],C=c[2],S=c[3],M=Math.sin(p),z=Math.cos(p),l[0]=g*z+C*M,l[1]=b*z+S*M,l[2]=g*-M+C*z,l[3]=b*-M+S*z)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const r=a.ag(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==r&&(this._unmodified=!1,this._pitchInRadians=r,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const r=e/180*Math.PI;this._rollInRadians!==r&&(this._unmodified=!1,this._rollInRadians=r,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return a.aO(this._fovInRadians)}setFov(e){e=a.ag(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=a.ad(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const r=this.getConstrained(this._center,e).zoom;this._zoom!==r&&(this._unmodified=!1,this._zoom=r,this._tileZoom=Math.max(0,Math.floor(r)),this._scale=a.ae(r),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,r){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=r,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,r,l){this._unmodified=!1,this._edgeInsets.interpolate(e,r,l),this._constrain(),this._calcMatrices()}resize(e,r,l=!0){this._width=e,this._height=r,l&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new ar([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,a.ah])}getConstrained(e,r){return this._callbacks.getConstrained(e,r)}getCameraQueryGeometry(e,r){if(r.length===1)return[r[0],e];{const{minX:l,minY:c,maxX:p,maxY:g}=a.a1.fromPoints(r).extend(e);return[new a.P(l,c),new a.P(p,c),new a.P(p,g),new a.P(l,g),new a.P(l,c)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:r,zoom:l}=this.getConstrained(this.center,this.zoom);this.setCenter(r),this.setZoom(l),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=a.af(new Float64Array(16));a.N(e,e,[this._width/2,-this._height/2,1]),a.M(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=a.af(new Float64Array(16)),a.N(e,e,[1,-1,1]),a.M(e,e,[-1,-1,0]),a.N(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,r,l,c){const p=l!==void 0?l:this.bearing,g=c=c!==void 0?c:this.pitch,b=a.a0.fromLngLat(e,r),C=-Math.cos(a.ad(g)),S=Math.sin(a.ad(g)),M=S*Math.sin(a.ad(p)),z=-S*Math.cos(a.ad(p));let A=this.elevation;const R=r-A;let V;C*R>=0||Math.abs(C)<.1?(V=1e4,A=r+V*C):V=-R/C;let Q,J,ee=a.aP(1,b.y),se=0;do{if(se+=1,se>10)break;J=V/ee,Q=new a.a0(b.x+M*J,b.y+z*J),ee=1/Q.meterInMercatorCoordinateUnits()}while(Math.abs(V-J*ee)>1e-12);return{center:Q.toLngLat(),elevation:A,zoom:a.aj(this.height/2/Math.tan(this.fovInRadians/2)/J/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const r=a.ai(1,this.center.lat)*this.worldSize,l=this.cameraToCenterDistance/r,c=a.a0.fromLngLat(this.center,this.elevation),p=ce(this.center,this.elevation,this.pitch,this.bearing,l);this._elevation=e;const g=this.calculateCenterFromCameraLngLatAlt(p.toLngLat(),a.aP(p.z,c.y),this.bearing,this.pitch);this._elevation=g.elevation,this._center=g.center,this.setZoom(g.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=a.ai(1,this.center.lat)*this.worldSize;return ce(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const r=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/r,e.canonical.y/r,1/r/a.$,1/r/a.$]}}class ca{constructor(e,r){this.min=e,this.max=r,this.center=a.aQ([],a.aR([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],l=a.aS(this.min),c=a.aS(this.max);for(let p=0;p<r.length;p++)l[p]=r[p]?this.min[p]:this.center[p],c[p]=r[p]?this.center[p]:this.max[p];return c[2]=this.max[2],new ca(l,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let r=!0;for(let l=0;l<e.planes.length;l++){const c=this.intersectsPlane(e.planes[l]);if(c===0)return 0;c===1&&(r=!1)}return r?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let r=e[3],l=e[3];for(let c=0;c<3;c++)e[c]>0?(r+=e[c]*this.min[c],l+=e[c]*this.max[c]):(l+=e[c]*this.min[c],r+=e[c]*this.max[c]);return r>=0?2:l<0?0:1}}class gl{distanceToTile2d(e,r,l,c){const p=c.distanceX([e,r]),g=c.distanceY([e,r]);return Math.hypot(p,g)}getWrap(e,r,l){return l}getTileBoundingVolume(e,r,l,c){var p,g;let b=l,C=l;if(c!=null&&c.terrain){const M=new a.Z(e.z,r,e.z,e.x,e.y),z=c.terrain.getMinMaxElevation(M);b=(p=z.minElevation)!==null&&p!==void 0?p:l,C=(g=z.maxElevation)!==null&&g!==void 0?g:l}const S=1<<e.z;return new ca([r+e.x/S,e.y/S,b],[r+(e.x+1)/S,(e.y+1)/S,C])}allowVariableZoom(e,r){const l=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,c=a.ag(78.5-l/2,0,60);return!!r.terrain||e.pitch>c}allowWorldCopies(){return!0}prepareNextFrame(){}}class gi{constructor(e,r,l){this.points=e,this.planes=r,this.aabb=l}static fromInvProjectionMatrix(e,r=1,l=0,c,p){const g=p?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],b=Math.pow(2,l),C=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(A=>function(R,V,Q,J){const ee=a.av([],R,V),se=1/ee[3]/Q*J;return a.aX(ee,ee,[se,se,1/ee[3],se])}(A,e,r,b));c&&function(A,R,V,Q){const J=Q?4:0,ee=Q?0:4;let se=0;const fe=[],he=[];for(let ue=0;ue<4;ue++){const Ce=a.aT([],A[ue+ee],A[ue+J]),Be=a.aY(Ce);a.aQ(Ce,Ce,1/Be),fe.push(Be),he.push(Ce)}for(let ue=0;ue<4;ue++){const Ce=a.aZ(A[ue+J],he[ue],V);se=Ce!==null&&Ce>=0?Math.max(se,Ce):Math.max(se,fe[ue])}const _e=function(ue,Ce){const Be=a.aT([],ue[Ce[0]],ue[Ce[1]]),De=a.aT([],ue[Ce[2]],ue[Ce[1]]),Re=[0,0,0,0];return a.aU(Re,a.aV([],Be,De)),Re[3]=-a.aW(Re,ue[Ce[0]]),Re}(A,R),ye=function(ue,Ce){const Be=a.a_(ue),De=a.a$([],ue,1/Be),Re=a.aT([],Ce,a.aQ([],De,a.aW(Ce,De))),je=a.a_(Re);if(je>0){const ft=Math.sqrt(1-De[3]*De[3]),ht=a.aQ([],De,-De[3]),tt=a.aR([],ht,a.aQ([],Re,ft/je));return a.b0(Ce,tt)}return null}(V,_e);if(ye!==null){const ue=ye/a.aW(he[0],_e);se=Math.min(se,ue)}for(let ue=0;ue<4;ue++){const Ce=Math.min(se,fe[ue]);A[ue+ee]=[A[ue+J][0]+he[ue][0]*Ce,A[ue+J][1]+he[ue][1]*Ce,A[ue+J][2]+he[ue][2]*Ce,1]}}(C,g[0],c,p);const S=g.map(A=>{const R=a.aT([],C[A[0]],C[A[1]]),V=a.aT([],C[A[2]],C[A[1]]),Q=a.aU([],a.aV([],R,V)),J=-a.aW(Q,C[A[1]]);return Q.concat(J)}),M=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],z=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const A of C)for(let R=0;R<3;R++)M[R]=Math.min(M[R],A[R]),z[R]=Math.max(z[R],A[R]);return new gi(C,S,new ca(M,z))}}class $r{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,l){return this._helper.interpolatePadding(e,r,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r,l=!0){this._helper.resize(e,r,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,r){}constructor(e,r,l,c,p){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new ho({calcMatrices:()=>{this._calcMatrices()},getConstrained:(g,b)=>this.getConstrained(g,b)},e,r,l,c,p),this._coveringTilesDetailsProvider=new gl}clone(){const e=new $r;return e.apply(this),e}apply(e,r,l){this._helper.apply(e,r,l)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const r=[new a.b1(0,e)];if(this._helper._renderWorldCopies){const l=this.screenPointToMercatorCoordinate(new a.P(0,0)),c=this.screenPointToMercatorCoordinate(new a.P(this._helper._width,0)),p=this.screenPointToMercatorCoordinate(new a.P(this._helper._width,this._helper._height)),g=this.screenPointToMercatorCoordinate(new a.P(0,this._helper._height)),b=Math.floor(Math.min(l.x,c.x,p.x,g.x)),C=Math.floor(Math.max(l.x,c.x,p.x,g.x)),S=1;for(let M=b-S;M<=C+S;M++)M!==0&&r.push(new a.b1(M,e))}return r}getCameraFrustum(){return gi.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const r=this.screenPointToLocation(this.centerPoint,e),l=e?e.getElevationForLngLatZoom(r,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(l)}setLocationAtPoint(e,r){const l=a.ai(this.elevation,this.center.lat),c=this.screenPointToMercatorCoordinateAtZ(r,l),p=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,l),g=a.a0.fromLngLat(e),b=new a.a0(g.x-(c.x-p.x),g.y-(c.y-p.y));this.setCenter(b==null?void 0:b.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,r){return r?this.coordinatePoint(a.a0.fromLngLat(e),r.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(a.a0.fromLngLat(e))}screenPointToLocation(e,r){var l;return(l=this.screenPointToMercatorCoordinate(e,r))===null||l===void 0?void 0:l.toLngLat()}screenPointToMercatorCoordinate(e,r){if(r){const l=r.pointCoordinate(e);if(l!=null)return l}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,r){const l=r||0,c=[e.x,e.y,0,1],p=[e.x,e.y,1,1];a.av(c,c,this._pixelMatrixInverse),a.av(p,p,this._pixelMatrixInverse);const g=c[3],b=p[3],C=c[1]/g,S=p[1]/b,M=c[2]/g,z=p[2]/b,A=M===z?0:(l-M)/(z-M);return new a.a0(a.C.number(c[0]/g,p[0]/b,A)/this.worldSize,a.C.number(C,S,A)/this.worldSize,l)}coordinatePoint(e,r=0,l=this._pixelMatrix){const c=[e.x*this.worldSize,e.y*this.worldSize,r,1];return a.av(c,c,l),new a.P(c[0]/c[3],c[1]/c[3])}getBounds(){const e=Math.max(0,this._helper._height/2-G(this));return new ar().extend(this.screenPointToLocation(new a.P(0,e))).extend(this.screenPointToLocation(new a.P(this._helper._width,e))).extend(this.screenPointToLocation(new a.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new a.P(0,this._helper._height)))}isPointOnMapSurface(e,r){return r?r.pointCoordinate(e)!=null:e.y>this.height/2-G(this)}calculatePosMatrix(e,r=!1,l){var c;const p=(c=e.key)!==null&&c!==void 0?c:a.b2(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),g=r?this._alignedPosMatrixCache:this._posMatrixCache;if(g.has(p)){const S=g.get(p);return l?S.f32:S.f64}const b=Y(e,this.worldSize);a.O(b,r?this._alignedProjMatrix:this._viewProjMatrix,b);const C={f64:b,f32:new Float32Array(b)};return g.set(p,C),l?C.f32:C.f64}calculateFogMatrix(e){const r=e.key,l=this._fogMatrixCacheF32;if(l.has(r))return l.get(r);const c=Y(e,this.worldSize);return a.O(c,this._fogMatrix,c),l.set(r,new Float32Array(c)),l.get(r)}getConstrained(e,r){r=a.ag(+r,this.minZoom,this.maxZoom);const l={center:new a.S(e.lng,e.lat),zoom:r};let c=this._helper._lngRange;this._helper._renderWorldCopies||c!==null||(c=[-179.9999999999,180-1e-10]);const p=this.tileSize*a.ae(l.zoom);let g=0,b=p,C=0,S=p,M=0,z=0;const{x:A,y:R}=this.size;if(this._helper._latRange){const fe=this._helper._latRange;g=a.U(fe[1])*p,b=a.U(fe[0])*p,b-g<R&&(M=R/(b-g))}c&&(C=a.aN(a.V(c[0])*p,0,p),S=a.aN(a.V(c[1])*p,0,p),S<C&&(S+=p),S-C<A&&(z=A/(S-C)));const{x:V,y:Q}=Se(p,e);let J,ee;const se=Math.max(z||0,M||0);if(se){const fe=new a.P(z?(S+C)/2:V,M?(b+g)/2:Q);return l.center=N(p,fe).wrap(),l.zoom+=a.aj(se),l}if(this._helper._latRange){const fe=R/2;Q-fe<g&&(ee=g+fe),Q+fe>b&&(ee=b-fe)}if(c){const fe=(C+S)/2;let he=V;this._helper._renderWorldCopies&&(he=a.aN(V,fe-p/2,fe+p/2));const _e=A/2;he-_e<C&&(J=C+_e),he+_e>S&&(J=S-_e)}if(J!==void 0||ee!==void 0){const fe=new a.P(J??V,ee??Q);l.center=N(p,fe).wrap()}return l}calculateCenterFromCameraLngLatAlt(e,r,l,c){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,l,c)}_calculateNearFarZIfNeeded(e,r,l){if(!this._helper.autoCalculateNearFarZ)return;const c=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),p=e-c*this._helper._pixelPerMeter/Math.cos(r),g=c<0?p:e,b=Math.PI/2+this.pitchInRadians,C=a.ad(this.fov)*(Math.abs(Math.cos(a.ad(this.roll)))*this.height+Math.abs(Math.sin(a.ad(this.roll)))*this.width)/this.height*(.5+l.y/this.height),S=Math.sin(C)*g/Math.sin(a.ag(Math.PI-b-C,.01,Math.PI-.01)),M=G(this),z=Math.atan(M/this._helper.cameraToCenterDistance),A=a.ad(.75),R=z>A?2*z*(.5+l.y/(2*M)):A,V=Math.sin(R)*g/Math.sin(a.ag(Math.PI-b-R,.01,Math.PI-.01)),Q=Math.min(S,V);this._helper._farZ=1.01*(Math.cos(Math.PI/2-r)*Q+g),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,r=Se(this.worldSize,this.center),l=r.x,c=r.y;this._helper._pixelPerMeter=a.ai(1,this.center.lat)*this.worldSize;const p=a.ad(Math.min(this.pitch,Ur)),g=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(p));let b;this._calculateNearFarZIfNeeded(g,p,e),b=new Float64Array(16),a.b3(b,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),a.ap(this._invProjMatrix,b),b[8]=2*-e.x/this._helper._width,b[9]=2*e.y/this._helper._height,this._projectionMatrix=a.b4(b),a.N(b,b,[1,-1,1]),a.M(b,b,[0,0,-this._helper.cameraToCenterDistance]),a.b5(b,b,-this.rollInRadians),a.b6(b,b,this.pitchInRadians),a.b5(b,b,-this.bearingInRadians),a.M(b,b,[-l,-c,0]),this._mercatorMatrix=a.N([],b,[this.worldSize,this.worldSize,this.worldSize]),a.N(b,b,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=a.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,b),a.M(b,b,[0,0,-this.elevation]),this._viewProjMatrix=b,this._invViewProjMatrix=a.ap([],b);const C=[0,0,-1,1];a.av(C,C,this._invViewProjMatrix),this._cameraPosition=[C[0]/C[3],C[1]/C[3],C[2]/C[3]],this._fogMatrix=new Float64Array(16),a.b3(this._fogMatrix,this.fovInRadians,this.width/this.height,g,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,a.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),a.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),a.b5(this._fogMatrix,this._fogMatrix,-this.rollInRadians),a.b6(this._fogMatrix,this._fogMatrix,this.pitchInRadians),a.b5(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),a.M(this._fogMatrix,this._fogMatrix,[-l,-c,0]),a.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),a.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=a.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,b);const S=this._helper._width%2/2,M=this._helper._height%2/2,z=Math.cos(this.bearingInRadians),A=Math.sin(-this.bearingInRadians),R=l-Math.round(l)+z*S+A*M,V=c-Math.round(c)+z*M+A*S,Q=new Float64Array(b);if(a.M(Q,Q,[R>.5?R-1:R,V>.5?V-1:V,0]),this._alignedProjMatrix=Q,b=a.ap(new Float64Array(16),this._pixelMatrix),!b)throw new Error("failed to invert matrix");this._pixelMatrixInverse=b,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new a.P(0,0)),r=[e.x*this.worldSize,e.y*this.worldSize,0,1];return a.av(r,r,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=a.ai(1,this.center.lat)*this.worldSize;return ce(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,r){const l=a.a0.fromLngLat(e),c=[l.x*this.worldSize,l.y*this.worldSize,r,1];return a.av(c,c,this._viewProjMatrix),c[2]/c[3]}getProjectionData(e){const{overscaledTileID:r,aligned:l,applyTerrainMatrix:c}=e,p=this._helper.getMercatorTileCoordinates(r),g=r?this.calculatePosMatrix(r,l,!0):null;let b;return b=r&&r.terrainRttPosMatrix32f&&c?r.terrainRttPosMatrix32f:g||a.b7(),{mainMatrix:b,tileMercatorCoords:p,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:b}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,r,l){return 1}transformLightDirection(e){return a.aS(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,r,l,c){const p=this.calculatePosMatrix(l);let g;c?(g=[e,r,c(e,r),1],a.av(g,g,p)):(g=[e,r,0,1],Yn(g,g,p));const b=g[3];return{point:new a.P(g[0]/b,g[1]/b),signedDistanceFromCamera:b,isOccluded:!1}}populateCache(e){for(const r of e)this.calculatePosMatrix(r)}getMatrixForModel(e,r){const l=a.a0.fromLngLat(e,r),c=l.meterInMercatorCoordinateUnits(),p=a.b8();return a.M(p,p,[l.x,l.y,l.z]),a.b5(p,p,Math.PI),a.b6(p,p,Math.PI/2),a.N(p,p,[-c,c,c]),p}getProjectionDataForCustomLayer(e=!0){const r=new a.Z(0,0,0,0,0),l=this.getProjectionData({overscaledTileID:r,applyGlobeMatrix:e}),c=Y(r,this.worldSize);a.O(c,this._viewProjMatrix,c),l.tileMercatorCoords=[0,0,1,1];const p=[a.$,a.$,this.worldSize/this._helper.pixelsPerMeter],g=a.b9();return a.N(g,c,p),l.fallbackMatrix=g,l.mainMatrix=g,l}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function yi(){a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Jr(d){if(d.useSlerp)if(d.k<1){const e=a.ba(d.startEulerAngles.roll,d.startEulerAngles.pitch,d.startEulerAngles.bearing),r=a.ba(d.endEulerAngles.roll,d.endEulerAngles.pitch,d.endEulerAngles.bearing),l=new Float64Array(4);a.bb(l,e,r,d.k);const c=a.bc(l);d.tr.setRoll(c.roll),d.tr.setPitch(c.pitch),d.tr.setBearing(c.bearing)}else d.tr.setRoll(d.endEulerAngles.roll),d.tr.setPitch(d.endEulerAngles.pitch),d.tr.setBearing(d.endEulerAngles.bearing);else d.tr.setRoll(a.C.number(d.startEulerAngles.roll,d.endEulerAngles.roll,d.k)),d.tr.setPitch(a.C.number(d.startEulerAngles.pitch,d.endEulerAngles.pitch,d.k)),d.tr.setBearing(a.C.number(d.startEulerAngles.bearing,d.endEulerAngles.bearing,d.k))}function Er(d,e,r,l,c){const p=c.padding,g=Se(c.worldSize,r.getNorthWest()),b=Se(c.worldSize,r.getNorthEast()),C=Se(c.worldSize,r.getSouthEast()),S=Se(c.worldSize,r.getSouthWest()),M=a.ad(-l),z=g.rotate(M),A=b.rotate(M),R=C.rotate(M),V=S.rotate(M),Q=new a.P(Math.max(z.x,A.x,V.x,R.x),Math.max(z.y,A.y,V.y,R.y)),J=new a.P(Math.min(z.x,A.x,V.x,R.x),Math.min(z.y,A.y,V.y,R.y)),ee=Q.sub(J),se=(c.width-(p.left+p.right+e.left+e.right))/ee.x,fe=(c.height-(p.top+p.bottom+e.top+e.bottom))/ee.y;if(fe<0||se<0)return void yi();const he=Math.min(a.aj(c.scale*Math.min(se,fe)),d.maxZoom),_e=a.P.convert(d.offset),ye=new a.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(a.ad(l)),ue=_e.add(ye).mult(c.scale/a.ae(he));return{center:N(c.worldSize,g.add(C).div(2).sub(ue)),zoom:he,bearing:l}}class ha{get useGlobeControls(){return!1}handlePanInertia(e,r){return{easingOffset:e,easingCenter:r.center}}handleMapControlsRollPitchBearingZoom(e,r){e.bearingDelta&&r.setBearing(r.bearing+e.bearingDelta),e.pitchDelta&&r.setPitch(r.pitch+e.pitchDelta),e.rollDelta&&r.setRoll(r.roll+e.rollDelta),e.zoomDelta&&r.setZoom(r.zoom+e.zoomDelta)}handleMapControlsPan(e,r,l){e.around.distSqr(r.centerPoint)<.01||r.setLocationAtPoint(l,e.around)}cameraForBoxAndBearing(e,r,l,c,p){return Er(e,r,l,c,p)}handleJumpToCenterZoom(e,r){e.zoom!==(r.zoom!==void 0?+r.zoom:e.zoom)&&e.setZoom(+r.zoom),r.center!==void 0&&e.setCenter(a.S.convert(r.center))}handleEaseTo(e,r){const l=e.zoom,c=e.padding,p={roll:e.roll,pitch:e.pitch,bearing:e.bearing},g={roll:r.roll===void 0?e.roll:r.roll,pitch:r.pitch===void 0?e.pitch:r.pitch,bearing:r.bearing===void 0?e.bearing:r.bearing},b=r.zoom!==void 0,C=!e.isPaddingEqual(r.padding);let S=!1;const M=b?+r.zoom:e.zoom;let z=e.centerPoint.add(r.offsetAsPoint);const A=e.screenPointToLocation(z),{center:R,zoom:V}=e.getConstrained(a.S.convert(r.center||A),M??l);Cn(e,R);const Q=Se(e.worldSize,A),J=Se(e.worldSize,R).sub(Q),ee=a.ae(V-l);return S=V!==l,{easeFunc:se=>{if(S&&e.setZoom(a.C.number(l,V,se)),a.bd(p,g)||Jr({startEulerAngles:p,endEulerAngles:g,tr:e,k:se,useSlerp:p.roll!=g.roll}),C&&(e.interpolatePadding(c,r.padding,se),z=e.centerPoint.add(r.offsetAsPoint)),r.around)e.setLocationAtPoint(r.around,r.aroundPoint);else{const fe=a.ae(e.zoom-l),he=V>l?Math.min(2,ee):Math.max(.5,ee),_e=Math.pow(he,1-se),ye=N(e.worldSize,Q.add(J.mult(se*_e)).mult(fe));e.setLocationAtPoint(e.renderWorldCopies?ye.wrap():ye,z)}},isZooming:S,elevationCenter:R}}handleFlyTo(e,r){const l=r.zoom!==void 0,c=e.zoom,p=e.getConstrained(a.S.convert(r.center||r.locationAtOffset),l?+r.zoom:c),g=p.center,b=p.zoom;Cn(e,g);const C=Se(e.worldSize,r.locationAtOffset),S=Se(e.worldSize,g).sub(C),M=S.mag(),z=a.ae(b-c);let A;if(r.minZoom!==void 0){const R=Math.min(+r.minZoom,c,b),V=e.getConstrained(g,R).zoom;A=a.ae(V-c)}return{easeFunc:(R,V,Q,J)=>{e.setZoom(R===1?b:c+a.aj(V));const ee=R===1?g:N(e.worldSize,C.add(S.mult(Q)).mult(V));e.setLocationAtPoint(e.renderWorldCopies?ee.wrap():ee,J)},scaleOfZoom:z,targetCenter:g,scaleOfMinZoom:A,pixelPathLength:M}}}class ir{constructor(e,r,l){this.blendFunction=e,this.blendColor=r,this.mask=l}}ir.Replace=[1,0],ir.disabled=new ir(ir.Replace,a.be.transparent,[!1,!1,!1,!1]),ir.unblended=new ir(ir.Replace,a.be.transparent,[!0,!0,!0,!0]),ir.alphaBlended=new ir([1,771],a.be.transparent,[!0,!0,!0,!0]);const Ei=2305;class Nt{constructor(e,r,l){this.enable=e,this.mode=r,this.frontFace=l}}Nt.disabled=new Nt(!1,1029,Ei),Nt.backCCW=new Nt(!0,1029,Ei),Nt.frontCCW=new Nt(!0,1028,Ei);class $t{constructor(e,r,l){this.func=e,this.mask=r,this.range=l}}$t.ReadOnly=!1,$t.ReadWrite=!0,$t.disabled=new $t(519,$t.ReadOnly,[0,1]);const es=7680;class Lt{constructor(e,r,l,c,p,g){this.test=e,this.ref=r,this.mask=l,this.fail=c,this.depthFail=p,this.pass=g}}Lt.disabled=new Lt({func:519,mask:0},0,0,es,es,es);const ts=new WeakMap;function xi(d){var e;if(ts.has(d))return ts.get(d);{const r=(e=d.getParameter(d.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return ts.set(d,r),r}}class xs{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const r=e.context,l=r.gl;this._texFormat=l.RGBA,this._texType=l.UNSIGNED_BYTE;const c=new a.aK;c.emplaceBack(-1,-1),c.emplaceBack(2,-1),c.emplaceBack(-1,2);const p=new a.aM;p.emplaceBack(0,1,2),this._fullscreenTriangle=new xn(r.createVertexBuffer(c,wn.members),r.createIndexBuffer(p),a.aL.simpleSegment(0,0,c.length,p.length)),this._resultBuffer=new Uint8Array(4),r.activeTexture.set(l.TEXTURE1);const g=l.createTexture();l.bindTexture(l.TEXTURE_2D,g),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texImage2D(l.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=r.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(g),xi(l)&&(this._pbo=l.createBuffer(),l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo),l.bufferData(l.PIXEL_PACK_BUFFER,4,l.STREAM_READ),l.bindBuffer(l.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,r){const l=this._updateCount;return this._readbackQueue?l>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():l>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,r),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,r=e.gl;e.activeTexture.set(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,r){const l=this._cachedRenderContext.context,c=l.gl;if(this._bindFramebuffer(),l.viewport.set([0,0,this._texWidth,this._texHeight]),l.clear({color:a.be.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(l,c.TRIANGLES,$t.disabled,Lt.disabled,ir.unblended,Nt.disabled,((p,g)=>({u_input:p,u_output_expected:g}))(e,r),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&xi(c)){c.bindBuffer(c.PIXEL_PACK_BUFFER,this._pbo),c.readBuffer(c.COLOR_ATTACHMENT0),c.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),c.bindBuffer(c.PIXEL_PACK_BUFFER,null);const p=c.fenceSync(c.SYNC_GPU_COMMANDS_COMPLETE,0);c.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:p}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&xi(e)){const r=e.clientWaitSync(this._readbackQueue.sync,0,0);if(r===e.WAIT_FAILED)return a.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(r===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=xs._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let r=0;return r+=e[0]/256,r+=e[1]/65536,r+=e[2]/16777216,e[3]<127&&(r=-r),r/128}}const $i=a.$/128;function yl(d,e){const r=d.granularity!==void 0?Math.max(d.granularity,1):1,l=r+(d.generateBorders?2:0),c=r+(d.extendToNorthPole||d.generateBorders?1:0)+(d.extendToSouthPole||d.generateBorders?1:0),p=l+1,g=c+1,b=d.generateBorders?-1:0,C=d.generateBorders||d.extendToNorthPole?-1:0,S=r+(d.generateBorders?1:0),M=r+(d.generateBorders||d.extendToSouthPole?1:0),z=p*g,A=l*c*6,R=p*g>65536;if(R&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const V=R||e==="32bit",Q=new Int16Array(2*z);let J=0;for(let fe=C;fe<=M;fe++)for(let he=b;he<=S;he++){let _e=he/r*a.$;he===-1&&(_e=-64),he===r+1&&(_e=a.$+$i);let ye=fe/r*a.$;fe===-1&&(ye=d.extendToNorthPole?a.bg:-64),fe===r+1&&(ye=d.extendToSouthPole?a.bh:a.$+$i),Q[J++]=_e,Q[J++]=ye}const ee=V?new Uint32Array(A):new Uint16Array(A);let se=0;for(let fe=0;fe<c;fe++)for(let he=0;he<l;he++){const _e=he+1+fe*p,ye=he+(fe+1)*p,ue=he+1+(fe+1)*p;ee[se++]=he+fe*p,ee[se++]=ye,ee[se++]=_e,ee[se++]=_e,ee[se++]=ye,ee[se++]=ue}return{vertices:Q.buffer.slice(0),indices:ee.buffer.slice(0),uses32bitIndices:V}}const un=new a.aJ({fill:new a.bi(128,2),line:new a.bi(512,0),tile:new a.bi(128,32),stencil:new a.bi(128,1),circle:3});class rh{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return hn.projectionGlobe}get vertexShaderPreludeCode(){return hn.projectionMercator.vertexSource}get subdivisionGranularity(){return un}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new xs(e));const r=a.U(this._errorQueryLatitudeDegrees),l=2*Math.atan(Math.exp(Math.PI-r*Math.PI*2))-.5*Math.PI,c=this._errorMeasurement.updateErrorLoop(r,l),p=oe.now();c!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=c,this._errorMeasurementLastChangeTime=p);const g=Math.min(Math.max((p-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=a.bj(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,a.bk(g))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,r,l,c,p){const g=(p==="stencil"?un.stencil:un.tile).getGranularityForZoomLevel(r.z);return this._getMesh(e,{granularity:g,generateBorders:l,extendToNorthPole:r.y===0&&c,extendToSouthPole:r.y===(1<<r.z)-1&&c})}_getMesh(e,r){const l=this._getMeshKey(r);if(l in this._tileMeshCache)return this._tileMeshCache[l];const c=function(p,g){const b=yl(g,"16bit"),C=a.aK.deserialize({arrayBuffer:b.vertices,length:b.vertices.byteLength/2/2}),S=a.aM.deserialize({arrayBuffer:b.indices,length:b.indices.byteLength/2/3});return new xn(p.createVertexBuffer(C,wn.members),p.createIndexBuffer(S),a.aL.simpleSegment(0,0,C.length,S.length))}(e,r);return this._tileMeshCache[l]=c,c}recalculate(e){}hasTransition(){const e=oe.now();let r=!1;return r=r||(e-this._errorMeasurementLastChangeTime)/1e3<.7,r=r||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,r}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const ih=new a.r({type:new a.D(a.v.projection.type)});class uo extends a.E{constructor(e){super(),this._transitionable=new a.t(ih),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.F(0)),this._mercatorProjection=new _l,this._verticalPerspectiveProjection=new rh}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof a.bl){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,r,l,c,p){return this.currentProjection.getMeshFromTileID(e,r,l,c,p)}setProjection(e){this._transitionable.setValue("type",(e==null?void 0:e.type)||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function po(d){const e=ws(d.worldSize,d.center.lat);return 2*Math.PI*e}function Ki(d,e,r,l,c){const p=1/(1<<c),g=e/a.$*p+l*p,b=a.bn((d/a.$*p+r*p)*Math.PI*2+Math.PI,2*Math.PI),C=2*Math.atan(Math.exp(Math.PI-g*Math.PI*2))-.5*Math.PI,S=Math.cos(C),M=new Float64Array(3);return M[0]=Math.sin(b)*S,M[1]=Math.sin(C),M[2]=Math.cos(b)*S,M}function Qr(d){return function(e,r){const l=Math.cos(r),c=new Float64Array(3);return c[0]=Math.sin(e)*l,c[1]=Math.sin(r),c[2]=Math.cos(e)*l,c}(d.lng*Math.PI/180,d.lat*Math.PI/180)}function ws(d,e){return d/(2*Math.PI)/Math.cos(e*Math.PI/180)}function fo(d){const e=Math.asin(d[1])/Math.PI*180,r=Math.sqrt(d[0]*d[0]+d[2]*d[2]);if(r>1e-6){const l=d[0]/r,c=Math.acos(d[2]/r),p=(l>0?c:-c)/Math.PI*180;return new a.S(a.aN(p,-180,180),e)}return new a.S(0,e)}function Cs(d){return Math.cos(d*Math.PI/180)}function Zr(d,e){const r=Cs(d),l=Cs(e);return a.aj(l/r)}function mo(d,e){const r=d.rotate(e.bearingInRadians),l=e.zoom+Zr(e.center.lat,0),c=a.bj(1/Cs(e.center.lat),1/Cs(Math.min(Math.abs(e.center.lat),60)),a.bm(l,7,3,0,1)),p=360/po({worldSize:e.worldSize,center:{lat:e.center.lat}});return new a.S(e.center.lng-r.x*p*c,a.ag(e.center.lat+r.y*p,-85.051129,a.ah))}function Ps(d){const e=.5*d,r=Math.sin(e),l=Math.cos(e);return Math.log(r+l)-Math.log(l-r)}function Ts(d,e,r,l){const c=d.lat+r*l;if(Math.abs(r)>1){const p=(Math.sign(d.lat+r)!==Math.sign(d.lat)?-Math.abs(d.lat):Math.abs(d.lat))*Math.PI/180,g=Math.abs(d.lat+r)*Math.PI/180,b=Ps(p+l*(g-p)),C=Ps(p),S=Ps(g);return new a.S(d.lng+e*((b-C)/(S-C)),c)}return new a.S(d.lng+e*l,c)}class Pu{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,r,l,c){const p=`${e.z}_${e.x}_${e.y}_${c!=null&&c.terrain?"t":""}`,g=this._cache.get(p);if(g)return g;const b=this._cachePrevious.get(p);if(b)return this._cache.set(p,b),b;const C=this._boundingVolumeFactory(e,r,l,c);return this._cache.set(p,C),this._hadAnyChanges=!0,C}}class Ln{constructor(e,r,l,c){this.min=l,this.max=c,this.points=e,this.planes=r}static fromAabb(e,r){const l=[];for(let c=0;c<8;c++)l.push([1&~c?e[0]:r[0],(c>>1&1)==1?r[1]:e[1],(c>>2&1)==1?r[2]:e[2]]);return new Ln(l,[[-1,0,0,r[0]],[1,0,0,-e[0]],[0,-1,0,r[1]],[0,1,0,-e[1]],[0,0,-1,r[2]],[0,0,1,-e[2]]],e,r)}static fromCenterSizeAngles(e,r,l){const c=a.bq([],l[0],l[1],l[2]),p=a.br([],[r[0],0,0],c),g=a.br([],[0,r[1],0],c),b=a.br([],[0,0,r[2]],c),C=[...e],S=[...e];for(let z=0;z<8;z++)for(let A=0;A<3;A++){const R=e[A]+p[A]*(1&~z?-1:1)+g[A]*((z>>1&1)==1?1:-1)+b[A]*((z>>2&1)==1?1:-1);C[A]=Math.min(C[A],R),S[A]=Math.max(S[A],R)}const M=[];for(let z=0;z<8;z++){const A=[...e];a.aR(A,A,a.aQ([],p,1&~z?-1:1)),a.aR(A,A,a.aQ([],g,(z>>1&1)==1?1:-1)),a.aR(A,A,a.aQ([],b,(z>>2&1)==1?1:-1)),M.push(A)}return new Ln(M,[[...p,-a.aW(p,M[0])],[...g,-a.aW(g,M[0])],[...b,-a.aW(b,M[0])],[-p[0],-p[1],-p[2],-a.aW(p,M[7])],[-g[0],-g[1],-g[2],-a.aW(g,M[7])],[-b[0],-b[1],-b[2],-a.aW(b,M[7])]],C,S)}intersectsFrustum(e){let r=!0;const l=this.points.length,c=this.planes.length,p=e.planes.length,g=e.points.length;for(let b=0;b<p;b++){const C=e.planes[b];let S=0;for(let M=0;M<l;M++){const z=this.points[M];C[0]*z[0]+C[1]*z[1]+C[2]*z[2]+C[3]>=0&&S++}if(S===0)return 0;S<l&&(r=!1)}if(r)return 2;for(let b=0;b<c;b++){const C=this.planes[b];let S=0;for(let M=0;M<g;M++){const z=e.points[M];C[0]*z[0]+C[1]*z[1]+C[2]*z[2]+C[3]>=0&&S++}if(S===0)return 0}return 1}intersectsPlane(e){const r=this.points.length;let l=0;for(let c=0;c<r;c++){const p=this.points[c];e[0]*p[0]+e[1]*p[1]+e[2]*p[2]+e[3]>=0&&l++}return l===r?2:l===0?0:1}}function _o(d,e,r){const l=d-e;return l<0?-l:Math.max(0,l-r)}function vl(d,e,r,l,c){const p=d-r;let g;return g=p<0?Math.min(-p,1+p-c):p>1?Math.min(Math.max(p-c,0),1-p):0,Math.max(g,_o(e,l,c))}class Tu{constructor(){this._boundingVolumeCache=new Pu(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,r,l,c){const p=1<<l.z,g=1/p,b=l.x/p,C=l.y/p;let S=2;return S=Math.min(S,vl(e,r,b,C,g)),S=Math.min(S,vl(e,r,b+.5,-C-g,g)),S=Math.min(S,vl(e,r,b+.5,2-C-g,g)),S}getWrap(e,r,l){const c=1<<r.z,p=1/c,g=r.x/c,b=_o(e.x,g,p),C=_o(e.x,g-1,p),S=_o(e.x,g+1,p),M=Math.min(b,C,S);return M===S?1:M===C?-1:0}allowVariableZoom(e,r){return $e(e,r)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,r,l,c){return this._boundingVolumeCache.getTileBoundingVolume(e,r,l,c)}_computeTileBoundingVolume(e,r,l,c){var p,g;let b=l,C=l;if(c!=null&&c.terrain){const S=new a.Z(e.z,r,e.z,e.x,e.y),M=c.terrain.getMinMaxElevation(S);b=(p=M.minElevation)!==null&&p!==void 0?p:l,C=(g=M.maxElevation)!==null&&g!==void 0?g:l}if(b/=a.bt,C/=a.bt,b+=1,C+=1,e.z<=0)return Ln.fromAabb([-C,-C,-C],[C,C,C]);if(e.z===1)return Ln.fromAabb([e.x===0?-C:0,e.y===0?0:-C,-C],[e.x===0?0:C,e.y===0?C:0,C]);{const S=[Ki(0,0,e.x,e.y,e.z),Ki(a.$,0,e.x,e.y,e.z),Ki(a.$,a.$,e.x,e.y,e.z),Ki(0,a.$,e.x,e.y,e.z)],M=[];for(const Re of S)M.push(a.aQ([],Re,C));if(C!==b)for(const Re of S)M.push(a.aQ([],Re,b));e.y===0&&M.push([0,1,0]),e.y===(1<<e.z)-1&&M.push([0,-1,0]);const z=[1,1,1],A=[-1,-1,-1];for(const Re of M)for(let je=0;je<3;je++)z[je]=Math.min(z[je],Re[je]),A[je]=Math.max(A[je],Re[je]);const R=Ki(a.$/2,a.$/2,e.x,e.y,e.z),V=a.aV([],[0,1,0],R);a.aU(V,V);const Q=a.aV([],R,V);a.aU(Q,Q);const J=a.aV([],S[2],S[1]);a.aU(J,J);const ee=a.aV([],S[0],S[3]);a.aU(ee,ee),M.push(a.aQ([],R,C)),e.y>=(1<<e.z)/2&&M.push(a.aQ([],Ki(a.$/2,0,e.x,e.y,e.z),C)),e.y<(1<<e.z)/2&&M.push(a.aQ([],Ki(a.$/2,a.$,e.x,e.y,e.z),C));const se=wi(R,M),fe=wi(Q,M),he=[-R[0],-R[1],-R[2],se.max],_e=[R[0],R[1],R[2],-se.min],ye=[-Q[0],-Q[1],-Q[2],fe.max],ue=[Q[0],Q[1],Q[2],-fe.min],Ce=[...J,0],Be=[...ee,0],De=[];return e.y===0?De.push(a.bs(Be,Ce,he),a.bs(Be,Ce,_e)):De.push(a.bs(ye,Ce,he),a.bs(ye,Ce,_e),a.bs(ye,Be,he),a.bs(ye,Be,_e)),e.y===(1<<e.z)-1?De.push(a.bs(Be,Ce,he),a.bs(Be,Ce,_e)):De.push(a.bs(ue,Ce,he),a.bs(ue,Ce,_e),a.bs(ue,Be,he),a.bs(ue,Be,_e)),new Ln(De,[he,_e,ye,ue,Ce,Be],z,A)}}}function wi(d,e){let r=1/0,l=-1/0;for(const c of e){const p=a.aW(d,c);r=Math.min(r,p),l=Math.max(l,p)}return{min:r,max:l}}class Ss{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,l){return this._helper.interpolatePadding(e,r,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r){this._helper.resize(e,r)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=a.bu(),this._projectionMatrix=a.b8(),this._globeViewProjMatrix32f=a.b7(),this._globeViewProjMatrixNoCorrection=a.b8(),this._globeViewProjMatrixNoCorrectionInverted=a.b8(),this._globeProjMatrixInverted=a.b8(),this._cameraPosition=a.bo(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new ho({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,r)=>this.getConstrained(e,r)}),this._coveringTilesDetailsProvider=new Tu}clone(){const e=new Ss;return e.apply(this),e}apply(e,r){this._globeLatitudeErrorCorrectionRadians=r||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=a.bo();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:r,applyGlobeMatrix:l}=e,c=this._helper.getMercatorTileCoordinates(r);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:c,clippingPlane:this._cachedClippingPlane,projectionTransition:l?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const r=this.pitchInRadians,l=this.cameraToCenterDistance/e,c=Math.sin(r)*l,p=Math.cos(r)*l+1,g=1/Math.sqrt(c*c+p*p)*1;let b=-c,C=p;const S=Math.sqrt(b*b+C*C);b/=S,C/=S;const M=[0,b,C];a.bv(M,M,[0,0,0],-this.bearingInRadians),a.bw(M,M,[0,0,0],-1*this.center.lat*Math.PI/180),a.bx(M,M,[0,0,0],this.center.lng*Math.PI/180);const z=1/a.aY(M);return a.aQ(M,M,z),[...M,-g*z]}isLocationOccluded(e){return!this.isSurfacePointVisible(Qr(e))}transformLightDirection(e){const r=this._helper._center.lng*Math.PI/180,l=this._helper._center.lat*Math.PI/180,c=Math.cos(l),p=[Math.sin(r)*c,Math.sin(l),Math.cos(r)*c],g=[p[2],0,-p[0]],b=[0,0,0];a.aV(b,g,p),a.aU(g,g),a.aU(b,b);const C=[0,0,0];return a.aU(C,[g[0]*e[0]+b[0]*e[1]+p[0]*e[2],g[1]*e[0]+b[1]*e[1]+p[1]*e[2],g[2]*e[0]+b[2]*e[1]+p[2]*e[2]]),C}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,r,l){const c=function(b,C,S){const M=1/(1<<S.z);return new a.a0(b/a.$*M+S.x*M,C/a.$*M+S.y*M)}(e,r,l.canonical),p=(g=c.y,[a.bn(c.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-g*Math.PI*2))-.5*Math.PI]);var g;return this.getCircleRadiusCorrection()/Math.cos(p[1])}projectTileCoordinates(e,r,l,c){const p=l.canonical,g=Ki(e,r,p.x,p.y,p.z),b=1+(c?c(e,r):0)/a.bt,C=[g[0]*b,g[1]*b,g[2]*b,1];a.av(C,C,this._globeViewProjMatrixNoCorrection);const S=this._cachedClippingPlane,M=S[0]*g[0]+S[1]*g[1]+S[2]*g[2]+S[3]<0;return{point:new a.P(C[0]/C[3],C[1]/C[3]),signedDistanceFromCamera:C[3],isOccluded:M}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=ws(this.worldSize,this.center.lat),r=a.b9(),l=a.b9();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),a.b3(r,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const c=this.centerOffset;r[8]=2*-c.x/this._helper._width,r[9]=2*c.y/this._helper._height,this._projectionMatrix=a.b4(r),this._globeProjMatrixInverted=a.b9(),a.ap(this._globeProjMatrixInverted,r),a.M(r,r,[0,0,-this.cameraToCenterDistance]),a.b5(r,r,this.rollInRadians),a.b6(r,r,-this.pitchInRadians),a.b5(r,r,this.bearingInRadians),a.M(r,r,[0,0,-e]);const p=a.bo();p[0]=e,p[1]=e,p[2]=e,a.b6(l,r,this.center.lat*Math.PI/180),a.by(l,l,-this.center.lng*Math.PI/180),a.N(l,l,p),this._globeViewProjMatrixNoCorrection=l,a.b6(r,r,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),a.by(r,r,-this.center.lng*Math.PI/180),a.N(r,r,p),this._globeViewProjMatrix32f=new Float32Array(r),this._globeViewProjMatrixNoCorrectionInverted=a.b9(),a.ap(this._globeViewProjMatrixNoCorrectionInverted,l);const g=a.bo();this._cameraPosition=a.bo(),this._cameraPosition[2]=this.cameraToCenterDistance/e,a.bv(this._cameraPosition,this._cameraPosition,g,-this.rollInRadians),a.bw(this._cameraPosition,this._cameraPosition,g,this.pitchInRadians),a.bv(this._cameraPosition,this._cameraPosition,g,-this.bearingInRadians),a.aR(this._cameraPosition,this._cameraPosition,[0,0,1]),a.bw(this._cameraPosition,this._cameraPosition,g,-this.center.lat*Math.PI/180),a.bx(this._cameraPosition,this._cameraPosition,g,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const b=a.b4(this._globeViewProjMatrixNoCorrectionInverted);a.N(b,b,[1,1,-1]),this._cachedFrustum=gi.fromInvProjectionMatrix(b,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){a.w("calculateFogMatrix is not supported on globe projection.");const r=a.b9();return a.af(r),r}getVisibleUnwrappedCoordinates(e){return[new a.b1(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&a.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,r){if(!this._globeViewProjMatrixNoCorrection)return 1;const l=Qr(e);a.aQ(l,l,1+r/a.bt);const c=a.bu();return a.av(c,[l[0],l[1],l[2],1],this._globeViewProjMatrixNoCorrection),c[2]/c[3]}populateCache(e){}getBounds(){const e=.5*this.width,r=.5*this.height,l=[new a.P(0,0),new a.P(e,0),new a.P(this.width,0),new a.P(this.width,r),new a.P(this.width,this.height),new a.P(e,this.height),new a.P(0,this.height),new a.P(0,r)],c=[];for(const z of l)c.push(this.unprojectScreenPoint(z));let p=0,g=0,b=0,C=0;const S=this.center;for(const z of c){const A=a.bz(S.lng,z.lng),R=a.bz(S.lat,z.lat);A<g&&(g=A),A>p&&(p=A),R<C&&(C=R),R>b&&(b=R)}const M=[S.lng+g,S.lat+C,S.lng+p,S.lat+b];return this.isSurfacePointOnScreen([0,1,0])&&(M[3]=90,M[0]=-180,M[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(M[1]=-90,M[0]=-180,M[2]=180),new ar(M)}getConstrained(e,r){const l=a.ag(e.lat,-85.051129,a.ah),c=a.ag(+r,this.minZoom+Zr(0,l),this.maxZoom);return{center:new a.S(e.lng,l),zoom:c}}calculateCenterFromCameraLngLatAlt(e,r,l,c){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,l,c)}setLocationAtPoint(e,r){const l=Qr(this.unprojectScreenPoint(r)),c=Qr(e),p=a.bo();a.bA(p);const g=a.bo();a.bx(g,l,p,-this.center.lng*Math.PI/180),a.bw(g,g,p,this.center.lat*Math.PI/180);const b=c[0]*c[0]+c[2]*c[2],C=g[0]*g[0];if(b<C)return;const S=Math.sqrt(b-C),M=-S,z=a.bB(c[0],c[2],g[0],S),A=a.bB(c[0],c[2],g[0],M),R=a.bo();a.bx(R,c,p,-z);const V=a.bB(R[1],R[2],g[1],g[2]),Q=a.bo();a.bx(Q,c,p,-A);const J=a.bB(Q[1],Q[2],g[1],g[2]),ee=.5*Math.PI,se=V>=-ee&&V<=ee,fe=J>=-ee&&J<=ee;let he,_e;if(se&&fe){const Be=this.center.lng*Math.PI/180,De=this.center.lat*Math.PI/180;a.bC(z,Be)+a.bC(V,De)<a.bC(A,Be)+a.bC(J,De)?(he=z,_e=V):(he=A,_e=J)}else if(se)he=z,_e=V;else{if(!fe)return;he=A,_e=J}const ye=he/Math.PI*180,ue=_e/Math.PI*180,Ce=this.center.lat;this.setCenter(new a.S(ye,a.ag(ue,-90,90))),this.setZoom(this.zoom+Zr(Ce,this.center.lat))}locationToScreenPoint(e,r){const l=Qr(e);if(r){const c=r.getElevationForLngLatZoom(e,this._helper._tileZoom);a.aQ(l,l,1+c/a.bt)}return this._projectSurfacePointToScreen(l)}_projectSurfacePointToScreen(e){const r=a.bu();return a.av(r,[...e,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],new a.P((.5*r[0]+.5)*this.width,(.5*-r[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,r){if(r){const l=r.pointCoordinate(e);if(l)return l}return a.a0.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,r){var l;return(l=this.screenPointToMercatorCoordinate(e,r))===null||l===void 0?void 0:l.toLngLat()}isPointOnMapSurface(e,r){const l=this._cameraPosition,c=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(l,c)}getRayDirectionFromPixel(e){const r=a.bu();r[0]=e.x/this.width*2-1,r[1]=-1*(e.y/this.height*2-1),r[2]=1,r[3]=1,a.av(r,r,this._globeViewProjMatrixNoCorrectionInverted),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3];const l=a.bo();l[0]=r[0]-this._cameraPosition[0],l[1]=r[1]-this._cameraPosition[1],l[2]=r[2]-this._cameraPosition[2];const c=a.bo();return a.aU(c,l),c}isSurfacePointVisible(e){const r=this._cachedClippingPlane;return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const r=a.bu();return a.av(r,[...e,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3],r[0]>-1&&r[0]<1&&r[1]>-1&&r[1]<1&&r[2]>-1&&r[2]<1}rayPlanetIntersection(e,r){const l=a.aW(e,r),c=a.bo(),p=a.bo();a.aQ(p,r,l),a.aT(c,e,p);const g=1-a.aW(c,c);if(g<0)return null;const b=a.aW(e,e)-1,C=-l+(l<0?1:-1)*Math.sqrt(g),S=b/C,M=C;return{tMin:Math.min(S,M),tMax:Math.max(S,M)}}unprojectScreenPoint(e){const r=this._cameraPosition,l=this.getRayDirectionFromPixel(e),c=this.rayPlanetIntersection(r,l);if(c){const M=a.bo();a.aR(M,r,[l[0]*c.tMin,l[1]*c.tMin,l[2]*c.tMin]);const z=a.bo();return a.aU(z,M),fo(z)}const p=this._cachedClippingPlane,g=p[0]*l[0]+p[1]*l[1]+p[2]*l[2],b=-a.b0(p,r)/g,C=a.bo();if(b>0)a.aR(C,r,[l[0]*b,l[1]*b,l[2]*b]);else{const M=a.bo();a.aR(M,r,[2*l[0],2*l[1],2*l[2]]);const z=a.b0(this._cachedClippingPlane,M);a.aT(C,M,[this._cachedClippingPlane[0]*z,this._cachedClippingPlane[1]*z,this._cachedClippingPlane[2]*z])}const S=function(M){const z=a.bo();return z[0]=M[0]*-M[3],z[1]=M[1]*-M[3],z[2]=M[2]*-M[3],{center:z,radius:Math.sqrt(1-M[3]*M[3])}}(p);return fo(function(M,z,A){const R=a.bo();a.aT(R,A,M);const V=a.bo();return a.bp(V,M,R,z/a.a_(R)),V}(S.center,S.radius,C))}getMatrixForModel(e,r){const l=a.S.convert(e),c=1/a.bt,p=a.b8();return a.by(p,p,l.lng/180*Math.PI),a.b6(p,p,-l.lat/180*Math.PI),a.M(p,p,[0,0,1+r/a.bt]),a.b6(p,p,.5*Math.PI),a.N(p,p,[c,c,c]),p}getProjectionDataForCustomLayer(e=!0){const r=this.getProjectionData({overscaledTileID:new a.Z(0,0,0,0,0),applyGlobeMatrix:e});return r.tileMercatorCoords=[0,0,1,1],r}getFastPathSimpleProjectionMatrix(e){}}class Fi{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,l){return this._helper.interpolatePadding(e,r,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r,l=!0){this._helper.resize(e,r,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,r){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=r,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new ho({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,r)=>this.getConstrained(e,r)}),this._globeness=1,this._mercatorTransform=new $r,this._verticalPerspectiveTransform=new Ss}clone(){const e=new Fi;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const r=this._mercatorTransform.getProjectionData(e),l=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?l.mainMatrix:r.mainMatrix,clippingPlane:l.clippingPlane,tileMercatorCoords:l.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:r.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return a.bj(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return a.bj(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,r,l){const c=this._mercatorTransform.getPitchedTextCorrection(e,r,l),p=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,r,l);return a.bj(c,p,this._globeness)}projectTileCoordinates(e,r,l,c){return this.currentTransform.projectTileCoordinates(e,r,l,c)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,r){return this.currentTransform.lngLatToCameraDepth(e,r)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,r){return this.currentTransform.getConstrained(e,r)}calculateCenterFromCameraLngLatAlt(e,r,l,c){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,l,c)}setLocationAtPoint(e,r){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,r),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,r),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,r){return this.currentTransform.locationToScreenPoint(e,r)}screenPointToMercatorCoordinate(e,r){return this.currentTransform.screenPointToMercatorCoordinate(e,r)}screenPointToLocation(e,r){return this.currentTransform.screenPointToLocation(e,r)}isPointOnMapSurface(e,r){return this.currentTransform.isPointOnMapSurface(e,r)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,r){return this.currentTransform.getMatrixForModel(e,r)}getProjectionDataForCustomLayer(e=!0){const r=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return r;const l=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return l.fallbackMatrix=r.mainMatrix,l}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class ki{get useGlobeControls(){return!0}handlePanInertia(e,r){const l=mo(e,r);return Math.abs(l.lng-r.center.lng)>180&&(l.lng=r.center.lng+179.5*Math.sign(l.lng-r.center.lng)),{easingCenter:l,easingOffset:new a.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,r){const l=e.around,c=r.screenPointToLocation(l);e.bearingDelta&&r.setBearing(r.bearing+e.bearingDelta),e.pitchDelta&&r.setPitch(r.pitch+e.pitchDelta),e.rollDelta&&r.setRoll(r.roll+e.rollDelta);const p=r.zoom;e.zoomDelta&&r.setZoom(r.zoom+e.zoomDelta);const g=r.zoom-p;if(g===0)return;const b=a.bz(r.center.lng,c.lng),C=b/(Math.abs(b/180)+1),S=a.bz(r.center.lat,c.lat),M=r.getRayDirectionFromPixel(l),z=r.cameraPosition,A=-1*a.aW(z,M),R=a.bo();a.aR(R,z,[M[0]*A,M[1]*A,M[2]*A]);const V=a.aY(R)-1,Q=Math.exp(.5*-Math.max(V-.3,0)),J=ws(r.worldSize,r.center.lat)/Math.min(r.width,r.height),ee=a.bm(J,.9,.5,1,.25),se=(1-a.ae(-g))*Math.min(Q,ee),fe=r.center.lat,he=r.zoom,_e=new a.S(r.center.lng+C*se,a.ag(r.center.lat+S*se,-85.051129,a.ah));r.setLocationAtPoint(c,l);const ye=r.center,ue=a.bm(Math.abs(b),45,85,0,1),Ce=a.bm(J,.75,.35,0,1),Be=Math.pow(Math.max(ue,Ce),.25),De=a.bz(ye.lng,_e.lng),Re=a.bz(ye.lat,_e.lat);r.setCenter(new a.S(ye.lng+De*Be,ye.lat+Re*Be).wrap()),r.setZoom(he+Zr(fe,r.center.lat))}handleMapControlsPan(e,r,l){if(!e.panDelta)return;const c=r.center.lat,p=r.zoom;r.setCenter(mo(e.panDelta,r).wrap()),r.setZoom(p+Zr(c,r.center.lat))}cameraForBoxAndBearing(e,r,l,c,p){const g=Er(e,r,l,c,p),b=r.left/p.width*2-1,C=(p.width-r.right)/p.width*2-1,S=r.top/p.height*-2+1,M=(p.height-r.bottom)/p.height*-2+1,z=a.bz(l.getWest(),l.getEast())<0,A=z?l.getEast():l.getWest(),R=z?l.getWest():l.getEast(),V=Math.max(l.getNorth(),l.getSouth()),Q=Math.min(l.getNorth(),l.getSouth()),J=A+.5*a.bz(A,R),ee=V+.5*a.bz(V,Q),se=p.clone();se.setCenter(g.center),se.setBearing(g.bearing),se.setPitch(0),se.setRoll(0),se.setZoom(g.zoom);const fe=se.modelViewProjectionMatrix,he=[Qr(l.getNorthWest()),Qr(l.getNorthEast()),Qr(l.getSouthWest()),Qr(l.getSouthEast()),Qr(new a.S(R,ee)),Qr(new a.S(A,ee)),Qr(new a.S(J,V)),Qr(new a.S(J,Q))],_e=Qr(g.center);let ye=Number.POSITIVE_INFINITY;for(const ue of he)b<0&&(ye=ki.getLesserNonNegativeNonNull(ye,ki.solveVectorScale(ue,_e,fe,"x",b))),C>0&&(ye=ki.getLesserNonNegativeNonNull(ye,ki.solveVectorScale(ue,_e,fe,"x",C))),S>0&&(ye=ki.getLesserNonNegativeNonNull(ye,ki.solveVectorScale(ue,_e,fe,"y",S))),M<0&&(ye=ki.getLesserNonNegativeNonNull(ye,ki.solveVectorScale(ue,_e,fe,"y",M)));if(Number.isFinite(ye)&&ye!==0)return g.zoom=se.zoom+a.aj(ye),g;yi()}handleJumpToCenterZoom(e,r){const l=e.center.lat,c=e.getConstrained(r.center?a.S.convert(r.center):e.center,e.zoom).center;e.setCenter(c.wrap());const p=r.zoom!==void 0?+r.zoom:e.zoom+Zr(l,c.lat);e.zoom!==p&&e.setZoom(p)}handleEaseTo(e,r){const l=e.zoom,c=e.center,p=e.padding,g={roll:e.roll,pitch:e.pitch,bearing:e.bearing},b={roll:r.roll===void 0?e.roll:r.roll,pitch:r.pitch===void 0?e.pitch:r.pitch,bearing:r.bearing===void 0?e.bearing:r.bearing},C=r.zoom!==void 0,S=!e.isPaddingEqual(r.padding);let M=!1;const z=r.center?a.S.convert(r.center):c,A=e.getConstrained(z,l).center;Cn(e,A);const R=e.clone();R.setCenter(A),R.setZoom(C?+r.zoom:l+Zr(c.lat,z.lat)),R.setBearing(r.bearing);const V=new a.P(a.ag(e.centerPoint.x+r.offsetAsPoint.x,0,e.width),a.ag(e.centerPoint.y+r.offsetAsPoint.y,0,e.height));R.setLocationAtPoint(A,V);const Q=(r.offset&&r.offsetAsPoint.mag())>0?R.center:A,J=C?+r.zoom:l+Zr(c.lat,Q.lat),ee=l+Zr(c.lat,0),se=J+Zr(Q.lat,0),fe=a.bz(c.lng,Q.lng),he=a.bz(c.lat,Q.lat),_e=a.ae(se-ee);return M=J!==l,{easeFunc:ye=>{if(a.bd(g,b)||Jr({startEulerAngles:g,endEulerAngles:b,tr:e,k:ye,useSlerp:g.roll!=b.roll}),S&&e.interpolatePadding(p,r.padding,ye),r.around)a.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(r.around,r.aroundPoint);else{const ue=se>ee?Math.min(2,_e):Math.max(.5,_e),Ce=Math.pow(ue,1-ye),Be=Ts(c,fe,he,ye*Ce);e.setCenter(Be.wrap())}if(M){const ue=a.C.number(ee,se,ye)+Zr(0,e.center.lat);e.setZoom(ue)}},isZooming:M,elevationCenter:Q}}handleFlyTo(e,r){const l=r.zoom!==void 0,c=e.center,p=e.zoom,g=e.padding,b=!e.isPaddingEqual(r.padding),C=e.getConstrained(a.S.convert(r.center||r.locationAtOffset),p).center,S=l?+r.zoom:e.zoom+Zr(e.center.lat,C.lat),M=e.clone();M.setCenter(C),M.setZoom(S),M.setBearing(r.bearing);const z=new a.P(a.ag(e.centerPoint.x+r.offsetAsPoint.x,0,e.width),a.ag(e.centerPoint.y+r.offsetAsPoint.y,0,e.height));M.setLocationAtPoint(C,z);const A=M.center;Cn(e,A);const R=function(he,_e,ye){const ue=Qr(_e),Ce=Qr(ye),Be=a.aW(ue,Ce),De=Math.acos(Be),Re=po(he);return De/(2*Math.PI)*Re}(e,c,A),V=p+Zr(c.lat,0),Q=S+Zr(A.lat,0),J=a.ae(Q-V);let ee;if(typeof r.minZoom=="number"){const he=+r.minZoom+Zr(A.lat,0),_e=Math.min(he,V,Q)+Zr(0,A.lat),ye=e.getConstrained(A,_e).zoom+Zr(A.lat,0);ee=a.ae(ye-V)}const se=a.bz(c.lng,A.lng),fe=a.bz(c.lat,A.lat);return{easeFunc:(he,_e,ye,ue)=>{const Ce=Ts(c,se,fe,ye);b&&e.interpolatePadding(g,r.padding,he);const Be=he===1?A:Ce;e.setCenter(Be.wrap());const De=V+a.aj(_e);e.setZoom(he===1?S:De+Zr(0,Be.lat))},scaleOfZoom:J,targetCenter:A,scaleOfMinZoom:ee,pixelPathLength:R}}static solveVectorScale(e,r,l,c,p){const g=c==="x"?[l[0],l[4],l[8],l[12]]:[l[1],l[5],l[9],l[13]],b=[l[3],l[7],l[11],l[15]],C=e[0]*g[0]+e[1]*g[1]+e[2]*g[2],S=e[0]*b[0]+e[1]*b[1]+e[2]*b[2],M=r[0]*g[0]+r[1]*g[1]+r[2]*g[2],z=r[0]*b[0]+r[1]*b[1]+r[2]*b[2];return M+p*S===C+p*z||b[3]*(C-M)+g[3]*(z-S)+C*z==M*S?null:(M+g[3]-p*z-p*b[3])/(M-C-p*z+p*S)}static getLesserNonNegativeNonNull(e,r){return r!==null&&r>=0&&r<e?r:e}}class bl{constructor(e){this._globe=e,this._mercatorCameraHelper=new ha,this._verticalPerspectiveCameraHelper=new ki}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,r){return this.currentHelper.handlePanInertia(e,r)}handleMapControlsRollPitchBearingZoom(e,r){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,r)}handleMapControlsPan(e,r,l){this.currentHelper.handleMapControlsPan(e,r,l)}cameraForBoxAndBearing(e,r,l,c,p){return this.currentHelper.cameraForBoxAndBearing(e,r,l,c,p)}handleJumpToCenterZoom(e,r){this.currentHelper.handleJumpToCenterZoom(e,r)}handleEaseTo(e,r){return this.currentHelper.handleEaseTo(e,r)}handleFlyTo(e,r){return this.currentHelper.handleFlyTo(e,r)}}const go=(d,e)=>a.y(d,e&&e.filter(r=>r.identifier!=="source.canvas")),Es=a.bD();class xl extends a.E{constructor(e,r={}){super(),this._rtlPluginLoaded=()=>{for(const l in this.sourceCaches){const c=this.sourceCaches[l].getSource().type;c!=="vector"&&c!=="geojson"||this.sourceCaches[l].reload()}},this.map=e,this.dispatcher=new fr(gt(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(l,c)=>this.getGlyphs(l,c)),this.dispatcher.registerMessageHandler("GI",(l,c)=>this.getImages(l,c)),this.imageManager=new Ke,this.imageManager.setEventedParent(this),this.glyphManager=new Xe(e._requestManager,r.localIdeographFontFamily),this.lineAtlas=new dt(256,512),this.crossTileSymbolIndex=new aa,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.bE,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",a.bF()),Xt().on(wt,this._rtlPluginLoaded),this.on("data",l=>{if(l.dataType!=="source"||l.sourceDataType!=="metadata")return;const c=this.sourceCaches[l.sourceId];if(!c)return;const p=c.getSource();if(p&&p.vectorLayerIds)for(const g in this._layers){const b=this._layers[g];b.source===p.id&&this._validateLayer(b)}})}setGlobalStateProperty(e,r){var l,c,p;this._checkLoaded();const g=r===null?(p=(c=(l=this.stylesheet.state)===null||l===void 0?void 0:l[e])===null||c===void 0?void 0:c.default)!==null&&p!==void 0?p:null:r;if(a.bG(g,this._globalState[e]))return this;this._globalState[e]=g;const b=this._findGlobalStateAffectedSources([e]);for(const C in this.sourceCaches)b.has(C)&&(this._reloadSource(C),this._changed=!0)}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();const r=[];for(const c in e)!a.bG(this._globalState[c],e[c].default)&&(r.push(c),this._globalState[c]=e[c].default);const l=this._findGlobalStateAffectedSources(r);for(const c in this.sourceCaches)l.has(c)&&(this._reloadSource(c),this._changed=!0)}_findGlobalStateAffectedSources(e){if(e.length===0)return new Set;const r=new Set;for(const l in this._layers){const c=this._layers[l],p=c.getLayoutAffectingGlobalStateRefs();for(const g of e)p.has(g)&&r.add(c.source)}return r}loadURL(e,r={},l){this.fire(new a.l("dataloading",{dataType:"style"})),r.validate=typeof r.validate!="boolean"||r.validate;const c=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const p=this._loadStyleRequest;a.j(c,this._loadStyleRequest).then(g=>{this._loadStyleRequest=null,this._load(g.data,r,l)}).catch(g=>{this._loadStyleRequest=null,g&&!p.signal.aborted&&this.fire(new a.k(g))})}loadJSON(e,r={},l){this.fire(new a.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,oe.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,r.validate=r.validate!==!1,this._load(e,r,l)}).catch(()=>{})}loadEmpty(){this.fire(new a.l("dataloading",{dataType:"style"})),this._load(Es,{validate:!1})}_load(e,r,l){var c,p,g;const b=r.transformStyle?r.transformStyle(l,e):e;if(!r.validate||!go(this,a.z(b))){this._loaded=!0,this.stylesheet=b;for(const C in b.sources)this.addSource(C,b.sources[C],{validate:!1});b.sprite?this._loadSprite(b.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(b.glyphs),this._createLayers(),this.light=new jt(this.stylesheet.light),this._setProjectionInternal(((c=this.stylesheet.projection)===null||c===void 0?void 0:c.type)||"mercator"),this.sky=new Gt(this.stylesheet.sky),this.map.setTerrain((p=this.stylesheet.terrain)!==null&&p!==void 0?p:null),this.setGlobalState((g=this.stylesheet.state)!==null&&g!==void 0?g:null),this.fire(new a.l("data",{dataType:"style"})),this.fire(new a.l("style.load"))}}_createLayers(){const e=a.bH(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(r=>r.id),this._layers={},this._serializedLayers=null;for(const r of e){const l=a.bI(r);l.setEventedParent(this,{layer:{id:r.id}}),this._layers[r.id]=l}}_loadSprite(e,r=!1,l=void 0){let c;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(p,g,b,C){return a._(this,void 0,void 0,function*(){const S=qe(p),M=b>1?"@2x":"",z={},A={};for(const{id:R,url:V}of S){const Q=g.transformRequest(He(V,M,".json"),"SpriteJSON");z[R]=a.j(Q,C);const J=g.transformRequest(He(V,M,".png"),"SpriteImage");A[R]=Ae.getImage(J,C)}return yield Promise.all([...Object.values(z),...Object.values(A)]),function(R,V){return a._(this,void 0,void 0,function*(){const Q={};for(const J in R){Q[J]={};const ee=oe.getImageCanvasContext((yield V[J]).data),se=(yield R[J]).data;for(const fe in se){const{width:he,height:_e,x:ye,y:ue,sdf:Ce,pixelRatio:Be,stretchX:De,stretchY:Re,content:je,textFitWidth:ft,textFitHeight:ht}=se[fe];Q[J][fe]={data:null,pixelRatio:Be,sdf:Ce,stretchX:De,stretchY:Re,content:je,textFitWidth:ft,textFitHeight:ht,spriteData:{width:he,height:_e,x:ye,y:ue,context:ee}}}}return Q})}(z,A)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(p=>{if(this._spriteRequest=null,p)for(const g in p){this._spritesImagesIds[g]=[];const b=this._spritesImagesIds[g]?this._spritesImagesIds[g].filter(C=>!(C in p)):[];for(const C of b)this.imageManager.removeImage(C),this._changedImages[C]=!0;for(const C in p[g]){const S=g==="default"?C:`${g}:${C}`;this._spritesImagesIds[g].push(S),S in this.imageManager.images?this.imageManager.updateImage(S,p[g][C],!1):this.imageManager.addImage(S,p[g][C]),r&&(this._changedImages[S]=!0)}}}).catch(p=>{this._spriteRequest=null,c=p,this.fire(new a.k(c))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),r&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"})),l&&l(c)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}_validateLayer(e){const r=this.sourceCaches[e.source];if(!r)return;const l=e.sourceLayer;if(!l)return;const c=r.getSource();(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(l)===-1)&&this.fire(new a.k(new Error(`Source layer "${l}" does not exist on source "${c.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,r=!1){const l=this._serializedAllLayers();if(!e||e.length===0)return Object.values(r?a.bJ(l):l);const c=[];for(const p of e)if(l[p]){const g=r?a.bJ(l[p]):l[p];c.push(g)}return c}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const r=Object.keys(this._layers);for(const l of r){const c=this._layers[l];c.type!=="custom"&&(e[l]=c.serialize())}return e}hasTransitions(){var e,r,l;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((r=this.sky)===null||r===void 0)&&r.hasTransition()||!((l=this.projection)===null||l===void 0)&&l.hasTransition())return!0;for(const c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(const c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const r=this._changed;if(r){const c=Object.keys(this._updatedLayers),p=Object.keys(this._removedLayers);(c.length||p.length)&&this._updateWorkerLayers(c,p);for(const g in this._updatedSources){const b=this._updatedSources[g];if(b==="reload")this._reloadSource(g);else{if(b!=="clear")throw new Error(`Invalid action ${b}`);this._clearSource(g)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const g in this._updatedPaintProps)this._layers[g].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const l={};for(const c in this.sourceCaches){const p=this.sourceCaches[c];l[c]=p.used,p.used=!1}for(const c of this._order){const p=this._layers[c];p.recalculate(e,this._availableImages),!p.isHidden(e.zoom)&&p.source&&(this.sourceCaches[p.source].used=!0)}for(const c in l){const p=this.sourceCaches[c];!!l[c]!=!!p.used&&p.fire(new a.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:c}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,r&&this.fire(new a.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,r){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:r})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,r={}){var l;this._checkLoaded();const c=this.serialize();if(e=r.transformStyle?r.transformStyle(c,e):e,((l=r.validate)===null||l===void 0||l)&&go(this,a.z(e)))return!1;(e=a.bJ(e)).layers=a.bH(e.layers);const p=a.bK(c,e),g=this._getOperationsToPerform(p);if(g.unimplemented.length>0)throw new Error(`Unimplemented: ${g.unimplemented.join(", ")}.`);if(g.operations.length===0)return!1;for(const b of g.operations)b();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const r=[],l=[];for(const c of e)switch(c.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":r.push(()=>this.addLayer.apply(this,c.args));break;case"removeLayer":r.push(()=>this.removeLayer.apply(this,c.args));break;case"setPaintProperty":r.push(()=>this.setPaintProperty.apply(this,c.args));break;case"setLayoutProperty":r.push(()=>this.setLayoutProperty.apply(this,c.args));break;case"setFilter":r.push(()=>this.setFilter.apply(this,c.args));break;case"addSource":r.push(()=>this.addSource.apply(this,c.args));break;case"removeSource":r.push(()=>this.removeSource.apply(this,c.args));break;case"setLayerZoomRange":r.push(()=>this.setLayerZoomRange.apply(this,c.args));break;case"setLight":r.push(()=>this.setLight.apply(this,c.args));break;case"setGeoJSONSourceData":r.push(()=>this.setGeoJSONSourceData.apply(this,c.args));break;case"setGlyphs":r.push(()=>this.setGlyphs.apply(this,c.args));break;case"setSprite":r.push(()=>this.setSprite.apply(this,c.args));break;case"setTerrain":r.push(()=>this.map.setTerrain.apply(this,c.args));break;case"setSky":r.push(()=>this.setSky.apply(this,c.args));break;case"setProjection":this.setProjection.apply(this,c.args);break;case"setGlobalState":r.push(()=>this.setGlobalState.apply(this,c.args));break;case"setTransition":r.push(()=>{});break;default:l.push(c.command)}return{operations:r,unimplemented:l}}addImage(e,r){if(this.getImage(e))return this.fire(new a.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,r),this._afterImageUpdated(e)}updateImage(e,r){this.imageManager.updateImage(e,r)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new a.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,r,l={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(a.z.source,`sources.${e}`,r,null,l))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const c=this.sourceCaches[e]=new Ye(e,r,this.dispatcher);c.style=this,c.setEventedParent(this,()=>({isSourceLoaded:c.loaded(),source:c.serialize(),sourceId:e})),c.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===e)return this.fire(new a.k(new Error(`Source "${e}" cannot be removed while layer "${l}" is using it.`)));const r=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],r.fire(new a.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),r.setEventedParent(null),r.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,r){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const l=this.sourceCaches[e].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(r),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,r,l={}){this._checkLoaded();const c=e.id;if(this.getLayer(c))return void this.fire(new a.k(new Error(`Layer "${c}" already exists on this map.`)));let p;if(e.type==="custom"){if(go(this,a.bL(e)))return;p=a.bI(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(c,e.source),e=a.bJ(e),e=a.e(e,{source:c})),this._validate(a.z.layer,`layers.${c}`,e,{arrayIndex:-1},l))return;p=a.bI(e),this._validateLayer(p),p.setEventedParent(this,{layer:{id:c}})}const g=r?this._order.indexOf(r):this._order.length;if(r&&g===-1)this.fire(new a.k(new Error(`Cannot add layer "${c}" before non-existing layer "${r}".`)));else{if(this._order.splice(g,0,c),this._layerOrderChanged=!0,this._layers[c]=p,this._removedLayers[c]&&p.source&&p.type!=="custom"){const b=this._removedLayers[c];delete this._removedLayers[c],b.type!==p.type?this._updatedSources[p.source]="clear":(this._updatedSources[p.source]="reload",this.sourceCaches[p.source].pause())}this._updateLayer(p),p.onAdd&&p.onAdd(this.map)}}moveLayer(e,r){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new a.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===r)return;const l=this._order.indexOf(e);this._order.splice(l,1);const c=r?this._order.indexOf(r):this._order.length;r&&c===-1?this.fire(new a.k(new Error(`Cannot move layer "${e}" before non-existing layer "${r}".`))):(this._order.splice(c,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const r=this._layers[e];if(!r)return void this.fire(new a.k(new Error(`Cannot remove non-existing layer "${e}".`)));r.setEventedParent(null);const l=this._order.indexOf(e);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=r,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],r.onRemove&&r.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,r,l){this._checkLoaded();const c=this.getLayer(e);c?c.minzoom===r&&c.maxzoom===l||(r!=null&&(c.minzoom=r),l!=null&&(c.maxzoom=l),this._updateLayer(c)):this.fire(new a.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,r,l={}){this._checkLoaded();const c=this.getLayer(e);if(c){if(!a.bG(c.filter,r))return r==null?(c.setFilter(void 0),void this._updateLayer(c)):void(this._validate(a.z.filter,`layers.${c.id}.filter`,r,null,l)||(c.setFilter(a.bJ(r)),this._updateLayer(c)))}else this.fire(new a.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return a.bJ(this.getLayer(e).filter)}setLayoutProperty(e,r,l,c={}){this._checkLoaded();const p=this.getLayer(e);p?a.bG(p.getLayoutProperty(r),l)||(p.setLayoutProperty(r,l,c),this._updateLayer(p)):this.fire(new a.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,r){const l=this.getLayer(e);if(l)return l.getLayoutProperty(r);this.fire(new a.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,r,l,c={}){this._checkLoaded();const p=this.getLayer(e);p?a.bG(p.getPaintProperty(r),l)||(p.setPaintProperty(r,l,c)&&this._updateLayer(p),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new a.k(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,r){return this.getLayer(e).getPaintProperty(r)}setFeatureState(e,r){this._checkLoaded();const l=e.source,c=e.sourceLayer,p=this.sourceCaches[l];if(p===void 0)return void this.fire(new a.k(new Error(`The source '${l}' does not exist in the map's style.`)));const g=p.getSource().type;g==="geojson"&&c?this.fire(new a.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):g!=="vector"||c?(e.id===void 0&&this.fire(new a.k(new Error("The feature id parameter must be provided."))),p.setFeatureState(c,e.id,r)):this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,r){this._checkLoaded();const l=e.source,c=this.sourceCaches[l];if(c===void 0)return void this.fire(new a.k(new Error(`The source '${l}' does not exist in the map's style.`)));const p=c.getSource().type,g=p==="vector"?e.sourceLayer:void 0;p!=="vector"||g?r&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new a.k(new Error("A feature id is required to remove its specific state property."))):c.removeFeatureState(g,e.id,r):this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const r=e.source,l=e.sourceLayer,c=this.sourceCaches[r];if(c!==void 0)return c.getSource().type!=="vector"||l?(e.id===void 0&&this.fire(new a.k(new Error("The feature id parameter must be provided."))),c.getFeatureState(l,e.id)):void this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.k(new Error(`The source '${r}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=a.bM(this.sourceCaches,p=>p.serialize()),r=this._serializeByIds(this._order,!0),l=this.map.getTerrain()||void 0,c=this.stylesheet;return a.bN({version:c.version,name:c.name,metadata:c.metadata,light:c.light,sky:c.sky,center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,sprite:c.sprite,glyphs:c.glyphs,transition:c.transition,projection:c.projection,sources:e,layers:r,terrain:l},p=>p!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const r=g=>this._layers[g].type==="fill-extrusion",l={},c=[];for(let g=this._order.length-1;g>=0;g--){const b=this._order[g];if(r(b)){l[b]=g;for(const C of e){const S=C[b];if(S)for(const M of S)c.push(M)}}}c.sort((g,b)=>b.intersectionZ-g.intersectionZ);const p=[];for(let g=this._order.length-1;g>=0;g--){const b=this._order[g];if(r(b))for(let C=c.length-1;C>=0;C--){const S=c[C].feature;if(l[S.layer.id]<g)break;p.push(S),c.pop()}else for(const C of e){const S=C[b];if(S)for(const M of S)p.push(M.feature)}}return p}queryRenderedFeatures(e,r,l){r&&r.filter&&this._validate(a.z.filter,"queryRenderedFeatures.filter",r.filter,null,r);const c={};if(r&&r.layers){if(!(Array.isArray(r.layers)||r.layers instanceof Set))return this.fire(new a.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const S of r.layers){const M=this._layers[S];if(!M)return this.fire(new a.k(new Error(`The layer '${S}' does not exist in the map's style and cannot be queried for features.`))),[];c[M.source]=!0}}const p=[];r.availableImages=this._availableImages;const g=this._serializedAllLayers(),b=r.layers instanceof Set?r.layers:Array.isArray(r.layers)?new Set(r.layers):null,C=Object.assign(Object.assign({},r),{layers:b});for(const S in this.sourceCaches)r.layers&&!c[S]||p.push(Vt(this.sourceCaches[S],this._layers,g,e,C,l,this.map.terrain?(M,z,A)=>this.map.terrain.getElevation(M,z,A):void 0));return this.placement&&p.push(function(S,M,z,A,R,V,Q){const J={},ee=V.queryRenderedSymbols(A),se=[];for(const fe of Object.keys(ee).map(Number))se.push(Q[fe]);se.sort(Pr);for(const fe of se){const he=fe.featureIndex.lookupSymbolFeatures(ee[fe.bucketInstanceId],M,fe.bucketIndex,fe.sourceLayerIndex,R.filter,R.layers,R.availableImages,S);for(const _e in he){const ye=J[_e]=J[_e]||[],ue=he[_e];ue.sort((Ce,Be)=>{const De=fe.featureSortOrder;if(De){const Re=De.indexOf(Ce.featureIndex);return De.indexOf(Be.featureIndex)-Re}return Be.featureIndex-Ce.featureIndex});for(const Ce of ue)ye.push(Ce)}}return function(fe,he,_e){for(const ye in fe)for(const ue of fe[ye])or(ue,_e[he[ye].source]);return fe}(J,S,z)}(this._layers,g,this.sourceCaches,e,C,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(p)}querySourceFeatures(e,r){r&&r.filter&&this._validate(a.z.filter,"querySourceFeatures.filter",r.filter,null,r);const l=this.sourceCaches[e];return l?function(c,p){const g=c.getRenderableIds().map(S=>c.getTileByID(S)),b=[],C={};for(let S=0;S<g.length;S++){const M=g[S],z=M.tileID.canonical.key;C[z]||(C[z]=!0,M.querySourceFeatures(b,p))}return b}(l,r):[]}getLight(){return this.light.getLight()}setLight(e,r={}){this._checkLoaded();const l=this.light.getLight();let c=!1;for(const g in e)if(!a.bG(e[g],l[g])){c=!0;break}if(!c)return;const p={now:oe.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,r),this.light.updateTransitions(p)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,r={}){this._checkLoaded();const l=this.getSky();let c=!1;if(!e&&!l)return;if(e&&!l)c=!0;else if(!e&&l)c=!0;else for(const g in e)if(!a.bG(e[g],l[g])){c=!0;break}if(!c)return;const p={now:oe.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,r),this.sky.updateTransitions(p)}_setProjectionInternal(e){const r=function(l){if(Array.isArray(l)){const c=new uo({type:l});return{projection:c,transform:new Fi,cameraHelper:new bl(c)}}switch(l){case"mercator":return{projection:new _l,transform:new $r,cameraHelper:new ha};case"globe":{const c=new uo({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:c,transform:new Fi,cameraHelper:new bl(c)}}case"vertical-perspective":return{projection:new rh,transform:new Ss,cameraHelper:new ki};default:return a.w(`Unknown projection name: ${l}. Falling back to mercator projection.`),{projection:new _l,transform:new $r,cameraHelper:new ha}}}(e);this.projection=r.projection,this.map.migrateProjection(r.transform,r.cameraHelper);for(const l in this.sourceCaches)this.sourceCaches[l].reload()}_validate(e,r,l,c,p={}){return(!p||p.validate!==!1)&&go(this,e.call(a.z,a.e({key:r,style:this.serialize(),value:l,styleSpec:a.v},c)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Xt().off(wt,this._rtlPluginLoaded);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this.sourceCaches){const l=this.sourceCaches[r];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const r in this.sourceCaches)this.sourceCaches[r].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,r,l,c,p=!1){let g=!1,b=!1;const C={};for(const S of this._order){const M=this._layers[S];if(M.type!=="symbol")continue;if(!C[M.source]){const A=this.sourceCaches[M.source];C[M.source]=A.getRenderableIds(!0).map(R=>A.getTileByID(R)).sort((R,V)=>V.tileID.overscaledZ-R.tileID.overscaledZ||(R.tileID.isLessThan(V.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(M,C[M.source],e.center.lng);g=g||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((p=p||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(oe.now(),e.zoom))&&(this.pauseablePlacement=new eh(e,this.map.terrain,this._order,p,r,l,c,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,C),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(oe.now()),b=!0),g&&this.pauseablePlacement.placement.setStale()),b||g)for(const S of this._order){const M=this._layers[S];M.type==="symbol"&&this.placement.updateLayerOpacities(M,C[M.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(oe.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,r){return a._(this,void 0,void 0,function*(){const l=yield this.imageManager.getImages(r.icons);this._updateTilesForChangedImages();const c=this.sourceCaches[r.source];return c&&c.setDependencies(r.tileID.key,r.type,r.icons),l})}getGlyphs(e,r){return a._(this,void 0,void 0,function*(){const l=yield this.glyphManager.getGlyphs(r.stacks),c=this.sourceCaches[r.source];return c&&c.setDependencies(r.tileID.key,r.type,[""]),l})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,r={}){this._checkLoaded(),e&&this._validate(a.z.glyphs,"glyphs",e,null,r)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,r,l={},c){this._checkLoaded();const p=[{id:e,url:r}],g=[...qe(this.stylesheet.sprite),...p];this._validate(a.z.sprite,"sprite",g,null,l)||(this.stylesheet.sprite=g,this._loadSprite(p,!0,c))}removeSprite(e){this._checkLoaded();const r=qe(this.stylesheet.sprite);if(r.find(l=>l.id===e)){if(this._spritesImagesIds[e])for(const l of this._spritesImagesIds[e])this.imageManager.removeImage(l),this._changedImages[l]=!0;r.splice(r.findIndex(l=>l.id===e),1),this.stylesheet.sprite=r.length>0?r:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}else this.fire(new a.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return qe(this.stylesheet.sprite)}setSprite(e,r={},l){this._checkLoaded(),e&&this._validate(a.z.sprite,"sprite",e,null,r)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,l):(this._unloadSprite(),l&&l(null)))}}var Su=a.aI([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Eu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,r,l,c,p,g,b,C,S){this.context=e;let M=this.boundPaintVertexBuffers.length!==c.length;for(let z=0;!M&&z<c.length;z++)this.boundPaintVertexBuffers[z]!==c[z]&&(M=!0);!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==l||M||this.boundIndexBuffer!==p||this.boundVertexOffset!==g||this.boundDynamicVertexBuffer!==b||this.boundDynamicVertexBuffer2!==C||this.boundDynamicVertexBuffer3!==S?this.freshBind(r,l,c,p,g,b,C,S):(e.bindVertexArray.set(this.vao),b&&b.bind(),p&&p.dynamicDraw&&p.bind(),C&&C.bind(),S&&S.bind())}freshBind(e,r,l,c,p,g,b,C){const S=e.numAttributes,M=this.context,z=M.gl;this.vao&&this.destroy(),this.vao=M.createVertexArray(),M.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=c,this.boundVertexOffset=p,this.boundDynamicVertexBuffer=g,this.boundDynamicVertexBuffer2=b,this.boundDynamicVertexBuffer3=C,r.enableAttributes(z,e);for(const A of l)A.enableAttributes(z,e);g&&g.enableAttributes(z,e),b&&b.enableAttributes(z,e),C&&C.enableAttributes(z,e),r.bind(),r.setVertexAttribPointers(z,e,p);for(const A of l)A.bind(),A.setVertexAttribPointers(z,e,p);g&&(g.bind(),g.setVertexAttribPointers(z,e,p)),c&&c.bind(),b&&(b.bind(),b.setVertexAttribPointers(z,e,p)),C&&(C.bind(),C.setVertexAttribPointers(z,e,p)),M.currentNumAttributes=S}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const ku=(d,e,r,l,c)=>({u_texture:0,u_ele_delta:d,u_fog_matrix:e,u_fog_color:r?r.properties.get("fog-color"):a.be.white,u_fog_ground_blend:r?r.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:c?0:r?r.calculateFogBlendOpacity(l):0,u_horizon_color:r?r.properties.get("horizon-color"):a.be.white,u_horizon_fog_blend:r?r.properties.get("horizon-fog-blend"):1,u_is_globe_mode:c?1:0}),Mu={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function ua(d){const e=[];for(let r=0;r<d.length;r++){if(d[r]===null)continue;const l=d[r].split(" ");e.push(l.pop())}return e}class da{constructor(e,r,l,c,p,g,b,C,S=[]){const M=e.gl;this.program=M.createProgram();const z=ua(r.staticAttributes),A=l?l.getBinderAttributes():[],R=z.concat(A),V=hn.prelude.staticUniforms?ua(hn.prelude.staticUniforms):[],Q=b.staticUniforms?ua(b.staticUniforms):[],J=r.staticUniforms?ua(r.staticUniforms):[],ee=l?l.getBinderUniforms():[],se=V.concat(Q).concat(J).concat(ee),fe=[];for(const De of se)fe.indexOf(De)<0&&fe.push(De);const he=l?l.defines():[];xi(M)&&he.unshift("#version 300 es"),p&&he.push("#define OVERDRAW_INSPECTOR;"),g&&he.push("#define TERRAIN3D;"),C&&he.push(C),S&&he.push(...S);let _e=he.concat(hn.prelude.fragmentSource,b.fragmentSource,r.fragmentSource).join(`
`),ye=he.concat(hn.prelude.vertexSource,b.vertexSource,r.vertexSource).join(`
`);xi(M)||(_e=function(De){return De.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(_e),ye=function(De){return De.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(ye));const ue=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);if(M.shaderSource(ue,_e),M.compileShader(ue),!M.getShaderParameter(ue,M.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${M.getShaderInfoLog(ue)}`);M.attachShader(this.program,ue);const Ce=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);if(M.shaderSource(Ce,ye),M.compileShader(Ce),!M.getShaderParameter(Ce,M.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${M.getShaderInfoLog(Ce)}`);M.attachShader(this.program,Ce),this.attributes={};const Be={};this.numAttributes=R.length;for(let De=0;De<this.numAttributes;De++)R[De]&&(M.bindAttribLocation(this.program,De,R[De]),this.attributes[R[De]]=De);if(M.linkProgram(this.program),!M.getProgramParameter(this.program,M.LINK_STATUS))throw new Error(`Program failed to link: ${M.getProgramInfoLog(this.program)}`);M.deleteShader(Ce),M.deleteShader(ue);for(let De=0;De<fe.length;De++){const Re=fe[De];if(Re&&!Be[Re]){const je=M.getUniformLocation(this.program,Re);je&&(Be[Re]=je)}}this.fixedUniforms=c(e,Be),this.terrainUniforms=((De,Re)=>({u_depth:new a.bO(De,Re.u_depth),u_terrain:new a.bO(De,Re.u_terrain),u_terrain_dim:new a.bf(De,Re.u_terrain_dim),u_terrain_matrix:new a.bQ(De,Re.u_terrain_matrix),u_terrain_unpack:new a.bR(De,Re.u_terrain_unpack),u_terrain_exaggeration:new a.bf(De,Re.u_terrain_exaggeration)}))(e,Be),this.projectionUniforms=((De,Re)=>({u_projection_matrix:new a.bQ(De,Re.u_projection_matrix),u_projection_tile_mercator_coords:new a.bR(De,Re.u_projection_tile_mercator_coords),u_projection_clipping_plane:new a.bR(De,Re.u_projection_clipping_plane),u_projection_transition:new a.bf(De,Re.u_projection_transition),u_projection_fallback_matrix:new a.bQ(De,Re.u_projection_fallback_matrix)}))(e,Be),this.binderUniforms=l?l.getUniforms(e,Be):[]}draw(e,r,l,c,p,g,b,C,S,M,z,A,R,V,Q,J,ee,se,fe){const he=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(l),e.setStencilMode(c),e.setColorMode(p),e.setCullFace(g),C){e.activeTexture.set(he.TEXTURE2),he.bindTexture(he.TEXTURE_2D,C.depthTexture),e.activeTexture.set(he.TEXTURE3),he.bindTexture(he.TEXTURE_2D,C.texture);for(const ye in this.terrainUniforms)this.terrainUniforms[ye].set(C[ye])}if(S)for(const ye in S)this.projectionUniforms[Mu[ye]].set(S[ye]);if(b)for(const ye in this.fixedUniforms)this.fixedUniforms[ye].set(b[ye]);J&&J.setUniforms(e,this.binderUniforms,V,{zoom:Q});let _e=0;switch(r){case he.LINES:_e=2;break;case he.TRIANGLES:_e=3;break;case he.LINE_STRIP:_e=1}for(const ye of R.get()){const ue=ye.vaos||(ye.vaos={});(ue[M]||(ue[M]=new Eu)).bind(e,this,z,J?J.getPaintVertexBuffers():[],A,ye.vertexOffset,ee,se,fe),he.drawElements(r,ye.primitiveLength*_e,he.UNSIGNED_SHORT,ye.primitiveOffset*_e*2)}}}function pa(d,e,r){const l=1/a.aB(r,1,e.transform.tileZoom),c=Math.pow(2,r.tileID.overscaledZ),p=r.tileSize*Math.pow(2,e.transform.tileZoom)/c,g=p*(r.tileID.canonical.x+r.tileID.wrap*c),b=p*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[l,d.fromScale,d.toScale],u_fade:d.t,u_pixel_coord_upper:[g>>16,b>>16],u_pixel_coord_lower:[65535&g,65535&b]}}const yo=(d,e,r,l)=>{const c=d.style.light,p=c.properties.get("position"),g=[p.x,p.y,p.z],b=a.bU();c.properties.get("anchor")==="viewport"&&a.bV(b,d.transform.bearingInRadians),a.bW(g,g,b);const C=d.transform.transformLightDirection(g),S=c.properties.get("color");return{u_lightpos:g,u_lightpos_globe:C,u_lightintensity:c.properties.get("intensity"),u_lightcolor:[S.r,S.g,S.b],u_vertical_gradient:+e,u_opacity:r,u_fill_translate:l}},wl=(d,e,r,l,c,p,g)=>a.e(yo(d,e,r,l),pa(p,d,g),{u_height_factor:-Math.pow(2,c.overscaledZ)/g.tileSize/8}),fa=(d,e,r,l)=>a.e(pa(e,d,r),{u_fill_translate:l}),dn=(d,e)=>({u_world:d,u_fill_translate:e}),Iu=(d,e,r,l,c)=>a.e(fa(d,e,r,c),{u_world:l}),Cl=(d,e,r,l,c)=>{const p=d.transform;let g,b,C=0;if(r.paint.get("circle-pitch-alignment")==="map"){const S=a.aB(e,1,p.zoom);g=!0,b=[S,S],C=S/(a.$*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*c}else g=!1,b=p.pixelsToGLUnits;return{u_camera_to_center_distance:p.cameraToCenterDistance,u_scale_with_map:+(r.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+g,u_device_pixel_ratio:d.pixelRatio,u_extrude_scale:b,u_globe_extrude_scale:C,u_translate:l}},vo=d=>({u_pixel_extrude_scale:[1/d.width,1/d.height]}),bo=d=>({u_viewport_size:[d.width,d.height]}),nh=(d,e=1)=>({u_color:d,u_overlay:0,u_overlay_scale:e}),xo=(d,e,r,l)=>{const c=a.aB(d,1,e)/(a.$*Math.pow(2,d.tileID.overscaledZ))*2*Math.PI*l;return{u_extrude_scale:a.aB(d,1,e),u_intensity:r,u_globe_extrude_scale:c}},sh=(d,e,r,l)=>{const c=a.L();a.bX(c,0,d.width,d.height,0,0,1);const p=d.context.gl;return{u_matrix:c,u_world:[p.drawingBufferWidth,p.drawingBufferHeight],u_image:r,u_color_ramp:l,u_opacity:e.paint.get("heatmap-opacity")}},ks=(d,e,r)=>{const l=r.paint.get("hillshade-accent-color");let c;switch(r.paint.get("hillshade-method")){case"basic":c=4;break;case"combined":c=1;break;case"igor":c=2;break;case"multidirectional":c=3;break;default:c=0}const p=r.getIlluminationProperties();for(let g=0;g<p.directionRadians.length;g++)r.paint.get("hillshade-illumination-anchor")==="viewport"&&(p.directionRadians[g]+=d.transform.bearingInRadians);return{u_image:0,u_latrange:oh(0,e.tileID),u_exaggeration:r.paint.get("hillshade-exaggeration"),u_altitudes:p.altitudeRadians,u_azimuths:p.directionRadians,u_accent:l,u_method:c,u_highlights:p.highlightColor,u_shadows:p.shadowColor}},Au=(d,e)=>{const r=e.stride,l=a.L();return a.bX(l,0,a.$,-8192,0,0,1),a.M(l,l,[0,-8192,0]),{u_matrix:l,u_image:1,u_dimension:[r,r],u_zoom:d.overscaledZ,u_unpack:e.getUnpackVector()}};function oh(d,e){const r=Math.pow(2,e.canonical.z),l=e.canonical.y;return[new a.a0(0,l/r).toLngLat().lat,new a.a0(0,(l+1)/r).toLngLat().lat]}const zu=(d,e)=>({u_image:0,u_unpack:e.getUnpackVector(),u_dimension:[e.stride,e.stride],u_elevation_stops:1,u_color_stops:4,u_opacity:d.paint.get("color-relief-opacity")}),ma=(d,e,r,l)=>{const c=d.transform;return{u_translation:Sl(d,e,r),u_ratio:l/a.aB(e,1,c.zoom),u_device_pixel_ratio:d.pixelRatio,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]]}},Pl=(d,e,r,l,c)=>a.e(ma(d,e,r,l),{u_image:0,u_image_height:c}),ah=(d,e,r,l,c)=>{const p=d.transform,g=Tl(e,p);return{u_translation:Sl(d,e,r),u_texsize:e.imageAtlasTexture.size,u_ratio:l/a.aB(e,1,p.zoom),u_device_pixel_ratio:d.pixelRatio,u_image:0,u_scale:[g,c.fromScale,c.toScale],u_fade:c.t,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},lh=(d,e,r,l,c,p)=>{const g=d.lineAtlas,b=Tl(e,d.transform),C=r.layout.get("line-cap")==="round",S=g.getDash(c.from,C),M=g.getDash(c.to,C),z=S.width*p.fromScale,A=M.width*p.toScale;return a.e(ma(d,e,r,l),{u_patternscale_a:[b/z,-S.height/2],u_patternscale_b:[b/A,-M.height/2],u_sdfgamma:g.width/(256*Math.min(z,A)*d.pixelRatio)/2,u_image:0,u_tex_y_a:S.y,u_tex_y_b:M.y,u_mix:p.t})};function Tl(d,e){return 1/a.aB(d,1,e.tileZoom)}function Sl(d,e,r){return a.aC(d.transform,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const rs=(d,e,r,l,c)=>{return{u_tl_parent:d,u_scale_parent:e,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*l.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:l.paint.get("raster-brightness-min"),u_brightness_high:l.paint.get("raster-brightness-max"),u_saturation_factor:(g=l.paint.get("raster-saturation"),g>0?1-1/(1.001-g):-g),u_contrast_factor:(p=l.paint.get("raster-contrast"),p>0?1/(1-p):1+p),u_spin_weights:ch(l.paint.get("raster-hue-rotate")),u_coords_top:[c[0].x,c[0].y,c[1].x,c[1].y],u_coords_bottom:[c[3].x,c[3].y,c[2].x,c[2].y]};var p,g};function ch(d){d*=Math.PI/180;const e=Math.sin(d),r=Math.cos(d);return[(2*r+1)/3,(-Math.sqrt(3)*e-r+1)/3,(Math.sqrt(3)*e-r+1)/3]}const El=(d,e,r,l,c,p,g,b,C,S,M,z,A)=>{const R=g.transform;return{u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:R.cameraToCenterDistance,u_pitch:R.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:R.width/R.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_label_plane_matrix:b,u_coord_matrix:C,u_is_text:+M,u_pitch_with_map:+l,u_is_along_line:c,u_is_variable_anchor:p,u_texsize:z,u_texture:0,u_translation:S,u_pitched_scale:A}},Ms=(d,e,r,l,c,p,g,b,C,S,M,z,A,R)=>{const V=g.transform;return a.e(El(d,e,r,l,c,p,g,b,C,S,M,z,R),{u_gamma_scale:l?Math.cos(V.pitch*Math.PI/180)*V.cameraToCenterDistance:1,u_device_pixel_ratio:g.pixelRatio,u_is_halo:1})},Du=(d,e,r,l,c,p,g,b,C,S,M,z,A)=>a.e(Ms(d,e,r,l,c,p,g,b,C,S,!0,M,0,A),{u_texsize_icon:z,u_texture_icon:1}),_a=(d,e)=>({u_opacity:d,u_color:e}),Ru=(d,e,r,l,c)=>a.e(function(p,g,b,C){const S=b.imageManager.getPattern(p.from.toString()),M=b.imageManager.getPattern(p.to.toString()),{width:z,height:A}=b.imageManager.getPixelSize(),R=Math.pow(2,C.tileID.overscaledZ),V=C.tileSize*Math.pow(2,b.transform.tileZoom)/R,Q=V*(C.tileID.canonical.x+C.tileID.wrap*R),J=V*C.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:S.tl,u_pattern_br_a:S.br,u_pattern_tl_b:M.tl,u_pattern_br_b:M.br,u_texsize:[z,A],u_mix:g.t,u_pattern_size_a:S.displaySize,u_pattern_size_b:M.displaySize,u_scale_a:g.fromScale,u_scale_b:g.toScale,u_tile_units_to_pixels:1/a.aB(C,1,b.transform.tileZoom),u_pixel_coord_upper:[Q>>16,J>>16],u_pixel_coord_lower:[65535&Q,65535&J]}}(r,c,e,l),{u_opacity:d}),hh=(d,e)=>{},uh={fillExtrusion:(d,e)=>({u_lightpos:new a.bS(d,e.u_lightpos),u_lightpos_globe:new a.bS(d,e.u_lightpos_globe),u_lightintensity:new a.bf(d,e.u_lightintensity),u_lightcolor:new a.bS(d,e.u_lightcolor),u_vertical_gradient:new a.bf(d,e.u_vertical_gradient),u_opacity:new a.bf(d,e.u_opacity),u_fill_translate:new a.bT(d,e.u_fill_translate)}),fillExtrusionPattern:(d,e)=>({u_lightpos:new a.bS(d,e.u_lightpos),u_lightpos_globe:new a.bS(d,e.u_lightpos_globe),u_lightintensity:new a.bf(d,e.u_lightintensity),u_lightcolor:new a.bS(d,e.u_lightcolor),u_vertical_gradient:new a.bf(d,e.u_vertical_gradient),u_height_factor:new a.bf(d,e.u_height_factor),u_opacity:new a.bf(d,e.u_opacity),u_fill_translate:new a.bT(d,e.u_fill_translate),u_image:new a.bO(d,e.u_image),u_texsize:new a.bT(d,e.u_texsize),u_pixel_coord_upper:new a.bT(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new a.bT(d,e.u_pixel_coord_lower),u_scale:new a.bS(d,e.u_scale),u_fade:new a.bf(d,e.u_fade)}),fill:(d,e)=>({u_fill_translate:new a.bT(d,e.u_fill_translate)}),fillPattern:(d,e)=>({u_image:new a.bO(d,e.u_image),u_texsize:new a.bT(d,e.u_texsize),u_pixel_coord_upper:new a.bT(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new a.bT(d,e.u_pixel_coord_lower),u_scale:new a.bS(d,e.u_scale),u_fade:new a.bf(d,e.u_fade),u_fill_translate:new a.bT(d,e.u_fill_translate)}),fillOutline:(d,e)=>({u_world:new a.bT(d,e.u_world),u_fill_translate:new a.bT(d,e.u_fill_translate)}),fillOutlinePattern:(d,e)=>({u_world:new a.bT(d,e.u_world),u_image:new a.bO(d,e.u_image),u_texsize:new a.bT(d,e.u_texsize),u_pixel_coord_upper:new a.bT(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new a.bT(d,e.u_pixel_coord_lower),u_scale:new a.bS(d,e.u_scale),u_fade:new a.bf(d,e.u_fade),u_fill_translate:new a.bT(d,e.u_fill_translate)}),circle:(d,e)=>({u_camera_to_center_distance:new a.bf(d,e.u_camera_to_center_distance),u_scale_with_map:new a.bO(d,e.u_scale_with_map),u_pitch_with_map:new a.bO(d,e.u_pitch_with_map),u_extrude_scale:new a.bT(d,e.u_extrude_scale),u_device_pixel_ratio:new a.bf(d,e.u_device_pixel_ratio),u_globe_extrude_scale:new a.bf(d,e.u_globe_extrude_scale),u_translate:new a.bT(d,e.u_translate)}),collisionBox:(d,e)=>({u_pixel_extrude_scale:new a.bT(d,e.u_pixel_extrude_scale)}),collisionCircle:(d,e)=>({u_viewport_size:new a.bT(d,e.u_viewport_size)}),debug:(d,e)=>({u_color:new a.bP(d,e.u_color),u_overlay:new a.bO(d,e.u_overlay),u_overlay_scale:new a.bf(d,e.u_overlay_scale)}),depth:hh,clippingMask:hh,heatmap:(d,e)=>({u_extrude_scale:new a.bf(d,e.u_extrude_scale),u_intensity:new a.bf(d,e.u_intensity),u_globe_extrude_scale:new a.bf(d,e.u_globe_extrude_scale)}),heatmapTexture:(d,e)=>({u_matrix:new a.bQ(d,e.u_matrix),u_world:new a.bT(d,e.u_world),u_image:new a.bO(d,e.u_image),u_color_ramp:new a.bO(d,e.u_color_ramp),u_opacity:new a.bf(d,e.u_opacity)}),hillshade:(d,e)=>({u_image:new a.bO(d,e.u_image),u_latrange:new a.bT(d,e.u_latrange),u_exaggeration:new a.bf(d,e.u_exaggeration),u_altitudes:new a.bZ(d,e.u_altitudes),u_azimuths:new a.bZ(d,e.u_azimuths),u_accent:new a.bP(d,e.u_accent),u_method:new a.bO(d,e.u_method),u_shadows:new a.bY(d,e.u_shadows),u_highlights:new a.bY(d,e.u_highlights)}),hillshadePrepare:(d,e)=>({u_matrix:new a.bQ(d,e.u_matrix),u_image:new a.bO(d,e.u_image),u_dimension:new a.bT(d,e.u_dimension),u_zoom:new a.bf(d,e.u_zoom),u_unpack:new a.bR(d,e.u_unpack)}),colorRelief:(d,e)=>({u_image:new a.bO(d,e.u_image),u_unpack:new a.bR(d,e.u_unpack),u_dimension:new a.bT(d,e.u_dimension),u_elevation_stops:new a.bO(d,e.u_elevation_stops),u_color_stops:new a.bO(d,e.u_color_stops),u_opacity:new a.bf(d,e.u_opacity)}),line:(d,e)=>({u_translation:new a.bT(d,e.u_translation),u_ratio:new a.bf(d,e.u_ratio),u_device_pixel_ratio:new a.bf(d,e.u_device_pixel_ratio),u_units_to_pixels:new a.bT(d,e.u_units_to_pixels)}),lineGradient:(d,e)=>({u_translation:new a.bT(d,e.u_translation),u_ratio:new a.bf(d,e.u_ratio),u_device_pixel_ratio:new a.bf(d,e.u_device_pixel_ratio),u_units_to_pixels:new a.bT(d,e.u_units_to_pixels),u_image:new a.bO(d,e.u_image),u_image_height:new a.bf(d,e.u_image_height)}),linePattern:(d,e)=>({u_translation:new a.bT(d,e.u_translation),u_texsize:new a.bT(d,e.u_texsize),u_ratio:new a.bf(d,e.u_ratio),u_device_pixel_ratio:new a.bf(d,e.u_device_pixel_ratio),u_image:new a.bO(d,e.u_image),u_units_to_pixels:new a.bT(d,e.u_units_to_pixels),u_scale:new a.bS(d,e.u_scale),u_fade:new a.bf(d,e.u_fade)}),lineSDF:(d,e)=>({u_translation:new a.bT(d,e.u_translation),u_ratio:new a.bf(d,e.u_ratio),u_device_pixel_ratio:new a.bf(d,e.u_device_pixel_ratio),u_units_to_pixels:new a.bT(d,e.u_units_to_pixels),u_patternscale_a:new a.bT(d,e.u_patternscale_a),u_patternscale_b:new a.bT(d,e.u_patternscale_b),u_sdfgamma:new a.bf(d,e.u_sdfgamma),u_image:new a.bO(d,e.u_image),u_tex_y_a:new a.bf(d,e.u_tex_y_a),u_tex_y_b:new a.bf(d,e.u_tex_y_b),u_mix:new a.bf(d,e.u_mix)}),raster:(d,e)=>({u_tl_parent:new a.bT(d,e.u_tl_parent),u_scale_parent:new a.bf(d,e.u_scale_parent),u_buffer_scale:new a.bf(d,e.u_buffer_scale),u_fade_t:new a.bf(d,e.u_fade_t),u_opacity:new a.bf(d,e.u_opacity),u_image0:new a.bO(d,e.u_image0),u_image1:new a.bO(d,e.u_image1),u_brightness_low:new a.bf(d,e.u_brightness_low),u_brightness_high:new a.bf(d,e.u_brightness_high),u_saturation_factor:new a.bf(d,e.u_saturation_factor),u_contrast_factor:new a.bf(d,e.u_contrast_factor),u_spin_weights:new a.bS(d,e.u_spin_weights),u_coords_top:new a.bR(d,e.u_coords_top),u_coords_bottom:new a.bR(d,e.u_coords_bottom)}),symbolIcon:(d,e)=>({u_is_size_zoom_constant:new a.bO(d,e.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bO(d,e.u_is_size_feature_constant),u_size_t:new a.bf(d,e.u_size_t),u_size:new a.bf(d,e.u_size),u_camera_to_center_distance:new a.bf(d,e.u_camera_to_center_distance),u_pitch:new a.bf(d,e.u_pitch),u_rotate_symbol:new a.bO(d,e.u_rotate_symbol),u_aspect_ratio:new a.bf(d,e.u_aspect_ratio),u_fade_change:new a.bf(d,e.u_fade_change),u_label_plane_matrix:new a.bQ(d,e.u_label_plane_matrix),u_coord_matrix:new a.bQ(d,e.u_coord_matrix),u_is_text:new a.bO(d,e.u_is_text),u_pitch_with_map:new a.bO(d,e.u_pitch_with_map),u_is_along_line:new a.bO(d,e.u_is_along_line),u_is_variable_anchor:new a.bO(d,e.u_is_variable_anchor),u_texsize:new a.bT(d,e.u_texsize),u_texture:new a.bO(d,e.u_texture),u_translation:new a.bT(d,e.u_translation),u_pitched_scale:new a.bf(d,e.u_pitched_scale)}),symbolSDF:(d,e)=>({u_is_size_zoom_constant:new a.bO(d,e.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bO(d,e.u_is_size_feature_constant),u_size_t:new a.bf(d,e.u_size_t),u_size:new a.bf(d,e.u_size),u_camera_to_center_distance:new a.bf(d,e.u_camera_to_center_distance),u_pitch:new a.bf(d,e.u_pitch),u_rotate_symbol:new a.bO(d,e.u_rotate_symbol),u_aspect_ratio:new a.bf(d,e.u_aspect_ratio),u_fade_change:new a.bf(d,e.u_fade_change),u_label_plane_matrix:new a.bQ(d,e.u_label_plane_matrix),u_coord_matrix:new a.bQ(d,e.u_coord_matrix),u_is_text:new a.bO(d,e.u_is_text),u_pitch_with_map:new a.bO(d,e.u_pitch_with_map),u_is_along_line:new a.bO(d,e.u_is_along_line),u_is_variable_anchor:new a.bO(d,e.u_is_variable_anchor),u_texsize:new a.bT(d,e.u_texsize),u_texture:new a.bO(d,e.u_texture),u_gamma_scale:new a.bf(d,e.u_gamma_scale),u_device_pixel_ratio:new a.bf(d,e.u_device_pixel_ratio),u_is_halo:new a.bO(d,e.u_is_halo),u_translation:new a.bT(d,e.u_translation),u_pitched_scale:new a.bf(d,e.u_pitched_scale)}),symbolTextAndIcon:(d,e)=>({u_is_size_zoom_constant:new a.bO(d,e.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bO(d,e.u_is_size_feature_constant),u_size_t:new a.bf(d,e.u_size_t),u_size:new a.bf(d,e.u_size),u_camera_to_center_distance:new a.bf(d,e.u_camera_to_center_distance),u_pitch:new a.bf(d,e.u_pitch),u_rotate_symbol:new a.bO(d,e.u_rotate_symbol),u_aspect_ratio:new a.bf(d,e.u_aspect_ratio),u_fade_change:new a.bf(d,e.u_fade_change),u_label_plane_matrix:new a.bQ(d,e.u_label_plane_matrix),u_coord_matrix:new a.bQ(d,e.u_coord_matrix),u_is_text:new a.bO(d,e.u_is_text),u_pitch_with_map:new a.bO(d,e.u_pitch_with_map),u_is_along_line:new a.bO(d,e.u_is_along_line),u_is_variable_anchor:new a.bO(d,e.u_is_variable_anchor),u_texsize:new a.bT(d,e.u_texsize),u_texsize_icon:new a.bT(d,e.u_texsize_icon),u_texture:new a.bO(d,e.u_texture),u_texture_icon:new a.bO(d,e.u_texture_icon),u_gamma_scale:new a.bf(d,e.u_gamma_scale),u_device_pixel_ratio:new a.bf(d,e.u_device_pixel_ratio),u_is_halo:new a.bO(d,e.u_is_halo),u_translation:new a.bT(d,e.u_translation),u_pitched_scale:new a.bf(d,e.u_pitched_scale)}),background:(d,e)=>({u_opacity:new a.bf(d,e.u_opacity),u_color:new a.bP(d,e.u_color)}),backgroundPattern:(d,e)=>({u_opacity:new a.bf(d,e.u_opacity),u_image:new a.bO(d,e.u_image),u_pattern_tl_a:new a.bT(d,e.u_pattern_tl_a),u_pattern_br_a:new a.bT(d,e.u_pattern_br_a),u_pattern_tl_b:new a.bT(d,e.u_pattern_tl_b),u_pattern_br_b:new a.bT(d,e.u_pattern_br_b),u_texsize:new a.bT(d,e.u_texsize),u_mix:new a.bf(d,e.u_mix),u_pattern_size_a:new a.bT(d,e.u_pattern_size_a),u_pattern_size_b:new a.bT(d,e.u_pattern_size_b),u_scale_a:new a.bf(d,e.u_scale_a),u_scale_b:new a.bf(d,e.u_scale_b),u_pixel_coord_upper:new a.bT(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new a.bT(d,e.u_pixel_coord_lower),u_tile_units_to_pixels:new a.bf(d,e.u_tile_units_to_pixels)}),terrain:(d,e)=>({u_texture:new a.bO(d,e.u_texture),u_ele_delta:new a.bf(d,e.u_ele_delta),u_fog_matrix:new a.bQ(d,e.u_fog_matrix),u_fog_color:new a.bP(d,e.u_fog_color),u_fog_ground_blend:new a.bf(d,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new a.bf(d,e.u_fog_ground_blend_opacity),u_horizon_color:new a.bP(d,e.u_horizon_color),u_horizon_fog_blend:new a.bf(d,e.u_horizon_fog_blend),u_is_globe_mode:new a.bf(d,e.u_is_globe_mode)}),terrainDepth:(d,e)=>({u_ele_delta:new a.bf(d,e.u_ele_delta)}),terrainCoords:(d,e)=>({u_texture:new a.bO(d,e.u_texture),u_terrain_coords_id:new a.bf(d,e.u_terrain_coords_id),u_ele_delta:new a.bf(d,e.u_ele_delta)}),projectionErrorMeasurement:(d,e)=>({u_input:new a.bf(d,e.u_input),u_output_expected:new a.bf(d,e.u_output_expected)}),atmosphere:(d,e)=>({u_sun_pos:new a.bS(d,e.u_sun_pos),u_atmosphere_blend:new a.bf(d,e.u_atmosphere_blend),u_globe_position:new a.bS(d,e.u_globe_position),u_globe_radius:new a.bf(d,e.u_globe_radius),u_inv_proj_matrix:new a.bQ(d,e.u_inv_proj_matrix)}),sky:(d,e)=>({u_sky_color:new a.bP(d,e.u_sky_color),u_horizon_color:new a.bP(d,e.u_horizon_color),u_horizon:new a.bT(d,e.u_horizon),u_horizon_normal:new a.bT(d,e.u_horizon_normal),u_sky_horizon_blend:new a.bf(d,e.u_sky_horizon_blend),u_sky_blend:new a.bf(d,e.u_sky_blend)})};class dh{constructor(e,r,l){this.context=e;const c=e.gl;this.buffer=c.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const r=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ph={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class kl{constructor(e,r,l,c){this.length=r.length,this.attributes=l,this.itemSize=r.bytesPerElement,this.dynamicDraw=c,this.context=e;const p=e.gl;this.buffer=p.createBuffer(),e.bindVertexBuffer.set(this.buffer),p.bufferData(p.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,r){for(let l=0;l<this.attributes.length;l++){const c=r.attributes[this.attributes[l].name];c!==void 0&&e.enableVertexAttribArray(c)}}setVertexAttribPointers(e,r,l){for(let c=0;c<this.attributes.length;c++){const p=this.attributes[c],g=r.attributes[p.name];g!==void 0&&e.vertexAttribPointer(g,p.components,e[ph[p.type]],!1,this.itemSize,p.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class cr{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ga extends cr{getDefault(){return a.be.transparent}set(e){const r=this.current;(e.r!==r.r||e.g!==r.g||e.b!==r.b||e.a!==r.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Pn extends cr{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Ml extends cr{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Il extends cr{getDefault(){return[!0,!0,!0,!0]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||e[3]!==r[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Al extends cr{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class fh extends cr{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class zl extends cr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const r=this.current;(e.func!==r.func||e.ref!==r.ref||e.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class is extends cr{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Dl extends cr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=e,this.dirty=!1}}class Lu extends cr{getDefault(){return[0,1]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Fu extends cr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=e,this.dirty=!1}}class Bu extends cr{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Ou extends cr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.BLEND):r.disable(r.BLEND),this.current=e,this.dirty=!1}}class mh extends cr{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class ju extends cr{getDefault(){return a.be.transparent}set(e){const r=this.current;(e.r!==r.r||e.g!==r.g||e.b!==r.b||e.a!==r.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class _h extends cr{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class ya extends cr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=e,this.dirty=!1}}class va extends cr{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class ba extends cr{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Rl extends cr{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class ns extends cr{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class wo extends cr{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||e[3]!==r[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Is extends cr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Zi extends cr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class gh extends cr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class yh extends cr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ll extends cr{getDefault(){return null}set(e){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class ss extends cr{getDefault(){return null}set(e){var r;if(e===this.current&&!this.dirty)return;const l=this.gl;xi(l)?l.bindVertexArray(e):(r=l.getExtension("OES_vertex_array_object"))===null||r===void 0||r.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class xa extends cr{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class wa extends cr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Co extends cr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class As extends cr{constructor(e,r){super(e),this.context=e,this.parent=r}getDefault(){return null}}class vh extends As{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class zs extends As{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Ds extends As{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const Fl="Framebuffer is not complete";class Bl{constructor(e,r,l,c,p){this.context=e,this.width=r,this.height=l;const g=e.gl,b=this.framebuffer=g.createFramebuffer();if(this.colorAttachment=new vh(e,b),c)this.depthAttachment=p?new Ds(e,b):new zs(e,b);else if(p)throw new Error("Stencil cannot be set without depth");if(g.checkFramebufferStatus(g.FRAMEBUFFER)!==g.FRAMEBUFFER_COMPLETE)throw new Error(Fl)}destroy(){const e=this.context.gl,r=this.colorAttachment.get();if(r&&e.deleteTexture(r),this.depthAttachment){const l=this.depthAttachment.get();l&&e.deleteRenderbuffer(l)}e.deleteFramebuffer(this.framebuffer)}}class Jt{constructor(e){var r,l;if(this.gl=e,this.clearColor=new ga(this),this.clearDepth=new Pn(this),this.clearStencil=new Ml(this),this.colorMask=new Il(this),this.depthMask=new Al(this),this.stencilMask=new fh(this),this.stencilFunc=new zl(this),this.stencilOp=new is(this),this.stencilTest=new Dl(this),this.depthRange=new Lu(this),this.depthTest=new Fu(this),this.depthFunc=new Bu(this),this.blend=new Ou(this),this.blendFunc=new mh(this),this.blendColor=new ju(this),this.blendEquation=new _h(this),this.cullFace=new ya(this),this.cullFaceSide=new va(this),this.frontFace=new ba(this),this.program=new Rl(this),this.activeTexture=new ns(this),this.viewport=new wo(this),this.bindFramebuffer=new Is(this),this.bindRenderbuffer=new Zi(this),this.bindTexture=new gh(this),this.bindVertexBuffer=new yh(this),this.bindElementBuffer=new Ll(this),this.bindVertexArray=new ss(this),this.pixelStoreUnpack=new xa(this),this.pixelStoreUnpackPremultiplyAlpha=new wa(this),this.pixelStoreUnpackFlipY=new Co(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),xi(e)){this.HALF_FLOAT=e.HALF_FLOAT;const c=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(r=e.RGBA16F)!==null&&r!==void 0?r:c==null?void 0:c.RGBA16F_EXT,this.RGB16F=(l=e.RGB16F)!==null&&l!==void 0?l:c==null?void 0:c.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const c=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=c==null?void 0:c.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,r){return new dh(this,e,r)}createVertexBuffer(e,r,l){return new kl(this,e,r,l)}createRenderbuffer(e,r,l){const c=this.gl,p=c.createRenderbuffer();return this.bindRenderbuffer.set(p),c.renderbufferStorage(c.RENDERBUFFER,e,r,l),this.bindRenderbuffer.set(null),p}createFramebuffer(e,r,l,c){return new Bl(this,e,r,l,c)}clear({color:e,depth:r,stencil:l}){const c=this.gl;let p=0;e&&(p|=c.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),r!==void 0&&(p|=c.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),l!==void 0&&(p|=c.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),c.clear(p)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){a.bG(e.blendFunction,ir.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return xi(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var r;return xi(this.gl)?this.gl.deleteVertexArray(e):(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let os;function bh(d,e,r,l,c){const p=d.context,g=d.transform,b=p.gl,C=d.useProgram("collisionBox"),S=[];let M=0,z=0;for(let ee=0;ee<l.length;ee++){const se=l[ee],fe=e.getTile(se).getBucket(r);if(!fe)continue;const he=c?fe.textCollisionBox:fe.iconCollisionBox,_e=fe.collisionCircleArray;_e.length>0&&(S.push({circleArray:_e,circleOffset:z,coord:se}),M+=_e.length/4,z=M),he&&C.draw(p,b.LINES,$t.disabled,Lt.disabled,d.colorModeForRenderPass(),Nt.disabled,vo(d.transform),d.style.map.terrain&&d.style.map.terrain.getTerrainData(se),g.getProjectionData({overscaledTileID:se,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),r.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,null,d.transform.zoom,null,null,he.collisionVertexBuffer)}if(!c||!S.length)return;const A=d.useProgram("collisionCircle"),R=new a.b_;R.resize(4*M),R._trim();let V=0;for(const ee of S)for(let se=0;se<ee.circleArray.length/4;se++){const fe=4*se,he=ee.circleArray[fe+0],_e=ee.circleArray[fe+1],ye=ee.circleArray[fe+2],ue=ee.circleArray[fe+3];R.emplace(V++,he,_e,ye,ue,0),R.emplace(V++,he,_e,ye,ue,1),R.emplace(V++,he,_e,ye,ue,2),R.emplace(V++,he,_e,ye,ue,3)}(!os||os.length<2*M)&&(os=function(ee){const se=2*ee,fe=new a.c0;fe.resize(se),fe._trim();for(let he=0;he<se;he++){const _e=6*he;fe.uint16[_e+0]=4*he+0,fe.uint16[_e+1]=4*he+1,fe.uint16[_e+2]=4*he+2,fe.uint16[_e+3]=4*he+2,fe.uint16[_e+4]=4*he+3,fe.uint16[_e+5]=4*he+0}return fe}(M));const Q=p.createIndexBuffer(os,!0),J=p.createVertexBuffer(R,a.b$.members,!0);for(const ee of S){const se=bo(d.transform);A.draw(p,b.TRIANGLES,$t.disabled,Lt.disabled,d.colorModeForRenderPass(),Nt.disabled,se,d.style.map.terrain&&d.style.map.terrain.getTerrainData(ee.coord),null,r.id,J,Q,a.aL.simpleSegment(0,2*ee.circleOffset,ee.circleArray.length,ee.circleArray.length/2),null,d.transform.zoom,null,null,null)}J.destroy(),Q.destroy()}const xh=a.af(new Float32Array(16));function Po(d,e,r,l,c,p){const{horizontalAlign:g,verticalAlign:b}=a.aG(d);return new a.P((-(g-.5)*e/c+l[0])*p,(-(b-.5)*r/c+l[1])*p)}function Vu(d,e,r,l,c,p){const g=e.tileAnchorPoint.add(new a.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let b=l.mult(p);r||(b=b.rotate(-c));const C=g.add(b);return lr(C.x,C.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(r){const b=mt(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(d),C=Math.atan(b.y/b.x)+(b.x<0?Math.PI:0);return d.add(l.rotate(C))}return d.add(l)}function Nu(d,e,r,l,c,p,g,b,C,S,M,z){const A=d.text.placedSymbolArray,R=d.text.dynamicLayoutVertexArray,V=d.icon.dynamicLayoutVertexArray,Q={};R.clear();for(let J=0;J<A.length;J++){const ee=A.get(J),se=ee.hidden||!ee.crossTileID||d.allowVerticalPlacement&&!ee.placedOrientation?null:l[ee.crossTileID];if(se){const fe=new a.P(ee.anchorX,ee.anchorY),he={getElevation:z,width:c.width,height:c.height,pitchedLabelPlaneMatrix:p,pitchWithMap:r,transform:c,tileAnchorPoint:fe,translation:S,unwrappedTileID:M},_e=r?Wt(fe.x,fe.y,he):mt(fe.x,fe.y,he),ye=Bt(c.cameraToCenterDistance,_e.signedDistanceFromCamera);let ue=a.ao(d.textSizeData,b,ee)*ye/a.aA;r&&(ue*=d.tilePixelRatio/g);const{width:Ce,height:Be,anchor:De,textOffset:Re,textBoxScale:je}=se,ft=Po(De,Ce,Be,Re,je,ue),ht=c.getPitchedTextCorrection(fe.x+S[0],fe.y+S[1],M),tt=Vu(_e.point,he,e,ft,-c.bearingInRadians,ht),Ct=d.allowVerticalPlacement&&ee.placedOrientation===a.an.vertical?Math.PI/2:0;for(let Zt=0;Zt<ee.numGlyphs;Zt++)a.au(R,tt,Ct);C&&ee.associatedIconIndex>=0&&(Q[ee.associatedIconIndex]={shiftedAnchor:tt,angle:Ct})}else vn(ee.numGlyphs,R)}if(C){V.clear();const J=d.icon.placedSymbolArray;for(let ee=0;ee<J.length;ee++){const se=J.get(ee);if(se.hidden)vn(se.numGlyphs,V);else{const fe=Q[ee];if(fe)for(let he=0;he<se.numGlyphs;he++)a.au(V,fe.shiftedAnchor,fe.angle);else vn(se.numGlyphs,V)}}d.icon.dynamicLayoutVertexBuffer.updateData(V)}d.text.dynamicLayoutVertexBuffer.updateData(R)}function wh(d,e,r){return r.iconsInText&&e?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function Ch(d,e,r,l,c,p,g,b,C,S,M,z,A){const R=d.context,V=R.gl,Q=d.transform,J=b==="map",ee=C==="map",se=b!=="viewport"&&r.layout.get("symbol-placement")!=="point",fe=J&&!ee&&!se,he=!r.layout.get("symbol-sort-key").isConstant();let _e=!1;const ye=d.getDepthModeForSublayer(0,$t.ReadOnly),ue=r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ce=[],Be=Q.getCircleRadiusCorrection();for(const De of l){const Re=e.getTile(De),je=Re.getBucket(r);if(!je)continue;const ft=c?je.text:je.icon;if(!ft||!ft.segments.get().length||!ft.hasVisibleVertices)continue;const ht=ft.programConfigurations.get(r.id),tt=c||je.sdfIcons,Ct=c?je.textSizeData:je.iconSizeData,Zt=ee||Q.pitch!==0,hr=d.useProgram(wh(tt,c,je),ht),Mr=a.am(Ct,Q.zoom),mr=d.style.map.terrain&&d.style.map.terrain.getTerrainData(De);let Ir,gr,_r,yr,ci=[0,0],nr=null;if(c)gr=Re.glyphAtlasTexture,_r=V.LINEAR,Ir=Re.glyphAtlasTexture.size,je.iconsInText&&(ci=Re.imageAtlasTexture.size,nr=Re.imageAtlasTexture,yr=Zt||d.options.rotating||d.options.zooming||Ct.kind==="composite"||Ct.kind==="camera"?V.LINEAR:V.NEAREST);else{const Br=r.layout.get("icon-size").constantOr(0)!==1||je.iconsNeedLinear;gr=Re.imageAtlasTexture,_r=tt||d.options.rotating||d.options.zooming||Br||Zt?V.LINEAR:V.NEAREST,Ir=Re.imageAtlasTexture.size}const ei=a.aB(Re,1,d.transform.zoom),hi=Ot(J,d.transform,ei),Nn=a.L();a.ap(Nn,hi);const Un=br(ee,J,d.transform,ei),$n=a.aC(Q,Re,p,g),mn=Q.getProjectionData({overscaledTileID:De,applyGlobeMatrix:!A,applyTerrainMatrix:!0}),Oo=ue&&je.hasTextData(),jo=r.layout.get("icon-text-fit")!=="none"&&Oo&&je.hasIconData();if(se){const Br=d.style.map.terrain?(Ti,Wr)=>d.style.map.terrain.getElevation(De,Ti,Wr):null,xr=r.layout.get("text-rotation-alignment")==="map";Yr(je,d,c,hi,Nn,ee,S,xr,De.toUnwrapped(),Q.width,Q.height,$n,Br)}const Gs=c&&ue||jo,Ii=se||Gs?xh:ee?hi:d.transform.clipSpaceToPixelsMatrix,Qi=tt&&r.paint.get(c?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Zn;Zn=tt?je.iconsInText?Du(Ct.kind,Mr,fe,ee,se,Gs,d,Ii,Un,$n,Ir,ci,Be):Ms(Ct.kind,Mr,fe,ee,se,Gs,d,Ii,Un,$n,c,Ir,0,Be):El(Ct.kind,Mr,fe,ee,se,Gs,d,Ii,Un,$n,c,Ir,Be);const cs={program:hr,buffers:ft,uniformValues:Zn,projectionData:mn,atlasTexture:gr,atlasTextureIcon:nr,atlasInterpolation:_r,atlasInterpolationIcon:yr,isSDF:tt,hasHalo:Qi};if(he&&je.canOverlap){_e=!0;const Br=ft.segments.get();for(const xr of Br)Ce.push({segments:new a.aL([xr]),sortKey:xr.sortKey,state:cs,terrainData:mr})}else Ce.push({segments:ft.segments,sortKey:0,state:cs,terrainData:mr})}_e&&Ce.sort((De,Re)=>De.sortKey-Re.sortKey);for(const De of Ce){const Re=De.state;if(R.activeTexture.set(V.TEXTURE0),Re.atlasTexture.bind(Re.atlasInterpolation,V.CLAMP_TO_EDGE),Re.atlasTextureIcon&&(R.activeTexture.set(V.TEXTURE1),Re.atlasTextureIcon&&Re.atlasTextureIcon.bind(Re.atlasInterpolationIcon,V.CLAMP_TO_EDGE)),Re.isSDF){const je=Re.uniformValues;Re.hasHalo&&(je.u_is_halo=1,Ca(Re.buffers,De.segments,r,d,Re.program,ye,M,z,je,Re.projectionData,De.terrainData)),je.u_is_halo=0}Ca(Re.buffers,De.segments,r,d,Re.program,ye,M,z,Re.uniformValues,Re.projectionData,De.terrainData)}}function Ca(d,e,r,l,c,p,g,b,C,S,M){const z=l.context;c.draw(z,z.gl.TRIANGLES,p,g,b,Nt.backCCW,C,M,S,r.id,d.layoutVertexBuffer,d.indexBuffer,e,r.paint,l.transform.zoom,d.programConfigurations.get(r.id),d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer)}function Pa(d,e,r,l,c){const p=d.context,g=p.gl,b=Lt.disabled,C=new ir([g.ONE,g.ONE],a.be.transparent,[!0,!0,!0,!0]),S=e.getBucket(r);if(!S)return;const M=l.key;let z=r.heatmapFbos.get(M);z||(z=To(p,e.tileSize,e.tileSize),r.heatmapFbos.set(M,z)),p.bindFramebuffer.set(z.framebuffer),p.viewport.set([0,0,e.tileSize,e.tileSize]),p.clear({color:a.be.transparent});const A=S.programConfigurations.get(r.id),R=d.useProgram("heatmap",A,!c),V=d.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Q=d.style.map.terrain.getTerrainData(l);R.draw(p,g.TRIANGLES,$t.disabled,b,C,Nt.disabled,xo(e,d.transform.zoom,r.paint.get("heatmap-intensity"),1),Q,V,r.id,S.layoutVertexBuffer,S.indexBuffer,S.segments,r.paint,d.transform.zoom,A)}function Ta(d,e,r,l,c){const p=d.context,g=p.gl,b=d.transform;p.setColorMode(d.colorModeForRenderPass());const C=Sa(p,e),S=r.key,M=e.heatmapFbos.get(S);if(!M)return;p.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,M.colorAttachment.get()),p.activeTexture.set(g.TEXTURE1),C.bind(g.LINEAR,g.CLAMP_TO_EDGE);const z=b.getProjectionData({overscaledTileID:r,applyTerrainMatrix:c,applyGlobeMatrix:!l});d.useProgram("heatmapTexture").draw(p,g.TRIANGLES,$t.disabled,Lt.disabled,d.colorModeForRenderPass(),Nt.disabled,sh(d,e,0,1),null,z,e.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments,e.paint,b.zoom),M.destroy(),e.heatmapFbos.delete(S)}function To(d,e,r){var l,c;const p=d.gl,g=p.createTexture();p.bindTexture(p.TEXTURE_2D,g),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR);const b=(l=d.HALF_FLOAT)!==null&&l!==void 0?l:p.UNSIGNED_BYTE,C=(c=d.RGBA16F)!==null&&c!==void 0?c:p.RGBA;p.texImage2D(p.TEXTURE_2D,0,C,e,r,0,p.RGBA,b,null);const S=d.createFramebuffer(e,r,!1,!1);return S.colorAttachment.set(g),S}function Sa(d,e){return e.colorRampTexture||(e.colorRampTexture=new a.T(d,e.colorRamp,d.gl.RGBA)),e.colorRampTexture}function Ol(d,e,r,l,c){if(!r||!l||!l.imageAtlas)return;const p=l.imageAtlas.patternPositions;let g=p[r.to.toString()],b=p[r.from.toString()];if(!g&&b&&(g=b),!b&&g&&(b=g),!g||!b){const C=c.getPaintProperty(e);g=p[C],b=p[C]}g&&b&&d.setConstantPatternPositions(g,b)}function So(d,e,r,l,c,p,g,b){const C=d.context.gl,S="fill-pattern",M=r.paint.get(S),z=M&&M.constantOr(1),A=r.getCrossfadeParameters();let R,V,Q,J,ee;const se=d.transform,fe=r.paint.get("fill-translate"),he=r.paint.get("fill-translate-anchor");g?(V=z&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=C.LINES):(V=z?"fillPattern":"fill",R=C.TRIANGLES);const _e=M.constantOr(null);for(const ye of l){const ue=e.getTile(ye);if(z&&!ue.patternsLoaded())continue;const Ce=ue.getBucket(r);if(!Ce)continue;const Be=Ce.programConfigurations.get(r.id),De=d.useProgram(V,Be),Re=d.style.map.terrain&&d.style.map.terrain.getTerrainData(ye);z&&(d.context.activeTexture.set(C.TEXTURE0),ue.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),Be.updatePaintBuffers(A)),Ol(Be,S,_e,ue,r);const je=se.getProjectionData({overscaledTileID:ye,applyGlobeMatrix:!b,applyTerrainMatrix:!0}),ft=a.aC(se,ue,fe,he);if(g){J=Ce.indexBuffer2,ee=Ce.segments2;const tt=[C.drawingBufferWidth,C.drawingBufferHeight];Q=V==="fillOutlinePattern"&&z?Iu(d,A,ue,tt,ft):dn(tt,ft)}else J=Ce.indexBuffer,ee=Ce.segments,Q=z?fa(d,A,ue,ft):{u_fill_translate:ft};const ht=d.stencilModeForClipping(ye);De.draw(d.context,R,c,ht,p,Nt.backCCW,Q,Re,je,r.id,Ce.layoutVertexBuffer,J,ee,r.paint,d.transform.zoom,Be)}}function Rs(d,e,r,l,c,p,g,b){const C=d.context,S=C.gl,M="fill-extrusion-pattern",z=r.paint.get(M),A=z.constantOr(1),R=r.getCrossfadeParameters(),V=r.paint.get("fill-extrusion-opacity"),Q=z.constantOr(null),J=d.transform;for(const ee of l){const se=e.getTile(ee),fe=se.getBucket(r);if(!fe)continue;const he=d.style.map.terrain&&d.style.map.terrain.getTerrainData(ee),_e=fe.programConfigurations.get(r.id),ye=d.useProgram(A?"fillExtrusionPattern":"fillExtrusion",_e);A&&(d.context.activeTexture.set(S.TEXTURE0),se.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),_e.updatePaintBuffers(R));const ue=J.getProjectionData({overscaledTileID:ee,applyGlobeMatrix:!b,applyTerrainMatrix:!0});Ol(_e,M,Q,se,r);const Ce=a.aC(J,se,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),Be=r.paint.get("fill-extrusion-vertical-gradient"),De=A?wl(d,Be,V,Ce,ee,R,se):yo(d,Be,V,Ce);ye.draw(C,C.gl.TRIANGLES,c,p,g,Nt.backCCW,De,he,ue,r.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,r.paint,d.transform.zoom,_e,d.style.map.terrain&&fe.centroidVertexBuffer)}}function Ls(d,e,r,l,c,p,g,b,C){var S;const M=d.style.projection,z=d.context,A=d.transform,R=z.gl,V=[`#define NUM_ILLUMINATION_SOURCES ${r.paint.get("hillshade-highlight-color").values.length}`],Q=d.useProgram("hillshade",null,!1,V),J=!d.options.moving;for(const ee of l){const se=e.getTile(ee),fe=se.fbo;if(!fe)continue;const he=M.getMeshFromTileID(z,ee.canonical,b,!0,"raster"),_e=(S=d.style.map.terrain)===null||S===void 0?void 0:S.getTerrainData(ee);z.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,fe.colorAttachment.get());const ye=A.getProjectionData({overscaledTileID:ee,aligned:J,applyGlobeMatrix:!C,applyTerrainMatrix:!0});Q.draw(z,R.TRIANGLES,p,c[ee.overscaledZ],g,Nt.backCCW,ks(d,se,r),_e,ye,r.id,he.vertexBuffer,he.indexBuffer,he.segments)}}function Eo(d,e,r,l,c,p,g,b,C){var S;const M=d.style.projection,z=d.context,A=d.transform,R=z.gl,V=d.useProgram("colorRelief"),Q=!d.options.moving;let J=!0;for(const ee of l){const se=e.getTile(ee),fe=se.dem;if(J){const Be=R.getParameter(R.MAX_TEXTURE_SIZE),{elevationTexture:De,colorTexture:Re}=r.getColorRampTextures(z,Be,fe.getUnpackVector());z.activeTexture.set(R.TEXTURE1),De.bind(R.NEAREST,R.CLAMP_TO_EDGE),z.activeTexture.set(R.TEXTURE4),Re.bind(R.LINEAR,R.CLAMP_TO_EDGE),J=!1}if(!fe||!fe.data)continue;const he=fe.stride,_e=fe.getPixels();if(z.activeTexture.set(R.TEXTURE0),z.pixelStoreUnpackPremultiplyAlpha.set(!1),se.demTexture=se.demTexture||d.getTileTexture(he),se.demTexture){const Be=se.demTexture;Be.update(_e,{premultiply:!1}),Be.bind(R.LINEAR,R.CLAMP_TO_EDGE)}else se.demTexture=new a.T(z,_e,R.RGBA,{premultiply:!1}),se.demTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE);const ye=M.getMeshFromTileID(z,ee.canonical,b,!0,"raster"),ue=(S=d.style.map.terrain)===null||S===void 0?void 0:S.getTerrainData(ee),Ce=A.getProjectionData({overscaledTileID:ee,aligned:Q,applyGlobeMatrix:!C,applyTerrainMatrix:!0});V.draw(z,R.TRIANGLES,p,c[ee.overscaledZ],g,Nt.backCCW,zu(r,se.dem),ue,Ce,r.id,ye.vertexBuffer,ye.indexBuffer,ye.segments)}}const jl=[new a.P(0,0),new a.P(a.$,0),new a.P(a.$,a.$),new a.P(0,a.$)];function Fn(d,e,r,l,c,p,g,b,C=!1,S=!1){const M=l[l.length-1].overscaledZ,z=d.context,A=z.gl,R=d.useProgram("raster"),V=d.transform,Q=d.style.projection,J=d.colorModeForRenderPass(),ee=!d.options.moving;for(const se of l){const fe=d.getDepthModeForSublayer(se.overscaledZ-M,r.paint.get("raster-opacity")===1?$t.ReadWrite:$t.ReadOnly,A.LESS),he=e.getTile(se);he.registerFadeDuration(r.paint.get("raster-fade-duration"));const _e=e.findLoadedParent(se,0),ye=e.findLoadedSibling(se),ue=Uu(he,_e||ye||null,e,r,d.transform,d.style.map.terrain);let Ce,Be;const De=r.paint.get("raster-resampling")==="nearest"?A.NEAREST:A.LINEAR;z.activeTexture.set(A.TEXTURE0),he.texture.bind(De,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),z.activeTexture.set(A.TEXTURE1),_e?(_e.texture.bind(De,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),Ce=Math.pow(2,_e.tileID.overscaledZ-he.tileID.overscaledZ),Be=[he.tileID.canonical.x*Ce%1,he.tileID.canonical.y*Ce%1]):he.texture.bind(De,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),he.texture.useMipmap&&z.extTextureFilterAnisotropic&&d.transform.pitch>20&&A.texParameterf(A.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax);const Re=d.style.map.terrain&&d.style.map.terrain.getTerrainData(se),je=V.getProjectionData({overscaledTileID:se,aligned:ee,applyGlobeMatrix:!S,applyTerrainMatrix:!0}),ft=rs(Be||[0,0],Ce||1,ue,r,b),ht=Q.getMeshFromTileID(z,se.canonical,p,g,"raster");R.draw(z,A.TRIANGLES,fe,c?c[se.overscaledZ]:Lt.disabled,J,C?Nt.frontCCW:Nt.backCCW,ft,Re,je,r.id,ht.vertexBuffer,ht.indexBuffer,ht.segments)}}function Uu(d,e,r,l,c,p){const g=l.paint.get("raster-fade-duration");if(!p&&g>0){const b=oe.now(),C=(b-d.timeAdded)/g,S=e?(b-e.timeAdded)/g:-1,M=r.getSource(),z=$e(c,{tileSize:M.tileSize,roundZoom:M.roundZoom}),A=!e||Math.abs(e.tileID.overscaledZ-z)>Math.abs(d.tileID.overscaledZ-z),R=A&&d.refreshedUponExpiration?1:a.ag(A?C:1-S,0,1);return d.refreshedUponExpiration&&C>=1&&(d.refreshedUponExpiration=!1),e?{opacity:1,mix:1-R}:{opacity:R,mix:0}}return{opacity:1,mix:0}}const Ph=new a.be(1,0,0,1),Ea=new a.be(0,1,0,1),Vl=new a.be(0,0,1,1),Th=new a.be(1,0,1,1),Sh=new a.be(0,1,1,1);function ko(d,e,r,l){Ma(d,0,e+r/2,d.transform.width,r,l)}function ka(d,e,r,l){Ma(d,e-r/2,0,r,d.transform.height,l)}function Ma(d,e,r,l,c,p){const g=d.context,b=g.gl;b.enable(b.SCISSOR_TEST),b.scissor(e*d.pixelRatio,r*d.pixelRatio,l*d.pixelRatio,c*d.pixelRatio),g.clear({color:p}),b.disable(b.SCISSOR_TEST)}function Eh(d,e,r){const l=d.context,c=l.gl,p=d.useProgram("debug"),g=$t.disabled,b=Lt.disabled,C=d.colorModeForRenderPass(),S="$debug",M=d.style.map.terrain&&d.style.map.terrain.getTerrainData(r);l.activeTexture.set(c.TEXTURE0);const z=e.getTileByID(r.key).latestRawTileData,A=Math.floor((z&&z.byteLength||0)/1024),R=e.getTile(r).tileSize,V=512/Math.min(R,512)*(r.overscaledZ/d.transform.zoom)*.5;let Q=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(Q+=` => ${r.overscaledZ}`),function(ee,se){ee.initDebugOverlayCanvas();const fe=ee.debugOverlayCanvas,he=ee.context.gl,_e=ee.debugOverlayCanvas.getContext("2d");_e.clearRect(0,0,fe.width,fe.height),_e.shadowColor="white",_e.shadowBlur=2,_e.lineWidth=1.5,_e.strokeStyle="white",_e.textBaseline="top",_e.font="bold 36px Open Sans, sans-serif",_e.fillText(se,5,5),_e.strokeText(se,5,5),ee.debugOverlayTexture.update(fe),ee.debugOverlayTexture.bind(he.LINEAR,he.CLAMP_TO_EDGE)}(d,`${Q} ${A}kB`);const J=d.transform.getProjectionData({overscaledTileID:r,applyGlobeMatrix:!0,applyTerrainMatrix:!0});p.draw(l,c.TRIANGLES,g,b,ir.alphaBlended,Nt.disabled,nh(a.be.transparent,V),null,J,S,d.debugBuffer,d.quadTriangleIndexBuffer,d.debugSegments),p.draw(l,c.LINE_STRIP,g,b,C,Nt.disabled,nh(a.be.red),M,J,S,d.debugBuffer,d.tileBorderIndexBuffer,d.debugSegments)}function Rr(d,e,r,l){const{isRenderingGlobe:c}=l,p=d.context,g=p.gl,b=d.transform,C=d.colorModeForRenderPass(),S=d.getDepthModeFor3D(),M=d.useProgram("terrain");p.bindFramebuffer.set(null),p.viewport.set([0,0,d.width,d.height]);for(const z of r){const A=e.getTerrainMesh(z.tileID),R=d.renderToTexture.getTexture(z),V=e.getTerrainData(z.tileID);p.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,R.texture);const Q=e.getMeshFrameDelta(b.zoom),J=b.calculateFogMatrix(z.tileID.toUnwrapped()),ee=ku(Q,J,d.style.sky,b.pitch,c),se=b.getProjectionData({overscaledTileID:z.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});M.draw(p,g.TRIANGLES,S,Lt.disabled,C,Nt.backCCW,ee,V,se,"terrain",A.vertexBuffer,A.indexBuffer,A.segments)}}function Bn(d,e){if(!e.mesh){const r=new a.aK;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(1,1),r.emplaceBack(-1,1);const l=new a.aM;l.emplaceBack(0,1,2),l.emplaceBack(0,2,3),e.mesh=new xn(d.createVertexBuffer(r,wn.members),d.createIndexBuffer(l),a.aL.simpleSegment(0,0,r.length,l.length))}return e.mesh}class Gi{constructor(e,r){this.context=new Jt(e),this.transform=r,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.af(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ye.maxUnderzooming+Ye.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new aa}resize(e,r,l){if(this.width=Math.floor(e*l),this.height=Math.floor(r*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style._order)this.style._layers[c].resize()}setup(){const e=this.context,r=new a.aK;r.emplaceBack(0,0),r.emplaceBack(a.$,0),r.emplaceBack(0,a.$),r.emplaceBack(a.$,a.$),this.tileExtentBuffer=e.createVertexBuffer(r,wn.members),this.tileExtentSegments=a.aL.simpleSegment(0,0,4,2);const l=new a.aK;l.emplaceBack(0,0),l.emplaceBack(a.$,0),l.emplaceBack(0,a.$),l.emplaceBack(a.$,a.$),this.debugBuffer=e.createVertexBuffer(l,wn.members),this.debugSegments=a.aL.simpleSegment(0,0,4,5);const c=new a.c5;c.emplaceBack(0,0,0,0),c.emplaceBack(a.$,0,a.$,0),c.emplaceBack(0,a.$,0,a.$),c.emplaceBack(a.$,a.$,a.$,a.$),this.rasterBoundsBuffer=e.createVertexBuffer(c,Su.members),this.rasterBoundsSegments=a.aL.simpleSegment(0,0,4,2);const p=new a.aK;p.emplaceBack(0,0),p.emplaceBack(a.$,0),p.emplaceBack(0,a.$),p.emplaceBack(a.$,a.$),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(p,wn.members),this.rasterBoundsSegmentsPosOnly=a.aL.simpleSegment(0,0,4,5);const g=new a.aK;g.emplaceBack(0,0),g.emplaceBack(1,0),g.emplaceBack(0,1),g.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(g,wn.members),this.viewportSegments=a.aL.simpleSegment(0,0,4,2);const b=new a.c6;b.emplaceBack(0),b.emplaceBack(1),b.emplaceBack(3),b.emplaceBack(2),b.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(b);const C=new a.aM;C.emplaceBack(1,0,2),C.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(C);const S=this.context.gl;this.stencilClearMode=new Lt({func:S.ALWAYS,mask:0},0,255,S.ZERO,S.ZERO,S.ZERO),this.tileExtentMesh=new xn(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,r=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=a.L();a.bX(l,0,this.width,this.height,0,0,1),a.N(l,l,[r.drawingBufferWidth,r.drawingBufferHeight,0]);const c={mainMatrix:l,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:l};this.useProgram("clippingMask",null,!0).draw(e,r.TRIANGLES,$t.disabled,this.stencilClearMode,ir.disabled,Nt.disabled,null,null,c,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,r,l){if(this.currentStencilSource===e.source||!e.isTileClipped()||!r||!r.length)return;this.currentStencilSource=e.source,this.nextStencilID+r.length>256&&this.clearStencil();const c=this.context;c.setColorMode(ir.disabled),c.setDepthMode($t.disabled);const p={};for(const g of r)p[g.key]=this.nextStencilID++;this._renderTileMasks(p,r,l,!0),this._renderTileMasks(p,r,l,!1),this._tileClippingMaskIDs=p}_renderTileMasks(e,r,l,c){const p=this.context,g=p.gl,b=this.style.projection,C=this.transform,S=this.useProgram("clippingMask");for(const M of r){const z=e[M.key],A=this.style.map.terrain&&this.style.map.terrain.getTerrainData(M),R=b.getMeshFromTileID(this.context,M.canonical,c,!0,"stencil"),V=C.getProjectionData({overscaledTileID:M,applyGlobeMatrix:!l,applyTerrainMatrix:!0});S.draw(p,g.TRIANGLES,$t.disabled,new Lt({func:g.ALWAYS,mask:0},z,255,g.KEEP,g.KEEP,g.REPLACE),ir.disabled,l?Nt.disabled:Nt.backCCW,null,A,V,"$clipping",R.vertexBuffer,R.indexBuffer,R.segments)}}_renderTilesDepthBuffer(){const e=this.context,r=e.gl,l=this.style.projection,c=this.transform,p=this.useProgram("depth"),g=this.getDepthModeFor3D(),b=Ve(c,{tileSize:c.tileSize});for(const C of b){const S=this.style.map.terrain&&this.style.map.terrain.getTerrainData(C),M=l.getMeshFromTileID(this.context,C.canonical,!0,!0,"raster"),z=c.getProjectionData({overscaledTileID:C,applyGlobeMatrix:!0,applyTerrainMatrix:!0});p.draw(e,r.TRIANGLES,g,Lt.disabled,ir.disabled,Nt.backCCW,null,S,z,"$clipping",M.vertexBuffer,M.indexBuffer,M.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,r=this.context.gl;return new Lt({func:r.NOTEQUAL,mask:255},e,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(e){const r=this.context.gl;return new Lt({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,r.KEEP,r.KEEP,r.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const r=this.context.gl,l=e.sort((g,b)=>b.overscaledZ-g.overscaledZ),c=l[l.length-1].overscaledZ,p=l[0].overscaledZ-c+1;if(p>1){this.currentStencilSource=void 0,this.nextStencilID+p>256&&this.clearStencil();const g={};for(let b=0;b<p;b++)g[b+c]=new Lt({func:r.GEQUAL,mask:255},b+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=p,[g,l]}return[{[c]:Lt.disabled},l]}stencilConfigForOverlapTwoPass(e){const r=this.context.gl,l=e.sort((g,b)=>b.overscaledZ-g.overscaledZ),c=l[l.length-1].overscaledZ,p=l[0].overscaledZ-c+1;if(this.clearStencil(),p>1){const g={},b={};for(let C=0;C<p;C++)g[C+c]=new Lt({func:r.GREATER,mask:255},p+1+C,255,r.KEEP,r.KEEP,r.REPLACE),b[C+c]=new Lt({func:r.GREATER,mask:255},1+C,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID=2*p+1,[g,b,l]}return this.nextStencilID=3,[{[c]:new Lt({func:r.GREATER,mask:255},2,255,r.KEEP,r.KEEP,r.REPLACE)},{[c]:new Lt({func:r.GREATER,mask:255},1,255,r.KEEP,r.KEEP,r.REPLACE)},l]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new ir([e.CONSTANT_COLOR,e.ONE],new a.be(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ir.unblended:ir.alphaBlended}getDepthModeForSublayer(e,r,l){if(!this.opaquePassEnabledForLayer())return $t.disabled;const c=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new $t(l||this.context.gl.LEQUAL,r,[c,c])}getDepthModeFor3D(){return new $t(this.context.gl.LEQUAL,$t.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,r){var l,c;this.style=e,this.options=r,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(oe.now()),this.imageManager.beginFrame();const p=this.style._order,g=this.style.sourceCaches,b={},C={},S={},M={isRenderingToTexture:!1,isRenderingGlobe:((l=e.projection)===null||l===void 0?void 0:l.transitionState)>0};for(const A in g){const R=g[A];R.used&&R.prepare(this.context),b[A]=R.getVisibleCoordinates(!1),C[A]=b[A].slice().reverse(),S[A]=R.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let A=0;A<p.length;A++)if(this.style._layers[p[A]].is3D()){this.opaquePassCutoff=A;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const A of p){const R=this.style._layers[A];if(!R.hasOffscreenPass()||R.isHidden(this.transform.zoom))continue;const V=C[R.source];(R.type==="custom"||V.length)&&this.renderLayer(this,g[R.source],R,V,M)}if((c=this.style.projection)===null||c===void 0||c.updateGPUdependent({context:this.context,useProgram:A=>this.useProgram(A)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?a.be.black:a.be.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(A,R){const V=A.context,Q=V.gl,J=((ye,ue,Ce)=>{const Be=Math.cos(ue.rollInRadians),De=Math.sin(ue.rollInRadians),Re=G(ue),je=ue.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:ye.properties.get("sky-color"),u_horizon_color:ye.properties.get("horizon-color"),u_horizon:[(ue.width/2-Re*De)*Ce,(ue.height/2+Re*Be)*Ce],u_horizon_normal:[-De,Be],u_sky_horizon_blend:ye.properties.get("sky-horizon-blend")*ue.height/2*Ce,u_sky_blend:je}})(R,A.style.map.transform,A.pixelRatio),ee=new $t(Q.LEQUAL,$t.ReadWrite,[0,1]),se=Lt.disabled,fe=A.colorModeForRenderPass(),he=A.useProgram("sky"),_e=Bn(V,R);he.draw(V,Q.TRIANGLES,ee,se,fe,Nt.disabled,J,null,void 0,"sky",_e.vertexBuffer,_e.indexBuffer,_e.segments)}(this,this.style.sky),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const A=this.style._layers[p[this.currentLayer]],R=g[A.source],V=b[A.source];this._renderTileClippingMasks(A,V,!1),this.renderLayer(this,R,A,V,M)}this.renderPass="translucent";let z=!1;for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const A=this.style._layers[p[this.currentLayer]],R=g[A.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(A,M))continue;this.opaquePassEnabledForLayer()||z||(z=!0,M.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const V=(A.type==="symbol"?S:C)[A.source];this._renderTileClippingMasks(A,b[A.source],!!this.renderToTexture),this.renderLayer(this,R,A,V,M)}if(M.isRenderingGlobe&&function(A,R,V){const Q=A.context,J=Q.gl,ee=A.useProgram("atmosphere"),se=new $t(J.LEQUAL,$t.ReadOnly,[0,1]),fe=A.transform,he=function(je,ft){const ht=je.properties.get("position"),tt=[-ht.x,-ht.y,-ht.z],Ct=a.af(new Float64Array(16));return je.properties.get("anchor")==="map"&&(a.b5(Ct,Ct,ft.rollInRadians),a.b6(Ct,Ct,-ft.pitchInRadians),a.b5(Ct,Ct,ft.bearingInRadians),a.b6(Ct,Ct,ft.center.lat*Math.PI/180),a.by(Ct,Ct,-ft.center.lng*Math.PI/180)),a.c4(tt,tt,Ct),tt}(V,A.transform),_e=fe.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ye=R.properties.get("atmosphere-blend")*_e.projectionTransition;if(ye===0)return;const ue=ws(fe.worldSize,fe.center.lat),Ce=fe.inverseProjectionMatrix,Be=new Float64Array(4);Be[3]=1,a.av(Be,Be,fe.modelViewProjectionMatrix),Be[0]/=Be[3],Be[1]/=Be[3],Be[2]/=Be[3],Be[3]=1,a.av(Be,Be,Ce),Be[0]/=Be[3],Be[1]/=Be[3],Be[2]/=Be[3],Be[3]=1;const De=((je,ft,ht,tt,Ct)=>({u_sun_pos:je,u_atmosphere_blend:ft,u_globe_position:ht,u_globe_radius:tt,u_inv_proj_matrix:Ct}))(he,ye,[Be[0],Be[1],Be[2]],ue,Ce),Re=Bn(Q,R);ee.draw(Q,J.TRIANGLES,se,Lt.disabled,ir.alphaBlended,Nt.disabled,De,null,null,"atmosphere",Re.vertexBuffer,Re.indexBuffer,Re.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const A=function(R,V){let Q=null;const J=Object.values(R._layers).flatMap(he=>he.source&&!he.isHidden(V)?[R.sourceCaches[he.source]]:[]),ee=J.filter(he=>he.getSource().type==="vector"),se=J.filter(he=>he.getSource().type!=="vector"),fe=he=>{(!Q||Q.getSource().maxzoom<he.getSource().maxzoom)&&(Q=he)};return ee.forEach(he=>fe(he)),Q||se.forEach(he=>fe(he)),Q}(this.style,this.transform.zoom);A&&function(R,V,Q){for(let J=0;J<Q.length;J++)Eh(R,V,Q[J])}(this,A,A.getVisibleCoordinates())}this.options.showPadding&&function(A){const R=A.transform.padding;ko(A,A.transform.height-(R.top||0),3,Ph),ko(A,R.bottom||0,3,Ea),ka(A,R.left||0,3,Vl),ka(A,A.transform.width-(R.right||0),3,Th);const V=A.transform.centerPoint;(function(Q,J,ee,se){Ma(Q,J-1,ee-10,2,20,se),Ma(Q,J-10,ee-1,20,2,se)})(A,V.x,A.transform.height-V.y,Sh)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const r=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let c=this.terrainFacilitator.dirty;c||(c=e?!a.c7(r,l):!a.c8(r,l)),c||(c=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),c&&(a.c9(r,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(p,g){const b=p.context,C=b.gl,S=p.transform,M=ir.unblended,z=new $t(C.LEQUAL,$t.ReadWrite,[0,1]),A=g.sourceCache.getRenderableTiles(),R=p.useProgram("terrainDepth");b.bindFramebuffer.set(g.getFramebuffer("depth").framebuffer),b.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),b.clear({color:a.be.transparent,depth:1});for(const V of A){const Q=g.getTerrainMesh(V.tileID),J=g.getTerrainData(V.tileID),ee=S.getProjectionData({overscaledTileID:V.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),se={u_ele_delta:g.getMeshFrameDelta(S.zoom)};R.draw(b,C.TRIANGLES,z,Lt.disabled,M,Nt.backCCW,se,J,ee,"terrain",Q.vertexBuffer,Q.indexBuffer,Q.segments)}b.bindFramebuffer.set(null),b.viewport.set([0,0,p.width,p.height])}(this,this.style.map.terrain),function(p,g){const b=p.context,C=b.gl,S=p.transform,M=ir.unblended,z=new $t(C.LEQUAL,$t.ReadWrite,[0,1]),A=g.getCoordsTexture(),R=g.sourceCache.getRenderableTiles(),V=p.useProgram("terrainCoords");b.bindFramebuffer.set(g.getFramebuffer("coords").framebuffer),b.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),b.clear({color:a.be.transparent,depth:1}),g.coordsIndex=[];for(const Q of R){const J=g.getTerrainMesh(Q.tileID),ee=g.getTerrainData(Q.tileID);b.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,A.texture);const se={u_terrain_coords_id:(255-g.coordsIndex.length)/255,u_texture:0,u_ele_delta:g.getMeshFrameDelta(S.zoom)},fe=S.getProjectionData({overscaledTileID:Q.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});V.draw(b,C.TRIANGLES,z,Lt.disabled,M,Nt.backCCW,se,ee,fe,"terrain",J.vertexBuffer,J.indexBuffer,J.segments),g.coordsIndex.push(Q.tileID.key)}b.bindFramebuffer.set(null),b.viewport.set([0,0,p.width,p.height])}(this,this.style.map.terrain))}renderLayer(e,r,l,c,p){l.isHidden(this.transform.zoom)||(l.type==="background"||l.type==="custom"||(c||[]).length)&&(this.id=l.id,a.ca(l)?function(g,b,C,S,M,z){if(g.renderPass!=="translucent")return;const{isRenderingToTexture:A}=z,R=Lt.disabled,V=g.colorModeForRenderPass();(C._unevaluatedLayout.hasValue("text-variable-anchor")||C._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(Q,J,ee,se,fe,he,_e,ye,ue){const Ce=J.transform,Be=J.style.map.terrain,De=fe==="map",Re=he==="map";for(const je of Q){const ft=se.getTile(je),ht=ft.getBucket(ee);if(!ht||!ht.text||!ht.text.segments.get().length)continue;const tt=a.am(ht.textSizeData,Ce.zoom),Ct=a.aB(ft,1,J.transform.zoom),Zt=Ot(De,J.transform,Ct),hr=ee.layout.get("icon-text-fit")!=="none"&&ht.hasIconData();if(tt){const Mr=Math.pow(2,Ce.zoom-ft.tileID.overscaledZ),mr=Be?(Ir,gr)=>Be.getElevation(je,Ir,gr):null;Nu(ht,De,Re,ue,Ce,Zt,Mr,tt,hr,a.aC(Ce,ft,_e,ye),je.toUnwrapped(),mr)}}}(S,g,C,b,C.layout.get("text-rotation-alignment"),C.layout.get("text-pitch-alignment"),C.paint.get("text-translate"),C.paint.get("text-translate-anchor"),M),C.paint.get("icon-opacity").constantOr(1)!==0&&Ch(g,b,C,S,!1,C.paint.get("icon-translate"),C.paint.get("icon-translate-anchor"),C.layout.get("icon-rotation-alignment"),C.layout.get("icon-pitch-alignment"),C.layout.get("icon-keep-upright"),R,V,A),C.paint.get("text-opacity").constantOr(1)!==0&&Ch(g,b,C,S,!0,C.paint.get("text-translate"),C.paint.get("text-translate-anchor"),C.layout.get("text-rotation-alignment"),C.layout.get("text-pitch-alignment"),C.layout.get("text-keep-upright"),R,V,A),b.map.showCollisionBoxes&&(bh(g,b,C,S,!0),bh(g,b,C,S,!1))}(e,r,l,c,this.style.placement.variableOffsets,p):a.cb(l)?function(g,b,C,S,M){if(g.renderPass!=="translucent")return;const{isRenderingToTexture:z}=M,A=C.paint.get("circle-opacity"),R=C.paint.get("circle-stroke-width"),V=C.paint.get("circle-stroke-opacity"),Q=!C.layout.get("circle-sort-key").isConstant();if(A.constantOr(1)===0&&(R.constantOr(1)===0||V.constantOr(1)===0))return;const J=g.context,ee=J.gl,se=g.transform,fe=g.getDepthModeForSublayer(0,$t.ReadOnly),he=Lt.disabled,_e=g.colorModeForRenderPass(),ye=[],ue=se.getCircleRadiusCorrection();for(let Ce=0;Ce<S.length;Ce++){const Be=S[Ce],De=b.getTile(Be),Re=De.getBucket(C);if(!Re)continue;const je=C.paint.get("circle-translate"),ft=C.paint.get("circle-translate-anchor"),ht=a.aC(se,De,je,ft),tt=Re.programConfigurations.get(C.id),Ct=g.useProgram("circle",tt),Zt=Re.layoutVertexBuffer,hr=Re.indexBuffer,Mr=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Be),mr={programConfiguration:tt,program:Ct,layoutVertexBuffer:Zt,indexBuffer:hr,uniformValues:Cl(g,De,C,ht,ue),terrainData:Mr,projectionData:se.getProjectionData({overscaledTileID:Be,applyGlobeMatrix:!z,applyTerrainMatrix:!0})};if(Q){const Ir=Re.segments.get();for(const gr of Ir)ye.push({segments:new a.aL([gr]),sortKey:gr.sortKey,state:mr})}else ye.push({segments:Re.segments,sortKey:0,state:mr})}Q&&ye.sort((Ce,Be)=>Ce.sortKey-Be.sortKey);for(const Ce of ye){const{programConfiguration:Be,program:De,layoutVertexBuffer:Re,indexBuffer:je,uniformValues:ft,terrainData:ht,projectionData:tt}=Ce.state;De.draw(J,ee.TRIANGLES,fe,he,_e,Nt.backCCW,ft,ht,tt,C.id,Re,je,Ce.segments,C.paint,g.transform.zoom,Be)}}(e,r,l,c,p):a.cc(l)?function(g,b,C,S,M){if(C.paint.get("heatmap-opacity")===0)return;const z=g.context,{isRenderingToTexture:A,isRenderingGlobe:R}=M;if(g.style.map.terrain){for(const V of S){const Q=b.getTile(V);b.hasRenderableParent(V)||(g.renderPass==="offscreen"?Pa(g,Q,C,V,R):g.renderPass==="translucent"&&Ta(g,C,V,A,R))}z.viewport.set([0,0,g.width,g.height])}else g.renderPass==="offscreen"?function(V,Q,J,ee){const se=V.context,fe=se.gl,he=V.transform,_e=Lt.disabled,ye=new ir([fe.ONE,fe.ONE],a.be.transparent,[!0,!0,!0,!0]);(function(ue,Ce,Be){const De=ue.gl;ue.activeTexture.set(De.TEXTURE1),ue.viewport.set([0,0,Ce.width/4,Ce.height/4]);let Re=Be.heatmapFbos.get(a.c1);Re?(De.bindTexture(De.TEXTURE_2D,Re.colorAttachment.get()),ue.bindFramebuffer.set(Re.framebuffer)):(Re=To(ue,Ce.width/4,Ce.height/4),Be.heatmapFbos.set(a.c1,Re))})(se,V,J),se.clear({color:a.be.transparent});for(let ue=0;ue<ee.length;ue++){const Ce=ee[ue];if(Q.hasRenderableParent(Ce))continue;const Be=Q.getTile(Ce),De=Be.getBucket(J);if(!De)continue;const Re=De.programConfigurations.get(J.id),je=V.useProgram("heatmap",Re),ft=he.getProjectionData({overscaledTileID:Ce,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),ht=he.getCircleRadiusCorrection();je.draw(se,fe.TRIANGLES,$t.disabled,_e,ye,Nt.backCCW,xo(Be,he.zoom,J.paint.get("heatmap-intensity"),ht),null,ft,J.id,De.layoutVertexBuffer,De.indexBuffer,De.segments,J.paint,he.zoom,Re)}se.viewport.set([0,0,V.width,V.height])}(g,b,C,S):g.renderPass==="translucent"&&function(V,Q){const J=V.context,ee=J.gl;J.setColorMode(V.colorModeForRenderPass());const se=Q.heatmapFbos.get(a.c1);se&&(J.activeTexture.set(ee.TEXTURE0),ee.bindTexture(ee.TEXTURE_2D,se.colorAttachment.get()),J.activeTexture.set(ee.TEXTURE1),Sa(J,Q).bind(ee.LINEAR,ee.CLAMP_TO_EDGE),V.useProgram("heatmapTexture").draw(J,ee.TRIANGLES,$t.disabled,Lt.disabled,V.colorModeForRenderPass(),Nt.disabled,sh(V,Q,0,1),null,null,Q.id,V.viewportBuffer,V.quadTriangleIndexBuffer,V.viewportSegments,Q.paint,V.transform.zoom))}(g,C)}(e,r,l,c,p):a.cd(l)?function(g,b,C,S,M){if(g.renderPass!=="translucent")return;const{isRenderingToTexture:z}=M,A=C.paint.get("line-opacity"),R=C.paint.get("line-width");if(A.constantOr(1)===0||R.constantOr(1)===0)return;const V=g.getDepthModeForSublayer(0,$t.ReadOnly),Q=g.colorModeForRenderPass(),J=C.paint.get("line-dasharray"),ee=C.paint.get("line-pattern"),se=ee.constantOr(1),fe=C.paint.get("line-gradient"),he=C.getCrossfadeParameters(),_e=se?"linePattern":J?"lineSDF":fe?"lineGradient":"line",ye=g.context,ue=ye.gl,Ce=g.transform;let Be=!0;for(const De of S){const Re=b.getTile(De);if(se&&!Re.patternsLoaded())continue;const je=Re.getBucket(C);if(!je)continue;const ft=je.programConfigurations.get(C.id),ht=g.context.program.get(),tt=g.useProgram(_e,ft),Ct=Be||tt.program!==ht,Zt=g.style.map.terrain&&g.style.map.terrain.getTerrainData(De),hr=ee.constantOr(null);if(hr&&Re.imageAtlas){const _r=Re.imageAtlas,yr=_r.patternPositions[hr.to.toString()],ci=_r.patternPositions[hr.from.toString()];yr&&ci&&ft.setConstantPatternPositions(yr,ci)}const Mr=Ce.getProjectionData({overscaledTileID:De,applyGlobeMatrix:!z,applyTerrainMatrix:!0}),mr=Ce.getPixelScale(),Ir=se?ah(g,Re,C,mr,he):J?lh(g,Re,C,mr,J,he):fe?Pl(g,Re,C,mr,je.lineClipsArray.length):ma(g,Re,C,mr);if(se)ye.activeTexture.set(ue.TEXTURE0),Re.imageAtlasTexture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE),ft.updatePaintBuffers(he);else if(J&&(Ct||g.lineAtlas.dirty))ye.activeTexture.set(ue.TEXTURE0),g.lineAtlas.bind(ye);else if(fe){const _r=je.gradients[C.id];let yr=_r.texture;if(C.gradientVersion!==_r.version){let ci=256;if(C.stepInterpolant){const nr=b.getSource().maxzoom,ei=De.canonical.z===nr?Math.ceil(1<<g.transform.maxZoom-De.canonical.z):1;ci=a.ag(a.c2(je.maxLineLength/a.$*1024*ei),256,ye.maxTextureSize)}_r.gradient=a.c3({expression:C.gradientExpression(),evaluationKey:"lineProgress",resolution:ci,image:_r.gradient||void 0,clips:je.lineClipsArray}),_r.texture?_r.texture.update(_r.gradient):_r.texture=new a.T(ye,_r.gradient,ue.RGBA),_r.version=C.gradientVersion,yr=_r.texture}ye.activeTexture.set(ue.TEXTURE0),yr.bind(C.stepInterpolant?ue.NEAREST:ue.LINEAR,ue.CLAMP_TO_EDGE)}const gr=g.stencilModeForClipping(De);tt.draw(ye,ue.TRIANGLES,V,gr,Q,Nt.disabled,Ir,Zt,Mr,C.id,je.layoutVertexBuffer,je.indexBuffer,je.segments,C.paint,g.transform.zoom,ft,je.layoutVertexBuffer2),Be=!1}}(e,r,l,c,p):a.ce(l)?function(g,b,C,S,M){const z=C.paint.get("fill-color"),A=C.paint.get("fill-opacity");if(A.constantOr(1)===0)return;const{isRenderingToTexture:R}=M,V=g.colorModeForRenderPass(),Q=C.paint.get("fill-pattern"),J=g.opaquePassEnabledForLayer()&&!Q.constantOr(1)&&z.constantOr(a.be.transparent).a===1&&A.constantOr(0)===1?"opaque":"translucent";if(g.renderPass===J){const ee=g.getDepthModeForSublayer(1,g.renderPass==="opaque"?$t.ReadWrite:$t.ReadOnly);So(g,b,C,S,ee,V,!1,R)}if(g.renderPass==="translucent"&&C.paint.get("fill-antialias")){const ee=g.getDepthModeForSublayer(C.getPaintProperty("fill-outline-color")?2:0,$t.ReadOnly);So(g,b,C,S,ee,V,!0,R)}}(e,r,l,c,p):a.cf(l)?function(g,b,C,S,M){const z=C.paint.get("fill-extrusion-opacity");if(z===0)return;const{isRenderingToTexture:A}=M;if(g.renderPass==="translucent"){const R=new $t(g.context.gl.LEQUAL,$t.ReadWrite,g.depthRangeFor3D);if(z!==1||C.paint.get("fill-extrusion-pattern").constantOr(1))Rs(g,b,C,S,R,Lt.disabled,ir.disabled,A),Rs(g,b,C,S,R,g.stencilModeFor3D(),g.colorModeForRenderPass(),A);else{const V=g.colorModeForRenderPass();Rs(g,b,C,S,R,Lt.disabled,V,A)}}}(e,r,l,c,p):a.cg(l)?function(g,b,C,S,M){if(g.renderPass!=="offscreen"&&g.renderPass!=="translucent")return;const{isRenderingToTexture:z}=M,A=g.context,R=g.style.projection.useSubdivision,V=g.getDepthModeForSublayer(0,$t.ReadOnly),Q=g.colorModeForRenderPass();if(g.renderPass==="offscreen")(function(J,ee,se,fe,he,_e,ye){const ue=J.context,Ce=ue.gl;for(const Be of se){const De=ee.getTile(Be),Re=De.dem;if(!Re||!Re.data||!De.needsHillshadePrepare)continue;const je=Re.dim,ft=Re.stride,ht=Re.getPixels();if(ue.activeTexture.set(Ce.TEXTURE1),ue.pixelStoreUnpackPremultiplyAlpha.set(!1),De.demTexture=De.demTexture||J.getTileTexture(ft),De.demTexture){const Ct=De.demTexture;Ct.update(ht,{premultiply:!1}),Ct.bind(Ce.NEAREST,Ce.CLAMP_TO_EDGE)}else De.demTexture=new a.T(ue,ht,Ce.RGBA,{premultiply:!1}),De.demTexture.bind(Ce.NEAREST,Ce.CLAMP_TO_EDGE);ue.activeTexture.set(Ce.TEXTURE0);let tt=De.fbo;if(!tt){const Ct=new a.T(ue,{width:je,height:je,data:null},Ce.RGBA);Ct.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE),tt=De.fbo=ue.createFramebuffer(je,je,!0,!1),tt.colorAttachment.set(Ct.texture)}ue.bindFramebuffer.set(tt.framebuffer),ue.viewport.set([0,0,je,je]),J.useProgram("hillshadePrepare").draw(ue,Ce.TRIANGLES,he,_e,ye,Nt.disabled,Au(De.tileID,Re),null,null,fe.id,J.rasterBoundsBuffer,J.quadTriangleIndexBuffer,J.rasterBoundsSegments),De.needsHillshadePrepare=!1}})(g,b,S,C,V,Lt.disabled,Q),A.viewport.set([0,0,g.width,g.height]);else if(g.renderPass==="translucent")if(R){const[J,ee,se]=g.stencilConfigForOverlapTwoPass(S);Ls(g,b,C,se,J,V,Q,!1,z),Ls(g,b,C,se,ee,V,Q,!0,z)}else{const[J,ee]=g.getStencilConfigForOverlapAndUpdateStencilID(S);Ls(g,b,C,ee,J,V,Q,!1,z)}}(e,r,l,c,p):a.ch(l)?function(g,b,C,S,M){if(g.renderPass!=="translucent"||!S.length)return;const{isRenderingToTexture:z}=M,A=g.style.projection.useSubdivision,R=g.getDepthModeForSublayer(0,$t.ReadOnly),V=g.colorModeForRenderPass();if(A){const[Q,J,ee]=g.stencilConfigForOverlapTwoPass(S);Eo(g,b,C,ee,Q,R,V,!1,z),Eo(g,b,C,ee,J,R,V,!0,z)}else{const[Q,J]=g.getStencilConfigForOverlapAndUpdateStencilID(S);Eo(g,b,C,J,Q,R,V,!1,z)}}(e,r,l,c,p):a.ci(l)?function(g,b,C,S,M){if(g.renderPass!=="translucent"||C.paint.get("raster-opacity")===0||!S.length)return;const{isRenderingToTexture:z}=M,A=b.getSource(),R=g.style.projection.useSubdivision;if(A instanceof ke)Fn(g,b,C,S,null,!1,!1,A.tileCoords,A.flippedWindingOrder,z);else if(R){const[V,Q,J]=g.stencilConfigForOverlapTwoPass(S);Fn(g,b,C,J,V,!1,!0,jl,!1,z),Fn(g,b,C,J,Q,!0,!0,jl,!1,z)}else{const[V,Q]=g.getStencilConfigForOverlapAndUpdateStencilID(S);Fn(g,b,C,Q,V,!1,!0,jl,!1,z)}}(e,r,l,c,p):a.cj(l)?function(g,b,C,S,M){const z=C.paint.get("background-color"),A=C.paint.get("background-opacity");if(A===0)return;const{isRenderingToTexture:R}=M,V=g.context,Q=V.gl,J=g.style.projection,ee=g.transform,se=ee.tileSize,fe=C.paint.get("background-pattern");if(g.isPatternMissing(fe))return;const he=!fe&&z.a===1&&A===1&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==he)return;const _e=Lt.disabled,ye=g.getDepthModeForSublayer(0,he==="opaque"?$t.ReadWrite:$t.ReadOnly),ue=g.colorModeForRenderPass(),Ce=g.useProgram(fe?"backgroundPattern":"background"),Be=S||Ve(ee,{tileSize:se,terrain:g.style.map.terrain});fe&&(V.activeTexture.set(Q.TEXTURE0),g.imageManager.bind(g.context));const De=C.getCrossfadeParameters();for(const Re of Be){const je=ee.getProjectionData({overscaledTileID:Re,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),ft=fe?Ru(A,g,fe,{tileID:Re,tileSize:se},De):_a(A,z),ht=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Re),tt=J.getMeshFromTileID(V,Re.canonical,!1,!0,"raster");Ce.draw(V,Q.TRIANGLES,ye,_e,ue,Nt.backCCW,ft,ht,je,C.id,tt.vertexBuffer,tt.indexBuffer,tt.segments)}}(e,0,l,c,p):a.ck(l)&&function(g,b,C,S){const{isRenderingGlobe:M}=S,z=g.context,A=C.implementation,R=g.style.projection,V=g.transform,Q=V.getProjectionDataForCustomLayer(M),J={farZ:V.farZ,nearZ:V.nearZ,fov:V.fov*Math.PI/180,modelViewProjectionMatrix:V.modelViewProjectionMatrix,projectionMatrix:V.projectionMatrix,shaderData:{variantName:R.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${R.shaderPreludeCode.vertexSource}`,define:R.shaderDefine},defaultProjectionData:Q},ee=A.renderingMode?A.renderingMode:"2d";if(g.renderPass==="offscreen"){const se=A.prerender;se&&(g.setCustomLayerDefaults(),z.setColorMode(g.colorModeForRenderPass()),se.call(A,z.gl,J),z.setDirty(),g.setBaseState())}else if(g.renderPass==="translucent"){g.setCustomLayerDefaults(),z.setColorMode(g.colorModeForRenderPass()),z.setStencilMode(Lt.disabled);const se=ee==="3d"?g.getDepthModeFor3D():g.getDepthModeForSublayer(0,$t.ReadOnly);z.setDepthMode(se),A.render(z.gl,J),z.setDirty(),g.setBaseState(),z.bindFramebuffer.set(null)}}(e,0,l,p))}saveTileTexture(e){const r=this._tileTextures[e.size[0]];r?r.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const r=this._tileTextures[e];return r&&r.length>0?r.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const r=this.imageManager.getPattern(e.from.toString()),l=this.imageManager.getPattern(e.to.toString());return!r||!l}useProgram(e,r,l=!1,c=[]){this.cache=this.cache||{};const p=!!this.style.map.terrain,g=this.style.projection,b=l?hn.projectionMercator:g.shaderPreludeCode,C=l?Qn:g.shaderDefine,S=e+(r?r.cacheKey:"")+`/${l?ml:g.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(p?"/terrain":"")+(c?`/${c.join("/")}`:"");return this.cache[S]||(this.cache[S]=new da(this.context,hn[e],r,uh[e],this._showOverdrawInspector,p,b,C,c)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:r}=this.context.gl;return this.width!==e||this.height!==r}}function Ia(d,e){let r,l=!1,c=null,p=null;const g=()=>{c=null,l&&(d.apply(p,r),c=setTimeout(g,e),l=!1)};return(...b)=>(l=!0,p=this,r=b,c||g(),c)}class Mo{constructor(e){this._getCurrentHash=()=>{const r=window.location.hash.replace("#","");if(this._hashName){let l;return r.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(l=c)}),(l&&l[1]||"").split("/")}return r.split("/")},this._onHashChange=()=>{const r=this._getCurrentHash();if(!this._isValidHash(r))return!1;const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(r[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:l,pitch:+(r[4]||0)}),!0},this._updateHashUnthrottled=()=>{const r=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,r)},this._removeHash=()=>{const r=this._getCurrentHash();if(r.length===0)return;const l=r.join("/");let c=l;c.split("&").length>0&&(c=c.split("&")[0]),this._hashName&&(c=`${this._hashName}=${l}`);let p=window.location.hash.replace(c,"");p.startsWith("#&")?p=p.slice(0,1)+p.slice(2):p==="#"&&(p="");let g=window.location.href.replace(/(#.+)?$/,p);g=g.replace("&&","&"),window.history.replaceState(window.history.state,null,g)},this._updateHash=Ia(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const r=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,c=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),p=Math.pow(10,c),g=Math.round(r.lng*p)/p,b=Math.round(r.lat*p)/p,C=this._map.getBearing(),S=this._map.getPitch();let M="";if(M+=e?`/${g}/${b}/${l}`:`${l}/${b}/${g}`,(C||S)&&(M+="/"+Math.round(10*C)/10),S&&(M+=`/${Math.round(S)}`),this._hashName){const z=this._hashName;let A=!1;const R=window.location.hash.slice(1).split("&").map(V=>{const Q=V.split("=")[0];return Q===z?(A=!0,`${Q}=${M}`):V}).filter(V=>V);return A||R.push(`${z}=${M}`),`#${R.join("&")}`}return`#${M}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new a.S(+e[2],+e[1])}catch{return!1}const r=+e[0],l=+(e[3]||0),c=+(e[4]||0);return r>=this._map.getMinZoom()&&r<=this._map.getMaxZoom()&&l>=-180&&l<=180&&c>=this._map.getMinPitch()&&c<=this._map.getMaxPitch()}}const Fs={linearity:.3,easing:a.cl(0,0,.3,1)},Bs=a.e({deceleration:2500,maxSpeed:1400},Fs),Nl=a.e({deceleration:20,maxSpeed:1400},Fs),Io=a.e({deceleration:1e3,maxSpeed:360},Fs),Ul=a.e({deceleration:1e3,maxSpeed:90},Fs),kh=a.e({deceleration:1e3,maxSpeed:360},Fs);class Mh{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:oe.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,r=oe.now();for(;e.length>0&&r-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const r={zoom:0,bearing:0,pitch:0,roll:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:p}of this._inertiaBuffer)r.zoom+=p.zoomDelta||0,r.bearing+=p.bearingDelta||0,r.pitch+=p.pitchDelta||0,r.roll+=p.rollDelta||0,p.panDelta&&r.pan._add(p.panDelta),p.around&&(r.around=p.around),p.pinchAround&&(r.pinchAround=p.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,c={};if(r.pan.mag()){const p=js(r.pan.mag(),l,a.e({},Bs,e||{})),g=r.pan.mult(p.amount/r.pan.mag()),b=this._map.cameraHelper.handlePanInertia(g,this._map.transform);c.center=b.easingCenter,c.offset=b.easingOffset,Os(c,p)}if(r.zoom){const p=js(r.zoom,l,Nl);c.zoom=this._map.transform.zoom+p.amount,Os(c,p)}if(r.bearing){const p=js(r.bearing,l,Io);c.bearing=this._map.transform.bearing+a.ag(p.amount,-179,179),Os(c,p)}if(r.pitch){const p=js(r.pitch,l,Ul);c.pitch=this._map.transform.pitch+p.amount,Os(c,p)}if(r.roll){const p=js(r.roll,l,kh);c.roll=this._map.transform.roll+a.ag(p.amount,-179,179),Os(c,p)}if(c.zoom||c.bearing){const p=r.pinchAround===void 0?r.around:r.pinchAround;c.around=p?this._map.unproject(p):this._map.getCenter()}return this.clear(),a.e(c,{noMoveStart:!0})}}function Os(d,e){(!d.duration||d.duration<e.duration)&&(d.duration=e.duration,d.easing=e.easing)}function js(d,e,r){const{maxSpeed:l,linearity:c,deceleration:p}=r,g=a.ag(d*c/(e/1e3),-l,l),b=Math.abs(g)/(p*c);return{easing:r.easing,duration:1e3*b,amount:g*(b/2)}}class Mi extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,l,c={}){l=l instanceof MouseEvent?l:new MouseEvent(e,l);const p=L.mousePos(r.getCanvas(),l),g=r.unproject(p);super(e,a.e({point:p,lngLat:g,originalEvent:l},c)),this._defaultPrevented=!1,this.target=r}}class Yi extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,l){const c=e==="touchend"?l.changedTouches:l.touches,p=L.touchPos(r.getCanvasContainer(),c),g=p.map(C=>r.unproject(C)),b=p.reduce((C,S,M,z)=>C.add(S.div(z.length)),new a.P(0,0));super(e,{points:p,point:b,lngLats:g,lngLat:r.unproject(b),originalEvent:l}),this._defaultPrevented=!1}}class $l extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,l){super(e,{originalEvent:l}),this._defaultPrevented=!1}}class Ih{constructor(e,r){this._map=e,this._clickTolerance=r.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new $l(e.type,this._map,e))}mousedown(e,r){return this._mousedownPos=r,this._firePreventable(new Mi(e.type,this._map,e))}mouseup(e){this._map.fire(new Mi(e.type,this._map,e))}click(e,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||this._map.fire(new Mi(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Mi(e.type,this._map,e))}mouseover(e){this._map.fire(new Mi(e.type,this._map,e))}mouseout(e){this._map.fire(new Mi(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Yi(e.type,this._map,e))}touchmove(e){this._map.fire(new Yi(e.type,this._map,e))}touchend(e){this._map.fire(new Yi(e.type,this._map,e))}touchcancel(e){this._map.fire(new Yi(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ah{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Mi(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Mi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Mi(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Vs{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(a.P.convert(e),this._map.terrain)}}class Zl{constructor(e,r){this._map=e,this._tr=new Vs(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,r){this.isEnabled()&&e.shiftKey&&e.button===0&&(L.disableDrag(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(e,r){if(!this._active)return;const l=r;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const c=this._startPos;this._lastPos=l,this._box||(this._box=L.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const p=Math.min(c.x,l.x),g=Math.max(c.x,l.x),b=Math.min(c.y,l.y),C=Math.max(c.y,l.y);L.setTransform(this._box,`translate(${p}px,${b}px)`),this._box.style.width=g-p+"px",this._box.style.height=C-b+"px"}mouseupWindow(e,r){if(!this._active||e.button!==0)return;const l=this._startPos,c=r;if(this.reset(),L.suppressClick(),l.x!==c.x||l.y!==c.y)return this._map.fire(new a.l("boxzoomend",{originalEvent:e})),{cameraAnimation:p=>p.fitScreenCoordinates(l,c,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(L.remove(this._box),this._box=null),L.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,r){return this._map.fire(new a.l(e,{originalEvent:r}))}}function Aa(d,e){if(d.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${d.length}, points ${e.length}`);const r={};for(let l=0;l<d.length;l++)r[d[l].identifier]=e[l];return r}class zh{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,r,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),l.length===this.numTouches&&(this.centroid=function(c){const p=new a.P(0,0);for(const g of c)p._add(g);return p.div(c.length)}(r),this.touches=Aa(l,r)))}touchmove(e,r,l){if(this.aborted||!this.centroid)return;const c=Aa(l,r);for(const p in this.touches){const g=c[p];(!g||g.dist(this.touches[p])>30)&&(this.aborted=!0)}}touchend(e,r,l){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const c=!this.aborted&&this.centroid;if(this.reset(),c)return c}}}class za{constructor(e){this.singleTap=new zh(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,r,l){this.singleTap.touchstart(e,r,l)}touchmove(e,r,l){this.singleTap.touchmove(e,r,l)}touchend(e,r,l){const c=this.singleTap.touchend(e,r,l);if(c){const p=e.timeStamp-this.lastTime<500,g=!this.lastTap||this.lastTap.dist(c)<30;if(p&&g||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=c,this.count===this.numTaps)return this.reset(),c}}}class Da{constructor(e){this._tr=new Vs(e),this._zoomIn=new za({numTouches:1,numTaps:2}),this._zoomOut=new za({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,r,l){this._zoomIn.touchstart(e,r,l),this._zoomOut.touchstart(e,r,l)}touchmove(e,r,l){this._zoomIn.touchmove(e,r,l),this._zoomOut.touchmove(e,r,l)}touchend(e,r,l){const c=this._zoomIn.touchend(e,r,l),p=this._zoomOut.touchend(e,r,l),g=this._tr;return c?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:g.zoom+1,around:g.unproject(c)},{originalEvent:e})}):p?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:g.zoom-1,around:g.unproject(p)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ns{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const r=this._moveFunction(...e);if(r.bearingDelta||r.pitchDelta||r.rollDelta||r.around||r.panDelta)return this._active=!0,r}dragStart(e,r){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(r)?r[0]:r,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,r){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const c=Array.isArray(r)?r[0]:r;return!this._moved&&c.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=c,this._move(l,c))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&L.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const qi=0,Ji=2,Dh={[qi]:1,[Ji]:2};class Ci{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const r=L.mouseButton(e);this._eventButton=r}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(r,l){const c=Dh[l];return r.buttons===void 0||(r.buttons&c)!==c}(e,this._eventButton)}isValidEndEvent(e){return L.mouseButton(e)===this._eventButton}}class Us{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class $u{constructor(e=new Ci({checkCorrectEvent:()=>!0}),r=new Us){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=r}_executeRelevantHandler(e,r,l){return e instanceof MouseEvent?r(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?l(e):void 0}startMove(e){this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.startMove(r),r=>this.oneFingerTouchMoveStateManager.startMove(r))}endMove(e){this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.endMove(r),r=>this.oneFingerTouchMoveStateManager.endMove(r))}isValidStartEvent(e){return this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.isValidStartEvent(r),r=>this.oneFingerTouchMoveStateManager.isValidStartEvent(r))}isValidMoveEvent(e){return this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.isValidMoveEvent(r),r=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(r))}isValidEndEvent(e){return this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.isValidEndEvent(r),r=>this.oneFingerTouchMoveStateManager.isValidEndEvent(r))}}const Ra=d=>{d.mousedown=d.dragStart,d.mousemoveWindow=d.dragMove,d.mouseup=d.dragEnd,d.contextmenu=e=>{e.preventDefault()}};class Zu{constructor(e,r){this._clickTolerance=e.clickTolerance||1,this._map=r,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,r,l){return this._calculateTransform(e,r,l)}touchmove(e,r,l){if(this._active){if(!this._shouldBePrevented(l.length))return e.preventDefault(),this._calculateTransform(e,r,l);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,r,l){this._calculateTransform(e,r,l),this._active&&this._shouldBePrevented(l.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,r,l){l.length>0&&(this._active=!0);const c=Aa(l,r),p=new a.P(0,0),g=new a.P(0,0);let b=0;for(const S in c){const M=c[S],z=this._touches[S];z&&(p._add(M),g._add(M.sub(z)),b++,c[S]=M)}if(this._touches=c,this._shouldBePrevented(b)||!g.mag())return;const C=g.div(b);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:p.div(b),panDelta:C}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gl{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,r,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([r[0],r[1]]))}touchmove(e,r,l){if(!this._firstTwoTouches)return;e.preventDefault();const[c,p]=this._firstTwoTouches,g=Ao(l,r,c),b=Ao(l,r,p);if(!g||!b)return;const C=this._aroundCenter?null:g.add(b).div(2);return this._move([g,b],C,e)}touchend(e,r,l){if(!this._firstTwoTouches)return;const[c,p]=this._firstTwoTouches,g=Ao(l,r,c),b=Ao(l,r,p);g&&b||(this._active&&L.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ao(d,e,r){for(let l=0;l<d.length;l++)if(d[l].identifier===r)return e[l]}function $s(d,e){return Math.log(d/e)/Math.LN2}class pn extends Gl{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,r){const l=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs($s(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:$s(this._distance,l),pinchAround:r}}}function vt(d,e){return 180*d.angleWith(e)/Math.PI}class ql extends Gl{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,r,l){const c=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:vt(this._vector,c),pinchAround:r}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const r=25/(Math.PI*this._minDiameter)*360,l=vt(e,this._startVector);return Math.abs(l)<r}}function zo(d){return Math.abs(d.y)>Math.abs(d.x)}class Wl extends Gl{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,r,l){super.touchstart(e,r,l),this._currentTouchCount=l.length}_start(e){this._lastPoints=e,zo(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,r,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const c=e[0].sub(this._lastPoints[0]),p=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(c,p,l.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(c.y+p.y)/2*-.5}):void 0}gestureBeginsVertically(e,r,l){if(this._valid!==void 0)return this._valid;const c=e.mag()>=2,p=r.mag()>=2;if(!c&&!p)return;if(!c||!p)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const g=e.y>0==r.y>0;return zo(e)&&zo(r)&&g}}const Do={panStep:100,bearingStep:15,pitchStep:10};class Zs{constructor(e){this._tr=new Vs(e);const r=Do;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let r=0,l=0,c=0,p=0,g=0;switch(e.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:e.shiftKey?l=-1:(e.preventDefault(),p=-1);break;case 39:e.shiftKey?l=1:(e.preventDefault(),p=1);break;case 38:e.shiftKey?c=1:(e.preventDefault(),g=-1);break;case 40:e.shiftKey?c=-1:(e.preventDefault(),g=1);break;default:return}return this._rotationDisabled&&(l=0,c=0),{cameraAnimation:b=>{const C=this._tr;b.easeTo({duration:300,easeId:"keyboardHandler",easing:Hl,zoom:r?Math.round(C.zoom)+r*(e.shiftKey?2:1):C.zoom,bearing:C.bearing+l*this._bearingStep,pitch:C.pitch+c*this._pitchStep,offset:[-p*this._panStep,-g*this._panStep],center:C.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Hl(d){return d*(2-d)}const Qt=4.000244140625,Xl=1/450;class Rh{constructor(e,r){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=e,this._tr=new Vs(e),this._triggerRenderFrame=r,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Xl}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let r=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const l=oe.now(),c=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,r!==0&&r%Qt==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":c>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(c*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),e.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=e,this._delta-=r,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=L.mousePos(this._map.getCanvas(),e),l=this._tr;this._aroundPoint=this._aroundCenter?l.transform.locationToScreenPoint(a.S.convert(l.center)):r,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const b=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=b),typeof this._targetZoom=="number"&&(this._targetZoom+=b)}if(this._delta!==0){const b=this._type==="wheel"&&Math.abs(this._delta)>Qt?this._wheelZoomRate:this._defaultZoomRate;let C=2/(1+Math.exp(-Math.abs(this._delta*b)));this._delta<0&&C!==0&&(C=1/C);const S=typeof this._targetZoom!="number"?e.scale:a.ae(this._targetZoom);this._targetZoom=e.getConstrained(e.getCameraLngLat(),a.aj(S*C)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const r=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,l=this._startZoom,c=this._easing;let p,g=!1;if(this._type==="wheel"&&l&&c){const b=oe.now()-this._lastWheelEventTime,C=Math.min((b+5)/200,1),S=c(C);p=a.C.number(l,r,S),C<1?this._frameId||(this._frameId=!0):g=!0}else p=r,g=!0;return this._active=!0,g&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=p,{noInertia:!0,needsRenderFrame:!g,zoomDelta:p-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let r=a.cn;if(this._prevEase){const l=this._prevEase,c=(oe.now()-l.start)/l.duration,p=l.easing(c+.01)-l.easing(c),g=.27/Math.sqrt(p*p+1e-4)*.01,b=Math.sqrt(.0729-g*g);r=a.cl(g,b,.25,1)}return this._prevEase={start:oe.now(),duration:e,easing:r},r}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class La{constructor(e,r){this._clickZoom=e,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Gu{constructor(e){this._tr=new Vs(e),this.reset()}reset(){this._active=!1}dblclick(e,r){return e.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(r)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qu{constructor(){this._tap=new za({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,r,l){if(!this._swipePoint)if(this._tapTime){const c=r[0],p=e.timeStamp-this._tapTime<500,g=this._tapPoint.dist(c)<30;p&&g?l.length>0&&(this._swipePoint=c,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(e,r,l)}touchmove(e,r,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const c=r[0],p=c.y-this._swipePoint.y;return this._swipePoint=c,e.preventDefault(),this._active=!0,{zoomDelta:p/128}}}else this._tap.touchmove(e,r,l)}touchend(e,r,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const c=this._tap.touchend(e,r,l);c&&(this._tapTime=e.timeStamp,this._tapPoint=c)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Kl{constructor(e,r,l){this._el=e,this._mousePan=r,this._touchPan=l}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Fa{constructor(e,r,l,c){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=r,this._mousePitch=l,this._mouseRoll=c}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Yl{constructor(e,r,l,c){this._el=e,this._touchZoom=r,this._touchRotate=l,this._tapDragZoom=c,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Lh{constructor(e,r){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=r,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=L.create("div","maplibregl-cooperative-gesture-screen",e);let r=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(r=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),c=document.createElement("div");c.className="maplibregl-desktop-message",c.textContent=r,this._container.appendChild(c);const p=document.createElement("div");p.className="maplibregl-mobile-message",p.textContent=l,this._container.appendChild(p),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(L.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,r){this._enabled&&(this._map.fire(new a.l("cooperativegestureprevented",{gestureType:e,originalEvent:r})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Ro=d=>d.zoom||d.drag||d.roll||d.pitch||d.rotate;class Wu extends a.l{}function Jl(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta||d.rollDelta}class On{constructor(e,r){this.handleWindowEvent=c=>{this.handleEvent(c,`${c.type}Window`)},this.handleEvent=(c,p)=>{if(c.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const g=c.type==="renderFrame"?void 0:c,b={needsRenderFrame:!1},C={},S={};for(const{handlerName:A,handler:R,allowed:V}of this._handlers){if(!R.isEnabled())continue;let Q;if(this._blockedByActive(S,V,A))R.reset();else if(R[p||c.type]){if(a.co(c,p||c.type)){const J=L.mousePos(this._map.getCanvas(),c);Q=R[p||c.type](c,J)}else if(a.cp(c,p||c.type)){const J=this._getMapTouches(c.touches),ee=L.touchPos(this._map.getCanvas(),J);Q=R[p||c.type](c,ee,J)}else a.cq(p||c.type)||(Q=R[p||c.type](c));this.mergeHandlerResult(b,C,Q,A,g),Q&&Q.needsRenderFrame&&this._triggerRenderFrame()}(Q||R.isActive())&&(S[A]=R)}const M={};for(const A in this._previousActiveHandlers)S[A]||(M[A]=g);this._previousActiveHandlers=S,(Object.keys(M).length||Jl(b))&&(this._changes.push([b,C,M]),this._triggerRenderFrame()),(Object.keys(S).length||Jl(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:z}=b;z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],z(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Mh(e),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[c,p,g]of this._listeners)L.addEventListener(c,p,c===document?this.handleWindowEvent:this.handleEvent,g)}destroy(){for(const[e,r,l]of this._listeners)L.removeEventListener(e,r,e===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(e){const r=this._map,l=r.getCanvasContainer();this._add("mapEvent",new Ih(r,e));const c=r.boxZoom=new Zl(r,e);this._add("boxZoom",c),e.interactive&&e.boxZoom&&c.enable();const p=r.cooperativeGestures=new Lh(r,e.cooperativeGestures);this._add("cooperativeGestures",p),e.cooperativeGestures&&p.enable();const g=new Da(r),b=new Gu(r);r.doubleClickZoom=new La(b,g),this._add("tapZoom",g),this._add("clickZoom",b),e.interactive&&e.doubleClickZoom&&r.doubleClickZoom.enable();const C=new qu;this._add("tapDragZoom",C);const S=r.touchPitch=new Wl(r);this._add("touchPitch",S),e.interactive&&e.touchPitch&&r.touchPitch.enable(e.touchPitch);const M=()=>r.project(r.getCenter()),z=function({enable:he,clickTolerance:_e,aroundCenter:ye=!0,minPixelCenterThreshold:ue=100,rotateDegreesPerPixelMoved:Ce=.8},Be){const De=new Ci({checkCorrectEvent:Re=>L.mouseButton(Re)===0&&Re.ctrlKey||L.mouseButton(Re)===2&&!Re.ctrlKey});return new Ns({clickTolerance:_e,move:(Re,je)=>{const ft=Be();if(ye&&Math.abs(ft.y-Re.y)>ue)return{bearingDelta:a.cm(new a.P(Re.x,je.y),je,ft)};let ht=(je.x-Re.x)*Ce;return ye&&je.y<ft.y&&(ht=-ht),{bearingDelta:ht}},moveStateManager:De,enable:he,assignEvents:Ra})}(e,M),A=function({enable:he,clickTolerance:_e,pitchDegreesPerPixelMoved:ye=-.5}){const ue=new Ci({checkCorrectEvent:Ce=>L.mouseButton(Ce)===0&&Ce.ctrlKey||L.mouseButton(Ce)===2});return new Ns({clickTolerance:_e,move:(Ce,Be)=>({pitchDelta:(Be.y-Ce.y)*ye}),moveStateManager:ue,enable:he,assignEvents:Ra})}(e),R=function({enable:he,clickTolerance:_e,rollDegreesPerPixelMoved:ye=.3},ue){const Ce=new Ci({checkCorrectEvent:Be=>L.mouseButton(Be)===2&&Be.ctrlKey});return new Ns({clickTolerance:_e,move:(Be,De)=>{const Re=ue();let je=(De.x-Be.x)*ye;return De.y<Re.y&&(je=-je),{rollDelta:je}},moveStateManager:Ce,enable:he,assignEvents:Ra})}(e,M);r.dragRotate=new Fa(e,z,A,R),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",A,["mouseRotate","mouseRoll"]),this._add("mouseRoll",R,["mousePitch"]),e.interactive&&e.dragRotate&&r.dragRotate.enable();const V=function({enable:he,clickTolerance:_e}){const ye=new Ci({checkCorrectEvent:ue=>L.mouseButton(ue)===0&&!ue.ctrlKey});return new Ns({clickTolerance:_e,move:(ue,Ce)=>({around:Ce,panDelta:Ce.sub(ue)}),activateOnStart:!0,moveStateManager:ye,enable:he,assignEvents:Ra})}(e),Q=new Zu(e,r);r.dragPan=new Kl(l,V,Q),this._add("mousePan",V),this._add("touchPan",Q,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&r.dragPan.enable(e.dragPan);const J=new ql,ee=new pn;r.touchZoomRotate=new Yl(l,ee,J,C),this._add("touchRotate",J,["touchPan","touchZoom"]),this._add("touchZoom",ee,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&r.touchZoomRotate.enable(e.touchZoomRotate);const se=r.scrollZoom=new Rh(r,()=>this._triggerRenderFrame());this._add("scrollZoom",se,["mousePan"]),e.interactive&&e.scrollZoom&&r.scrollZoom.enable(e.scrollZoom);const fe=r.keyboard=new Zs(r);this._add("keyboard",fe),e.interactive&&e.keyboard&&r.keyboard.enable(),this._add("blockableMapEvent",new Ah(r))}_add(e,r,l){this._handlers.push({handlerName:e,handler:r,allowed:l}),this._handlersById[e]=r}stop(e){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ro(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,r,l){for(const c in e)if(c!==l&&(!r||r.indexOf(c)<0))return!0;return!1}_getMapTouches(e){const r=[];for(const l of e)this._el.contains(l.target)&&r.push(l);return r}mergeHandlerResult(e,r,l,c,p){if(!l)return;a.e(e,l);const g={handlerName:c,originalEvent:l.originalEvent||p};l.zoomDelta!==void 0&&(r.zoom=g),l.panDelta!==void 0&&(r.drag=g),l.rollDelta!==void 0&&(r.roll=g),l.pitchDelta!==void 0&&(r.pitch=g),l.bearingDelta!==void 0&&(r.rotate=g)}_applyChanges(){const e={},r={},l={};for(const[c,p,g]of this._changes)c.panDelta&&(e.panDelta=(e.panDelta||new a.P(0,0))._add(c.panDelta)),c.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+c.zoomDelta),c.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+c.bearingDelta),c.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+c.pitchDelta),c.rollDelta&&(e.rollDelta=(e.rollDelta||0)+c.rollDelta),c.around!==void 0&&(e.around=c.around),c.pinchAround!==void 0&&(e.pinchAround=c.pinchAround),c.noInertia&&(e.noInertia=c.noInertia),a.e(r,p),a.e(l,g);this._updateMapTransform(e,r,l),this._changes=[]}_updateMapTransform(e,r,l){const c=this._map,p=c._getTransformForUpdate(),g=c.terrain;if(!(Jl(e)||g&&this._terrainMovement))return this._fireEvents(r,l,!0);c._stop(!0);let{panDelta:b,zoomDelta:C,bearingDelta:S,pitchDelta:M,rollDelta:z,around:A,pinchAround:R}=e;R!==void 0&&(A=R),A=A||c.transform.centerPoint,g&&!p.isPointOnMapSurface(A)&&(A=p.centerPoint);const V={panDelta:b,zoomDelta:C,rollDelta:z,pitchDelta:M,bearingDelta:S,around:A};this._map.cameraHelper.useGlobeControls&&!p.isPointOnMapSurface(A)&&(A=p.centerPoint);const Q=A.distSqr(p.centerPoint)<.01?p.center:p.screenPointToLocation(b?A.sub(b):A);g?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(V,p),this._terrainMovement||!r.drag&&!r.zoom?r.drag&&this._terrainMovement?p.setCenter(p.screenPointToLocation(p.centerPoint.sub(b))):this._map.cameraHelper.handleMapControlsPan(V,p,Q):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(V,p,Q))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(V,p),this._map.cameraHelper.handleMapControlsPan(V,p,Q)),c._applyUpdatedTransform(p),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(r,l,!0)}_fireEvents(e,r,l){const c=Ro(this._eventsInProgress),p=Ro(e),g={};for(const z in e){const{originalEvent:A}=e[z];this._eventsInProgress[z]||(g[`${z}start`]=A),this._eventsInProgress[z]=e[z]}!c&&p&&this._fireEvent("movestart",p.originalEvent);for(const z in g)this._fireEvent(z,g[z]);p&&this._fireEvent("move",p.originalEvent);for(const z in e){const{originalEvent:A}=e[z];this._fireEvent(z,A)}const b={};let C;for(const z in this._eventsInProgress){const{handlerName:A,originalEvent:R}=this._eventsInProgress[z];this._handlersById[A].isActive()||(delete this._eventsInProgress[z],C=r[A]||R,b[`${z}end`]=C)}for(const z in b)this._fireEvent(z,b[z]);const S=Ro(this._eventsInProgress),M=(c||p)&&!S;if(M&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const z=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&z.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(z)}if(l&&M){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),A=R=>R!==0&&-this._bearingSnap<R&&R<this._bearingSnap;!z||!z.essential&&oe.prefersReducedMotion?(this._map.fire(new a.l("moveend",{originalEvent:C})),A(this._map.getBearing())&&this._map.resetNorth()):(A(z.bearing||this._map.getBearing())&&(z.bearing=0),z.freezeElevation=!0,this._map.easeTo(z,{originalEvent:C})),this._updatingCamera=!1}}_fireEvent(e,r){this._map.fire(new a.l(e,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new Wu("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Cr extends a.E{constructor(e,r,l){super(),this._renderFrameCallback=()=>{const c=Math.min((oe.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=l.bearingSnap,this.cameraHelper=r,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(e,r){e.apply(this.transform),this.transform=e,this.cameraHelper=r}getCenter(){return new a.S(this.transform.center.lng,this.transform.center.lat)}setCenter(e,r){return this.jumpTo({center:e},r)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,r){return this.jumpTo({elevation:e},r),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,r,l){return e=a.P.convert(e).mult(-1),this.panTo(this.transform.center,a.e({offset:e},r),l)}panTo(e,r,l){return this.easeTo(a.e({center:e},r),l)}getZoom(){return this.transform.zoom}setZoom(e,r){return this.jumpTo({zoom:e},r),this}zoomTo(e,r,l){return this.easeTo(a.e({zoom:e},r),l)}zoomIn(e,r){return this.zoomTo(this.getZoom()+1,e,r),this}zoomOut(e,r){return this.zoomTo(this.getZoom()-1,e,r),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,r){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new a.l("movestart",r)).fire(new a.l("move",r)).fire(new a.l("moveend",r))),this}getBearing(){return this.transform.bearing}setBearing(e,r){return this.jumpTo({bearing:e},r),this}getPadding(){return this.transform.padding}setPadding(e,r){return this.jumpTo({padding:e},r),this}rotateTo(e,r,l){return this.easeTo(a.e({bearing:e},r),l)}resetNorth(e,r){return this.rotateTo(0,a.e({duration:1e3},e),r),this}resetNorthPitch(e,r){return this.easeTo(a.e({bearing:0,pitch:0,roll:0,duration:1e3},e),r),this}snapToNorth(e,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,r):this}getPitch(){return this.transform.pitch}setPitch(e,r){return this.jumpTo({pitch:e},r),this}getRoll(){return this.transform.roll}setRoll(e,r){return this.jumpTo({roll:e},r),this}cameraForBounds(e,r){e=ar.convert(e).adjustAntiMeridian();const l=r&&r.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),l,r)}_cameraForBoxAndBearing(e,r,l,c){const p={top:0,bottom:0,right:0,left:0};if(typeof(c=a.e({padding:p,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){const S=c.padding;c.padding={top:S,bottom:S,right:S,left:S}}const g=a.e(p,c.padding);c.padding=g;const b=this.transform,C=new ar(e,r);return this.cameraHelper.cameraForBoxAndBearing(c,g,C,l,b)}fitBounds(e,r,l){return this._fitInternal(this.cameraForBounds(e,r),r,l)}fitScreenCoordinates(e,r,l,c,p){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(a.P.convert(e)),this.transform.screenPointToLocation(a.P.convert(r)),l,c),c,p)}_fitInternal(e,r,l){return e?(delete(r=a.e(e,r)).padding,r.linear?this.easeTo(r,l):this.flyTo(r,l)):this}jumpTo(e,r){this.stop();const l=this._getTransformForUpdate();let c=!1,p=!1,g=!1;const b=l.zoom;this.cameraHelper.handleJumpToCenterZoom(l,e);const C=l.zoom!==b;return"elevation"in e&&l.elevation!==+e.elevation&&l.setElevation(+e.elevation),"bearing"in e&&l.bearing!==+e.bearing&&(c=!0,l.setBearing(+e.bearing)),"pitch"in e&&l.pitch!==+e.pitch&&(p=!0,l.setPitch(+e.pitch)),"roll"in e&&l.roll!==+e.roll&&(g=!0,l.setRoll(+e.roll)),e.padding==null||l.isPaddingEqual(e.padding)||l.setPadding(e.padding),this._applyUpdatedTransform(l),this.fire(new a.l("movestart",r)).fire(new a.l("move",r)),C&&this.fire(new a.l("zoomstart",r)).fire(new a.l("zoom",r)).fire(new a.l("zoomend",r)),c&&this.fire(new a.l("rotatestart",r)).fire(new a.l("rotate",r)).fire(new a.l("rotateend",r)),p&&this.fire(new a.l("pitchstart",r)).fire(new a.l("pitch",r)).fire(new a.l("pitchend",r)),g&&this.fire(new a.l("rollstart",r)).fire(new a.l("roll",r)).fire(new a.l("rollend",r)),this.fire(new a.l("moveend",r))}calculateCameraOptionsFromTo(e,r,l,c=0){const p=a.a0.fromLngLat(e,r),g=a.a0.fromLngLat(l,c),b=g.x-p.x,C=g.y-p.y,S=g.z-p.z,M=Math.hypot(b,C,S);if(M===0)throw new Error("Can't calculate camera options with same From and To");const z=Math.hypot(b,C),A=a.aj(this.transform.cameraToCenterDistance/M/this.transform.tileSize),R=180*Math.atan2(b,-C)/Math.PI;let V=180*Math.acos(z/M)/Math.PI;return V=S<0?90-V:90+V,{center:g.toLngLat(),elevation:c,zoom:A,pitch:V,bearing:R}}calculateCameraOptionsFromCameraLngLatAltRotation(e,r,l,c,p){const g=this.transform.calculateCenterFromCameraLngLatAlt(e,r,l,c);return{center:g.center,elevation:g.elevation,zoom:g.zoom,bearing:l,pitch:c,roll:p}}easeTo(e,r){this._stop(!1,e.easeId),((e=a.e({offset:[0,0],duration:500,easing:a.cn},e)).animate===!1||!e.essential&&oe.prefersReducedMotion)&&(e.duration=0);const l=this._getTransformForUpdate(),c=this.getBearing(),p=l.pitch,g=l.roll,b="bearing"in e?this._normalizeBearing(e.bearing,c):c,C="pitch"in e?+e.pitch:p,S="roll"in e?this._normalizeBearing(e.roll,g):g,M="padding"in e?e.padding:l.padding,z=a.P.convert(e.offset);let A,R;e.around&&(A=a.S.convert(e.around),R=l.locationToScreenPoint(A));const V={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},Q=this.cameraHelper.handleEaseTo(l,{bearing:b,pitch:C,roll:S,padding:M,around:A,aroundPoint:R,offsetAsPoint:z,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||c!==b,this._pitching=this._pitching||C!==p,this._rolling=this._rolling||S!==g,this._padding=!l.isPaddingEqual(M),this._zooming=this._zooming||Q.isZooming,this._easeId=e.easeId,this._prepareEase(r,e.noMoveStart,V),this.terrain&&this._prepareElevation(Q.elevationCenter),this._ease(J=>{Q.easeFunc(J),this.terrain&&!e.freezeElevation&&this._updateElevation(J),this._applyUpdatedTransform(l),this._fireMoveEvents(r)},J=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(r,J)},e),this}_prepareEase(e,r,l={}){this._moving=!0,r||l.moving||this.fire(new a.l("movestart",e)),this._zooming&&!l.zooming&&this.fire(new a.l("zoomstart",e)),this._rotating&&!l.rotating&&this.fire(new a.l("rotatestart",e)),this._pitching&&!l.pitching&&this.fire(new a.l("pitchstart",e)),this._rolling&&!l.rolling&&this.fire(new a.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const r=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&r!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(l-(r-(l*e+this._elevationStart))/(1-e)),this._elevationTarget=r}this.transform.setElevation(a.C.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const r=e.getCameraLngLat(),l=e.getCameraAltitude(),c=this.terrain?this.terrain.getElevationForLngLatZoom(r,e.zoom):0;if(l<c){const p=this.calculateCameraOptionsFromTo(r,c,e.center,e.elevation);return{pitch:p.pitch,zoom:p.zoom}}return{}}_applyUpdatedTransform(e){const r=[];if(r.push(c=>this._elevateCameraIfInsideTerrain(c)),this.transformCameraUpdate&&r.push(c=>this.transformCameraUpdate(c)),!r.length)return;const l=e.clone();for(const c of r){const p=l.clone(),{center:g,zoom:b,roll:C,pitch:S,bearing:M,elevation:z}=c(p);g&&p.setCenter(g),z!==void 0&&p.setElevation(z),b!==void 0&&p.setZoom(b),C!==void 0&&p.setRoll(C),S!==void 0&&p.setPitch(S),M!==void 0&&p.setBearing(M),l.apply(p)}this.transform.apply(l)}_fireMoveEvents(e){this.fire(new a.l("move",e)),this._zooming&&this.fire(new a.l("zoom",e)),this._rotating&&this.fire(new a.l("rotate",e)),this._pitching&&this.fire(new a.l("pitch",e)),this._rolling&&this.fire(new a.l("roll",e))}_afterEase(e,r){if(this._easeId&&r&&this._easeId===r)return;delete this._easeId;const l=this._zooming,c=this._rotating,p=this._pitching,g=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,l&&this.fire(new a.l("zoomend",e)),c&&this.fire(new a.l("rotateend",e)),p&&this.fire(new a.l("pitchend",e)),g&&this.fire(new a.l("rollend",e)),this.fire(new a.l("moveend",e))}flyTo(e,r){if(!e.essential&&oe.prefersReducedMotion){const je=a.Q(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(je,r)}this.stop(),e=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.cn},e);const l=this._getTransformForUpdate(),c=l.bearing,p=l.pitch,g=l.roll,b=l.padding,C="bearing"in e?this._normalizeBearing(e.bearing,c):c,S="pitch"in e?+e.pitch:p,M="roll"in e?this._normalizeBearing(e.roll,g):g,z="padding"in e?e.padding:l.padding,A=a.P.convert(e.offset);let R=l.centerPoint.add(A);const V=l.screenPointToLocation(R),Q=this.cameraHelper.handleFlyTo(l,{bearing:C,pitch:S,roll:M,padding:z,locationAtOffset:V,offsetAsPoint:A,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let J=e.curve;const ee=Math.max(l.width,l.height),se=ee/Q.scaleOfZoom,fe=Q.pixelPathLength;typeof Q.scaleOfMinZoom=="number"&&(J=Math.sqrt(ee/Q.scaleOfMinZoom/fe*2));const he=J*J;function _e(je){const ft=(se*se-ee*ee+(je?-1:1)*he*he*fe*fe)/(2*(je?se:ee)*he*fe);return Math.log(Math.sqrt(ft*ft+1)-ft)}function ye(je){return(Math.exp(je)-Math.exp(-je))/2}function ue(je){return(Math.exp(je)+Math.exp(-je))/2}const Ce=_e(!1);let Be=function(je){return ue(Ce)/ue(Ce+J*je)},De=function(je){return ee*((ue(Ce)*(ye(ft=Ce+J*je)/ue(ft))-ye(Ce))/he)/fe;var ft},Re=(_e(!0)-Ce)/J;if(Math.abs(fe)<2e-6||!isFinite(Re)){if(Math.abs(ee-se)<1e-6)return this.easeTo(e,r);const je=se<ee?-1:1;Re=Math.abs(Math.log(se/ee))/J,De=()=>0,Be=ft=>Math.exp(je*J*ft)}return e.duration="duration"in e?+e.duration:1e3*Re/("screenSpeed"in e?+e.screenSpeed/J:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=c!==C,this._pitching=S!==p,this._rolling=M!==g,this._padding=!l.isPaddingEqual(z),this._prepareEase(r,!1),this.terrain&&this._prepareElevation(Q.targetCenter),this._ease(je=>{const ft=je*Re,ht=1/Be(ft),tt=De(ft);this._rotating&&l.setBearing(a.C.number(c,C,je)),this._pitching&&l.setPitch(a.C.number(p,S,je)),this._rolling&&l.setRoll(a.C.number(g,M,je)),this._padding&&(l.interpolatePadding(b,z,je),R=l.centerPoint.add(A)),Q.easeFunc(je,ht,tt,R),this.terrain&&!e.freezeElevation&&this._updateElevation(je),this._applyUpdatedTransform(l),this._fireMoveEvents(r)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(r)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,r){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const c=this._onEaseEnd;delete this._onEaseEnd,c.call(this,r)}return e||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(e,r,l){l.animate===!1||l.duration===0?(e(1),r()):(this._easeStart=oe.now(),this._easeOptions=l,this._onEaseFrame=e,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,r){e=a.aN(e,-180,180);const l=Math.abs(e-r);return Math.abs(e-360-r)<l&&(e-=360),Math.abs(e+360-r)<l&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(a.S.convert(e),this.transform.tileZoom):null}}const Lo={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Ba{constructor(e=Lo){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=r=>{!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"&&r.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=L.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=L.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=L.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){L.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,r){const l=this._map._getUIString(`AttributionControl.${r}`);e.title=l,e.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(c=>typeof c!="string"?"":c)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const c=this._map.style.stylesheet;this.styleOwner=c.owner,this.styleId=c.id}const r=this._map.style.sourceCaches;for(const c in r){const p=r[c];if(p.used||p.usedForTerrain){const g=p.getSource();g.attribution&&e.indexOf(g.attribution)<0&&e.push(g.attribution)}}e=e.filter(c=>String(c).trim()),e.sort((c,p)=>c.length-p.length),e=e.filter((c,p)=>{for(let g=p+1;g<e.length;g++)if(e[g].indexOf(c)>=0)return!1;return!0});const l=e.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,e.length?(this._innerContainer.innerHTML=L.sanitize(l),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Ql{constructor(e={}){this._updateCompact=()=>{const r=this._container.children;if(r.length){const l=r[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=L.create("div","maplibregl-ctrl");const r=L.create("a","maplibregl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://maplibre.org/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){L.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Fh{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const r=++this._id;return this._queue.push({callback:e,id:r,cancelled:!1}),r}remove(e){const r=this._currentlyRunning,l=r?this._queue.concat(r):this._queue;for(const c of l)if(c.id===e)return void(c.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const r=this._currentlyRunning=this._queue;this._queue=[];for(const l of r)if(!l.cancelled&&(l.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Bh=a.aI([{name:"a_pos3d",type:"Int16",components:3}]);class Hu extends a.E{constructor(e){super(),this._lastTilesetChange=oe.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,r){this.sourceCache.update(e,r),this._renderableTilesKeys=[];const l={};for(const c of Ve(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:r,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))l[c.key]=!0,this._renderableTilesKeys.push(c.key),this._tiles[c.key]||(c.terrainRttPosMatrix32f=new Float64Array(16),a.bX(c.terrainRttPosMatrix32f,0,a.$,a.$,0,0,1),this._tiles[c.key]=new Ut(c,this.tileSize),this._lastTilesetChange=oe.now());for(const c in this._tiles)l[c]||delete this._tiles[c]}freeRtt(e){for(const r in this._tiles){const l=this._tiles[r];(!e||l.tileID.equals(e)||l.tileID.isChildOf(e)||e.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,r){return r?this._getTerrainCoordsForTileRanges(e,r):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const r={};for(const l of this._renderableTilesKeys){const c=this._tiles[l].tileID,p=e.clone(),g=a.b9();if(c.canonical.equals(e.canonical))a.bX(g,0,a.$,a.$,0,0,1);else if(c.canonical.isChildOf(e.canonical)){const b=c.canonical.z-e.canonical.z,C=c.canonical.x-(c.canonical.x>>b<<b),S=c.canonical.y-(c.canonical.y>>b<<b),M=a.$>>b;a.bX(g,0,M,M,0,0,1),a.M(g,g,[-C*M,-S*M,0])}else{if(!e.canonical.isChildOf(c.canonical))continue;{const b=e.canonical.z-c.canonical.z,C=e.canonical.x-(e.canonical.x>>b<<b),S=e.canonical.y-(e.canonical.y>>b<<b),M=a.$>>b;a.bX(g,0,a.$,a.$,0,0,1),a.M(g,g,[C*M,S*M,0]),a.N(g,g,[1/2**b,1/2**b,0])}}p.terrainRttPosMatrix32f=new Float32Array(g),r[l]=p}return r}_getTerrainCoordsForTileRanges(e,r){const l={};for(const c of this._renderableTilesKeys){const p=this._tiles[c].tileID;if(!this._isWithinTileRanges(p,r))continue;const g=e.clone(),b=a.b9();if(p.canonical.z===e.canonical.z){const C=e.canonical.x-p.canonical.x,S=e.canonical.y-p.canonical.y;a.bX(b,0,a.$,a.$,0,0,1),a.M(b,b,[C*a.$,S*a.$,0])}else if(p.canonical.z>e.canonical.z){const C=p.canonical.z-e.canonical.z,S=p.canonical.x-(p.canonical.x>>C<<C),M=p.canonical.y-(p.canonical.y>>C<<C),z=e.canonical.x-(p.canonical.x>>C),A=e.canonical.y-(p.canonical.y>>C),R=a.$>>C;a.bX(b,0,R,R,0,0,1),a.M(b,b,[-S*R+z*a.$,-M*R+A*a.$,0])}else{const C=e.canonical.z-p.canonical.z,S=e.canonical.x-(e.canonical.x>>C<<C),M=e.canonical.y-(e.canonical.y>>C<<C),z=(e.canonical.x>>C)-p.canonical.x,A=(e.canonical.y>>C)-p.canonical.y,R=a.$<<C;a.bX(b,0,R,R,0,0,1),a.M(b,b,[S*a.$+z*R,M*a.$+A*R,0])}g.terrainRttPosMatrix32f=new Float32Array(b),l[c]=g}return l}getSourceTile(e,r){const l=this.sourceCache._source;let c=e.overscaledZ-this.deltaZoom;if(c>l.maxzoom&&(c=l.maxzoom),c<l.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(c).key);let p=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!p||!p.dem)&&r)for(;c>=l.minzoom&&(!p||!p.dem);)p=this.sourceCache.getTileByID(e.scaledTo(c--).key);return p}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,r){return r[e.canonical.z]&&e.canonical.x>=r[e.canonical.z].minTileX&&e.canonical.x<=r[e.canonical.z].maxTileX&&e.canonical.y>=r[e.canonical.z].minTileY&&e.canonical.y<=r[e.canonical.z].maxTileY}}class fn{constructor(e,r,l){this._meshCache={},this.painter=e,this.sourceCache=new Hu(r),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,r,l,c=a.$){var p;if(!(r>=0&&r<c&&l>=0&&l<c))return 0;const g=this.getTerrainData(e),b=(p=g.tile)===null||p===void 0?void 0:p.dem;if(!b)return 0;const C=a.cr([],[r/c*a.$,l/c*a.$],g.u_terrain_matrix),S=[C[0]*b.dim,C[1]*b.dim],M=Math.floor(S[0]),z=Math.floor(S[1]),A=S[0]-M,R=S[1]-z;return b.get(M,z)*(1-A)*(1-R)+b.get(M+1,z)*A*(1-R)+b.get(M,z+1)*(1-A)*R+b.get(M+1,z+1)*A*R}getElevationForLngLatZoom(e,r){if(!a.cs(r,e.wrap()))return 0;const{tileID:l,mercatorX:c,mercatorY:p}=this._getOverscaledTileIDFromLngLatZoom(e,r);return this.getElevation(l,c%a.$,p%a.$,a.$)}getElevation(e,r,l,c=a.$){return this.getDEMElevation(e,r,l,c)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const c=this.painter.context,p=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new a.T(c,p,c.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new a.T(c,new a.R({width:1,height:1}),c.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.af([])}const r=this.sourceCache.getSourceTile(e,!0);if(r&&r.dem&&(!r.demTexture||r.needsTerrainPrepare)){const c=this.painter.context;r.demTexture=this.painter.getTileTexture(r.dem.stride),r.demTexture?r.demTexture.update(r.dem.getPixels(),{premultiply:!1}):r.demTexture=new a.T(c,r.dem.getPixels(),c.gl.RGBA,{premultiply:!1}),r.demTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),r.needsTerrainPrepare=!1}const l=r&&r+r.tileID.key+e.key;if(l&&!this._demMatrixCache[l]){const c=this.sourceCache.sourceCache._source.maxzoom;let p=e.canonical.z-r.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=c?p=e.canonical.z-c:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const g=e.canonical.x-(e.canonical.x>>p<<p),b=e.canonical.y-(e.canonical.y>>p<<p),C=a.ct(new Float64Array(16),[1/(a.$<<p),1/(a.$<<p),0]);a.M(C,C,[g*a.$,b*a.$,0]),this._demMatrixCache[e.key]={matrix:C,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:r&&r.dem&&r.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:r&&r.dem&&r.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(r&&r.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:r}}getFramebuffer(e){const r=this.painter,l=r.width/devicePixelRatio,c=r.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===c||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new a.T(r.context,{width:l,height:c,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new a.T(r.context,{width:l,height:c,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=r.context.createFramebuffer(l,c,!0,!1),this._fbo.depthAttachment.set(r.context.createRenderbuffer(r.context.gl.DEPTH_COMPONENT16,l,c))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const r=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let p=0,g=0;p<this._coordsTextureSize;p++)for(let b=0;b<this._coordsTextureSize;b++,g+=4)r[g+0]=255&b,r[g+1]=255&p,r[g+2]=b>>8<<4|p>>8,r[g+3]=0;const l=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(r.buffer)),c=new a.T(e,l,e.gl.RGBA,{premultiply:!1});return c.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=c,c}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const r=new Uint8Array(4),l=this.painter.context,c=l.gl,p=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),g=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),b=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),c.readPixels(p,b-g-1,1,1,c.RGBA,c.UNSIGNED_BYTE,r),l.bindFramebuffer.set(null);const C=r[0]+(r[2]>>4<<8),S=r[1]+((15&r[2])<<8),M=this.coordsIndex[255-r[3]],z=M&&this.sourceCache.getTileByID(M);if(!z)return null;const A=this._coordsTextureSize,R=(1<<z.tileID.canonical.z)*A;return new a.a0((z.tileID.canonical.x*A+C)/R+z.tileID.wrap,(z.tileID.canonical.y*A+S)/R,this.getElevation(z.tileID,C,S,A))}depthAtPoint(e){const r=new Uint8Array(4),l=this.painter.context,c=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),c.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,c.RGBA,c.UNSIGNED_BYTE,r),l.bindFramebuffer.set(null),(r[0]/16777216+r[1]/65536+r[2]/256+r[3])/256}getTerrainMesh(e){var r;const l=((r=this.painter.style.projection)===null||r===void 0?void 0:r.transitionState)>0,c=l&&e.canonical.y===0,p=l&&e.canonical.y===(1<<e.canonical.z)-1,g=`m_${c?"n":""}_${p?"s":""}`;if(this._meshCache[g])return this._meshCache[g];const b=this.painter.context,C=new a.cu,S=new a.aM,M=this.meshSize,z=a.$/M,A=M*M;for(let ue=0;ue<=M;ue++)for(let Ce=0;Ce<=M;Ce++)C.emplaceBack(Ce*z,ue*z,0);for(let ue=0;ue<A;ue+=M+1)for(let Ce=0;Ce<M;Ce++)S.emplaceBack(Ce+ue,M+Ce+ue+1,M+Ce+ue+2),S.emplaceBack(Ce+ue,M+Ce+ue+2,Ce+ue+1);const R=C.length,V=R+(M+1),Q=(M+1)*M,J=c?a.bg:0,ee=c?0:1,se=p?a.bh:a.$,fe=p?0:1;for(let ue=0;ue<=M;ue++)C.emplaceBack(ue*z,J,ee);for(let ue=0;ue<=M;ue++)C.emplaceBack(ue*z,se,fe);for(let ue=0;ue<M;ue++)S.emplaceBack(Q+ue,V+ue,V+ue+1),S.emplaceBack(Q+ue,V+ue+1,Q+ue+1),S.emplaceBack(0+ue,R+ue+1,R+ue),S.emplaceBack(0+ue,0+ue+1,R+ue+1);const he=C.length,_e=he+2*(M+1);for(const ue of[0,1])for(let Ce=0;Ce<=M;Ce++)for(const Be of[0,1])C.emplaceBack(ue*a.$,Ce*z,Be);for(let ue=0;ue<2*M;ue+=2)S.emplaceBack(he+ue,he+ue+1,he+ue+3),S.emplaceBack(he+ue,he+ue+3,he+ue+2),S.emplaceBack(_e+ue,_e+ue+3,_e+ue+1),S.emplaceBack(_e+ue,_e+ue+2,_e+ue+3);const ye=new xn(b.createVertexBuffer(C,Bh.members),b.createIndexBuffer(S),a.aL.simpleSegment(0,0,C.length,S.length));return this._meshCache[g]=ye,ye}getMeshFrameDelta(e){return 2*Math.PI*a.bt/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,r){var l;const{tileID:c}=this._getOverscaledTileIDFromLngLatZoom(e,r);return(l=this.getMinMaxElevation(c).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(e){const r=this.getTerrainData(e).tile,l={minElevation:null,maxElevation:null};return r&&r.dem&&(l.minElevation=r.dem.min*this.exaggeration,l.maxElevation=r.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(e,r){const l=a.a0.fromLngLat(e.wrap()),c=(1<<r)*a.$,p=l.x*c,g=l.y*c,b=Math.floor(p/a.$),C=Math.floor(g/a.$);return{tileID:new a.Z(r,0,r,b,C),mercatorX:p,mercatorY:g}}}class Oa{constructor(e,r,l){this._context=e,this._size=r,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const r=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new a.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),r.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),r.colorAttachment.set(l.texture),{id:e,fbo:r,texture:l,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(r=>e.id!==r),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const r of this._recentlyUsed)if(!this._objects[r].inUse)return this._objects[r];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const Tt={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Dt{constructor(e,r){this.painter=e,this.terrain=r,this.pool=new Oa(e.context,30,r.sourceCache.tileSize*r.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,r){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(l=>!e._layers[l].isHidden(r)),this._coordsAscending={};for(const l in e.sourceCaches){this._coordsAscending[l]={};const c=e.sourceCaches[l].getVisibleCoordinates(),p=e.sourceCaches[l].getSource(),g=p instanceof ke?p.terrainTileRanges:null;for(const b of c){const C=this.terrain.sourceCache.getTerrainCoords(b,g);for(const S in C)this._coordsAscending[l][S]||(this._coordsAscending[l][S]=[]),this._coordsAscending[l][S].push(C[S])}}this._coordsAscendingStr={};for(const l of e._order){const c=e._layers[l],p=c.source;if(Tt[c.type]&&!this._coordsAscendingStr[p]){this._coordsAscendingStr[p]={};for(const g in this._coordsAscending[p])this._coordsAscendingStr[p][g]=this._coordsAscending[p][g].map(b=>b.key).sort().join()}}for(const l of this._renderableTiles)for(const c in this._coordsAscendingStr){const p=this._coordsAscendingStr[c][l.tileID.key];p&&p!==l.rttCoords[c]&&(l.rtt=[])}}renderLayer(e,r){if(e.isHidden(this.painter.transform.zoom))return!1;const l=Object.assign(Object.assign({},r),{isRenderingToTexture:!0}),c=e.type,p=this.painter,g=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(Tt[c]&&(this._prevType&&Tt[this._prevType]||this._stacks.push([]),this._prevType=c,this._stacks[this._stacks.length-1].push(e.id),!g))return!0;if(Tt[this._prevType]||Tt[c]&&g){this._prevType=c;const b=this._stacks.length-1,C=this._stacks[b]||[];for(const S of this._renderableTiles){if(this.pool.isFull()&&(Rr(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(S),S.rtt[b]){const z=this.pool.getObjectForId(S.rtt[b].id);if(z.stamp===S.rtt[b].stamp){this.pool.useObject(z);continue}}const M=this.pool.getOrCreateFreeObject();this.pool.useObject(M),this.pool.stampObject(M),S.rtt[b]={id:M.id,stamp:M.stamp},p.context.bindFramebuffer.set(M.fbo.framebuffer),p.context.clear({color:a.be.transparent,stencil:0}),p.currentStencilSource=void 0;for(let z=0;z<C.length;z++){const A=p.style._layers[C[z]],R=A.source?this._coordsAscending[A.source][S.tileID.key]:[S.tileID];p.context.viewport.set([0,0,M.fbo.width,M.fbo.height]),p._renderTileClippingMasks(A,R,!0),p.renderLayer(p,p.style.sourceCaches[A.source],A,R,l),A.source&&(S.rttCoords[A.source]=this._coordsAscendingStr[A.source][S.tileID.key])}}return Rr(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects(),Tt[c]}return!1}}const ja={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},ec=$,Fo={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Lo,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},Pi={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Oh{constructor(e,r,l=!1){this.mousedown=p=>{this.startMove(p,L.mousePos(this.element,p)),L.addEventListener(window,"mousemove",this.mousemove),L.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=p=>{this.move(p,L.mousePos(this.element,p))},this.mouseup=p=>{this._rotatePitchHanlder.dragEnd(p),this.offTemp()},this.touchstart=p=>{p.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=L.touchPos(this.element,p.targetTouches)[0],this.startMove(p,this._startPos),L.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),L.addEventListener(window,"touchend",this.touchend))},this.touchmove=p=>{p.targetTouches.length!==1?this.reset():(this._lastPos=L.touchPos(this.element,p.targetTouches)[0],this.move(p,this._lastPos))},this.touchend=p=>{p.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=r;const c=new $u;this._rotatePitchHanlder=new Ns({clickTolerance:3,move:(p,g)=>{const b=r.getBoundingClientRect(),C=new a.P((b.bottom-b.top)/2,(b.right-b.left)/2);return{bearingDelta:a.cm(new a.P(p.x,g.y),g,C),pitchDelta:l?-.5*(g.y-p.y):void 0}},moveStateManager:c,enable:!0,assignEvents:()=>{}}),this.map=e,L.addEventListener(r,"mousedown",this.mousedown),L.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),L.addEventListener(r,"touchcancel",this.reset)}startMove(e,r){this._rotatePitchHanlder.dragStart(e,r),L.disableDrag()}move(e,r){const l=this.map,{bearingDelta:c,pitchDelta:p}=this._rotatePitchHanlder.dragMove(e,r)||{};c&&l.setBearing(l.getBearing()+c),p&&l.setPitch(l.getPitch()+p)}off(){const e=this.element;L.removeEventListener(e,"mousedown",this.mousedown),L.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),L.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),L.removeEventListener(window,"touchend",this.touchend),L.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){L.enableDrag(),L.removeEventListener(window,"mousemove",this.mousemove),L.removeEventListener(window,"mouseup",this.mouseup),L.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),L.removeEventListener(window,"touchend",this.touchend)}}let li;function jh(d,e,r,l=!1){if(l||!r.getCoveringTilesDetailsProvider().allowWorldCopies())return d==null?void 0:d.wrap();const c=new a.S(d.lng,d.lat);if(d=new a.S(d.lng,d.lat),e){const p=new a.S(d.lng-360,d.lat),g=new a.S(d.lng+360,d.lat),b=r.locationToScreenPoint(d).distSqr(e);r.locationToScreenPoint(p).distSqr(e)<b?d=p:r.locationToScreenPoint(g).distSqr(e)<b&&(d=g)}for(;Math.abs(d.lng-r.center.lng)>180;){const p=r.locationToScreenPoint(d);if(p.x>=0&&p.y>=0&&p.x<=r.width&&p.y<=r.height)break;d.lng>r.center.lng?d.lng-=360:d.lng+=360}return d.lng!==c.lng&&r.isPointOnMapSurface(r.locationToScreenPoint(d))?d:c}const as={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function kr(d,e,r){const l=d.classList;for(const c in as)l.remove(`maplibregl-${r}-anchor-${c}`);l.add(`maplibregl-${r}-anchor-${e}`)}class Lr extends a.E{constructor(e){if(super(),this._onKeyPress=r=>{const l=r.code,c=r.charCode||r.keyCode;l!=="Space"&&l!=="Enter"&&c!==32&&c!==13||this.togglePopup()},this._onMapClick=r=>{const l=r.originalEvent.target,c=this._element;this._popup&&(l===c||c.contains(l))&&this.togglePopup()},this._update=r=>{if(!this._map)return;const l=this._map.loaded()&&!this._map.isMoving();((r==null?void 0:r.type)==="terrain"||(r==null?void 0:r.type)==="render"&&!l)&&this._map.once("render",this._update),this._lngLat=jh(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let c="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?c=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(c=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let p="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?p="rotateX(0deg)":this._pitchAlignment==="map"&&(p=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||r&&r.type!=="moveend"||(this._pos=this._pos.round()),L.setTransform(this._element,`${as[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${p} ${c}`),oe.frameAsync(new AbortController).then(()=>{this._updateOpacity(r&&r.type==="moveend")}).catch(()=>{})},this._onMove=r=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.l("dragstart"))),this.fire(new a.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.l("dragend")),this._state="inactive"},this._addDragHandler=r=>{this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos).add(this._offset),this._pointerdownPos=r.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=a.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=L.create("div");const r=L.createNS("http://www.w3.org/2000/svg","svg"),l=41,c=27;r.setAttributeNS(null,"display","block"),r.setAttributeNS(null,"height",`${l}px`),r.setAttributeNS(null,"width",`${c}px`),r.setAttributeNS(null,"viewBox",`0 0 ${c} ${l}`);const p=L.createNS("http://www.w3.org/2000/svg","g");p.setAttributeNS(null,"stroke","none"),p.setAttributeNS(null,"stroke-width","1"),p.setAttributeNS(null,"fill","none"),p.setAttributeNS(null,"fill-rule","evenodd");const g=L.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"fill-rule","nonzero");const b=L.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"transform","translate(3.0, 29.0)"),b.setAttributeNS(null,"fill","#000000");const C=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ee of C){const se=L.createNS("http://www.w3.org/2000/svg","ellipse");se.setAttributeNS(null,"opacity","0.04"),se.setAttributeNS(null,"cx","10.5"),se.setAttributeNS(null,"cy","5.80029008"),se.setAttributeNS(null,"rx",ee.rx),se.setAttributeNS(null,"ry",ee.ry),b.appendChild(se)}const S=L.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"fill",this._color);const M=L.createNS("http://www.w3.org/2000/svg","path");M.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),S.appendChild(M);const z=L.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"opacity","0.25"),z.setAttributeNS(null,"fill","#000000");const A=L.createNS("http://www.w3.org/2000/svg","path");A.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),z.appendChild(A);const R=L.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(6.0, 7.0)"),R.setAttributeNS(null,"fill","#FFFFFF");const V=L.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Q=L.createNS("http://www.w3.org/2000/svg","circle");Q.setAttributeNS(null,"fill","#000000"),Q.setAttributeNS(null,"opacity","0.25"),Q.setAttributeNS(null,"cx","5.5"),Q.setAttributeNS(null,"cy","5.5"),Q.setAttributeNS(null,"r","5.4999962");const J=L.createNS("http://www.w3.org/2000/svg","circle");J.setAttributeNS(null,"fill","#FFFFFF"),J.setAttributeNS(null,"cx","5.5"),J.setAttributeNS(null,"cy","5.5"),J.setAttributeNS(null,"r","5.4999962"),V.appendChild(Q),V.appendChild(J),g.appendChild(b),g.appendChild(S),g.appendChild(z),g.appendChild(R),g.appendChild(V),r.appendChild(g),r.setAttributeNS(null,"height",l*this._scale+"px"),r.setAttributeNS(null,"width",c*this._scale+"px"),this._element.appendChild(r),this._offset=a.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",r=>{r.preventDefault()}),this._element.addEventListener("mousedown",r=>{r.preventDefault()}),kr(this._element,this._anchor,"marker"),e&&e.className)for(const r of e.className.split(" "))this._element.classList.add(r);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),L.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=a.S.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const c=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[c,-1*(38.1-13.5+c)],"bottom-right":[-c,-1*(38.1-13.5+c)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var r,l;const c=(r=this._map)===null||r===void 0?void 0:r.terrain,p=this._map.transform.isLocationOccluded(this._lngLat);if(!c||p){const R=p?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==R&&(this._element.style.opacity=R))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const g=this._map,b=g.terrain.depthAtPoint(this._pos),C=g.terrain.getElevationForLngLatZoom(this._lngLat,g.transform.tileZoom);if(g.transform.lngLatToCameraDepth(this._lngLat,C)-b<.006)return void(this._element.style.opacity=this._opacity);const S=-this._offset.y/g.transform.pixelsPerMeter,M=Math.sin(g.getPitch()*Math.PI/180)*S,z=g.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),A=g.transform.lngLatToCameraDepth(this._lngLat,C+M)-z>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&A&&this._popup.remove(),this._element.style.opacity=A?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=a.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,r){return(this._opacity===void 0||e===void 0&&r===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),r!==void 0&&(this._opacityWhenCovered=r),this._map&&this._updateOpacity(!0),this}}const Vh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let jn=0,Vn=!1;const tc={maxWidth:100,unit:"metric"};function Va(d,e,r){const l=r&&r.maxWidth||100,c=d._container.clientHeight/2,p=d._container.clientWidth/2,g=d.unproject([p-l/2,c]),b=d.unproject([p+l/2,c]),C=Math.round(d.project(b).x-d.project(g).x),S=Math.min(l,C,d._container.clientWidth),M=g.distanceTo(b);if(r&&r.unit==="imperial"){const z=3.2808*M;z>5280?ls(e,S,z/5280,d._getUIString("ScaleControl.Miles")):ls(e,S,z,d._getUIString("ScaleControl.Feet"))}else r&&r.unit==="nautical"?ls(e,S,M/1852,d._getUIString("ScaleControl.NauticalMiles")):M>=1e3?ls(e,S,M/1e3,d._getUIString("ScaleControl.Kilometers")):ls(e,S,M,d._getUIString("ScaleControl.Meters"))}function ls(d,e,r,l){const c=function(p){const g=Math.pow(10,`${Math.floor(p)}`.length-1);let b=p/g;return b=b>=10?10:b>=5?5:b>=3?3:b>=2?2:b>=1?1:function(C){const S=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*S)/S}(b),g*b}(r);d.style.width=e*(c/r)+"px",d.innerHTML=`${c}&nbsp;${l}`}const Bo={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},rc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Na(d){if(d){if(typeof d=="number"){const e=Math.round(Math.abs(d)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,d),"top-left":new a.P(e,e),"top-right":new a.P(-e,e),bottom:new a.P(0,-d),"bottom-left":new a.P(e,-e),"bottom-right":new a.P(-e,-e),left:new a.P(d,0),right:new a.P(-d,0)}}if(d instanceof a.P||Array.isArray(d)){const e=a.P.convert(d);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:a.P.convert(d.center||[0,0]),top:a.P.convert(d.top||[0,0]),"top-left":a.P.convert(d["top-left"]||[0,0]),"top-right":a.P.convert(d["top-right"]||[0,0]),bottom:a.P.convert(d.bottom||[0,0]),"bottom-left":a.P.convert(d["bottom-left"]||[0,0]),"bottom-right":a.P.convert(d["bottom-right"]||[0,0]),left:a.P.convert(d.left||[0,0]),right:a.P.convert(d.right||[0,0])}}return Na(new a.P(0,0))}const ic=$;w.AJAXError=a.cy,w.Event=a.l,w.Evented=a.E,w.LngLat=a.S,w.MercatorCoordinate=a.a0,w.Point=a.P,w.addProtocol=a.cz,w.config=a.a,w.removeProtocol=a.cA,w.AttributionControl=Ba,w.BoxZoomHandler=Zl,w.CanvasSource=nt,w.CooperativeGesturesHandler=Lh,w.DoubleClickZoomHandler=La,w.DragPanHandler=Kl,w.DragRotateHandler=Fa,w.EdgeInsets=Ui,w.FullscreenControl=class extends a.E{constructor(d={}){super(),this._onFullscreenChange=()=>{var e;let r=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=r==null?void 0:r.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)r=r.shadowRoot.fullscreenElement;r===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){L.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const d=this._fullscreenButton=L.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);L.create("span","maplibregl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.title=d}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},w.GeoJSONSource=ae,w.GeolocateControl=class extends a.E{constructor(d){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new a.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const r=new a.S(e.coords.longitude,e.coords.latitude),l=e.coords.accuracy,c=this._map.getBearing(),p=a.e({bearing:c},this.options.fitBoundsOptions),g=ar.fromLngLat(r,l);this._map.fitBounds(g,p,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const r=new a.S(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Vn)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=L.create("button","maplibregl-ctrl-geolocate",this._container),L.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=L.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Lr({element:this._dotElement}),this._circleElement=L.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Lr({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.l("trackuserlocationend")),this.fire(new a.l("userlocationlostfocus")))})}},this.options=a.e({},Vh,d)}onAdd(d){return this._map=d,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return a._(this,arguments,void 0,function*(e=!1){if(li!==void 0&&!e)return li;if(window.navigator.permissions===void 0)return li=!!window.navigator.geolocation,li;try{li=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{li=!!window.navigator.geolocation}return li})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),L.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,jn=0,Vn=!1}_isOutOfMapMaxBounds(d){const e=this._map.getMaxBounds(),r=d.coords;return e&&(r.longitude<e.getWest()||r.longitude>e.getEast()||r.latitude<e.getSouth()||r.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const d=this._map.getBounds(),e=d.getSouthEast(),r=d.getNorthEast(),l=e.distanceTo(r),c=Math.ceil(this._accuracy/(l/this._map._container.clientHeight)*2);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":jn--,Vn=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.l("trackuserlocationstart")),this.fire(new a.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),jn++,jn>1?(d={maximumAge:6e5,timeout:0},Vn=!0):(d=this.options.positionOptions,Vn=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,d)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},w.GlobeControl=class{constructor(){this._toggleProjection=()=>{var d;const e=(d=this._map.getProjection())===null||d===void 0?void 0:d.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var d;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((d=this._map.getProjection())===null||d===void 0?void 0:d.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(d){return this._map=d,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=L.create("button","maplibregl-ctrl-globe",this._container),L.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){L.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},w.Hash=Mo,w.ImageSource=ke,w.KeyboardHandler=Zs,w.LngLatBounds=ar,w.LogoControl=Ql,w.Map=class extends Cr{constructor(d){var e,r;a.cv.mark(a.cw.create);const l=Object.assign(Object.assign(Object.assign({},Fo),d),{canvasContextAttributes:Object.assign(Object.assign({},Fo.canvasContextAttributes),d.canvasContextAttributes)});if(l.minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const c=new $r,p=new ha;if(l.minZoom!==void 0&&c.setMinZoom(l.minZoom),l.maxZoom!==void 0&&c.setMaxZoom(l.maxZoom),l.minPitch!==void 0&&c.setMinPitch(l.minPitch),l.maxPitch!==void 0&&c.setMaxPitch(l.maxPitch),l.renderWorldCopies!==void 0&&c.setRenderWorldCopies(l.renderWorldCopies),super(c,p,{bearingSnap:l.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Fh,this._controls=[],this._mapId=a.a6(),this._contextLost=b=>{b.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.l("webglcontextlost",{originalEvent:b}))},this._contextRestored=b=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.l("webglcontextrestored",{originalEvent:b}))},this._onMapScroll=b=>{if(b.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=l.interactive,this._maxTileCacheSize=l.maxTileCacheSize,this._maxTileCacheZoomLevels=l.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},l.canvasContextAttributes),this._trackResize=l.trackResize===!0,this._bearingSnap=l.bearingSnap,this._centerClampedToGround=l.centerClampedToGround,this._refreshExpiredTiles=l.refreshExpiredTiles===!0,this._fadeDuration=l.fadeDuration,this._crossSourceCollisions=l.crossSourceCollisions===!0,this._collectResourceTiming=l.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},ja),l.locale),this._clickTolerance=l.clickTolerance,this._overridePixelRatio=l.pixelRatio,this._maxCanvasSize=l.maxCanvasSize,this.transformCameraUpdate=l.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=l.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Ae.addThrottleControl(()=>this.isMoving()),this._requestManager=new Me(l.transformRequest),typeof l.container=="string"){if(this._container=document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(l.maxBounds&&this.setMaxBounds(l.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let b=!1;const C=Ia(S=>{this._trackResize&&!this._removed&&(this.resize(S),this.redraw())},50);this._resizeObserver=new ResizeObserver(S=>{b?C(S):b=!0}),this._resizeObserver.observe(this._container)}this.handlers=new On(this,l),this._hash=l.hash&&new Mo(typeof l.hash=="string"&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,elevation:l.elevation,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,roll:l.roll}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,a.e({},l.fitBoundsOptions,{duration:0}))));const g=typeof l.style=="string"||((r=(e=l.style)===null||e===void 0?void 0:e.projection)===null||r===void 0?void 0:r.type)!=="globe";this.resize(null,g),this._localIdeographFontFamily=l.localIdeographFontFamily,this._validateStyle=l.validateStyle,l.style&&this.setStyle(l.style,{localIdeographFontFamily:l.localIdeographFontFamily}),l.attributionControl&&this.addControl(new Ba(typeof l.attributionControl=="boolean"?void 0:l.attributionControl)),l.maplibreLogo&&this.addControl(new Ql,l.logoPosition),this.on("style.load",()=>{if(g||this._resizeTransform(),this.transform.unmodified){const b=a.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(b)}}),this.on("data",b=>{this._update(b.dataType==="style"),this.fire(new a.l(`${b.dataType}data`,b))}),this.on("dataloading",b=>{this.fire(new a.l(`${b.dataType}dataloading`,b))}),this.on("dataabort",b=>{this.fire(new a.l("sourcedataabort",b))})}_getMapId(){return this._mapId}setGlobalStateProperty(d,e){return this.style.setGlobalStateProperty(d,e),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(d,e){if(e===void 0&&(e=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new a.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=d.onAdd(this);this._controls.push(d);const l=this._controlPositions[e];return e.indexOf("bottom")!==-1?l.insertBefore(r,l.firstChild):l.appendChild(r),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new a.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(d);return e>-1&&this._controls.splice(e,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}calculateCameraOptionsFromTo(d,e,r,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(d,e,r,l)}resize(d,e=!0){const[r,l]=this._containerDimensions(),c=this._getClampedPixelRatio(r,l);if(this._resizeCanvas(r,l,c),this.painter.resize(r,l,c),this.painter.overLimit()){const g=this.painter.context.gl;this._maxCanvasSize=[g.drawingBufferWidth,g.drawingBufferHeight];const b=this._getClampedPixelRatio(r,l);this._resizeCanvas(r,l,b),this.painter.resize(r,l,b)}this._resizeTransform(e);const p=!this._moving;return p&&(this.stop(),this.fire(new a.l("movestart",d)).fire(new a.l("move",d))),this.fire(new a.l("resize",d)),p&&this.fire(new a.l("moveend",d)),this}_resizeTransform(d=!0){var e;const[r,l]=this._containerDimensions();this.transform.resize(r,l,d),(e=this._requestedCameraState)===null||e===void 0||e.resize(r,l,d)}_getClampedPixelRatio(d,e){const{0:r,1:l}=this._maxCanvasSize,c=this.getPixelRatio(),p=d*c,g=e*c;return Math.min(p>r?r/p:1,g>l?l/g:1)*c}getPixelRatio(){var d;return(d=this._overridePixelRatio)!==null&&d!==void 0?d:devicePixelRatio}setPixelRatio(d){this._overridePixelRatio=d,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(d){return this.transform.setMaxBounds(ar.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.setMinZoom(d),this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.setMaxZoom(d),this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.setMinPitch(d),this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(d>=this.transform.minPitch)return this.transform.setMaxPitch(d),this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.setRenderWorldCopies(d),this._update()}project(d){return this.transform.locationToScreenPoint(a.S.convert(d),this.style&&this.terrain)}unproject(d){return this.transform.screenPointToLocation(a.P.convert(d),this.terrain)}isMoving(){var d;return this._moving||((d=this.handlers)===null||d===void 0?void 0:d.isMoving())}isZooming(){var d;return this._zooming||((d=this.handlers)===null||d===void 0?void 0:d.isZooming())}isRotating(){var d;return this._rotating||((d=this.handlers)===null||d===void 0?void 0:d.isRotating())}_createDelegatedListener(d,e,r){if(d==="mouseenter"||d==="mouseover"){let l=!1;return{layers:e,listener:r,delegates:{mousemove:p=>{const g=e.filter(C=>this.getLayer(C)),b=g.length!==0?this.queryRenderedFeatures(p.point,{layers:g}):[];b.length?l||(l=!0,r.call(this,new Mi(d,this,p.originalEvent,{features:b}))):l=!1},mouseout:()=>{l=!1}}}}if(d==="mouseleave"||d==="mouseout"){let l=!1;return{layers:e,listener:r,delegates:{mousemove:g=>{const b=e.filter(C=>this.getLayer(C));(b.length!==0?this.queryRenderedFeatures(g.point,{layers:b}):[]).length?l=!0:l&&(l=!1,r.call(this,new Mi(d,this,g.originalEvent)))},mouseout:g=>{l&&(l=!1,r.call(this,new Mi(d,this,g.originalEvent)))}}}}{const l=c=>{const p=e.filter(b=>this.getLayer(b)),g=p.length!==0?this.queryRenderedFeatures(c.point,{layers:p}):[];g.length&&(c.features=g,r.call(this,c),delete c.features)};return{layers:e,listener:r,delegates:{[d]:l}}}}_saveDelegatedListener(d,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(e)}_removeDelegatedListener(d,e,r){if(!this._delegatedListeners||!this._delegatedListeners[d])return;const l=this._delegatedListeners[d];for(let c=0;c<l.length;c++){const p=l[c];if(p.listener===r&&p.layers.length===e.length&&p.layers.every(g=>e.includes(g))){for(const g in p.delegates)this.off(g,p.delegates[g]);return void l.splice(c,1)}}}on(d,e,r){if(r===void 0)return super.on(d,e);const l=typeof e=="string"?[e]:e,c=this._createDelegatedListener(d,l,r);this._saveDelegatedListener(d,c);for(const p in c.delegates)this.on(p,c.delegates[p]);return{unsubscribe:()=>{this._removeDelegatedListener(d,l,r)}}}once(d,e,r){if(r===void 0)return super.once(d,e);const l=typeof e=="string"?[e]:e,c=this._createDelegatedListener(d,l,r);for(const p in c.delegates){const g=c.delegates[p];c.delegates[p]=(...b)=>{this._removeDelegatedListener(d,l,r),g(...b)}}this._saveDelegatedListener(d,c);for(const p in c.delegates)this.once(p,c.delegates[p]);return this}off(d,e,r){return r===void 0?super.off(d,e):(this._removeDelegatedListener(d,typeof e=="string"?[e]:e,r),this)}queryRenderedFeatures(d,e){if(!this.style)return[];let r;const l=d instanceof a.P||Array.isArray(d),c=l?d:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(l?{}:d)||{},c instanceof a.P||typeof c[0]=="number")r=[a.P.convert(c)];else{const p=a.P.convert(c[0]),g=a.P.convert(c[1]);r=[p,new a.P(g.x,p.y),g,new a.P(p.x,g.y),p]}return this.style.queryRenderedFeatures(r,e,this.transform)}querySourceFeatures(d,e){return this.style.querySourceFeatures(d,e)}setStyle(d,e){return(e=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(d,e))}setTransformRequest(d){return this._requestManager.setTransformRequest(d),this}_getUIString(d){const e=this._locale[d];if(e==null)throw new Error(`Missing UI string '${d}'`);return e}_updateStyle(d,e){var r,l;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(d,e));const c=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!d)),d?(this.style=new xl(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d,e,c):this.style.loadJSON(d,e,c),this):((l=(r=this.style)===null||r===void 0?void 0:r.projection)===null||l===void 0||l.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new xl(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,e){if(typeof d=="string"){const r=this._requestManager.transformRequest(d,"Style");a.j(r,new AbortController).then(l=>{this._updateDiff(l.data,e)}).catch(l=>{l&&this.fire(new a.k(l))})}else typeof d=="object"&&this._updateDiff(d,e)}_updateDiff(d,e){try{this.style.setState(d,e)&&this._update(!0)}catch(r){a.w(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(d,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(d,e){return this._lazyInitEmptyStyle(),this.style.addSource(d,e),this._update(!0)}isSourceLoaded(d){const e=this.style&&this.style.sourceCaches[d];if(e!==void 0)return e.loaded();this.fire(new a.k(new Error(`There is no source with ID '${d}'`)))}setTerrain(d){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),d){const e=this.style.sourceCaches[d.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${d.source}`);this.terrain===null&&e.reload();for(const r in this.style._layers){const l=this.style._layers[r];l.type==="hillshade"&&l.source===d.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),l.type==="color-relief"&&l.source===d.source&&a.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new fn(this.painter,e,d),this.painter.renderToTexture=new Dt(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=r=>{var l;r.dataType==="style"?this.terrain.sourceCache.freeRtt():r.dataType==="source"&&r.tile&&(r.sourceId!==d.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((l=r.source)===null||l===void 0?void 0:l.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(r.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new a.l("terrain",{terrain:d})),this}getTerrain(){var d,e;return(e=(d=this.terrain)===null||d===void 0?void 0:d.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const d=this.style&&this.style.sourceCaches;for(const e in d){const r=d[e]._tiles;for(const l in r){const c=r[l];if(c.state!=="loaded"&&c.state!=="errored")return!1}}return!0}removeSource(d){return this.style.removeSource(d),this._update(!0)}getSource(d){return this.style.getSource(d)}setSourceTileLodParams(d,e,r){if(r){const l=this.getSource(r);if(!l)throw new Error(`There is no source with ID "${r}", cannot set LOD parameters`);l.calculateTileZoom=Fe(Math.max(1,d),Math.max(1,e))}else for(const l in this.style.sourceCaches)this.style.sourceCaches[l].getSource().calculateTileZoom=Fe(Math.max(1,d),Math.max(1,e));return this._update(!0),this}refreshTiles(d,e){const r=this.style.sourceCaches[d];if(!r)throw new Error(`There is no source cache with ID "${d}", cannot refresh tile`);e===void 0?r.reload(!0):r.refreshTiles(e.map(l=>new a.a3(l.z,l.x,l.y)))}addImage(d,e,r={}){const{pixelRatio:l=1,sdf:c=!1,stretchX:p,stretchY:g,content:b,textFitWidth:C,textFitHeight:S}=r;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||a.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new a.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:M,height:z,data:A}=e,R=e;return this.style.addImage(d,{data:new a.R({width:M,height:z},new Uint8Array(A)),pixelRatio:l,stretchX:p,stretchY:g,content:b,textFitWidth:C,textFitHeight:S,sdf:c,version:0,userImage:R}),R.onAdd&&R.onAdd(this,d),this}}{const{width:M,height:z,data:A}=oe.getImageData(e);this.style.addImage(d,{data:new a.R({width:M,height:z},A),pixelRatio:l,stretchX:p,stretchY:g,content:b,textFitWidth:C,textFitHeight:S,sdf:c,version:0})}}updateImage(d,e){const r=this.style.getImage(d);if(!r)return this.fire(new a.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=e instanceof HTMLImageElement||a.b(e)?oe.getImageData(e):e,{width:c,height:p,data:g}=l;if(c===void 0||p===void 0)return this.fire(new a.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(c!==r.data.width||p!==r.data.height)return this.fire(new a.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const b=!(e instanceof HTMLImageElement||a.b(e));return r.data.replace(g,b),this.style.updateImage(d,r),this}getImage(d){return this.style.getImage(d)}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new a.k(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d){return Ae.getImage(this._requestManager.transformRequest(d,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(d,e){return this._lazyInitEmptyStyle(),this.style.addLayer(d,e),this._update(!0)}moveLayer(d,e){return this.style.moveLayer(d,e),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(d,e,r){return this.style.setLayerZoomRange(d,e,r),this._update(!0)}setFilter(d,e,r={}){return this.style.setFilter(d,e,r),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,e,r,l={}){return this.style.setPaintProperty(d,e,r,l),this._update(!0)}getPaintProperty(d,e){return this.style.getPaintProperty(d,e)}setLayoutProperty(d,e,r,l={}){return this.style.setLayoutProperty(d,e,r,l),this._update(!0)}getLayoutProperty(d,e){return this.style.getLayoutProperty(d,e)}setGlyphs(d,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(d,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(d,e,r={}){return this._lazyInitEmptyStyle(),this.style.addSprite(d,e,r,l=>{l||this._update(!0)}),this}removeSprite(d){return this._lazyInitEmptyStyle(),this.style.removeSprite(d),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(d,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(d,e,r=>{r||this._update(!0)}),this}setLight(d,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(d,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(d,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(d,e){return this.style.setFeatureState(d,e),this._update()}removeFeatureState(d,e){return this.style.removeFeatureState(d,e),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let d=0,e=0;return this._container&&(d=this._container.clientWidth||400,e=this._container.clientHeight||300),[d,e]}_setupContainer(){const d=this._container;d.classList.add("maplibregl-map");const e=this._canvasContainer=L.create("div","maplibregl-canvas-container",d);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=L.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const r=this._containerDimensions(),l=this._getClampedPixelRatio(r[0],r[1]);this._resizeCanvas(r[0],r[1],l);const c=this._controlContainer=L.create("div","maplibregl-control-container",d),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(g=>{p[g]=L.create("div",`maplibregl-ctrl-${g} `,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,e,r){this._canvas.width=Math.floor(r*d),this._canvas.height=Math.floor(r*e),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const d=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",l=>{e={requestedAttributes:d},l&&(e.statusMessage=l.statusMessage,e.type=l.type)},{once:!0});let r=null;if(r=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,d):this._canvas.getContext("webgl2",d)||this._canvas.getContext("webgl",d),!r){const l="Failed to initialize WebGL";throw e?(e.message=l,new Error(JSON.stringify(e))):new Error(l)}this.painter=new Gi(r,this.transform),H.testSupport(r)}migrateProjection(d,e){super.migrateProjection(d,e),this.painter.transform=d,this.fire(new a.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_render(d){var e,r,l,c,p;const g=this._idleTriggered?this._fadeDuration:0,b=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),this._removed)return;let C=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const z=this.transform.zoom,A=oe.now();this.style.zoomHistory.update(z,A);const R=new a.F(z,{now:A,fadeDuration:g,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),V=R.crossFadingFactor();V===1&&V===this._crossFadingFactor||(C=!0,this._crossFadingFactor=V),this.style.update(R)}const S=((r=this.style.projection)===null||r===void 0?void 0:r.transitionState)>0!==b;(l=this.style.projection)===null||l===void 0||l.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((c=this.style.projection)===null||c===void 0?void 0:c.transitionState,(p=this.style.projection)===null||p===void 0?void 0:p.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||S)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,g,this._crossSourceCollisions,S),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:g,showPadding:this.showPadding}),this.fire(new a.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.cv.mark(a.cw.load),this.fire(new a.l("load"))),this.style&&(this.style.hasTransitions()||C)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const M=this._sourcesDirty||this._styleDirty||this._placementDirty;return M||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.l("idle")),!this._loaded||this._fullyLoaded||M||(this._fullyLoaded=!0,a.cv.mark(a.cw.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var d;this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Ae.removeThrottleControl(this._imageQueueHandle),(d=this._resizeObserver)===null||d===void 0||d.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),L.remove(this._canvasContainer),L.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),a.cv.clearMetrics(),this._removed=!0,this.fire(new a.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,oe.frame(this._frameRequest,d=>{a.cv.frame(d),this._frameRequest=null;try{this._render(d)}catch(e){if(!a.cx(e)&&!function(r){return r.message===Fl}(e))throw e}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get version(){return ec}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(d){return this._lazyInitEmptyStyle(),this.style.setProjection(d),this._update(!0)}},w.MapMouseEvent=Mi,w.MapTouchEvent=Yi,w.MapWheelEvent=$l,w.Marker=Lr,w.NavigationControl=class{constructor(d){this._updateZoomButtons=()=>{const e=this._map.getZoom(),r=e===this._map.getMaxZoom(),l=e===this._map.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,r)=>{const l=this._map._getUIString(`NavigationControl.${r}`);e.title=l,e.setAttribute("aria-label",l)},this.options=a.e({},Pi,d),this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),L.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),L.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=L.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Oh(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){L.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(d,e){const r=L.create("button",d,this._container);return r.type="button",r.addEventListener("click",e),r}},w.Popup=class extends a.E{constructor(d){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:void 0)},this.remove=()=>(this._content&&L.remove(this._content),this._container&&(L.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=L.create("div","maplibregl-popup",this._map.getContainer()),this._tip=L.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const g of this.options.className.split(" "))this._container.classList.add(g);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=jh(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const r=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let l=this.options.anchor;const c=Na(this.options.offset);if(!l){const g=this._container.offsetWidth,b=this._container.offsetHeight;let C;C=r.y+c.bottom.y<b?["top"]:r.y>this._map.transform.height-b?["bottom"]:[],r.x<g/2?C.push("left"):r.x>this._map.transform.width-g/2&&C.push("right"),l=C.length===0?"bottom":C.join("-")}let p=r.add(c[l]);this.options.subpixelPositioning||(p=p.round()),L.setTransform(this._container,`${as[l]} translate(${p.x}px,${p.y}px)`),kr(this._container,l,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(Bo),d)}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(d){return this._lngLat=a.S.convert(d),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){const e=document.createDocumentFragment(),r=document.createElement("body");let l;for(r.innerHTML=d;l=r.firstChild,l;)e.appendChild(l);return this.setDOMContent(e)}getMaxWidth(){var d;return(d=this._container)===null||d===void 0?void 0:d.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=L.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(d),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(d){return this._container&&this._container.classList.add(d),this}removeClassName(d){return this._container&&this._container.classList.remove(d),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){if(this._container)return this._container.classList.toggle(d)}setSubpixelPositioning(d){this.options.subpixelPositioning=d}_createCloseButton(){this.options.closeButton&&(this._closeButton=L.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(rc);d&&d.focus()}},w.RasterDEMTileSource=de,w.RasterTileSource=Ge,w.ScaleControl=class{constructor(d){this._onMove=()=>{Va(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Va(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},tc),d)}getDefaultPosition(){return"bottom-left"}onAdd(d){return this._map=d,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-scale",d.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){L.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},w.ScrollZoomHandler=Rh,w.Style=xl,w.TerrainControl=class{constructor(d){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=d}onAdd(d){return this._map=d,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=L.create("button","maplibregl-ctrl-terrain",this._container),L.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){L.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},w.TwoFingersTouchPitchHandler=Wl,w.TwoFingersTouchRotateHandler=ql,w.TwoFingersTouchZoomHandler=pn,w.TwoFingersTouchZoomRotateHandler=Yl,w.VectorTileSource=Je,w.VideoSource=it,w.addSourceType=(d,e)=>a._(void 0,void 0,void 0,function*(){if(pt(d))throw new Error(`A source type called "${d}" already exists.`);((r,l)=>{Oe[r]=l})(d,e)}),w.clearPrewarmedResources=function(){const d=Et;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(Ft),Et=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},w.createTileMesh=yl,w.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},w.getRTLTextPluginStatus=function(){return Xt().getRTLTextPluginStatus()},w.getVersion=function(){return ic},w.getWorkerCount=function(){return Ue.workerCount},w.getWorkerUrl=function(){return a.a.WORKER_URL},w.importScriptInWorkers=function(d){return Dr().broadcast("IS",d)},w.prewarm=function(){gt().acquire(Ft)},w.setMaxParallelImageRequests=function(d){a.a.MAX_PARALLEL_IMAGE_REQUESTS=d},w.setRTLTextPlugin=function(d,e){return Xt().setRTLTextPlugin(d,e)},w.setWorkerCount=function(d){Ue.workerCount=d},w.setWorkerUrl=function(d){a.a.WORKER_URL=d}});var k=u;return k})}(hu)),hu.exports}var uv=hv();const gn={u_resolution:[1,1],u_bbox_4326:[0,0,0,0],u_min:0,u_max:100,u_max_color:{r:1,g:1,b:1},u_min_color:{r:0,g:0,b:0},u_dem_type:0,u_time:0,u_scale:1};/*! Tweakpane 4.0.5 (c) 2016 cocopon, licensed under the MIT license. */function zr(_){return _==null}function lp(_){return _!==null&&typeof _=="object"}function ep(_){return _!==null&&typeof _=="object"}function dv(_,o){if(_.length!==o.length)return!1;for(let u=0;u<_.length;u++)if(_[u]!==o[u])return!1;return!0}function Jo(_,o){return Array.from(new Set([...Object.keys(_),...Object.keys(o)])).reduce((v,P)=>{const k=_[P],w=o[P];return ep(k)&&ep(w)?Object.assign(Object.assign({},v),{[P]:Jo(k,w)}):Object.assign(Object.assign({},v),{[P]:P in o?w:k})},{})}function cp(_){return lp(_)?"target"in _:!1}const pv={alreadydisposed:()=>"View has been already disposed",invalidparams:_=>`Invalid parameters for '${_.name}'`,nomatchingcontroller:_=>`No matching controller for '${_.key}'`,nomatchingview:_=>`No matching view for '${JSON.stringify(_.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:_=>`Not compatible with  plugin '${_.id}'`,propertynotfound:_=>`Property '${_.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class qr{static alreadyDisposed(){return new qr({type:"alreadydisposed"})}static notBindable(){return new qr({type:"notbindable"})}static notCompatible(o,u){return new qr({type:"notcompatible",context:{id:`${o}.${u}`}})}static propertyNotFound(o){return new qr({type:"propertynotfound",context:{name:o}})}static shouldNeverHappen(){return new qr({type:"shouldneverhappen"})}constructor(o){var u;this.message=(u=pv[o.type](o.context))!==null&&u!==void 0?u:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=o.type}toString(){return this.message}}class fu{constructor(o,u){this.obj_=o,this.key=u}static isBindable(o){return!(o===null||typeof o!="object"&&typeof o!="function")}read(){return this.obj_[this.key]}write(o){this.obj_[this.key]=o}writeProperty(o,u){const v=this.read();if(!fu.isBindable(v))throw qr.notBindable();if(!(o in v))throw qr.propertyNotFound(o);v[o]=u}}class oi{constructor(){this.observers_={}}on(o,u,v){var P;let k=this.observers_[o];return k||(k=this.observers_[o]=[]),k.push({handler:u,key:(P=v==null?void 0:v.key)!==null&&P!==void 0?P:u}),this}off(o,u){const v=this.observers_[o];return v&&(this.observers_[o]=v.filter(P=>P.key!==u)),this}emit(o,u){const v=this.observers_[o];v&&v.forEach(P=>{P.handler(u)})}}class fv{constructor(o,u){var v;this.constraint_=u==null?void 0:u.constraint,this.equals_=(v=u==null?void 0:u.equals)!==null&&v!==void 0?v:(P,k)=>P===k,this.emitter=new oi,this.rawValue_=o}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(o){this.setRawValue(o,{forceEmit:!1,last:!0})}setRawValue(o,u){const v=u??{forceEmit:!1,last:!0},P=this.constraint_?this.constraint_.constrain(o):o,k=this.rawValue_;this.equals_(k,P)&&!v.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=P,this.emitter.emit("change",{options:v,previousRawValue:k,rawValue:P,sender:this}))}}class mv{constructor(o){this.emitter=new oi,this.value_=o}get rawValue(){return this.value_}set rawValue(o){this.setRawValue(o,{forceEmit:!1,last:!0})}setRawValue(o,u){const v=u??{forceEmit:!1,last:!0},P=this.value_;P===o&&!v.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=o,this.emitter.emit("change",{options:v,previousRawValue:P,rawValue:this.value_,sender:this}))}}class _v{constructor(o){this.emitter=new oi,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=o,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(o){this.emitter.emit("beforechange",Object.assign(Object.assign({},o),{sender:this}))}onValueChange_(o){this.emitter.emit("change",Object.assign(Object.assign({},o),{sender:this}))}}function Or(_,o){const u=o==null?void 0:o.constraint,v=o==null?void 0:o.equals;return!u&&!v?new mv(_):new fv(_,o)}function gv(_){return[new _v(_),(o,u)=>{_.setRawValue(o,u)}]}class sr{constructor(o){this.emitter=new oi,this.valMap_=o;for(const u in this.valMap_)this.valMap_[u].emitter.on("change",()=>{this.emitter.emit("change",{key:u,sender:this})})}static createCore(o){return Object.keys(o).reduce((v,P)=>Object.assign(v,{[P]:Or(o[P])}),{})}static fromObject(o){const u=this.createCore(o);return new sr(u)}get(o){return this.valMap_[o].rawValue}set(o,u){this.valMap_[o].rawValue=u}value(o){return this.valMap_[o]}}class Fc{constructor(o){this.values=sr.fromObject({max:o.max,min:o.min})}constrain(o){const u=this.values.get("max"),v=this.values.get("min");return Math.min(Math.max(o,v),u)}}class yv{constructor(o){this.values=sr.fromObject({max:o.max,min:o.min})}constrain(o){const u=this.values.get("max"),v=this.values.get("min");let P=o;return zr(v)||(P=Math.max(P,v)),zr(u)||(P=Math.min(P,u)),P}}class vv{constructor(o,u=0){this.step=o,this.origin=u}constrain(o){const u=this.origin%this.step,v=Math.round((o-u)/this.step);return u+v*this.step}}class bv{constructor(o){this.text=o}evaluate(){return Number(this.text)}toString(){return this.text}}const xv={"**":(_,o)=>Math.pow(_,o),"*":(_,o)=>_*o,"/":(_,o)=>_/o,"%":(_,o)=>_%o,"+":(_,o)=>_+o,"-":(_,o)=>_-o,"<<":(_,o)=>_<<o,">>":(_,o)=>_>>o,">>>":(_,o)=>_>>>o,"&":(_,o)=>_&o,"^":(_,o)=>_^o,"|":(_,o)=>_|o};class wv{constructor(o,u,v){this.left=u,this.operator=o,this.right=v}evaluate(){const o=xv[this.operator];if(!o)throw new Error(`unexpected binary operator: '${this.operator}`);return o(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Cv={"+":_=>_,"-":_=>-_,"~":_=>~_};class Pv{constructor(o,u){this.operator=o,this.expression=u}evaluate(){const o=Cv[this.operator];if(!o)throw new Error(`unexpected unary operator: '${this.operator}`);return o(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function hp(_){return(o,u)=>{for(let v=0;v<_.length;v++){const P=_[v](o,u);if(P!=="")return P}return""}}function Ic(_,o){var u;const v=_.substr(o).match(/^\s+/);return(u=v&&v[0])!==null&&u!==void 0?u:""}function Tv(_,o){const u=_.substr(o,1);return u.match(/^[1-9]$/)?u:""}function Ac(_,o){var u;const v=_.substr(o).match(/^[0-9]+/);return(u=v&&v[0])!==null&&u!==void 0?u:""}function Sv(_,o){const u=Ac(_,o);if(u!=="")return u;const v=_.substr(o,1);if(o+=1,v!=="-"&&v!=="+")return"";const P=Ac(_,o);return P===""?"":v+P}function up(_,o){const u=_.substr(o,1);if(o+=1,u.toLowerCase()!=="e")return"";const v=Sv(_,o);return v===""?"":u+v}function c_(_,o){const u=_.substr(o,1);if(u==="0")return u;const v=Tv(_,o);return o+=v.length,v===""?"":v+Ac(_,o)}function Ev(_,o){const u=c_(_,o);if(o+=u.length,u==="")return"";const v=_.substr(o,1);if(o+=v.length,v!==".")return"";const P=Ac(_,o);return o+=P.length,u+v+P+up(_,o)}function kv(_,o){const u=_.substr(o,1);if(o+=u.length,u!==".")return"";const v=Ac(_,o);return o+=v.length,v===""?"":u+v+up(_,o)}function Mv(_,o){const u=c_(_,o);return o+=u.length,u===""?"":u+up(_,o)}const Iv=hp([Ev,kv,Mv]);function Av(_,o){var u;const v=_.substr(o).match(/^[01]+/);return(u=v&&v[0])!==null&&u!==void 0?u:""}function zv(_,o){const u=_.substr(o,2);if(o+=u.length,u.toLowerCase()!=="0b")return"";const v=Av(_,o);return v===""?"":u+v}function Dv(_,o){var u;const v=_.substr(o).match(/^[0-7]+/);return(u=v&&v[0])!==null&&u!==void 0?u:""}function Rv(_,o){const u=_.substr(o,2);if(o+=u.length,u.toLowerCase()!=="0o")return"";const v=Dv(_,o);return v===""?"":u+v}function Lv(_,o){var u;const v=_.substr(o).match(/^[0-9a-f]+/i);return(u=v&&v[0])!==null&&u!==void 0?u:""}function Fv(_,o){const u=_.substr(o,2);if(o+=u.length,u.toLowerCase()!=="0x")return"";const v=Lv(_,o);return v===""?"":u+v}const Bv=hp([zv,Rv,Fv]),Ov=hp([Bv,Iv]);function jv(_,o){const u=Ov(_,o);return o+=u.length,u===""?null:{evaluable:new bv(u),cursor:o}}function Vv(_,o){const u=_.substr(o,1);if(o+=u.length,u!=="(")return null;const v=u_(_,o);if(!v)return null;o=v.cursor,o+=Ic(_,o).length;const P=_.substr(o,1);return o+=P.length,P!==")"?null:{evaluable:v.evaluable,cursor:o}}function Nv(_,o){var u;return(u=jv(_,o))!==null&&u!==void 0?u:Vv(_,o)}function h_(_,o){const u=Nv(_,o);if(u)return u;const v=_.substr(o,1);if(o+=v.length,v!=="+"&&v!=="-"&&v!=="~")return null;const P=h_(_,o);return P?(o=P.cursor,{cursor:o,evaluable:new Pv(v,P.evaluable)}):null}function Uv(_,o,u){u+=Ic(o,u).length;const v=_.filter(P=>o.startsWith(P,u))[0];return v?(u+=v.length,u+=Ic(o,u).length,{cursor:u,operator:v}):null}function $v(_,o){return(u,v)=>{const P=_(u,v);if(!P)return null;v=P.cursor;let k=P.evaluable;for(;;){const w=Uv(o,u,v);if(!w)break;v=w.cursor;const a=_(u,v);if(!a)return null;v=a.cursor,k=new wv(w.operator,k,a.evaluable)}return k?{cursor:v,evaluable:k}:null}}const Zv=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((_,o)=>$v(_,o),h_);function u_(_,o){return o+=Ic(_,o).length,Zv(_,o)}function Gv(_){const o=u_(_,0);return!o||o.cursor+Ic(_,o.cursor).length!==_.length?null:o.evaluable}function _s(_){var o;const u=Gv(_);return(o=u==null?void 0:u.evaluate())!==null&&o!==void 0?o:null}function d_(_){if(typeof _=="number")return _;if(typeof _=="string"){const o=_s(_);if(!zr(o))return o}return 0}function qv(_){return String(_)}function Hi(_){return o=>o.toFixed(Math.max(Math.min(_,20),0))}function vr(_,o,u,v,P){const k=(_-o)/(u-o);return v+k*(P-v)}function Pm(_){return String(_.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function mi(_,o,u){return Math.min(Math.max(_,o),u)}function p_(_,o){return(_%o+o)%o}function Wv(_,o){return zr(_.step)?Math.max(Pm(o),2):Pm(_.step)}function f_(_){var o;return(o=_.step)!==null&&o!==void 0?o:1}function m_(_,o){var u;const v=Math.abs((u=_.step)!==null&&u!==void 0?u:o);return v===0?.1:Math.pow(10,Math.floor(Math.log10(v))-1)}function __(_,o){return zr(_.step)?null:new vv(_.step,o)}function g_(_){return!zr(_.max)&&!zr(_.min)?new Fc({max:_.max,min:_.min}):!zr(_.max)||!zr(_.min)?new yv({max:_.max,min:_.min}):null}function y_(_,o){var u,v,P;return{formatter:(u=_.format)!==null&&u!==void 0?u:Hi(Wv(_,o)),keyScale:(v=_.keyScale)!==null&&v!==void 0?v:f_(_),pointerScale:(P=_.pointerScale)!==null&&P!==void 0?P:m_(_,o)}}function v_(_){return{format:_.optional.function,keyScale:_.optional.number,max:_.optional.number,min:_.optional.number,pointerScale:_.optional.number,step:_.optional.number}}function dp(_){return{constraint:_.constraint,textProps:sr.fromObject(y_(_.params,_.initialValue))}}class ra{constructor(o){this.controller=o}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(o){this.controller.viewProps.set("disabled",o)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(o){this.controller.viewProps.set("hidden",o)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(o){return this.controller.importState(o)}exportState(){return this.controller.exportState()}}class vu{constructor(o){this.target=o}}class Bc extends vu{constructor(o,u,v){super(o),this.value=u,this.last=v??!0}}class Hv extends vu{constructor(o,u){super(o),this.expanded=u}}class Xv extends vu{constructor(o,u){super(o),this.index=u}}class Kv extends vu{constructor(o,u){super(o),this.native=u}}class zc extends ra{constructor(o){super(o),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new oi,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(o){this.controller.labelController.props.set("label",o)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(o){this.controller.tag=o}on(o,u){const v=u.bind(this);return this.emitter_.on(o,P=>{v(P)},{key:u}),this}off(o,u){return this.emitter_.off(o,u),this}refresh(){this.controller.value.fetch()}onValueChange_(o){const u=this.controller.value;this.emitter_.emit("change",new Bc(this,u.binding.target.read(),o.options.last))}}class Yv{constructor(o,u){this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=u,this.value_=o,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.emitter=new oi}get rawValue(){return this.value_.rawValue}set rawValue(o){this.value_.rawValue=o}setRawValue(o,u){this.value_.setRawValue(o,u)}fetch(){this.value_.rawValue=this.binding.read()}push(){this.binding.write(this.value_.rawValue)}onValueBeforeChange_(o){this.emitter.emit("beforechange",Object.assign(Object.assign({},o),{sender:this}))}onValueChange_(o){this.push(),this.emitter.emit("change",Object.assign(Object.assign({},o),{sender:this}))}}function Jv(_){if(!("binding"in _))return!1;const o=_.binding;return cp(o)&&"read"in o&&"write"in o}function Qv(_,o){const v=Object.keys(o).reduce((P,k)=>{if(P===void 0)return;const w=o[k],a=w(_[k]);return a.succeeded?Object.assign(Object.assign({},P),{[k]:a.value}):void 0},{});return v}function eb(_,o){return _.reduce((u,v)=>{if(u===void 0)return;const P=o(v);if(!(!P.succeeded||P.value===void 0))return[...u,P.value]},[])}function tb(_){return _===null?!1:typeof _=="object"}function ds(_){return o=>u=>{if(!o&&u===void 0)return{succeeded:!1,value:void 0};if(o&&u===void 0)return{succeeded:!0,value:void 0};const v=_(u);return v!==void 0?{succeeded:!0,value:v}:{succeeded:!1,value:void 0}}}function Tm(_){return{custom:o=>ds(o)(_),boolean:ds(o=>typeof o=="boolean"?o:void 0)(_),number:ds(o=>typeof o=="number"?o:void 0)(_),string:ds(o=>typeof o=="string"?o:void 0)(_),function:ds(o=>typeof o=="function"?o:void 0)(_),constant:o=>ds(u=>u===o?o:void 0)(_),raw:ds(o=>o)(_),object:o=>ds(u=>{if(tb(u))return Qv(u,o)})(_),array:o=>ds(u=>{if(Array.isArray(u))return eb(u,o)})(_)}}const tp={optional:Tm(!0),required:Tm(!1)};function Nr(_,o){const u=o(tp),v=tp.required.object(u)(_);return v.succeeded?v.value:void 0}function on(_,o,u,v){if(o&&!o(_))return!1;const P=Nr(_,u);return P?v(P):!1}function an(_,o){var u;return Jo((u=_==null?void 0:_())!==null&&u!==void 0?u:{},o)}function Yo(_){return"value"in _}function b_(_){if(!lp(_)||!("binding"in _))return!1;const o=_.binding;return cp(o)}const Wn="http://www.w3.org/2000/svg";function mu(_){_.offsetHeight}function rb(_,o){const u=_.style.transition;_.style.transition="none",o(),_.style.transition=u}function pp(_){return _.ontouchstart!==void 0}function ib(){return globalThis}function nb(){return ib().document}function sb(_){const o=_.ownerDocument.defaultView;return o&&"document"in o?_.getContext("2d",{willReadFrequently:!0}):null}const ob={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function bu(_,o){const u=_.createElementNS(Wn,"svg");return u.innerHTML=ob[o],u}function x_(_,o,u){_.insertBefore(o,_.children[u])}function fp(_){_.parentElement&&_.parentElement.removeChild(_)}function w_(_){for(;_.children.length>0;)_.removeChild(_.children[0])}function ab(_){for(;_.childNodes.length>0;)_.removeChild(_.childNodes[0])}function C_(_){return _.relatedTarget?_.relatedTarget:"explicitOriginalTarget"in _?_.explicitOriginalTarget:null}function ms(_,o){_.emitter.on("change",u=>{o(u.rawValue)}),o(_.rawValue)}function Hn(_,o,u){ms(_.value(o),u)}const lb="tp";function dr(_){return(u,v)=>[lb,"-",_,"v",u?`_${u}`:"",v?`-${v}`:""].join("")}const Pc=dr("lbl");function cb(_,o){const u=_.createDocumentFragment();return o.split(`
`).map(P=>_.createTextNode(P)).forEach((P,k)=>{k>0&&u.appendChild(_.createElement("br")),u.appendChild(P)}),u}class P_{constructor(o,u){this.element=o.createElement("div"),this.element.classList.add(Pc()),u.viewProps.bindClassModifiers(this.element);const v=o.createElement("div");v.classList.add(Pc("l")),Hn(u.props,"label",k=>{zr(k)?this.element.classList.add(Pc(void 0,"nol")):(this.element.classList.remove(Pc(void 0,"nol")),ab(v),v.appendChild(cb(o,k)))}),this.element.appendChild(v),this.labelElement=v;const P=o.createElement("div");P.classList.add(Pc("v")),this.element.appendChild(P),this.valueElement=P}}class T_{constructor(o,u){this.props=u.props,this.valueController=u.valueController,this.viewProps=u.valueController.viewProps,this.view=new P_(o,{props:u.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(o){return on(o,null,u=>({label:u.optional.string}),u=>(this.props.set("label",u.label),!0))}exportProps(){return an(null,{label:this.props.get("label")})}}function hb(){return["veryfirst","first","last","verylast"]}const Sm=dr(""),Em={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class xu{constructor(o){this.parent_=null,this.blade=o.blade,this.view=o.view,this.viewProps=o.viewProps;const u=this.view.element;this.blade.value("positions").emitter.on("change",()=>{hb().forEach(v=>{u.classList.remove(Sm(void 0,Em[v]))}),this.blade.get("positions").forEach(v=>{u.classList.add(Sm(void 0,Em[v]))})}),this.viewProps.handleDispose(()=>{fp(u)})}get parent(){return this.parent_}set parent(o){this.parent_=o,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(o){return on(o,null,u=>({disabled:u.required.boolean,hidden:u.required.boolean}),u=>(this.viewProps.importState(u),!0))}exportState(){return an(null,Object.assign({},this.viewProps.exportState()))}}class Qo extends xu{constructor(o,u){if(u.value!==u.valueController.value)throw qr.shouldNeverHappen();const v=u.valueController.viewProps,P=new T_(o,{blade:u.blade,props:u.props,valueController:u.valueController});super(Object.assign(Object.assign({},u),{view:new P_(o,{props:u.props,viewProps:v}),viewProps:v})),this.labelController=P,this.value=u.value,this.valueController=u.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}importState(o){return on(o,u=>{var v,P,k;return super.importState(u)&&this.labelController.importProps(u)&&((k=(P=(v=this.valueController).importProps)===null||P===void 0?void 0:P.call(v,o))!==null&&k!==void 0?k:!0)},u=>({value:u.optional.raw}),u=>(u.value&&(this.value.rawValue=u.value),!0))}exportState(){var o,u,v;return an(()=>super.exportState(),Object.assign(Object.assign({value:this.value.rawValue},this.labelController.exportProps()),(v=(u=(o=this.valueController).exportProps)===null||u===void 0?void 0:u.call(o))!==null&&v!==void 0?v:{}))}}function km(_){const o=Object.assign({},_);return delete o.value,o}class S_ extends Qo{constructor(o,u){super(o,u),this.tag=u.tag}importState(o){return on(o,u=>super.importState(km(o)),u=>({tag:u.optional.string}),u=>(this.tag=u.tag,!0))}exportState(){return an(()=>km(super.exportState()),{binding:{key:this.value.binding.target.key,value:this.value.binding.target.read()},tag:this.tag})}}function ub(_){return Yo(_)&&b_(_.value)}class db extends S_{importState(o){return on(o,u=>super.importState(u),u=>({binding:u.required.object({value:u.required.raw})}),u=>(this.value.binding.inject(u.binding.value),this.value.fetch(),!0))}}function pb(_){return Yo(_)&&Jv(_.value)}function E_(_,o){for(;_.length<o;)_.push(void 0)}function fb(_){const o=[];return E_(o,_),o}function mb(_){const o=_.indexOf(void 0);return o<0?_:_.slice(0,o)}function _b(_,o){const u=[...mb(_),o];return u.length>_.length?u.splice(0,u.length-_.length):E_(u,_.length),u}class gb{constructor(o){this.emitter=new oi,this.onTick_=this.onTick_.bind(this),this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=o.binding,this.value_=Or(fb(o.bufferSize)),this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.ticker=o.ticker,this.ticker.emitter.on("tick",this.onTick_),this.fetch()}get rawValue(){return this.value_.rawValue}set rawValue(o){this.value_.rawValue=o}setRawValue(o,u){this.value_.setRawValue(o,u)}fetch(){this.value_.rawValue=_b(this.value_.rawValue,this.binding.read())}onTick_(){this.fetch()}onValueBeforeChange_(o){this.emitter.emit("beforechange",Object.assign(Object.assign({},o),{sender:this}))}onValueChange_(o){this.emitter.emit("change",Object.assign(Object.assign({},o),{sender:this}))}}function yb(_){if(!("binding"in _))return!1;const o=_.binding;return cp(o)&&"read"in o&&!("write"in o)}class vb extends S_{exportState(){return an(()=>super.exportState(),{binding:{readonly:!0}})}}function bb(_){return Yo(_)&&yb(_.value)}class xb extends ra{get label(){return this.controller.labelController.props.get("label")}set label(o){this.controller.labelController.props.set("label",o)}get title(){var o;return(o=this.controller.buttonController.props.get("title"))!==null&&o!==void 0?o:""}set title(o){this.controller.buttonController.props.set("title",o)}on(o,u){const v=u.bind(this);return this.controller.buttonController.emitter.on(o,k=>{v(new Kv(this,k.nativeEvent))}),this}off(o,u){return this.controller.buttonController.emitter.off(o,u),this}}function wb(_,o,u){u?_.classList.add(o):_.classList.remove(o)}function ll(_,o){return u=>{wb(_,o,u)}}function mp(_,o){ms(_,u=>{o.textContent=u??""})}const Nd=dr("btn");class Cb{constructor(o,u){this.element=o.createElement("div"),this.element.classList.add(Nd()),u.viewProps.bindClassModifiers(this.element);const v=o.createElement("button");v.classList.add(Nd("b")),u.viewProps.bindDisabled(v),this.element.appendChild(v),this.buttonElement=v;const P=o.createElement("div");P.classList.add(Nd("t")),mp(u.props.value("title"),P),this.buttonElement.appendChild(P)}}class Pb{constructor(o,u){this.emitter=new oi,this.onClick_=this.onClick_.bind(this),this.props=u.props,this.viewProps=u.viewProps,this.view=new Cb(o,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(o){return on(o,null,u=>({title:u.optional.string}),u=>(this.props.set("title",u.title),!0))}exportProps(){return an(null,{title:this.props.get("title")})}onClick_(o){this.emitter.emit("click",{nativeEvent:o,sender:this})}}class Mm extends xu{constructor(o,u){const v=new Pb(o,{props:u.buttonProps,viewProps:u.viewProps}),P=new T_(o,{blade:u.blade,props:u.labelProps,valueController:v});super({blade:u.blade,view:P.view,viewProps:u.viewProps}),this.buttonController=v,this.labelController=P}importState(o){return on(o,u=>super.importState(u)&&this.buttonController.importProps(u)&&this.labelController.importProps(u),()=>({}),()=>!0)}exportState(){return an(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}}class k_{constructor(o){const[u,v]=o.split("-"),P=u.split(".");this.major=parseInt(P[0],10),this.minor=parseInt(P[1],10),this.patch=parseInt(P[2],10),this.prerelease=v??null}toString(){const o=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[o,this.prerelease].join("-"):o}}const cl=new k_("2.0.5");function Ni(_){return Object.assign({core:cl},_)}const Tb=Ni({id:"button",type:"blade",accept(_){const o=Nr(_,u=>({title:u.required.string,view:u.required.constant("button"),label:u.optional.string}));return o?{params:o}:null},controller(_){return new Mm(_.document,{blade:_.blade,buttonProps:sr.fromObject({title:_.params.title}),labelProps:sr.fromObject({label:_.params.label}),viewProps:_.viewProps})},api(_){return _.controller instanceof Mm?new xb(_.controller):null}});function Sb(_,o){return _.addBlade(Object.assign(Object.assign({},o),{view:"button"}))}function Eb(_,o){return _.addBlade(Object.assign(Object.assign({},o),{view:"folder"}))}function kb(_,o){return _.addBlade(Object.assign(Object.assign({},o),{view:"tab"}))}function Mb(_){return lp(_)?"refresh"in _&&typeof _.refresh=="function":!1}function Ib(_,o){if(!fu.isBindable(_))throw qr.notBindable();return new fu(_,o)}class Ab{constructor(o,u){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=o,this.emitter_=new oi,this.pool_=u,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(o=>this.pool_.createApi(o))}addBinding(o,u,v){const P=v??{},k=this.controller_.element.ownerDocument,w=this.pool_.createBinding(k,Ib(o,u),P),a=this.pool_.createBindingApi(w);return this.add(a,P.index)}addFolder(o){return Eb(this,o)}addButton(o){return Sb(this,o)}addTab(o){return kb(this,o)}add(o,u){const v=o.controller;return this.controller_.rack.add(v,u),o}remove(o){this.controller_.rack.remove(o.controller)}addBlade(o){const u=this.controller_.element.ownerDocument,v=this.pool_.createBlade(u,o),P=this.pool_.createApi(v);return this.add(P,o.index)}on(o,u){const v=u.bind(this);return this.emitter_.on(o,P=>{v(P)},{key:u}),this}off(o,u){return this.emitter_.off(o,u),this}refresh(){this.children.forEach(o=>{Mb(o)&&o.refresh()})}onRackValueChange_(o){const u=o.bladeController,v=this.pool_.createApi(u),P=b_(u.value)?u.value.binding:null;this.emitter_.emit("change",new Bc(v,P?P.target.read():u.value.rawValue,o.options.last))}}class _p extends ra{constructor(o,u){super(o),this.rackApi_=new Ab(o.rackController,u)}refresh(){this.rackApi_.refresh()}}class gp extends xu{constructor(o){super({blade:o.blade,view:o.view,viewProps:o.rackController.viewProps}),this.rackController=o.rackController}importState(o){return on(o,u=>super.importState(u),u=>({children:u.required.array(u.required.raw)}),u=>this.rackController.rack.children.every((v,P)=>v.importState(u.children[P])))}exportState(){return an(()=>super.exportState(),{children:this.rackController.rack.children.map(o=>o.exportState())})}}function rp(_){return"rackController"in _}class zb{constructor(o){this.emitter=new oi,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=o}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(o){for(const u of this.allItems())if(o(u))return u;return null}includes(o){return this.cache_.has(o)}add(o,u){if(this.includes(o))throw qr.shouldNeverHappen();const v=u!==void 0?u:this.items_.length;this.items_.splice(v,0,o),this.cache_.add(o);const P=this.extract_(o);P&&(P.emitter.on("add",this.onSubListAdd_),P.emitter.on("remove",this.onSubListRemove_),P.allItems().forEach(k=>{this.cache_.add(k)})),this.emitter.emit("add",{index:v,item:o,root:this,target:this})}remove(o){const u=this.items_.indexOf(o);if(u<0)return;this.items_.splice(u,1),this.cache_.delete(o);const v=this.extract_(o);v&&(v.allItems().forEach(P=>{this.cache_.delete(P)}),v.emitter.off("add",this.onSubListAdd_),v.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:u,item:o,root:this,target:this})}onSubListAdd_(o){this.cache_.add(o.item),this.emitter.emit("add",{index:o.index,item:o.item,root:this,target:o.target})}onSubListRemove_(o){this.cache_.delete(o.item),this.emitter.emit("remove",{index:o.index,item:o.item,root:this,target:o.target})}}function Db(_,o){for(let u=0;u<_.length;u++){const v=_[u];if(Yo(v)&&v.value===o)return v}return null}function Rb(_){return rp(_)?_.rackController.rack.bcSet_:null}class Lb{constructor(o){var u,v;this.emitter=new oi,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=(u=o.blade)!==null&&u!==void 0?u:null,(v=this.blade_)===null||v===void 0||v.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=o.viewProps,this.bcSet_=new zb(Rb),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(o,u){var v;(v=o.parent)===null||v===void 0||v.remove(o),o.parent=this,this.bcSet_.add(o,u)}remove(o){o.parent=null,this.bcSet_.remove(o)}find(o){return this.bcSet_.allItems().filter(o)}onSetAdd_(o){this.updatePositions_();const u=o.target===o.root;if(this.emitter.emit("add",{bladeController:o.item,index:o.index,root:u,sender:this}),!u)return;const v=o.item;if(v.viewProps.emitter.on("change",this.onChildViewPropsChange_),v.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),v.viewProps.handleDispose(this.onChildDispose_),Yo(v))v.value.emitter.on("change",this.onChildValueChange_);else if(rp(v)){const P=v.rackController.rack;if(P){const k=P.emitter;k.on("layout",this.onRackLayout_),k.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(o){this.updatePositions_();const u=o.target===o.root;if(this.emitter.emit("remove",{bladeController:o.item,root:u,sender:this}),!u)return;const v=o.item;if(Yo(v))v.value.emitter.off("change",this.onChildValueChange_);else if(rp(v)){const P=v.rackController.rack;if(P){const k=P.emitter;k.off("layout",this.onRackLayout_),k.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const o=this.bcSet_.items.filter(P=>!P.viewProps.get("hidden")),u=o[0],v=o[o.length-1];this.bcSet_.items.forEach(P=>{const k=[];P===u&&(k.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&k.push("veryfirst")),P===v&&(k.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&k.push("verylast")),P.blade.set("positions",k)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(o){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(u=>u.viewProps.get("disposed")).forEach(u=>{this.bcSet_.remove(u)})}onChildValueChange_(o){const u=Db(this.find(Yo),o.sender);if(!u)throw qr.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:u,options:o.options,sender:this})}onRackLayout_(o){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(o){this.emitter.emit("valuechange",{bladeController:o.bladeController,options:o.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class yp{constructor(o){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=o.element,this.viewProps=o.viewProps;const u=new Lb({blade:o.root?void 0:o.blade,viewProps:o.viewProps});u.emitter.on("add",this.onRackAdd_),u.emitter.on("remove",this.onRackRemove_),this.rack=u,this.viewProps.handleDispose(()=>{for(let v=this.rack.children.length-1;v>=0;v--)this.rack.children[v].viewProps.set("disposed",!0)})}onRackAdd_(o){o.root&&x_(this.element,o.bladeController.view.element,o.index)}onRackRemove_(o){o.root&&fp(o.bladeController.view.element)}}function hl(){return new sr({positions:Or([],{equals:dv})})}class Oc extends sr{constructor(o){super(o)}static create(o){const u={completed:!0,expanded:o,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},v=sr.createCore(u);return new Oc(v)}get styleExpanded(){var o;return(o=this.get("temporaryExpanded"))!==null&&o!==void 0?o:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const o=this.get("expandedHeight");return this.get("shouldFixHeight")&&!zr(o)?`${o}px`:"auto"}bindExpandedClass(o,u){const v=()=>{this.styleExpanded?o.classList.add(u):o.classList.remove(u)};Hn(this,"expanded",v),Hn(this,"temporaryExpanded",v)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function Fb(_,o){let u=0;return rb(o,()=>{_.set("expandedHeight",null),_.set("temporaryExpanded",!0),mu(o),u=o.clientHeight,_.set("temporaryExpanded",null),mu(o)}),u}function Im(_,o){o.style.height=_.styleHeight}function vp(_,o){_.value("expanded").emitter.on("beforechange",()=>{if(_.set("completed",!1),zr(_.get("expandedHeight"))){const u=Fb(_,o);u>0&&_.set("expandedHeight",u)}_.set("shouldFixHeight",!0),mu(o)}),_.emitter.on("change",()=>{Im(_,o)}),Im(_,o),o.addEventListener("transitionend",u=>{u.propertyName==="height"&&_.cleanUpTransition()})}class M_ extends _p{constructor(o,u){super(o,u),this.emitter_=new oi,this.controller.foldable.value("expanded").emitter.on("change",v=>{this.emitter_.emit("fold",new Hv(this,v.sender.rawValue))}),this.rackApi_.on("change",v=>{this.emitter_.emit("change",v)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(o){this.controller.foldable.set("expanded",o)}get title(){return this.controller.props.get("title")}set title(o){this.controller.props.set("title",o)}get children(){return this.rackApi_.children}addBinding(o,u,v){return this.rackApi_.addBinding(o,u,v)}addFolder(o){return this.rackApi_.addFolder(o)}addButton(o){return this.rackApi_.addButton(o)}addTab(o){return this.rackApi_.addTab(o)}add(o,u){return this.rackApi_.add(o,u)}remove(o){this.rackApi_.remove(o)}addBlade(o){return this.rackApi_.addBlade(o)}on(o,u){const v=u.bind(this);return this.emitter_.on(o,P=>{v(P)},{key:u}),this}off(o,u){return this.emitter_.off(o,u),this}}const I_=dr("cnt");class Bb{constructor(o,u){var v;this.className_=dr((v=u.viewName)!==null&&v!==void 0?v:"fld"),this.element=o.createElement("div"),this.element.classList.add(this.className_(),I_()),u.viewProps.bindClassModifiers(this.element),this.foldable_=u.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),Hn(this.foldable_,"completed",ll(this.element,this.className_(void 0,"cpl")));const P=o.createElement("button");P.classList.add(this.className_("b")),Hn(u.props,"title",K=>{zr(K)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),u.viewProps.bindDisabled(P),this.element.appendChild(P),this.buttonElement=P;const k=o.createElement("div");k.classList.add(this.className_("i")),this.element.appendChild(k);const w=o.createElement("div");w.classList.add(this.className_("t")),mp(u.props.value("title"),w),this.buttonElement.appendChild(w),this.titleElement=w;const a=o.createElement("div");a.classList.add(this.className_("m")),this.buttonElement.appendChild(a);const $=o.createElement("div");$.classList.add(this.className_("c")),this.element.appendChild($),this.containerElement=$}}class ip extends gp{constructor(o,u){var v;const P=Oc.create((v=u.expanded)!==null&&v!==void 0?v:!0),k=new Bb(o,{foldable:P,props:u.props,viewName:u.root?"rot":void 0,viewProps:u.viewProps});super(Object.assign(Object.assign({},u),{rackController:new yp({blade:u.blade,element:k.containerElement,root:u.root,viewProps:u.viewProps}),view:k})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=u.props,this.foldable=P,vp(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(o){return on(o,u=>super.importState(u),u=>({expanded:u.required.boolean,title:u.optional.string}),u=>(this.foldable.set("expanded",u.expanded),this.props.set("title",u.title),!0))}exportState(){return an(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const Ob=Ni({id:"folder",type:"blade",accept(_){const o=Nr(_,u=>({title:u.required.string,view:u.required.constant("folder"),expanded:u.optional.boolean}));return o?{params:o}:null},controller(_){return new ip(_.document,{blade:_.blade,expanded:_.params.expanded,props:sr.fromObject({title:_.params.title}),viewProps:_.viewProps})},api(_){return _.controller instanceof ip?new M_(_.controller,_.pool):null}}),jb=dr("");function Am(_,o){return ll(_,jb(void 0,o))}class ys extends sr{constructor(o){var u;super(o),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=gv(Or(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(u=this.get("parent"))===null||u===void 0||u.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(o){var u,v,P;const k=o??{};return new ys(sr.createCore({disabled:(u=k.disabled)!==null&&u!==void 0?u:!1,disposed:!1,hidden:(v=k.hidden)!==null&&v!==void 0?v:!1,parent:(P=k.parent)!==null&&P!==void 0?P:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(o){ms(this.globalDisabled_,Am(o,"disabled")),Hn(this,"hidden",Am(o,"hidden"))}bindDisabled(o){ms(this.globalDisabled_,u=>{o.disabled=u})}bindTabIndex(o){ms(this.globalDisabled_,u=>{o.tabIndex=u?-1:0})}handleDispose(o){this.value("disposed").emitter.on("change",u=>{u&&o()})}importState(o){this.set("disabled",o.disabled),this.set("hidden",o.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const o=this.get("parent");return(o?o.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(o){var u;const v=o.previousRawValue;v==null||v.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(u=this.get("parent"))===null||u===void 0||u.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}const zm=dr("tbp");class Vb{constructor(o,u){this.element=o.createElement("div"),this.element.classList.add(zm()),u.viewProps.bindClassModifiers(this.element);const v=o.createElement("div");v.classList.add(zm("c")),this.element.appendChild(v),this.containerElement=v}}const Tc=dr("tbi");class Nb{constructor(o,u){this.element=o.createElement("div"),this.element.classList.add(Tc()),u.viewProps.bindClassModifiers(this.element),Hn(u.props,"selected",k=>{k?this.element.classList.add(Tc(void 0,"sel")):this.element.classList.remove(Tc(void 0,"sel"))});const v=o.createElement("button");v.classList.add(Tc("b")),u.viewProps.bindDisabled(v),this.element.appendChild(v),this.buttonElement=v;const P=o.createElement("div");P.classList.add(Tc("t")),mp(u.props.value("title"),P),this.buttonElement.appendChild(P),this.titleElement=P}}class Ub{constructor(o,u){this.emitter=new oi,this.onClick_=this.onClick_.bind(this),this.props=u.props,this.viewProps=u.viewProps,this.view=new Nb(o,{props:u.props,viewProps:u.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class np extends gp{constructor(o,u){const v=new Vb(o,{viewProps:u.viewProps});super(Object.assign(Object.assign({},u),{rackController:new yp({blade:u.blade,element:v.containerElement,viewProps:u.viewProps}),view:v})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new Ub(o,{props:u.itemProps,viewProps:ys.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=u.props,Hn(this.props,"selected",P=>{this.itemController.props.set("selected",P),this.viewProps.set("hidden",!P)})}get itemController(){return this.ic_}importState(o){return on(o,u=>super.importState(u),u=>({selected:u.required.boolean,title:u.required.string}),u=>(this.ic_.props.set("selected",u.selected),this.ic_.props.set("title",u.title),!0))}exportState(){return an(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}}class $b extends _p{constructor(o,u){super(o,u),this.emitter_=new oi,this.onSelect_=this.onSelect_.bind(this),this.pool_=u,this.rackApi_.on("change",v=>{this.emitter_.emit("change",v)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(o){const u=this.controller.view.element.ownerDocument,v=new np(u,{blade:hl(),itemProps:sr.fromObject({selected:!1,title:o.title}),props:sr.fromObject({selected:!1}),viewProps:ys.create()}),P=this.pool_.createApi(v);return this.rackApi_.add(P,o.index)}removePage(o){this.rackApi_.remove(this.rackApi_.children[o])}on(o,u){const v=u.bind(this);return this.emitter_.on(o,P=>{v(P)},{key:u}),this}off(o,u){return this.emitter_.off(o,u),this}onSelect_(o){this.emitter_.emit("select",new Xv(this,o.rawValue))}}class Zb extends _p{get title(){var o;return(o=this.controller.itemController.props.get("title"))!==null&&o!==void 0?o:""}set title(o){this.controller.itemController.props.set("title",o)}get selected(){return this.controller.props.get("selected")}set selected(o){this.controller.props.set("selected",o)}get children(){return this.rackApi_.children}addButton(o){return this.rackApi_.addButton(o)}addFolder(o){return this.rackApi_.addFolder(o)}addTab(o){return this.rackApi_.addTab(o)}add(o,u){this.rackApi_.add(o,u)}remove(o){this.rackApi_.remove(o)}addBinding(o,u,v){return this.rackApi_.addBinding(o,u,v)}addBlade(o){return this.rackApi_.addBlade(o)}}const Dm=-1;class Gb{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=Or(!0),this.selectedIndex=Or(Dm),this.items_=[]}add(o,u){const v=u??this.items_.length;this.items_.splice(v,0,o),o.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(o){const u=this.items_.indexOf(o);u<0||(this.items_.splice(u,1),o.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=Dm,this.empty.rawValue=!0;return}const o=this.items_.findIndex(u=>u.rawValue);o<0?(this.items_.forEach((u,v)=>{u.rawValue=v===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((u,v)=>{u.rawValue=v===o}),this.selectedIndex.rawValue=o),this.empty.rawValue=!1}onItemSelectedChange_(o){if(o.rawValue){const u=this.items_.findIndex(v=>v===o.sender);this.items_.forEach((v,P)=>{v.rawValue=P===u}),this.selectedIndex.rawValue=u}else this.keepSelection_()}}const Sc=dr("tab");class qb{constructor(o,u){this.element=o.createElement("div"),this.element.classList.add(Sc(),I_()),u.viewProps.bindClassModifiers(this.element),ms(u.empty,ll(this.element,Sc(void 0,"nop")));const v=o.createElement("div");v.classList.add(Sc("t")),this.element.appendChild(v),this.itemsElement=v;const P=o.createElement("div");P.classList.add(Sc("i")),this.element.appendChild(P);const k=o.createElement("div");k.classList.add(Sc("c")),this.element.appendChild(k),this.contentsElement=k}}class Rm extends gp{constructor(o,u){const v=new Gb,P=new qb(o,{empty:v.empty,viewProps:u.viewProps});super({blade:u.blade,rackController:new yp({blade:u.blade,element:P.contentsElement,viewProps:u.viewProps}),view:P}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const k=this.rackController.rack;k.emitter.on("add",this.onRackAdd_),k.emitter.on("remove",this.onRackRemove_),this.tab=v}add(o,u){this.rackController.rack.add(o,u)}remove(o){this.rackController.rack.remove(this.rackController.rack.children[o])}onRackAdd_(o){if(!o.root)return;const u=o.bladeController;x_(this.view.itemsElement,u.itemController.view.element,o.index),u.itemController.viewProps.set("parent",this.viewProps),this.tab.add(u.props.value("selected"))}onRackRemove_(o){if(!o.root)return;const u=o.bladeController;fp(u.itemController.view.element),u.itemController.viewProps.set("parent",null),this.tab.remove(u.props.value("selected"))}}const A_=Ni({id:"tab",type:"blade",accept(_){const o=Nr(_,u=>({pages:u.required.array(u.required.object({title:u.required.string})),view:u.required.constant("tab")}));return!o||o.pages.length===0?null:{params:o}},controller(_){const o=new Rm(_.document,{blade:_.blade,viewProps:_.viewProps});return _.params.pages.forEach(u=>{const v=new np(_.document,{blade:hl(),itemProps:sr.fromObject({selected:!1,title:u.title}),props:sr.fromObject({selected:!1}),viewProps:ys.create()});o.add(v)}),o},api(_){return _.controller instanceof Rm?new $b(_.controller,_.pool):_.controller instanceof np?new Zb(_.controller,_.pool):null}});function Wb(_,o){const u=_.accept(o.params);if(!u)return null;const v=Nr(o.params,P=>({disabled:P.optional.boolean,hidden:P.optional.boolean}));return _.controller({blade:hl(),document:o.document,params:Object.assign(Object.assign({},u.params),{disabled:v==null?void 0:v.disabled,hidden:v==null?void 0:v.hidden}),viewProps:ys.create({disabled:v==null?void 0:v.disabled,hidden:v==null?void 0:v.hidden})})}class bp extends zc{get options(){return this.controller.valueController.props.get("options")}set options(o){this.controller.valueController.props.set("options",o)}}class Hb{constructor(){this.disabled=!1,this.emitter=new oi}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class Xb{constructor(o,u){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=o,this.emitter=new oi,this.interval_=u,this.setTimer_()}get disabled(){return this.disabled_}set disabled(o){this.disabled_=o,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const o=this.doc_.defaultView;o&&o.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const o=this.doc_.defaultView;o&&(this.timerId_=o.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class jc{constructor(o){this.constraints=o}constrain(o){return this.constraints.reduce((u,v)=>v.constrain(u),o)}}function _u(_,o){if(_ instanceof o)return _;if(_ instanceof jc){const u=_.constraints.reduce((v,P)=>v||(P instanceof o?P:null),null);if(u)return u}return null}class Vc{constructor(o){this.values=sr.fromObject({options:o})}constrain(o){const u=this.values.get("options");return u.length===0||u.filter(P=>P.value===o).length>0?o:u[0].value}}function Nc(_){var o;const u=tp;if(Array.isArray(_))return(o=Nr({items:_},v=>({items:v.required.array(v.required.object({text:v.required.string,value:v.required.raw}))})))===null||o===void 0?void 0:o.items;if(typeof _=="object")return u.required.raw(_).value}function xp(_){if(Array.isArray(_))return _;const o=[];return Object.keys(_).forEach(u=>{o.push({text:u,value:_[u]})}),o}function wp(_){return zr(_)?null:new Vc(xp(_))}const Ud=dr("lst");class Kb{constructor(o,u){this.onValueChange_=this.onValueChange_.bind(this),this.props_=u.props,this.element=o.createElement("div"),this.element.classList.add(Ud()),u.viewProps.bindClassModifiers(this.element);const v=o.createElement("select");v.classList.add(Ud("s")),u.viewProps.bindDisabled(v),this.element.appendChild(v),this.selectElement=v;const P=o.createElement("div");P.classList.add(Ud("m")),P.appendChild(bu(o,"dropdown")),this.element.appendChild(P),u.value.emitter.on("change",this.onValueChange_),this.value_=u.value,Hn(this.props_,"options",k=>{w_(this.selectElement),k.forEach(w=>{const a=o.createElement("option");a.textContent=w.text,this.selectElement.appendChild(a)}),this.update_()})}update_(){const o=this.props_.get("options").map(u=>u.value);this.selectElement.selectedIndex=o.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}}class io{constructor(o,u){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=u.props,this.value=u.value,this.viewProps=u.viewProps,this.view=new Kb(o,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(o){const u=o.currentTarget;this.value.rawValue=this.props.get("options")[u.selectedIndex].value}importProps(o){return on(o,null,u=>({options:u.required.custom(Nc)}),u=>(this.props.set("options",xp(u.options)),!0))}exportProps(){return an(null,{options:this.props.get("options")})}}const Lm=dr("pop");class Yb{constructor(o,u){this.element=o.createElement("div"),this.element.classList.add(Lm()),u.viewProps.bindClassModifiers(this.element),ms(u.shows,ll(this.element,Lm(void 0,"v")))}}class z_{constructor(o,u){this.shows=Or(!1),this.viewProps=u.viewProps,this.view=new Yb(o,{shows:this.shows,viewProps:this.viewProps})}}const Fm=dr("txt");class Jb{constructor(o,u){this.onChange_=this.onChange_.bind(this),this.element=o.createElement("div"),this.element.classList.add(Fm()),u.viewProps.bindClassModifiers(this.element),this.props_=u.props,this.props_.emitter.on("change",this.onChange_);const v=o.createElement("input");v.classList.add(Fm("i")),v.type="text",u.viewProps.bindDisabled(v),this.element.appendChild(v),this.inputElement=v,u.value.emitter.on("change",this.onChange_),this.value_=u.value,this.refresh()}refresh(){const o=this.props_.get("formatter");this.inputElement.value=o(this.value_.rawValue)}onChange_(){this.refresh()}}class Dc{constructor(o,u){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=u.parser,this.props=u.props,this.value=u.value,this.viewProps=u.viewProps,this.view=new Jb(o,{props:u.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(o){const v=o.currentTarget.value,P=this.parser_(v);zr(P)||(this.value.rawValue=P),this.view.refresh()}}function Qb(_){return String(_)}function D_(_){return _==="false"?!1:!!_}function Bm(_){return Qb(_)}function e0(_){return o=>_.reduce((u,v)=>u!==null?u:v(o),null)}const t0=Hi(0);function gu(_){return t0(_)+"%"}function R_(_){return String(_)}function sp(_){return _}function ul({primary:_,secondary:o,forward:u,backward:v}){let P=!1;function k(w){P||(P=!0,w(),P=!1)}_.emitter.on("change",w=>{k(()=>{o.setRawValue(u(_.rawValue,o.rawValue),w.options)})}),o.emitter.on("change",w=>{k(()=>{_.setRawValue(v(_.rawValue,o.rawValue),w.options)}),k(()=>{o.setRawValue(u(_.rawValue,o.rawValue),w.options)})}),k(()=>{o.setRawValue(u(_.rawValue,o.rawValue),{forceEmit:!1,last:!0})})}function Wi(_,o){const u=_*(o.altKey?.1:1)*(o.shiftKey?10:1);return o.upKey?+u:o.downKey?-u:0}function Rc(_){return{altKey:_.altKey,downKey:_.key==="ArrowDown",shiftKey:_.shiftKey,upKey:_.key==="ArrowUp"}}function gs(_){return{altKey:_.altKey,downKey:_.key==="ArrowLeft",shiftKey:_.shiftKey,upKey:_.key==="ArrowRight"}}function r0(_){return _==="ArrowUp"||_==="ArrowDown"}function L_(_){return r0(_)||_==="ArrowLeft"||_==="ArrowRight"}function $d(_,o){var u,v;const P=o.ownerDocument.defaultView,k=o.getBoundingClientRect();return{x:_.pageX-(((u=P&&P.scrollX)!==null&&u!==void 0?u:0)+k.left),y:_.pageY-(((v=P&&P.scrollY)!==null&&v!==void 0?v:0)+k.top)}}class ia{constructor(o){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=o,this.emitter=new oi,o.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),o.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),o.addEventListener("touchend",this.onTouchEnd_),o.addEventListener("mousedown",this.onMouseDown_)}computePosition_(o){const u=this.elem_.getBoundingClientRect();return{bounds:{width:u.width,height:u.height},point:o?{x:o.x,y:o.y}:null}}onMouseDown_(o){var u;o.preventDefault(),(u=o.currentTarget)===null||u===void 0||u.focus();const v=this.elem_.ownerDocument;v.addEventListener("mousemove",this.onDocumentMouseMove_),v.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:o.altKey,data:this.computePosition_($d(o,this.elem_)),sender:this,shiftKey:o.shiftKey})}onDocumentMouseMove_(o){this.emitter.emit("move",{altKey:o.altKey,data:this.computePosition_($d(o,this.elem_)),sender:this,shiftKey:o.shiftKey})}onDocumentMouseUp_(o){const u=this.elem_.ownerDocument;u.removeEventListener("mousemove",this.onDocumentMouseMove_),u.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:o.altKey,data:this.computePosition_($d(o,this.elem_)),sender:this,shiftKey:o.shiftKey})}onTouchStart_(o){o.preventDefault();const u=o.targetTouches.item(0),v=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:o.altKey,data:this.computePosition_(u?{x:u.clientX-v.left,y:u.clientY-v.top}:void 0),sender:this,shiftKey:o.shiftKey}),this.lastTouch_=u}onTouchMove_(o){const u=o.targetTouches.item(0),v=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:o.altKey,data:this.computePosition_(u?{x:u.clientX-v.left,y:u.clientY-v.top}:void 0),sender:this,shiftKey:o.shiftKey}),this.lastTouch_=u}onTouchEnd_(o){var u;const v=(u=o.targetTouches.item(0))!==null&&u!==void 0?u:this.lastTouch_,P=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:o.altKey,data:this.computePosition_(v?{x:v.clientX-P.left,y:v.clientY-P.top}:void 0),sender:this,shiftKey:o.shiftKey})}}const _n=dr("txt");class i0{constructor(o,u){this.onChange_=this.onChange_.bind(this),this.props_=u.props,this.props_.emitter.on("change",this.onChange_),this.element=o.createElement("div"),this.element.classList.add(_n(),_n(void 0,"num")),u.arrayPosition&&this.element.classList.add(_n(void 0,u.arrayPosition)),u.viewProps.bindClassModifiers(this.element);const v=o.createElement("input");v.classList.add(_n("i")),v.type="text",u.viewProps.bindDisabled(v),this.element.appendChild(v),this.inputElement=v,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=u.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(_n()),this.inputElement.classList.add(_n("i"));const P=o.createElement("div");P.classList.add(_n("k")),this.element.appendChild(P),this.knobElement=P;const k=o.createElementNS(Wn,"svg");k.classList.add(_n("g")),this.knobElement.appendChild(k);const w=o.createElementNS(Wn,"path");w.classList.add(_n("gb")),k.appendChild(w),this.guideBodyElem_=w;const a=o.createElementNS(Wn,"path");a.classList.add(_n("gh")),k.appendChild(a),this.guideHeadElem_=a;const $=o.createElement("div");$.classList.add(dr("tt")()),this.knobElement.appendChild($),this.tooltipElem_=$,u.value.emitter.on("change",this.onChange_),this.value=u.value,this.refresh()}onDraggingChange_(o){if(o.rawValue===null){this.element.classList.remove(_n(void 0,"drg"));return}this.element.classList.add(_n(void 0,"drg"));const u=o.rawValue/this.props_.get("pointerScale"),v=u+(u>0?-1:u<0?1:0),P=mi(-v,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${v+P},0 L${v},4 L${v+P},8`,`M ${u},-1 L${u},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${u},4`);const k=this.props_.get("formatter");this.tooltipElem_.textContent=k(this.value.rawValue),this.tooltipElem_.style.left=`${u}px`}refresh(){const o=this.props_.get("formatter");this.inputElement.value=o(this.value.rawValue)}onChange_(){this.refresh()}}class Uc{constructor(o,u){var v;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=u.parser,this.props=u.props,this.sliderProps_=(v=u.sliderProps)!==null&&v!==void 0?v:null,this.value=u.value,this.viewProps=u.viewProps,this.dragging_=Or(null),this.view=new i0(o,{arrayPosition:u.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const P=new ia(this.view.knobElement);P.emitter.on("down",this.onPointerDown_),P.emitter.on("move",this.onPointerMove_),P.emitter.on("up",this.onPointerUp_)}constrainValue_(o){var u,v;const P=(u=this.sliderProps_)===null||u===void 0?void 0:u.get("min"),k=(v=this.sliderProps_)===null||v===void 0?void 0:v.get("max");let w=o;return P!==void 0&&(w=Math.max(w,P)),k!==void 0&&(w=Math.min(w,k)),w}onInputChange_(o){const v=o.currentTarget.value,P=this.parser_(v);zr(P)||(this.value.rawValue=this.constrainValue_(P)),this.view.refresh()}onInputKeyDown_(o){const u=Wi(this.props.get("keyScale"),Rc(o));u!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+u),{forceEmit:!1,last:!1})}onInputKeyUp_(o){Wi(this.props.get("keyScale"),Rc(o))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(o){if(!o.point)return null;const u=o.point.x-o.bounds.width/2;return this.constrainValue_(this.originRawValue_+u*this.props.get("pointerScale"))}onPointerMove_(o){const u=this.computeDraggingValue_(o.data);u!==null&&(this.value.setRawValue(u,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(o){const u=this.computeDraggingValue_(o.data);u!==null&&(this.value.setRawValue(u,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const Zd=dr("sld");class n0{constructor(o,u){this.onChange_=this.onChange_.bind(this),this.props_=u.props,this.props_.emitter.on("change",this.onChange_),this.element=o.createElement("div"),this.element.classList.add(Zd()),u.viewProps.bindClassModifiers(this.element);const v=o.createElement("div");v.classList.add(Zd("t")),u.viewProps.bindTabIndex(v),this.element.appendChild(v),this.trackElement=v;const P=o.createElement("div");P.classList.add(Zd("k")),this.trackElement.appendChild(P),this.knobElement=P,u.value.emitter.on("change",this.onChange_),this.value=u.value,this.update_()}update_(){const o=mi(vr(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${o}%`}onChange_(){this.update_()}}class s0{constructor(o,u){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=u.value,this.viewProps=u.viewProps,this.props=u.props,this.view=new n0(o,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ia(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(o,u){o.point&&this.value.setRawValue(vr(mi(o.point.x,0,o.bounds.width),0,o.bounds.width,this.props.get("min"),this.props.get("max")),u)}onPointerDownOrMove_(o){this.handlePointerEvent_(o.data,{forceEmit:!1,last:!1})}onPointerUp_(o){this.handlePointerEvent_(o.data,{forceEmit:!0,last:!0})}onKeyDown_(o){const u=Wi(this.props.get("keyScale"),gs(o));u!==0&&this.value.setRawValue(this.value.rawValue+u,{forceEmit:!1,last:!1})}onKeyUp_(o){Wi(this.props.get("keyScale"),gs(o))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Gd=dr("sldtxt");class o0{constructor(o,u){this.element=o.createElement("div"),this.element.classList.add(Gd());const v=o.createElement("div");v.classList.add(Gd("s")),this.sliderView_=u.sliderView,v.appendChild(this.sliderView_.element),this.element.appendChild(v);const P=o.createElement("div");P.classList.add(Gd("t")),this.textView_=u.textView,P.appendChild(this.textView_.element),this.element.appendChild(P)}}class yu{constructor(o,u){this.value=u.value,this.viewProps=u.viewProps,this.sliderC_=new s0(o,{props:u.sliderProps,value:u.value,viewProps:this.viewProps}),this.textC_=new Uc(o,{parser:u.parser,props:u.textProps,sliderProps:u.sliderProps,value:u.value,viewProps:u.viewProps}),this.view=new o0(o,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(o){return on(o,null,u=>({max:u.required.number,min:u.required.number}),u=>{const v=this.sliderC_.props;return v.set("max",u.max),v.set("min",u.min),!0})}exportProps(){const o=this.sliderC_.props;return an(null,{max:o.get("max"),min:o.get("min")})}}function F_(_){return{sliderProps:new sr({keyScale:_.keyScale,max:_.max,min:_.min}),textProps:new sr({formatter:Or(_.formatter),keyScale:_.keyScale,pointerScale:Or(_.pointerScale)})}}const a0={containerUnitSize:"cnt-usz"};function B_(_){return`--${a0[_]}`}function Lc(_){return v_(_)}function to(_){if(ep(_))return Nr(_,Lc)}function fs(_,o){if(!_)return;const u=[],v=__(_,o);v&&u.push(v);const P=g_(_);return P&&u.push(P),new jc(u)}function l0(_){return _?_.major===cl.major:!1}function O_(_){if(_==="inline"||_==="popup")return _}function $c(_,o){_.write(o)}const au=dr("ckb");class c0{constructor(o,u){this.onValueChange_=this.onValueChange_.bind(this),this.element=o.createElement("div"),this.element.classList.add(au()),u.viewProps.bindClassModifiers(this.element);const v=o.createElement("label");v.classList.add(au("l")),this.element.appendChild(v),this.labelElement=v;const P=o.createElement("input");P.classList.add(au("i")),P.type="checkbox",this.labelElement.appendChild(P),this.inputElement=P,u.viewProps.bindDisabled(this.inputElement);const k=o.createElement("div");k.classList.add(au("w")),this.labelElement.appendChild(k);const w=bu(o,"check");k.appendChild(w),u.value.emitter.on("change",this.onValueChange_),this.value=u.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class h0{constructor(o,u){this.onInputChange_=this.onInputChange_.bind(this),this.onLabelMouseDown_=this.onLabelMouseDown_.bind(this),this.value=u.value,this.viewProps=u.viewProps,this.view=new c0(o,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.labelElement.addEventListener("mousedown",this.onLabelMouseDown_)}onInputChange_(o){const u=o.currentTarget;this.value.rawValue=u.checked,o.preventDefault(),o.stopPropagation()}onLabelMouseDown_(o){o.preventDefault()}}function u0(_){const o=[],u=wp(_.options);return u&&o.push(u),new jc(o)}const d0=Ni({id:"input-bool",type:"input",accept:(_,o)=>{if(typeof _!="boolean")return null;const u=Nr(o,v=>({options:v.optional.custom(Nc),readonly:v.optional.constant(!1)}));return u?{initialValue:_,params:u}:null},binding:{reader:_=>D_,constraint:_=>u0(_.params),writer:_=>$c},controller:_=>{const o=_.document,u=_.value,v=_.constraint,P=v&&_u(v,Vc);return P?new io(o,{props:new sr({options:P.values.value("options")}),value:u,viewProps:_.viewProps}):new h0(o,{value:u,viewProps:_.viewProps})},api(_){return typeof _.controller.value.rawValue!="boolean"?null:_.controller.valueController instanceof io?new bp(_.controller):null}}),Ko=dr("col");class p0{constructor(o,u){this.element=o.createElement("div"),this.element.classList.add(Ko()),u.foldable.bindExpandedClass(this.element,Ko(void 0,"expanded")),Hn(u.foldable,"completed",ll(this.element,Ko(void 0,"cpl")));const v=o.createElement("div");v.classList.add(Ko("h")),this.element.appendChild(v);const P=o.createElement("div");P.classList.add(Ko("s")),v.appendChild(P),this.swatchElement=P;const k=o.createElement("div");if(k.classList.add(Ko("t")),v.appendChild(k),this.textElement=k,u.pickerLayout==="inline"){const w=o.createElement("div");w.classList.add(Ko("p")),this.element.appendChild(w),this.pickerElement=w}else this.pickerElement=null}}function f0(_,o,u){const v=mi(_/255,0,1),P=mi(o/255,0,1),k=mi(u/255,0,1),w=Math.max(v,P,k),a=Math.min(v,P,k),$=w-a;let K=0,ne=0;const te=(a+w)/2;return $!==0&&(ne=$/(1-Math.abs(w+a-1)),v===w?K=(P-k)/$:P===w?K=2+(k-v)/$:K=4+(v-P)/$,K=K/6+(K<0?1:0)),[K*360,ne*100,te*100]}function m0(_,o,u){const v=(_%360+360)%360,P=mi(o/100,0,1),k=mi(u/100,0,1),w=(1-Math.abs(2*k-1))*P,a=w*(1-Math.abs(v/60%2-1)),$=k-w/2;let K,ne,te;return v>=0&&v<60?[K,ne,te]=[w,a,0]:v>=60&&v<120?[K,ne,te]=[a,w,0]:v>=120&&v<180?[K,ne,te]=[0,w,a]:v>=180&&v<240?[K,ne,te]=[0,a,w]:v>=240&&v<300?[K,ne,te]=[a,0,w]:[K,ne,te]=[w,0,a],[(K+$)*255,(ne+$)*255,(te+$)*255]}function _0(_,o,u){const v=mi(_/255,0,1),P=mi(o/255,0,1),k=mi(u/255,0,1),w=Math.max(v,P,k),a=Math.min(v,P,k),$=w-a;let K;$===0?K=0:w===v?K=60*(((P-k)/$%6+6)%6):w===P?K=60*((k-v)/$+2):K=60*((v-P)/$+4);const ne=w===0?0:$/w,te=w;return[K,ne*100,te*100]}function j_(_,o,u){const v=p_(_,360),P=mi(o/100,0,1),k=mi(u/100,0,1),w=k*P,a=w*(1-Math.abs(v/60%2-1)),$=k-w;let K,ne,te;return v>=0&&v<60?[K,ne,te]=[w,a,0]:v>=60&&v<120?[K,ne,te]=[a,w,0]:v>=120&&v<180?[K,ne,te]=[0,w,a]:v>=180&&v<240?[K,ne,te]=[0,a,w]:v>=240&&v<300?[K,ne,te]=[a,0,w]:[K,ne,te]=[w,0,a],[(K+$)*255,(ne+$)*255,(te+$)*255]}function g0(_,o,u){const v=u+o*(100-Math.abs(2*u-100))/200;return[_,v!==0?o*(100-Math.abs(2*u-100))/v:0,u+o*(100-Math.abs(2*u-100))/(2*100)]}function y0(_,o,u){const v=100-Math.abs(u*(200-o)/100-100);return[_,v!==0?o*u/v:0,u*(200-o)/(2*100)]}function Xn(_){return[_[0],_[1],_[2]]}function wu(_,o){return[_[0],_[1],_[2],o]}const v0={hsl:{hsl:(_,o,u)=>[_,o,u],hsv:g0,rgb:m0},hsv:{hsl:y0,hsv:(_,o,u)=>[_,o,u],rgb:j_},rgb:{hsl:f0,hsv:_0,rgb:(_,o,u)=>[_,o,u]}};function al(_,o){return[o==="float"?1:_==="rgb"?255:360,o==="float"?1:_==="rgb"?255:100,o==="float"?1:_==="rgb"?255:100]}function b0(_,o){return _===o?o:p_(_,o)}function V_(_,o,u){var v;const P=al(o,u);return[o==="rgb"?mi(_[0],0,P[0]):b0(_[0],P[0]),mi(_[1],0,P[1]),mi(_[2],0,P[2]),mi((v=_[3])!==null&&v!==void 0?v:1,0,1)]}function Om(_,o,u,v){const P=al(o,u),k=al(o,v);return _.map((w,a)=>w/P[a]*k[a])}function N_(_,o,u){const v=Om(_,o.mode,o.type,"int"),P=v0[o.mode][u.mode](...v);return Om(P,u.mode,"int",u.type)}class pr{static black(){return new pr([0,0,0],"rgb")}constructor(o,u){this.type="int",this.mode=u,this.comps_=V_(o,u,this.type)}getComponents(o){return wu(N_(Xn(this.comps_),{mode:this.mode,type:this.type},{mode:o??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const o=this.getComponents("rgb");return{r:o[0],g:o[1],b:o[2],a:o[3]}}}const Ys=dr("colp");class x0{constructor(o,u){this.alphaViews_=null,this.element=o.createElement("div"),this.element.classList.add(Ys()),u.viewProps.bindClassModifiers(this.element);const v=o.createElement("div");v.classList.add(Ys("hsv"));const P=o.createElement("div");P.classList.add(Ys("sv")),this.svPaletteView_=u.svPaletteView,P.appendChild(this.svPaletteView_.element),v.appendChild(P);const k=o.createElement("div");k.classList.add(Ys("h")),this.hPaletteView_=u.hPaletteView,k.appendChild(this.hPaletteView_.element),v.appendChild(k),this.element.appendChild(v);const w=o.createElement("div");if(w.classList.add(Ys("rgb")),this.textsView_=u.textsView,w.appendChild(this.textsView_.element),this.element.appendChild(w),u.alphaViews){this.alphaViews_={palette:u.alphaViews.palette,text:u.alphaViews.text};const a=o.createElement("div");a.classList.add(Ys("a"));const $=o.createElement("div");$.classList.add(Ys("ap")),$.appendChild(this.alphaViews_.palette.element),a.appendChild($);const K=o.createElement("div");K.classList.add(Ys("at")),K.appendChild(this.alphaViews_.text.element),a.appendChild(K),this.element.appendChild(a)}}get allFocusableElements(){const o=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(u=>u.inputElement)];return this.alphaViews_&&o.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),o}}function w0(_){return _==="int"?"int":_==="float"?"float":void 0}function Cp(_){return Nr(_,o=>({color:o.optional.object({alpha:o.optional.boolean,type:o.optional.custom(w0)}),expanded:o.optional.boolean,picker:o.optional.custom(O_),readonly:o.optional.constant(!1)}))}function ea(_){return _?.1:1}function U_(_){var o;return(o=_.color)===null||o===void 0?void 0:o.type}class Pp{constructor(o,u){this.type="float",this.mode=u,this.comps_=V_(o,u,this.type)}getComponents(o){return wu(N_(Xn(this.comps_),{mode:this.mode,type:this.type},{mode:o??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const o=this.getComponents("rgb");return{r:o[0],g:o[1],b:o[2],a:o[3]}}}const C0={int:(_,o)=>new pr(_,o),float:(_,o)=>new Pp(_,o)};function Tp(_,o,u){return C0[u](_,o)}function P0(_){return _.type==="float"}function T0(_){return _.type==="int"}function S0(_){const o=_.getComponents(),u=al(_.mode,"int");return new pr([Math.round(vr(o[0],0,1,0,u[0])),Math.round(vr(o[1],0,1,0,u[1])),Math.round(vr(o[2],0,1,0,u[2])),o[3]],_.mode)}function E0(_){const o=_.getComponents(),u=al(_.mode,"int");return new Pp([vr(o[0],0,u[0],0,1),vr(o[1],0,u[1],0,1),vr(o[2],0,u[2],0,1),o[3]],_.mode)}function Vi(_,o){if(_.type===o)return _;if(T0(_)&&o==="float")return E0(_);if(P0(_)&&o==="int")return S0(_);throw qr.shouldNeverHappen()}function k0(_,o){return _.alpha===o.alpha&&_.mode===o.mode&&_.notation===o.notation&&_.type===o.type}function yn(_,o){const u=_.match(/^(.+)%$/);return Math.min(u?parseFloat(u[1])*.01*o:parseFloat(_),o)}const M0={deg:_=>_,grad:_=>_*360/400,rad:_=>_*360/(2*Math.PI),turn:_=>_*360};function $_(_){const o=_.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!o)return parseFloat(_);const u=parseFloat(o[1]),v=o[2];return M0[v](u)}function Z_(_){const o=_.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!o)return null;const u=[yn(o[1],255),yn(o[2],255),yn(o[3],255)];return isNaN(u[0])||isNaN(u[1])||isNaN(u[2])?null:u}function I0(_){const o=Z_(_);return o?new pr(o,"rgb"):null}function G_(_){const o=_.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!o)return null;const u=[yn(o[1],255),yn(o[2],255),yn(o[3],255),yn(o[4],1)];return isNaN(u[0])||isNaN(u[1])||isNaN(u[2])||isNaN(u[3])?null:u}function A0(_){const o=G_(_);return o?new pr(o,"rgb"):null}function q_(_){const o=_.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!o)return null;const u=[$_(o[1]),yn(o[2],100),yn(o[3],100)];return isNaN(u[0])||isNaN(u[1])||isNaN(u[2])?null:u}function z0(_){const o=q_(_);return o?new pr(o,"hsl"):null}function W_(_){const o=_.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!o)return null;const u=[$_(o[1]),yn(o[2],100),yn(o[3],100),yn(o[4],1)];return isNaN(u[0])||isNaN(u[1])||isNaN(u[2])||isNaN(u[3])?null:u}function D0(_){const o=W_(_);return o?new pr(o,"hsl"):null}function H_(_){const o=_.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(o)return[parseInt(o[1]+o[1],16),parseInt(o[2]+o[2],16),parseInt(o[3]+o[3],16)];const u=_.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return u?[parseInt(u[1],16),parseInt(u[2],16),parseInt(u[3],16)]:null}function R0(_){const o=H_(_);return o?new pr(o,"rgb"):null}function X_(_){const o=_.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(o)return[parseInt(o[1]+o[1],16),parseInt(o[2]+o[2],16),parseInt(o[3]+o[3],16),vr(parseInt(o[4]+o[4],16),0,255,0,1)];const u=_.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return u?[parseInt(u[1],16),parseInt(u[2],16),parseInt(u[3],16),vr(parseInt(u[4],16),0,255,0,1)]:null}function L0(_){const o=X_(_);return o?new pr(o,"rgb"):null}function K_(_){const o=_.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!o)return null;const u=[parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3])];return isNaN(u[0])||isNaN(u[1])||isNaN(u[2])?null:u}function F0(_){return o=>{const u=K_(o);return u?Tp(u,"rgb",_):null}}function Y_(_){const o=_.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!o)return null;const u=[parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]),parseFloat(o[4])];return isNaN(u[0])||isNaN(u[1])||isNaN(u[2])||isNaN(u[3])?null:u}function B0(_){return o=>{const u=Y_(o);return u?Tp(u,"rgb",_):null}}const O0=[{parser:H_,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:X_,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:Z_,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:G_,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:q_,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:W_,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:K_,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:Y_,result:{alpha:!0,mode:"rgb",notation:"object"}}];function j0(_){return O0.reduce((o,{parser:u,result:v})=>o||(u(_)?v:null),null)}function V0(_,o="int"){const u=j0(_);return u?u.notation==="hex"&&o!=="float"?Object.assign(Object.assign({},u),{type:"int"}):u.notation==="func"?Object.assign(Object.assign({},u),{type:o}):null:null}function Zc(_){const o=[R0,L0,I0,A0,z0,D0];o.push(F0("int"),B0("int"));const u=e0(o);return v=>{const P=u(v);return P?Vi(P,_):null}}function N0(_){const o=Zc("int");if(typeof _!="string")return pr.black();const u=o(_);return u??pr.black()}function J_(_){const o=mi(Math.floor(_),0,255).toString(16);return o.length===1?`0${o}`:o}function Sp(_,o="#"){const u=Xn(_.getComponents("rgb")).map(J_).join("");return`${o}${u}`}function Ep(_,o="#"){const u=_.getComponents("rgb"),v=[u[0],u[1],u[2],u[3]*255].map(J_).join("");return`${o}${v}`}function Q_(_){const o=Hi(0),u=Vi(_,"int");return`rgb(${Xn(u.getComponents("rgb")).map(P=>o(P)).join(", ")})`}function uu(_){const o=Hi(2),u=Hi(0);return`rgba(${Vi(_,"int").getComponents("rgb").map((k,w)=>(w===3?o:u)(k)).join(", ")})`}function U0(_){const o=[Hi(0),gu,gu],u=Vi(_,"int");return`hsl(${Xn(u.getComponents("hsl")).map((P,k)=>o[k](P)).join(", ")})`}function $0(_){const o=[Hi(0),gu,gu,Hi(2)];return`hsla(${Vi(_,"int").getComponents("hsl").map((P,k)=>o[k](P)).join(", ")})`}function eg(_,o){const u=Hi(o==="float"?2:0),v=["r","g","b"],P=Vi(_,o);return`{${Xn(P.getComponents("rgb")).map((w,a)=>`${v[a]}: ${u(w)}`).join(", ")}}`}function Z0(_){return o=>eg(o,_)}function tg(_,o){const u=Hi(2),v=Hi(o==="float"?2:0),P=["r","g","b","a"];return`{${Vi(_,o).getComponents("rgb").map((a,$)=>{const K=$===3?u:v;return`${P[$]}: ${K(a)}`}).join(", ")}}`}function G0(_){return o=>tg(o,_)}const q0=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:Sp},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:Ep},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:Q_},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:uu},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:U0},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:$0},...["int","float"].reduce((_,o)=>[..._,{format:{alpha:!1,mode:"rgb",notation:"object",type:o},stringifier:Z0(o)},{format:{alpha:!0,mode:"rgb",notation:"object",type:o},stringifier:G0(o)}],[])];function rg(_){return q0.reduce((o,u)=>o||(k0(u.format,_)?u.stringifier:null),null)}const Ec=dr("apl");class W0{constructor(o,u){this.onValueChange_=this.onValueChange_.bind(this),this.value=u.value,this.value.emitter.on("change",this.onValueChange_),this.element=o.createElement("div"),this.element.classList.add(Ec()),u.viewProps.bindClassModifiers(this.element),u.viewProps.bindTabIndex(this.element);const v=o.createElement("div");v.classList.add(Ec("b")),this.element.appendChild(v);const P=o.createElement("div");P.classList.add(Ec("c")),v.appendChild(P),this.colorElem_=P;const k=o.createElement("div");k.classList.add(Ec("m")),this.element.appendChild(k),this.markerElem_=k;const w=o.createElement("div");w.classList.add(Ec("p")),this.markerElem_.appendChild(w),this.previewElem_=w,this.update_()}update_(){const o=this.value.rawValue,u=o.getComponents("rgb"),v=new pr([u[0],u[1],u[2],0],"rgb"),P=new pr([u[0],u[1],u[2],255],"rgb"),k=["to right",uu(v),uu(P)];this.colorElem_.style.background=`linear-gradient(${k.join(",")})`,this.previewElem_.style.backgroundColor=uu(o);const w=vr(u[3],0,1,0,100);this.markerElem_.style.left=`${w}%`}onValueChange_(){this.update_()}}class H0{constructor(o,u){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=u.value,this.viewProps=u.viewProps,this.view=new W0(o,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ia(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(o,u){if(!o.point)return;const v=o.point.x/o.bounds.width,P=this.value.rawValue,[k,w,a]=P.getComponents("hsv");this.value.setRawValue(new pr([k,w,a,v],"hsv"),u)}onPointerDown_(o){this.handlePointerEvent_(o.data,{forceEmit:!1,last:!1})}onPointerMove_(o){this.handlePointerEvent_(o.data,{forceEmit:!1,last:!1})}onPointerUp_(o){this.handlePointerEvent_(o.data,{forceEmit:!0,last:!0})}onKeyDown_(o){const u=Wi(ea(!0),gs(o));if(u===0)return;const v=this.value.rawValue,[P,k,w,a]=v.getComponents("hsv");this.value.setRawValue(new pr([P,k,w,a+u],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(o){Wi(ea(!0),gs(o))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const tl=dr("coltxt");function X0(_){const o=_.createElement("select"),u=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}];return o.appendChild(u.reduce((v,P)=>{const k=_.createElement("option");return k.textContent=P.text,k.value=P.value,v.appendChild(k),v},_.createDocumentFragment())),o}class K0{constructor(o,u){this.element=o.createElement("div"),this.element.classList.add(tl()),u.viewProps.bindClassModifiers(this.element);const v=o.createElement("div");v.classList.add(tl("m")),this.modeElem_=X0(o),this.modeElem_.classList.add(tl("ms")),v.appendChild(this.modeSelectElement),u.viewProps.bindDisabled(this.modeElem_);const P=o.createElement("div");P.classList.add(tl("mm")),P.appendChild(bu(o,"dropdown")),v.appendChild(P),this.element.appendChild(v);const k=o.createElement("div");k.classList.add(tl("w")),this.element.appendChild(k),this.inputsElem_=k,this.inputViews_=u.inputViews,this.applyInputViews_(),ms(u.mode,w=>{this.modeElem_.value=w})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(o){this.inputViews_=o,this.applyInputViews_()}applyInputViews_(){w_(this.inputsElem_);const o=this.element.ownerDocument;this.inputViews_.forEach(u=>{const v=o.createElement("div");v.classList.add(tl("c")),v.appendChild(u.element),this.inputsElem_.appendChild(v)})}}function Y0(_){return Hi(_==="float"?2:0)}function J0(_,o,u){const v=al(_,o)[u];return new Fc({min:0,max:v})}function Q0(_,o,u){return new Uc(_,{arrayPosition:u===0?"fst":u===2?"lst":"mid",parser:o.parser,props:sr.fromObject({formatter:Y0(o.colorType),keyScale:ea(!1),pointerScale:o.colorType==="float"?.01:1}),value:Or(0,{constraint:J0(o.colorMode,o.colorType,u)}),viewProps:o.viewProps})}function ex(_,o){const u={colorMode:o.colorMode,colorType:o.colorType,parser:_s,viewProps:o.viewProps};return[0,1,2].map(v=>{const P=Q0(_,u,v);return ul({primary:o.value,secondary:P.value,forward(k){return Vi(k,o.colorType).getComponents(o.colorMode)[v]},backward(k,w){const a=o.colorMode,K=Vi(k,o.colorType).getComponents(a);K[v]=w;const ne=Tp(wu(Xn(K),K[3]),a,o.colorType);return Vi(ne,"int")}}),P})}function tx(_,o){const u=new Dc(_,{parser:Zc("int"),props:sr.fromObject({formatter:Sp}),value:Or(pr.black()),viewProps:o.viewProps});return ul({primary:o.value,secondary:u.value,forward:v=>new pr(Xn(v.getComponents()),v.mode),backward:(v,P)=>new pr(wu(Xn(P.getComponents(v.mode)),v.getComponents()[3]),v.mode)}),[u]}function rx(_){return _!=="hex"}class ix{constructor(o,u){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=u.colorType,this.value=u.value,this.viewProps=u.viewProps,this.colorMode=Or(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(o),this.view=new K0(o,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(o){const u=this.colorMode.rawValue;return rx(u)?ex(o,{colorMode:u,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):tx(o,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(o){const u=o.currentTarget;this.colorMode.rawValue=u.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(v=>v.view)}}const qd=dr("hpl");class nx{constructor(o,u){this.onValueChange_=this.onValueChange_.bind(this),this.value=u.value,this.value.emitter.on("change",this.onValueChange_),this.element=o.createElement("div"),this.element.classList.add(qd()),u.viewProps.bindClassModifiers(this.element),u.viewProps.bindTabIndex(this.element);const v=o.createElement("div");v.classList.add(qd("c")),this.element.appendChild(v);const P=o.createElement("div");P.classList.add(qd("m")),this.element.appendChild(P),this.markerElem_=P,this.update_()}update_(){const o=this.value.rawValue,[u]=o.getComponents("hsv");this.markerElem_.style.backgroundColor=Q_(new pr([u,100,100],"hsv"));const v=vr(u,0,360,0,100);this.markerElem_.style.left=`${v}%`}onValueChange_(){this.update_()}}class sx{constructor(o,u){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=u.value,this.viewProps=u.viewProps,this.view=new nx(o,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ia(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(o,u){if(!o.point)return;const v=vr(mi(o.point.x,0,o.bounds.width),0,o.bounds.width,0,360),P=this.value.rawValue,[,k,w,a]=P.getComponents("hsv");this.value.setRawValue(new pr([v,k,w,a],"hsv"),u)}onPointerDown_(o){this.handlePointerEvent_(o.data,{forceEmit:!1,last:!1})}onPointerMove_(o){this.handlePointerEvent_(o.data,{forceEmit:!1,last:!1})}onPointerUp_(o){this.handlePointerEvent_(o.data,{forceEmit:!0,last:!0})}onKeyDown_(o){const u=Wi(ea(!1),gs(o));if(u===0)return;const v=this.value.rawValue,[P,k,w,a]=v.getComponents("hsv");this.value.setRawValue(new pr([P+u,k,w,a],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(o){Wi(ea(!1),gs(o))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Wd=dr("svp"),jm=64;class ox{constructor(o,u){this.onValueChange_=this.onValueChange_.bind(this),this.value=u.value,this.value.emitter.on("change",this.onValueChange_),this.element=o.createElement("div"),this.element.classList.add(Wd()),u.viewProps.bindClassModifiers(this.element),u.viewProps.bindTabIndex(this.element);const v=o.createElement("canvas");v.height=jm,v.width=jm,v.classList.add(Wd("c")),this.element.appendChild(v),this.canvasElement=v;const P=o.createElement("div");P.classList.add(Wd("m")),this.element.appendChild(P),this.markerElem_=P,this.update_()}update_(){const o=sb(this.canvasElement);if(!o)return;const v=this.value.rawValue.getComponents("hsv"),P=this.canvasElement.width,k=this.canvasElement.height,w=o.getImageData(0,0,P,k),a=w.data;for(let ne=0;ne<k;ne++)for(let te=0;te<P;te++){const oe=vr(te,0,P,0,100),L=vr(ne,0,k,100,0),H=j_(v[0],oe,L),q=(ne*P+te)*4;a[q]=H[0],a[q+1]=H[1],a[q+2]=H[2],a[q+3]=255}o.putImageData(w,0,0);const $=vr(v[1],0,100,0,100);this.markerElem_.style.left=`${$}%`;const K=vr(v[2],0,100,100,0);this.markerElem_.style.top=`${K}%`}onValueChange_(){this.update_()}}class ax{constructor(o,u){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=u.value,this.viewProps=u.viewProps,this.view=new ox(o,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ia(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(o,u){if(!o.point)return;const v=vr(o.point.x,0,o.bounds.width,0,100),P=vr(o.point.y,0,o.bounds.height,100,0),[k,,,w]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new pr([k,v,P,w],"hsv"),u)}onPointerDown_(o){this.handlePointerEvent_(o.data,{forceEmit:!1,last:!1})}onPointerMove_(o){this.handlePointerEvent_(o.data,{forceEmit:!1,last:!1})}onPointerUp_(o){this.handlePointerEvent_(o.data,{forceEmit:!0,last:!0})}onKeyDown_(o){L_(o.key)&&o.preventDefault();const[u,v,P,k]=this.value.rawValue.getComponents("hsv"),w=ea(!1),a=Wi(w,gs(o)),$=Wi(w,Rc(o));a===0&&$===0||this.value.setRawValue(new pr([u,v+a,P+$,k],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(o){const u=ea(!1),v=Wi(u,gs(o)),P=Wi(u,Rc(o));v===0&&P===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class lx{constructor(o,u){this.value=u.value,this.viewProps=u.viewProps,this.hPaletteC_=new sx(o,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new ax(o,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=u.supportsAlpha?{palette:new H0(o,{value:this.value,viewProps:this.viewProps}),text:new Uc(o,{parser:_s,props:sr.fromObject({pointerScale:.01,keyScale:.1,formatter:Hi(2)}),value:Or(0,{constraint:new Fc({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&ul({primary:this.value,secondary:this.alphaIcs_.text.value,forward:v=>v.getComponents()[3],backward:(v,P)=>{const k=v.getComponents();return k[3]=P,new pr(k,v.mode)}}),this.textsC_=new ix(o,{colorType:u.colorType,value:this.value,viewProps:this.viewProps}),this.view=new x0(o,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:u.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}}const Hd=dr("colsw");class cx{constructor(o,u){this.onValueChange_=this.onValueChange_.bind(this),u.value.emitter.on("change",this.onValueChange_),this.value=u.value,this.element=o.createElement("div"),this.element.classList.add(Hd()),u.viewProps.bindClassModifiers(this.element);const v=o.createElement("div");v.classList.add(Hd("sw")),this.element.appendChild(v),this.swatchElem_=v;const P=o.createElement("button");P.classList.add(Hd("b")),u.viewProps.bindDisabled(P),this.element.appendChild(P),this.buttonElement=P,this.update_()}update_(){const o=this.value.rawValue;this.swatchElem_.style.backgroundColor=Ep(o)}onValueChange_(){this.update_()}}class hx{constructor(o,u){this.value=u.value,this.viewProps=u.viewProps,this.view=new cx(o,{value:this.value,viewProps:this.viewProps})}}class kp{constructor(o,u){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=u.value,this.viewProps=u.viewProps,this.foldable_=Oc.create(u.expanded),this.swatchC_=new hx(o,{value:this.value,viewProps:this.viewProps});const v=this.swatchC_.view.buttonElement;v.addEventListener("blur",this.onButtonBlur_),v.addEventListener("click",this.onButtonClick_),this.textC_=new Dc(o,{parser:u.parser,props:sr.fromObject({formatter:u.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new p0(o,{foldable:this.foldable_,pickerLayout:u.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=u.pickerLayout==="popup"?new z_(o,{viewProps:this.viewProps}):null;const P=new lx(o,{colorType:u.colorType,supportsAlpha:u.supportsAlpha,value:this.value,viewProps:this.viewProps});P.view.allFocusableElements.forEach(k=>{k.addEventListener("blur",this.onPopupChildBlur_),k.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=P,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(P.view.element),ul({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:k=>k,backward:(k,w)=>w})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),vp(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(o){if(!this.popC_)return;const u=this.view.element,v=o.relatedTarget;(!v||!u.contains(v))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(o){if(!this.popC_)return;const u=this.popC_.view.element,v=C_(o);v&&u.contains(v)||v&&v===this.swatchC_.view.buttonElement&&!pp(u.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(o){this.popC_?o.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&o.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function ux(_){return Xn(_.getComponents("rgb")).reduce((o,u)=>o<<8|Math.floor(u)&255,0)}function dx(_){return _.getComponents("rgb").reduce((o,u,v)=>{const P=Math.floor(v===3?u*255:u)&255;return o<<8|P},0)>>>0}function px(_){return new pr([_>>16&255,_>>8&255,_&255],"rgb")}function fx(_){return new pr([_>>24&255,_>>16&255,_>>8&255,vr(_&255,0,255,0,1)],"rgb")}function mx(_){return typeof _!="number"?pr.black():px(_)}function _x(_){return typeof _!="number"?pr.black():fx(_)}function du(_,o){return typeof _!="object"||zr(_)?!1:o in _&&typeof _[o]=="number"}function ig(_){return du(_,"r")&&du(_,"g")&&du(_,"b")}function ng(_){return ig(_)&&du(_,"a")}function sg(_){return ig(_)}function Mp(_,o){if(_.mode!==o.mode||_.type!==o.type)return!1;const u=_.getComponents(),v=o.getComponents();for(let P=0;P<u.length;P++)if(u[P]!==v[P])return!1;return!0}function Vm(_){return"a"in _?[_.r,_.g,_.b,_.a]:[_.r,_.g,_.b]}function gx(_){const o=rg(_);return o?(u,v)=>{$c(u,o(v))}:null}function yx(_){const o=_?dx:ux;return(u,v)=>{$c(u,o(v))}}function vx(_,o,u){const P=Vi(o,u).toRgbaObject();_.writeProperty("r",P.r),_.writeProperty("g",P.g),_.writeProperty("b",P.b),_.writeProperty("a",P.a)}function bx(_,o,u){const P=Vi(o,u).toRgbaObject();_.writeProperty("r",P.r),_.writeProperty("g",P.g),_.writeProperty("b",P.b)}function xx(_,o){return(u,v)=>{_?vx(u,v,o):bx(u,v,o)}}function wx(_){var o;return!!(!((o=_==null?void 0:_.color)===null||o===void 0)&&o.alpha)}function Cx(_){return _?o=>Ep(o,"0x"):o=>Sp(o,"0x")}function Px(_){return"color"in _||_.view==="color"}const Tx=Ni({id:"input-color-number",type:"input",accept:(_,o)=>{if(typeof _!="number"||!Px(o))return null;const u=Cp(o);return u?{initialValue:_,params:Object.assign(Object.assign({},u),{supportsAlpha:wx(o)})}:null},binding:{reader:_=>_.params.supportsAlpha?_x:mx,equals:Mp,writer:_=>yx(_.params.supportsAlpha)},controller:_=>{var o,u;return new kp(_.document,{colorType:"int",expanded:(o=_.params.expanded)!==null&&o!==void 0?o:!1,formatter:Cx(_.params.supportsAlpha),parser:Zc("int"),pickerLayout:(u=_.params.picker)!==null&&u!==void 0?u:"popup",supportsAlpha:_.params.supportsAlpha,value:_.value,viewProps:_.viewProps})}});function Sx(_,o){if(!sg(_))return Vi(pr.black(),o);if(o==="int"){const u=Vm(_);return new pr(u,"rgb")}if(o==="float"){const u=Vm(_);return new Pp(u,"rgb")}return Vi(pr.black(),"int")}function Ex(_){return ng(_)}function kx(_){return o=>{const u=Sx(o,_);return Vi(u,"int")}}function Mx(_,o){return u=>_?tg(u,o):eg(u,o)}const Ix=Ni({id:"input-color-object",type:"input",accept:(_,o)=>{var u;if(!sg(_))return null;const v=Cp(o);return v?{initialValue:_,params:Object.assign(Object.assign({},v),{colorType:(u=U_(o))!==null&&u!==void 0?u:"int"})}:null},binding:{reader:_=>kx(_.params.colorType),equals:Mp,writer:_=>xx(Ex(_.initialValue),_.params.colorType)},controller:_=>{var o,u;const v=ng(_.initialValue);return new kp(_.document,{colorType:_.params.colorType,expanded:(o=_.params.expanded)!==null&&o!==void 0?o:!1,formatter:Mx(v,_.params.colorType),parser:Zc("int"),pickerLayout:(u=_.params.picker)!==null&&u!==void 0?u:"popup",supportsAlpha:v,value:_.value,viewProps:_.viewProps})}}),Ax=Ni({id:"input-color-string",type:"input",accept:(_,o)=>{if(typeof _!="string"||o.view==="text")return null;const u=V0(_,U_(o));if(!u)return null;const v=rg(u);if(!v)return null;const P=Cp(o);return P?{initialValue:_,params:Object.assign(Object.assign({},P),{format:u,stringifier:v})}:null},binding:{reader:()=>N0,equals:Mp,writer:_=>{const o=gx(_.params.format);if(!o)throw qr.notBindable();return o}},controller:_=>{var o,u;return new kp(_.document,{colorType:_.params.format.type,expanded:(o=_.params.expanded)!==null&&o!==void 0?o:!1,formatter:_.params.stringifier,parser:Zc("int"),pickerLayout:(u=_.params.picker)!==null&&u!==void 0?u:"popup",supportsAlpha:_.params.format.alpha,value:_.value,viewProps:_.viewProps})}});class Ip{constructor(o){this.components=o.components,this.asm_=o.assembly}constrain(o){const u=this.asm_.toComponents(o).map((v,P)=>{var k,w;return(w=(k=this.components[P])===null||k===void 0?void 0:k.constrain(v))!==null&&w!==void 0?w:v});return this.asm_.fromComponents(u)}}const Nm=dr("pndtxt");class zx{constructor(o,u){this.textViews=u.textViews,this.element=o.createElement("div"),this.element.classList.add(Nm()),this.textViews.forEach(v=>{const P=o.createElement("div");P.classList.add(Nm("a")),P.appendChild(v.element),this.element.appendChild(P)})}}function Dx(_,o,u){return new Uc(_,{arrayPosition:u===0?"fst":u===o.axes.length-1?"lst":"mid",parser:o.parser,props:o.axes[u].textProps,value:Or(0,{constraint:o.axes[u].constraint}),viewProps:o.viewProps})}class Ap{constructor(o,u){this.value=u.value,this.viewProps=u.viewProps,this.acs_=u.axes.map((v,P)=>Dx(o,u,P)),this.acs_.forEach((v,P)=>{ul({primary:this.value,secondary:v.value,forward:k=>u.assembly.toComponents(k)[P],backward:(k,w)=>{const a=u.assembly.toComponents(k);return a[P]=w,u.assembly.fromComponents(a)}})}),this.view=new zx(o,{textViews:this.acs_.map(v=>v.view)})}get textControllers(){return this.acs_}}class Rx extends zc{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(o){this.controller.valueController.sliderController.props.set("max",o)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(o){this.controller.valueController.sliderController.props.set("min",o)}}function Lx(_,o){const u=[],v=__(_,o);v&&u.push(v);const P=g_(_);P&&u.push(P);const k=wp(_.options);return k&&u.push(k),new jc(u)}const Fx=Ni({id:"input-number",type:"input",accept:(_,o)=>{if(typeof _!="number")return null;const u=Nr(o,v=>Object.assign(Object.assign({},v_(v)),{options:v.optional.custom(Nc),readonly:v.optional.constant(!1)}));return u?{initialValue:_,params:u}:null},binding:{reader:_=>d_,constraint:_=>Lx(_.params,_.initialValue),writer:_=>$c},controller:_=>{const o=_.value,u=_.constraint,v=u&&_u(u,Vc);if(v)return new io(_.document,{props:new sr({options:v.values.value("options")}),value:o,viewProps:_.viewProps});const P=y_(_.params,o.rawValue),k=u&&_u(u,Fc);return k?new yu(_.document,Object.assign(Object.assign({},F_(Object.assign(Object.assign({},P),{keyScale:Or(P.keyScale),max:k.values.value("max"),min:k.values.value("min")}))),{parser:_s,value:o,viewProps:_.viewProps})):new Uc(_.document,{parser:_s,props:sr.fromObject(P),value:o,viewProps:_.viewProps})},api(_){return typeof _.controller.value.rawValue!="number"?null:_.controller.valueController instanceof yu?new Rx(_.controller):_.controller.valueController instanceof io?new bp(_.controller):null}});class ro{constructor(o=0,u=0){this.x=o,this.y=u}getComponents(){return[this.x,this.y]}static isObject(o){if(zr(o))return!1;const u=o.x,v=o.y;return!(typeof u!="number"||typeof v!="number")}static equals(o,u){return o.x===u.x&&o.y===u.y}toObject(){return{x:this.x,y:this.y}}}const og={toComponents:_=>_.getComponents(),fromComponents:_=>new ro(..._)},rl=dr("p2d");class Bx{constructor(o,u){this.element=o.createElement("div"),this.element.classList.add(rl()),u.viewProps.bindClassModifiers(this.element),ms(u.expanded,ll(this.element,rl(void 0,"expanded")));const v=o.createElement("div");v.classList.add(rl("h")),this.element.appendChild(v);const P=o.createElement("button");P.classList.add(rl("b")),P.appendChild(bu(o,"p2dpad")),u.viewProps.bindDisabled(P),v.appendChild(P),this.buttonElement=P;const k=o.createElement("div");if(k.classList.add(rl("t")),v.appendChild(k),this.textElement=k,u.pickerLayout==="inline"){const w=o.createElement("div");w.classList.add(rl("p")),this.element.appendChild(w),this.pickerElement=w}else this.pickerElement=null}}const Js=dr("p2dp");class Ox{constructor(o,u){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=u.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=o.createElement("div"),this.element.classList.add(Js()),u.layout==="popup"&&this.element.classList.add(Js(void 0,"p")),u.viewProps.bindClassModifiers(this.element);const v=o.createElement("div");v.classList.add(Js("p")),u.viewProps.bindTabIndex(v),this.element.appendChild(v),this.padElement=v;const P=o.createElementNS(Wn,"svg");P.classList.add(Js("g")),this.padElement.appendChild(P),this.svgElem_=P;const k=o.createElementNS(Wn,"line");k.classList.add(Js("ax")),k.setAttributeNS(null,"x1","0"),k.setAttributeNS(null,"y1","50%"),k.setAttributeNS(null,"x2","100%"),k.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(k);const w=o.createElementNS(Wn,"line");w.classList.add(Js("ax")),w.setAttributeNS(null,"x1","50%"),w.setAttributeNS(null,"y1","0"),w.setAttributeNS(null,"x2","50%"),w.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(w);const a=o.createElementNS(Wn,"line");a.classList.add(Js("l")),a.setAttributeNS(null,"x1","50%"),a.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(a),this.lineElem_=a;const $=o.createElement("div");$.classList.add(Js("m")),this.padElement.appendChild($),this.markerElem_=$,u.value.emitter.on("change",this.onValueChange_),this.value=u.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[o,u]=this.value.rawValue.getComponents(),v=this.props_.get("max"),P=vr(o,-v,+v,0,100),k=vr(u,-v,+v,0,100),w=this.props_.get("invertsY")?100-k:k;this.lineElem_.setAttributeNS(null,"x2",`${P}%`),this.lineElem_.setAttributeNS(null,"y2",`${w}%`),this.markerElem_.style.left=`${P}%`,this.markerElem_.style.top=`${w}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}}function Um(_,o,u){return[Wi(o[0],gs(_)),Wi(o[1],Rc(_))*(u?1:-1)]}class jx{constructor(o,u){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=u.props,this.value=u.value,this.viewProps=u.viewProps,this.view=new Ox(o,{layout:u.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ia(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(o,u){if(!o.point)return;const v=this.props.get("max"),P=vr(o.point.x,0,o.bounds.width,-v,+v),k=vr(this.props.get("invertsY")?o.bounds.height-o.point.y:o.point.y,0,o.bounds.height,-v,+v);this.value.setRawValue(new ro(P,k),u)}onPointerDown_(o){this.handlePointerEvent_(o.data,{forceEmit:!1,last:!1})}onPointerMove_(o){this.handlePointerEvent_(o.data,{forceEmit:!1,last:!1})}onPointerUp_(o){this.handlePointerEvent_(o.data,{forceEmit:!0,last:!0})}onPadKeyDown_(o){L_(o.key)&&o.preventDefault();const[u,v]=Um(o,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));u===0&&v===0||this.value.setRawValue(new ro(this.value.rawValue.x+u,this.value.rawValue.y+v),{forceEmit:!1,last:!1})}onPadKeyUp_(o){const[u,v]=Um(o,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));u===0&&v===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Vx{constructor(o,u){var v,P;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=u.value,this.viewProps=u.viewProps,this.foldable_=Oc.create(u.expanded),this.popC_=u.pickerLayout==="popup"?new z_(o,{viewProps:this.viewProps}):null;const k=new jx(o,{layout:u.pickerLayout,props:new sr({invertsY:Or(u.invertsY),max:Or(u.max),xKeyScale:u.axes[0].textProps.value("keyScale"),yKeyScale:u.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});k.view.allFocusableElements.forEach(w=>{w.addEventListener("blur",this.onPopupChildBlur_),w.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=k,this.textC_=new Ap(o,{assembly:og,axes:u.axes,parser:u.parser,value:this.value,viewProps:this.viewProps}),this.view=new Bx(o,{expanded:this.foldable_.value("expanded"),pickerLayout:u.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(v=this.view.buttonElement)===null||v===void 0||v.addEventListener("blur",this.onPadButtonBlur_),(P=this.view.buttonElement)===null||P===void 0||P.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),ul({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:w=>w,backward:(w,a)=>a})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),vp(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(o){if(!this.popC_)return;const u=this.view.element,v=o.relatedTarget;(!v||!u.contains(v))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(o){if(!this.popC_)return;const u=this.popC_.view.element,v=C_(o);v&&u.contains(v)||v&&v===this.view.buttonElement&&!pp(u.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(o){this.popC_?o.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&o.key==="Escape"&&this.view.buttonElement.focus()}}function Nx(_){return ro.isObject(_)?new ro(_.x,_.y):new ro}function Ux(_,o){_.writeProperty("x",o.x),_.writeProperty("y",o.y)}function $x(_,o){return new Ip({assembly:og,components:[fs(Object.assign(Object.assign({},_),_.x),o.x),fs(Object.assign(Object.assign({},_),_.y),o.y)]})}function $m(_,o){var u,v;if(!zr(_.min)||!zr(_.max))return Math.max(Math.abs((u=_.min)!==null&&u!==void 0?u:0),Math.abs((v=_.max)!==null&&v!==void 0?v:0));const P=f_(_);return Math.max(Math.abs(P)*10,Math.abs(o)*10)}function Zx(_,o){var u,v;const P=$m(Jo(_,(u=_.x)!==null&&u!==void 0?u:{}),o.x),k=$m(Jo(_,(v=_.y)!==null&&v!==void 0?v:{}),o.y);return Math.max(P,k)}function Gx(_){if(!("y"in _))return!1;const o=_.y;return o&&"inverted"in o?!!o.inverted:!1}const qx=Ni({id:"input-point2d",type:"input",accept:(_,o)=>{if(!ro.isObject(_))return null;const u=Nr(o,v=>Object.assign(Object.assign({},Lc(v)),{expanded:v.optional.boolean,picker:v.optional.custom(O_),readonly:v.optional.constant(!1),x:v.optional.custom(to),y:v.optional.object(Object.assign(Object.assign({},Lc(v)),{inverted:v.optional.boolean}))}));return u?{initialValue:_,params:u}:null},binding:{reader:()=>Nx,constraint:_=>$x(_.params,_.initialValue),equals:ro.equals,writer:()=>Ux},controller:_=>{var o,u;const v=_.document,P=_.value,k=_.constraint,w=[_.params.x,_.params.y];return new Vx(v,{axes:P.rawValue.getComponents().map((a,$)=>{var K;return dp({constraint:k.components[$],initialValue:a,params:Jo(_.params,(K=w[$])!==null&&K!==void 0?K:{})})}),expanded:(o=_.params.expanded)!==null&&o!==void 0?o:!1,invertsY:Gx(_.params),max:Zx(_.params,P.rawValue),parser:_s,pickerLayout:(u=_.params.picker)!==null&&u!==void 0?u:"popup",value:P,viewProps:_.viewProps})}});class il{constructor(o=0,u=0,v=0){this.x=o,this.y=u,this.z=v}getComponents(){return[this.x,this.y,this.z]}static isObject(o){if(zr(o))return!1;const u=o.x,v=o.y,P=o.z;return!(typeof u!="number"||typeof v!="number"||typeof P!="number")}static equals(o,u){return o.x===u.x&&o.y===u.y&&o.z===u.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const ag={toComponents:_=>_.getComponents(),fromComponents:_=>new il(..._)};function Wx(_){return il.isObject(_)?new il(_.x,_.y,_.z):new il}function Hx(_,o){_.writeProperty("x",o.x),_.writeProperty("y",o.y),_.writeProperty("z",o.z)}function Xx(_,o){return new Ip({assembly:ag,components:[fs(Object.assign(Object.assign({},_),_.x),o.x),fs(Object.assign(Object.assign({},_),_.y),o.y),fs(Object.assign(Object.assign({},_),_.z),o.z)]})}const Kx=Ni({id:"input-point3d",type:"input",accept:(_,o)=>{if(!il.isObject(_))return null;const u=Nr(o,v=>Object.assign(Object.assign({},Lc(v)),{readonly:v.optional.constant(!1),x:v.optional.custom(to),y:v.optional.custom(to),z:v.optional.custom(to)}));return u?{initialValue:_,params:u}:null},binding:{reader:_=>Wx,constraint:_=>Xx(_.params,_.initialValue),equals:il.equals,writer:_=>Hx},controller:_=>{const o=_.value,u=_.constraint,v=[_.params.x,_.params.y,_.params.z];return new Ap(_.document,{assembly:ag,axes:o.rawValue.getComponents().map((P,k)=>{var w;return dp({constraint:u.components[k],initialValue:P,params:Jo(_.params,(w=v[k])!==null&&w!==void 0?w:{})})}),parser:_s,value:o,viewProps:_.viewProps})}});class nl{constructor(o=0,u=0,v=0,P=0){this.x=o,this.y=u,this.z=v,this.w=P}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(o){if(zr(o))return!1;const u=o.x,v=o.y,P=o.z,k=o.w;return!(typeof u!="number"||typeof v!="number"||typeof P!="number"||typeof k!="number")}static equals(o,u){return o.x===u.x&&o.y===u.y&&o.z===u.z&&o.w===u.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const lg={toComponents:_=>_.getComponents(),fromComponents:_=>new nl(..._)};function Yx(_){return nl.isObject(_)?new nl(_.x,_.y,_.z,_.w):new nl}function Jx(_,o){_.writeProperty("x",o.x),_.writeProperty("y",o.y),_.writeProperty("z",o.z),_.writeProperty("w",o.w)}function Qx(_,o){return new Ip({assembly:lg,components:[fs(Object.assign(Object.assign({},_),_.x),o.x),fs(Object.assign(Object.assign({},_),_.y),o.y),fs(Object.assign(Object.assign({},_),_.z),o.z),fs(Object.assign(Object.assign({},_),_.w),o.w)]})}const ew=Ni({id:"input-point4d",type:"input",accept:(_,o)=>{if(!nl.isObject(_))return null;const u=Nr(o,v=>Object.assign(Object.assign({},Lc(v)),{readonly:v.optional.constant(!1),w:v.optional.custom(to),x:v.optional.custom(to),y:v.optional.custom(to),z:v.optional.custom(to)}));return u?{initialValue:_,params:u}:null},binding:{reader:_=>Yx,constraint:_=>Qx(_.params,_.initialValue),equals:nl.equals,writer:_=>Jx},controller:_=>{const o=_.value,u=_.constraint,v=[_.params.x,_.params.y,_.params.z,_.params.w];return new Ap(_.document,{assembly:lg,axes:o.rawValue.getComponents().map((P,k)=>{var w;return dp({constraint:u.components[k],initialValue:P,params:Jo(_.params,(w=v[k])!==null&&w!==void 0?w:{})})}),parser:_s,value:o,viewProps:_.viewProps})}});function tw(_){const o=[],u=wp(_.options);return u&&o.push(u),new jc(o)}const rw=Ni({id:"input-string",type:"input",accept:(_,o)=>{if(typeof _!="string")return null;const u=Nr(o,v=>({readonly:v.optional.constant(!1),options:v.optional.custom(Nc)}));return u?{initialValue:_,params:u}:null},binding:{reader:_=>R_,constraint:_=>tw(_.params),writer:_=>$c},controller:_=>{const o=_.document,u=_.value,v=_.constraint,P=v&&_u(v,Vc);return P?new io(o,{props:new sr({options:P.values.value("options")}),value:u,viewProps:_.viewProps}):new Dc(o,{parser:k=>k,props:sr.fromObject({formatter:sp}),value:u,viewProps:_.viewProps})},api(_){return typeof _.controller.value.rawValue!="string"?null:_.controller.valueController instanceof io?new bp(_.controller):null}}),Gc={monitor:{defaultInterval:200,defaultRows:3}},Zm=dr("mll");class iw{constructor(o,u){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=u.formatter,this.element=o.createElement("div"),this.element.classList.add(Zm()),u.viewProps.bindClassModifiers(this.element);const v=o.createElement("textarea");v.classList.add(Zm("i")),v.style.height=`calc(var(${B_("containerUnitSize")}) * ${u.rows})`,v.readOnly=!0,u.viewProps.bindDisabled(v),this.element.appendChild(v),this.textareaElem_=v,u.value.emitter.on("change",this.onValueUpdate_),this.value=u.value,this.update_()}update_(){const o=this.textareaElem_,u=o.scrollTop===o.scrollHeight-o.clientHeight,v=[];this.value.rawValue.forEach(P=>{P!==void 0&&v.push(this.formatter_(P))}),o.textContent=v.join(`
`),u&&(o.scrollTop=o.scrollHeight)}onValueUpdate_(){this.update_()}}class zp{constructor(o,u){this.value=u.value,this.viewProps=u.viewProps,this.view=new iw(o,{formatter:u.formatter,rows:u.rows,value:this.value,viewProps:this.viewProps})}}const Gm=dr("sgl");class nw{constructor(o,u){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=u.formatter,this.element=o.createElement("div"),this.element.classList.add(Gm()),u.viewProps.bindClassModifiers(this.element);const v=o.createElement("input");v.classList.add(Gm("i")),v.readOnly=!0,v.type="text",u.viewProps.bindDisabled(v),this.element.appendChild(v),this.inputElement=v,u.value.emitter.on("change",this.onValueUpdate_),this.value=u.value,this.update_()}update_(){const o=this.value.rawValue,u=o[o.length-1];this.inputElement.value=u!==void 0?this.formatter_(u):""}onValueUpdate_(){this.update_()}}class Dp{constructor(o,u){this.value=u.value,this.viewProps=u.viewProps,this.view=new nw(o,{formatter:u.formatter,value:this.value,viewProps:this.viewProps})}}const sw=Ni({id:"monitor-bool",type:"monitor",accept:(_,o)=>{if(typeof _!="boolean")return null;const u=Nr(o,v=>({readonly:v.required.constant(!0),rows:v.optional.number}));return u?{initialValue:_,params:u}:null},binding:{reader:_=>D_},controller:_=>{var o;return _.value.rawValue.length===1?new Dp(_.document,{formatter:Bm,value:_.value,viewProps:_.viewProps}):new zp(_.document,{formatter:Bm,rows:(o=_.params.rows)!==null&&o!==void 0?o:Gc.monitor.defaultRows,value:_.value,viewProps:_.viewProps})}});class ow extends zc{get max(){return this.controller.valueController.props.get("max")}set max(o){this.controller.valueController.props.set("max",o)}get min(){return this.controller.valueController.props.get("min")}set min(o){this.controller.valueController.props.set("min",o)}}const Qs=dr("grl");class aw{constructor(o,u){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=o.createElement("div"),this.element.classList.add(Qs()),u.viewProps.bindClassModifiers(this.element),this.formatter_=u.formatter,this.props_=u.props,this.cursor_=u.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const v=o.createElementNS(Wn,"svg");v.classList.add(Qs("g")),v.style.height=`calc(var(${B_("containerUnitSize")}) * ${u.rows})`,this.element.appendChild(v),this.svgElem_=v;const P=o.createElementNS(Wn,"polyline");this.svgElem_.appendChild(P),this.lineElem_=P;const k=o.createElement("div");k.classList.add(Qs("t"),dr("tt")()),this.element.appendChild(k),this.tooltipElem_=k,u.value.emitter.on("change",this.onValueUpdate_),this.value=u.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const{clientWidth:o,clientHeight:u}=this.element,v=this.value.rawValue.length-1,P=this.props_.get("min"),k=this.props_.get("max"),w=[];this.value.rawValue.forEach((te,oe)=>{if(te===void 0)return;const L=vr(oe,0,v,0,o),H=vr(te,P,k,u,0);w.push([L,H].join(","))}),this.lineElem_.setAttributeNS(null,"points",w.join(" "));const a=this.tooltipElem_,$=this.value.rawValue[this.cursor_.rawValue];if($===void 0){a.classList.remove(Qs("t","a"));return}const K=vr(this.cursor_.rawValue,0,v,0,o),ne=vr($,P,k,u,0);a.style.left=`${K}px`,a.style.top=`${ne}px`,a.textContent=`${this.formatter_($)}`,a.classList.contains(Qs("t","a"))||(a.classList.add(Qs("t","a"),Qs("t","in")),mu(a),a.classList.remove(Qs("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class cg{constructor(o,u){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=u.props,this.value=u.value,this.viewProps=u.viewProps,this.cursor_=Or(-1),this.view=new aw(o,{cursor:this.cursor_,formatter:u.formatter,rows:u.rows,props:this.props,value:this.value,viewProps:this.viewProps}),!pp(o))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const v=new ia(this.view.element);v.emitter.on("down",this.onGraphPointerDown_),v.emitter.on("move",this.onGraphPointerMove_),v.emitter.on("up",this.onGraphPointerUp_)}}importProps(o){return on(o,null,u=>({max:u.required.number,min:u.required.number}),u=>(this.props.set("max",u.max),this.props.set("min",u.min),!0))}exportProps(){return an(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(o){const{clientWidth:u}=this.view.element;this.cursor_.rawValue=Math.floor(vr(o.offsetX,0,u,0,this.value.rawValue.length))}onGraphPointerDown_(o){this.onGraphPointerMove_(o)}onGraphPointerMove_(o){if(!o.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(vr(o.data.point.x,0,o.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function op(_){return zr(_.format)?Hi(2):_.format}function lw(_){var o;return _.value.rawValue.length===1?new Dp(_.document,{formatter:op(_.params),value:_.value,viewProps:_.viewProps}):new zp(_.document,{formatter:op(_.params),rows:(o=_.params.rows)!==null&&o!==void 0?o:Gc.monitor.defaultRows,value:_.value,viewProps:_.viewProps})}function cw(_){var o,u,v;return new cg(_.document,{formatter:op(_.params),rows:(o=_.params.rows)!==null&&o!==void 0?o:Gc.monitor.defaultRows,props:sr.fromObject({max:(u=_.params.max)!==null&&u!==void 0?u:100,min:(v=_.params.min)!==null&&v!==void 0?v:0}),value:_.value,viewProps:_.viewProps})}function qm(_){return _.view==="graph"}const hw=Ni({id:"monitor-number",type:"monitor",accept:(_,o)=>{if(typeof _!="number")return null;const u=Nr(o,v=>({format:v.optional.function,max:v.optional.number,min:v.optional.number,readonly:v.required.constant(!0),rows:v.optional.number,view:v.optional.string}));return u?{initialValue:_,params:u}:null},binding:{defaultBufferSize:_=>qm(_)?64:1,reader:_=>d_},controller:_=>qm(_.params)?cw(_):lw(_),api:_=>_.controller.valueController instanceof cg?new ow(_.controller):null}),uw=Ni({id:"monitor-string",type:"monitor",accept:(_,o)=>{if(typeof _!="string")return null;const u=Nr(o,v=>({multiline:v.optional.boolean,readonly:v.required.constant(!0),rows:v.optional.number}));return u?{initialValue:_,params:u}:null},binding:{reader:_=>R_},controller:_=>{var o;const u=_.value;return u.rawValue.length>1||_.params.multiline?new zp(_.document,{formatter:sp,rows:(o=_.params.rows)!==null&&o!==void 0?o:Gc.monitor.defaultRows,value:u,viewProps:_.viewProps}):new Dp(_.document,{formatter:sp,value:u,viewProps:_.viewProps})}});class dw{constructor(){this.map_=new Map}get(o){var u;return(u=this.map_.get(o))!==null&&u!==void 0?u:null}has(o){return this.map_.has(o)}add(o,u){return this.map_.set(o,u),o.viewProps.handleDispose(()=>{this.map_.delete(o)}),u}}class pw{constructor(o){this.target=o.target,this.reader_=o.reader,this.writer_=o.writer}read(){return this.reader_(this.target.read())}write(o){this.writer_(this.target,o)}inject(o){this.write(this.reader_(o))}}function fw(_,o){var u;const v=_.accept(o.target.read(),o.params);if(zr(v))return null;const P={target:o.target,initialValue:v.initialValue,params:v.params},k=Nr(o.params,te=>({disabled:te.optional.boolean,hidden:te.optional.boolean,label:te.optional.string,tag:te.optional.string})),w=_.binding.reader(P),a=_.binding.constraint?_.binding.constraint(P):void 0,$=new pw({reader:w,target:o.target,writer:_.binding.writer(P)}),K=new Yv(Or(w(v.initialValue),{constraint:a,equals:_.binding.equals}),$),ne=_.controller({constraint:a,document:o.document,initialValue:v.initialValue,params:v.params,value:K,viewProps:ys.create({disabled:k==null?void 0:k.disabled,hidden:k==null?void 0:k.hidden})});return new db(o.document,{blade:hl(),props:sr.fromObject({label:"label"in o.params?(u=k==null?void 0:k.label)!==null&&u!==void 0?u:null:o.target.key}),tag:k==null?void 0:k.tag,value:K,valueController:ne})}class mw{constructor(o){this.target=o.target,this.reader_=o.reader}read(){return this.reader_(this.target.read())}}function _w(_,o){return o===0?new Hb:new Xb(_,o??Gc.monitor.defaultInterval)}function gw(_,o){var u,v,P;const k=_.accept(o.target.read(),o.params);if(zr(k))return null;const w={target:o.target,initialValue:k.initialValue,params:k.params},a=Nr(o.params,oe=>({bufferSize:oe.optional.number,disabled:oe.optional.boolean,hidden:oe.optional.boolean,interval:oe.optional.number,label:oe.optional.string})),$=_.binding.reader(w),K=(v=(u=a==null?void 0:a.bufferSize)!==null&&u!==void 0?u:_.binding.defaultBufferSize&&_.binding.defaultBufferSize(k.params))!==null&&v!==void 0?v:1,ne=new gb({binding:new mw({reader:$,target:o.target}),bufferSize:K,ticker:_w(o.document,a==null?void 0:a.interval)}),te=_.controller({document:o.document,params:k.params,value:ne,viewProps:ys.create({disabled:a==null?void 0:a.disabled,hidden:a==null?void 0:a.hidden})});return te.viewProps.bindDisabled(ne.ticker),te.viewProps.handleDispose(()=>{ne.ticker.dispose()}),new vb(o.document,{blade:hl(),props:sr.fromObject({label:"label"in o.params?(P=a==null?void 0:a.label)!==null&&P!==void 0?P:null:o.target.key}),value:ne,valueController:te})}class yw{constructor(o){this.pluginsMap_={blades:[],inputs:[],monitors:[]},this.apiCache_=o}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(o,u){if(!l0(u.core))throw qr.notCompatible(o,u.id);u.type==="blade"?this.pluginsMap_.blades.unshift(u):u.type==="input"?this.pluginsMap_.inputs.unshift(u):u.type==="monitor"&&this.pluginsMap_.monitors.unshift(u)}createInput_(o,u,v){return this.pluginsMap_.inputs.reduce((P,k)=>P??fw(k,{document:o,target:u,params:v}),null)}createMonitor_(o,u,v){return this.pluginsMap_.monitors.reduce((P,k)=>P??gw(k,{document:o,params:v,target:u}),null)}createBinding(o,u,v){const P=u.read();if(zr(P))throw new qr({context:{key:u.key},type:"nomatchingcontroller"});const k=this.createInput_(o,u,v);if(k)return k;const w=this.createMonitor_(o,u,v);if(w)return w;throw new qr({context:{key:u.key},type:"nomatchingcontroller"})}createBlade(o,u){const v=this.pluginsMap_.blades.reduce((P,k)=>P??Wb(k,{document:o,params:u}),null);if(!v)throw new qr({type:"nomatchingview",context:{params:u}});return v}createInputBindingApi_(o){const u=this.pluginsMap_.inputs.reduce((v,P)=>{var k,w;return v||((w=(k=P.api)===null||k===void 0?void 0:k.call(P,{controller:o}))!==null&&w!==void 0?w:null)},null);return this.apiCache_.add(o,u??new zc(o))}createMonitorBindingApi_(o){const u=this.pluginsMap_.monitors.reduce((v,P)=>{var k,w;return v||((w=(k=P.api)===null||k===void 0?void 0:k.call(P,{controller:o}))!==null&&w!==void 0?w:null)},null);return this.apiCache_.add(o,u??new zc(o))}createBindingApi(o){if(this.apiCache_.has(o))return this.apiCache_.get(o);if(pb(o))return this.createInputBindingApi_(o);if(bb(o))return this.createMonitorBindingApi_(o);throw qr.shouldNeverHappen()}createApi(o){if(this.apiCache_.has(o))return this.apiCache_.get(o);if(ub(o))return this.createBindingApi(o);const u=this.pluginsMap_.blades.reduce((v,P)=>v??P.api({controller:o,pool:this}),null);if(!u)throw qr.shouldNeverHappen();return this.apiCache_.add(o,u)}}const vw=new dw;function bw(){const _=new yw(vw);return[qx,Kx,ew,rw,Fx,Ax,Ix,Tx,d0,sw,uw,hw,Tb,Ob,A_].forEach(o=>{_.register("core",o)}),_}class xw extends ra{constructor(o){super(o),this.emitter_=new oi,this.controller.value.emitter.on("change",u=>{this.emitter_.emit("change",new Bc(this,u.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(o){this.controller.labelController.props.set("label",o)}get options(){return this.controller.valueController.props.get("options")}set options(o){this.controller.valueController.props.set("options",o)}get value(){return this.controller.value.rawValue}set value(o){this.controller.value.rawValue=o}on(o,u){const v=u.bind(this);return this.emitter_.on(o,P=>{v(P)},{key:u}),this}off(o,u){return this.emitter_.off(o,u),this}}class ww extends ra{}class Cw extends ra{constructor(o){super(o),this.emitter_=new oi,this.controller.value.emitter.on("change",u=>{this.emitter_.emit("change",new Bc(this,u.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(o){this.controller.labelController.props.set("label",o)}get max(){return this.controller.valueController.sliderController.props.get("max")}set max(o){this.controller.valueController.sliderController.props.set("max",o)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(o){this.controller.valueController.sliderController.props.set("min",o)}get value(){return this.controller.value.rawValue}set value(o){this.controller.value.rawValue=o}on(o,u){const v=u.bind(this);return this.emitter_.on(o,P=>{v(P)},{key:u}),this}off(o,u){return this.emitter_.off(o,u),this}}class Pw extends ra{constructor(o){super(o),this.emitter_=new oi,this.controller.value.emitter.on("change",u=>{this.emitter_.emit("change",new Bc(this,u.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(o){this.controller.labelController.props.set("label",o)}get formatter(){return this.controller.valueController.props.get("formatter")}set formatter(o){this.controller.valueController.props.set("formatter",o)}get value(){return this.controller.value.rawValue}set value(o){this.controller.value.rawValue=o}on(o,u){const v=u.bind(this);return this.emitter_.on(o,P=>{v(P)},{key:u}),this}off(o,u){return this.emitter_.off(o,u),this}}const Tw=function(){return{id:"list",type:"blade",core:cl,accept(_){const o=Nr(_,u=>({options:u.required.custom(Nc),value:u.required.raw,view:u.required.constant("list"),label:u.optional.string}));return o?{params:o}:null},controller(_){const o=new Vc(xp(_.params.options)),u=Or(_.params.value,{constraint:o}),v=new io(_.document,{props:new sr({options:o.values.value("options")}),value:u,viewProps:_.viewProps});return new Qo(_.document,{blade:_.blade,props:sr.fromObject({label:_.params.label}),value:u,valueController:v})},api(_){return!(_.controller instanceof Qo)||!(_.controller.valueController instanceof io)?null:new xw(_.controller)}}}();class Sw extends M_{constructor(o,u){super(o,u)}get element(){return this.controller.view.element}}class Ew extends ip{constructor(o,u){super(o,{expanded:u.expanded,blade:u.blade,props:u.props,root:!0,viewProps:u.viewProps})}}const Wm=dr("spr");class kw{constructor(o,u){this.element=o.createElement("div"),this.element.classList.add(Wm()),u.viewProps.bindClassModifiers(this.element);const v=o.createElement("hr");v.classList.add(Wm("r")),this.element.appendChild(v)}}class Hm extends xu{constructor(o,u){super(Object.assign(Object.assign({},u),{view:new kw(o,{viewProps:u.viewProps})}))}}const Mw={id:"separator",type:"blade",core:cl,accept(_){const o=Nr(_,u=>({view:u.required.constant("separator")}));return o?{params:o}:null},controller(_){return new Hm(_.document,{blade:_.blade,viewProps:_.viewProps})},api(_){return _.controller instanceof Hm?new ww(_.controller):null}},Iw={id:"slider",type:"blade",core:cl,accept(_){const o=Nr(_,u=>({max:u.required.number,min:u.required.number,view:u.required.constant("slider"),format:u.optional.function,label:u.optional.string,value:u.optional.number}));return o?{params:o}:null},controller(_){var o,u;const v=(o=_.params.value)!==null&&o!==void 0?o:0,P=new Fc({max:_.params.max,min:_.params.min}),k=Or(v,{constraint:P}),w=new yu(_.document,Object.assign(Object.assign({},F_({formatter:(u=_.params.format)!==null&&u!==void 0?u:qv,keyScale:Or(1),max:P.values.value("max"),min:P.values.value("min"),pointerScale:m_(_.params,v)})),{parser:_s,value:k,viewProps:_.viewProps}));return new Qo(_.document,{blade:_.blade,props:sr.fromObject({label:_.params.label}),value:k,valueController:w})},api(_){return!(_.controller instanceof Qo)||!(_.controller.valueController instanceof yu)?null:new Cw(_.controller)}},Aw=function(){return{id:"text",type:"blade",core:cl,accept(_){const o=Nr(_,u=>({parse:u.required.function,value:u.required.raw,view:u.required.constant("text"),format:u.optional.function,label:u.optional.string}));return o?{params:o}:null},controller(_){var o;const u=Or(_.params.value),v=new Dc(_.document,{parser:_.params.parse,props:sr.fromObject({formatter:(o=_.params.format)!==null&&o!==void 0?o:P=>String(P)}),value:u,viewProps:_.viewProps});return new Qo(_.document,{blade:_.blade,props:sr.fromObject({label:_.params.label}),value:u,valueController:v})},api(_){return!(_.controller instanceof Qo)||!(_.controller.valueController instanceof Dc)?null:new Pw(_.controller)}}}();function zw(_){const o=_.createElement("div");return o.classList.add(dr("dfw")()),_.body&&_.body.appendChild(o),o}function Dw(_,o,u){if(_.querySelector(`style[data-tp-style=${o}]`))return;const v=_.createElement("style");v.dataset.tpStyle=o,v.textContent=u,_.head.appendChild(v)}class hg extends Sw{constructor(o){var u,v;const P=o??{},k=(u=P.document)!==null&&u!==void 0?u:nb(),w=bw(),a=new Ew(k,{expanded:P.expanded,blade:hl(),props:sr.fromObject({title:P.title}),viewProps:ys.create()});super(a,w),this.pool_=w,this.containerElem_=(v=P.container)!==null&&v!==void 0?v:zw(k),this.containerElem_.appendChild(this.element),this.doc_=k,this.usesDefaultWrapper_=!P.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw qr.alreadyDisposed();return this.doc_}dispose(){const o=this.containerElem_;if(!o)throw qr.alreadyDisposed();if(this.usesDefaultWrapper_){const u=o.parentElement;u&&u.removeChild(o)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(o){o.css&&Dw(this.document,`plugin-${o.id}`,o.css),("plugin"in o?[o.plugin]:"plugins"in o?o.plugins:[]).forEach(v=>{this.pool_.register(o.id,v)})}setUpDefaultPlugins_(){this.registerPlugin({id:"default",css:'.tp-tbiv_b,.tp-coltxtv_ms,.tp-colswv_b,.tp-ckbv_i,.tp-sglv_i,.tp-mllv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-rotv_b,.tp-fldv_b,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--bld-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--cnt-usz);line-height:var(--cnt-usz);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tbpv_c>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-vp))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tbpv_c>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--cnt-usp)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tbpv_c>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tbpv_c>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tbpv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tbpv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tbpv_c>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tbpv_c>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--bld-br);border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tbpv_c .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tbpv_c>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tbpv_c>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--bld-br)}.tp-tbpv_c .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--bld-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);overflow:hidden;padding-left:var(--cnt-hp);padding-right:calc(4px + var(--cnt-usz) + var(--cnt-hp));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-hp) + (var(--cnt-usz) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-vp);padding-top:var(--cnt-vp);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--cnt-usz);line-height:var(--cnt-usz);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-sglv_i,.tp-mllv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--mo-fg);height:var(--cnt-usz);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-sglv_i::-webkit-scrollbar,.tp-mllv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-sglv_i::-webkit-scrollbar-corner,.tp-mllv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-sglv_i::-webkit-scrollbar-thumb,.tp-mllv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-rotv{--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-br: var(--tp-base-border-radius, 6px);--bs-ff: var(--tp-base-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--bld-br: var(--tp-blade-border-radius, 2px);--bld-hp: var(--tp-blade-horizontal-padding, 4px);--bld-vw: var(--tp-blade-value-width, 160px);--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--cnt-hp: var(--tp-container-horizontal-padding, 4px);--cnt-vp: var(--tp-container-vertical-padding, 4px);--cnt-usp: var(--tp-container-unit-spacing, 4px);--cnt-usz: var(--tp-container-unit-size, 20px);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--bld-br);cursor:pointer;display:block;height:var(--cnt-usz);position:relative;width:var(--cnt-usz)}.tp-ckbv_w svg{display:block;height:16px;inset:0;margin:auto;opacity:0;position:absolute;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--cnt-usz)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--cnt-usp);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--cnt-usp)}.tp-colpv_rgb{display:flex;margin-top:var(--cnt-usp);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-vp);padding-top:calc(var(--cnt-vp) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-hp));position:absolute;right:calc(-1*var(--cnt-hp));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--bld-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--cnt-usz)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{inset:0;position:absolute}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--bld-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;inset:0;position:absolute}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--bld-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{cursor:pointer;display:block;height:var(--cnt-usz);left:0;position:absolute;top:0;width:var(--cnt-usz)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--bld-br);content:"";display:block;inset:0;position:absolute}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--bld-br);color:var(--lbl-fg);cursor:pointer;height:var(--cnt-usz);line-height:var(--cnt-usz);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--cnt-usz)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-hp);padding-right:var(--cnt-hp)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:var(--bld-vw)}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 var(--bld-hp);width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--cnt-usz)*3);line-height:var(--cnt-usz);padding-left:var(--bld-hp);padding-right:var(--bld-hp);resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--cnt-usz);margin-right:4px;position:relative;width:var(--cnt-usz)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--cnt-usp);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-p2dpv{padding-left:calc(var(--cnt-usz) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:var(--bld-vw);padding:var(--cnt-vp) var(--cnt-hp);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--cnt-usz);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";display:block;height:2px;inset:0;margin:auto;position:absolute}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;content:"";display:block;height:2px;inset:0;margin-bottom:auto;margin-top:auto;position:absolute}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--bld-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--cnt-usz) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-hp) + 4px);padding-right:calc(var(--cnt-hp) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);content:"";inset:0 0 2px;pointer-events:none;position:absolute}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);opacity:.5;overflow:hidden;position:relative;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-tbpv_c{padding-bottom:var(--cnt-vp);padding-left:4px;padding-top:var(--cnt-vp)}.tp-txtv{position:relative}.tp-txtv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:calc(var(--bld-hp) - 5px);position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--cnt-usz) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--bld-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--bs-ff);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--cnt-usz) + var(--cnt-hp));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0;transition-delay:0s;transition-duration:0s}.tp-rotv.tp-rotv-not>.tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst.tp-fldv-expanded>.tp-fldv_b{transition-delay:0s;transition-duration:0s}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}',plugins:[Tw,Mw,Iw,A_,Aw]})}}new k_("4.0.5");const qc=document.createElement("canvas");qc.id="canvas-layer";qc.style.display="none";document.body.appendChild(qc);const Xm=qc.transferControlToOffscreen(),na=new Worker(new URL(""+new URL("worker.canvas-layer-2yX3ATm2.js",import.meta.url).href,import.meta.url),{type:"module"});na.postMessage({type:"init",canvas:Xm},[Xm]);const Di=new uv.Map({container:"map",style:{version:8,glyphs:"https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf",sources:{pale:{type:"raster",tiles:["https://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png"],tileSize:256,minzoom:0,maxzoom:18,attribution:""}},layers:[{id:"pale",type:"raster",source:"pale",minzoom:0,maxzoom:22,paint:{"raster-opacity":.7,"raster-brightness-min":1,"raster-brightness-max":0,"raster-saturation":-1,"raster-contrast":0}}]},center:[139.477,35.681],zoom:4}),pu={id:"canvas-layer",type:"raster",source:"canvas-source",paint:{"raster-opacity":1}},Rw=async _=>{var te;if(!Di)throw new Error("MapLibre map instance is not initialized.");const{demArray:o,statistics:u}=_,v=o.length,P=((te=o[0])==null?void 0:te.length)||0,k=new Float32Array(P*v);let w=0;for(let oe=0;oe<v;oe++)for(let L=0;L<P;L++){let H=o[oe][L];k[w]=H,w++}const a=u.minElevation,$=u.maxElevation,K=[u.bounds.lower_left.lon,u.bounds.lower_left.lat,u.bounds.upper_right.lon,u.bounds.upper_right.lat],ne={array:k,bbox:K,min:a,max:$,height:v,width:P};na.postMessage({type:"add",option:ne}),Di.getSource("canvas-source")&&(Di.removeLayer("canvas-layer"),Di.removeSource("canvas-source")),Di.addSource("canvas-source",{type:"canvas",canvas:qc,coordinates:[[K[0],K[3]],[K[2],K[3]],[K[2],K[1]],[K[0],K[1]]],animate:!0}),Di.addLayer(pu),Di.fitBounds(K,{padding:{top:50,bottom:50,left:50,right:50},duration:0})},Lw=()=>{if(!Di){console.error("MapLibre map instance is not initialized.");return}Di.getLayer("canvas-layer")&&Di.removeLayer("canvas-layer"),Di.getSource("canvas-source")&&Di.removeSource("canvas-source")},Km=_=>{const o=document.getElementById("map");if(!o){console.error("Map container not found.");return}o.style.display=_?"block":"none",_&&!Di.isStyleLoaded()&&Di.resize()},dl=new hg({title:"",container:document.getElementById("tweakpane-map")});dl.addBinding(pu.paint,"raster-opacity",{min:0,max:1,label:"",step:.01}).on("change",_=>{Di.getLayer(pu.id)&&Di.setPaintProperty(pu.id,"raster-opacity",_.value)});dl.addBinding(gn,"u_max",{min:0,max:4e3,label:"",step:.01}).on("change",_=>{gn.u_max=_.value,na.postMessage({type:"updateUniforms",key:"u_max",value:_.value})});dl.addBinding(gn,"u_min",{min:0,max:4e3,label:"",step:.01}).on("change",_=>{gn.u_min=_.value,na.postMessage({type:"updateUniforms",key:"u_min",value:_.value})});dl.addBinding(gn,"u_max_color",{label:"",color:{type:"float"}}).on("change",_=>{gn.u_max_color=_.value,na.postMessage({type:"updateUniforms",key:"u_max_color",value:_.value})});dl.addBinding(gn,"u_min_color",{label:"",color:{type:"float"}}).on("change",_=>{gn.u_min_color=_.value,na.postMessage({type:"updateUniforms",key:"u_min_color",value:_.value})});na.onmessage=_=>{switch(_.data.type){case"update":gn.u_min_color=_.data.uniforms.u_min_color,gn.u_max_color=_.data.uniforms.u_max_color,gn.u_min=_.data.uniforms.u_min,gn.u_max=_.data.uniforms.u_max,dl.refresh();break}};/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const ug="177",Fw="",zn="srgb",Ym="srgb-linear",Jm="linear",Xd="srgb";function kc(_,o,u){return Math.max(o,Math.min(u,_))}function Bw(_,o){return(_%o+o)%o}function Kd(_,o,u){return(1-u)*_+u*o}class Wc{constructor(o,u,v,P,k,w,a,$,K){Wc.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],o!==void 0&&this.set(o,u,v,P,k,w,a,$,K)}set(o,u,v,P,k,w,a,$,K){const ne=this.elements;return ne[0]=o,ne[1]=P,ne[2]=a,ne[3]=u,ne[4]=k,ne[5]=$,ne[6]=v,ne[7]=w,ne[8]=K,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(o){const u=this.elements,v=o.elements;return u[0]=v[0],u[1]=v[1],u[2]=v[2],u[3]=v[3],u[4]=v[4],u[5]=v[5],u[6]=v[6],u[7]=v[7],u[8]=v[8],this}extractBasis(o,u,v){return o.setFromMatrix3Column(this,0),u.setFromMatrix3Column(this,1),v.setFromMatrix3Column(this,2),this}setFromMatrix4(o){const u=o.elements;return this.set(u[0],u[4],u[8],u[1],u[5],u[9],u[2],u[6],u[10]),this}multiply(o){return this.multiplyMatrices(this,o)}premultiply(o){return this.multiplyMatrices(o,this)}multiplyMatrices(o,u){const v=o.elements,P=u.elements,k=this.elements,w=v[0],a=v[3],$=v[6],K=v[1],ne=v[4],te=v[7],oe=v[2],L=v[5],H=v[8],q=P[0],le=P[3],ie=P[6],ge=P[1],Te=P[4],Ae=P[7],Me=P[2],qe=P[5],He=P[8];return k[0]=w*q+a*ge+$*Me,k[3]=w*le+a*Te+$*qe,k[6]=w*ie+a*Ae+$*He,k[1]=K*q+ne*ge+te*Me,k[4]=K*le+ne*Te+te*qe,k[7]=K*ie+ne*Ae+te*He,k[2]=oe*q+L*ge+H*Me,k[5]=oe*le+L*Te+H*qe,k[8]=oe*ie+L*Ae+H*He,this}multiplyScalar(o){const u=this.elements;return u[0]*=o,u[3]*=o,u[6]*=o,u[1]*=o,u[4]*=o,u[7]*=o,u[2]*=o,u[5]*=o,u[8]*=o,this}determinant(){const o=this.elements,u=o[0],v=o[1],P=o[2],k=o[3],w=o[4],a=o[5],$=o[6],K=o[7],ne=o[8];return u*w*ne-u*a*K-v*k*ne+v*a*$+P*k*K-P*w*$}invert(){const o=this.elements,u=o[0],v=o[1],P=o[2],k=o[3],w=o[4],a=o[5],$=o[6],K=o[7],ne=o[8],te=ne*w-a*K,oe=a*$-ne*k,L=K*k-w*$,H=u*te+v*oe+P*L;if(H===0)return this.set(0,0,0,0,0,0,0,0,0);const q=1/H;return o[0]=te*q,o[1]=(P*K-ne*v)*q,o[2]=(a*v-P*w)*q,o[3]=oe*q,o[4]=(ne*u-P*$)*q,o[5]=(P*k-a*u)*q,o[6]=L*q,o[7]=(v*$-K*u)*q,o[8]=(w*u-v*k)*q,this}transpose(){let o;const u=this.elements;return o=u[1],u[1]=u[3],u[3]=o,o=u[2],u[2]=u[6],u[6]=o,o=u[5],u[5]=u[7],u[7]=o,this}getNormalMatrix(o){return this.setFromMatrix4(o).invert().transpose()}transposeIntoArray(o){const u=this.elements;return o[0]=u[0],o[1]=u[3],o[2]=u[6],o[3]=u[1],o[4]=u[4],o[5]=u[7],o[6]=u[2],o[7]=u[5],o[8]=u[8],this}setUvTransform(o,u,v,P,k,w,a){const $=Math.cos(k),K=Math.sin(k);return this.set(v*$,v*K,-v*($*w+K*a)+w+o,-P*K,P*$,-P*(-K*w+$*a)+a+u,0,0,1),this}scale(o,u){return this.premultiply(Yd.makeScale(o,u)),this}rotate(o){return this.premultiply(Yd.makeRotation(-o)),this}translate(o,u){return this.premultiply(Yd.makeTranslation(o,u)),this}makeTranslation(o,u){return o.isVector2?this.set(1,0,o.x,0,1,o.y,0,0,1):this.set(1,0,o,0,1,u,0,0,1),this}makeRotation(o){const u=Math.cos(o),v=Math.sin(o);return this.set(u,-v,0,v,u,0,0,0,1),this}makeScale(o,u){return this.set(o,0,0,0,u,0,0,0,1),this}equals(o){const u=this.elements,v=o.elements;for(let P=0;P<9;P++)if(u[P]!==v[P])return!1;return!0}fromArray(o,u=0){for(let v=0;v<9;v++)this.elements[v]=o[v+u];return this}toArray(o=[],u=0){const v=this.elements;return o[u]=v[0],o[u+1]=v[1],o[u+2]=v[2],o[u+3]=v[3],o[u+4]=v[4],o[u+5]=v[5],o[u+6]=v[6],o[u+7]=v[7],o[u+8]=v[8],o}clone(){return new this.constructor().fromArray(this.elements)}}const Yd=new Wc,Qm={};function e_(_){_ in Qm||(Qm[_]=!0,console.warn(_))}const t_=new Wc().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),r_=new Wc().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function Ow(){const _={enabled:!0,workingColorSpace:Ym,spaces:{},convert:function(P,k,w){return this.enabled===!1||k===w||!k||!w||(this.spaces[k].transfer===Xd&&(P.r=sl(P.r),P.g=sl(P.g),P.b=sl(P.b)),this.spaces[k].primaries!==this.spaces[w].primaries&&(P.applyMatrix3(this.spaces[k].toXYZ),P.applyMatrix3(this.spaces[w].fromXYZ)),this.spaces[w].transfer===Xd&&(P.r=ol(P.r),P.g=ol(P.g),P.b=ol(P.b))),P},workingToColorSpace:function(P,k){return this.convert(P,this.workingColorSpace,k)},colorSpaceToWorking:function(P,k){return this.convert(P,k,this.workingColorSpace)},getPrimaries:function(P){return this.spaces[P].primaries},getTransfer:function(P){return P===Fw?Jm:this.spaces[P].transfer},getLuminanceCoefficients:function(P,k=this.workingColorSpace){return P.fromArray(this.spaces[k].luminanceCoefficients)},define:function(P){Object.assign(this.spaces,P)},_getMatrix:function(P,k,w){return P.copy(this.spaces[k].toXYZ).multiply(this.spaces[w].fromXYZ)},_getDrawingBufferColorSpace:function(P){return this.spaces[P].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(P=this.workingColorSpace){return this.spaces[P].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(P,k){return e_("THREE.ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),_.workingToColorSpace(P,k)},toWorkingColorSpace:function(P,k){return e_("THREE.ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),_.colorSpaceToWorking(P,k)}},o=[.64,.33,.3,.6,.15,.06],u=[.2126,.7152,.0722],v=[.3127,.329];return _.define({[Ym]:{primaries:o,whitePoint:v,transfer:Jm,toXYZ:t_,fromXYZ:r_,luminanceCoefficients:u,workingColorSpaceConfig:{unpackColorSpace:zn},outputColorSpaceConfig:{drawingBufferColorSpace:zn}},[zn]:{primaries:o,whitePoint:v,transfer:Xd,toXYZ:t_,fromXYZ:r_,luminanceCoefficients:u,outputColorSpaceConfig:{drawingBufferColorSpace:zn}}}),_}const An=Ow();function sl(_){return _<.04045?_*.0773993808:Math.pow(_*.9478672986+.0521327014,2.4)}function ol(_){return _<.0031308?_*12.92:1.055*Math.pow(_,.41666)-.055}const dg={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},eo={h:0,s:0,l:0},lu={h:0,s:0,l:0};function Jd(_,o,u){return u<0&&(u+=1),u>1&&(u-=1),u<1/6?_+(o-_)*6*u:u<1/2?o:u<2/3?_+(o-_)*6*(2/3-u):_}class Rp{constructor(o,u,v){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(o,u,v)}set(o,u,v){if(u===void 0&&v===void 0){const P=o;P&&P.isColor?this.copy(P):typeof P=="number"?this.setHex(P):typeof P=="string"&&this.setStyle(P)}else this.setRGB(o,u,v);return this}setScalar(o){return this.r=o,this.g=o,this.b=o,this}setHex(o,u=zn){return o=Math.floor(o),this.r=(o>>16&255)/255,this.g=(o>>8&255)/255,this.b=(o&255)/255,An.colorSpaceToWorking(this,u),this}setRGB(o,u,v,P=An.workingColorSpace){return this.r=o,this.g=u,this.b=v,An.colorSpaceToWorking(this,P),this}setHSL(o,u,v,P=An.workingColorSpace){if(o=Bw(o,1),u=kc(u,0,1),v=kc(v,0,1),u===0)this.r=this.g=this.b=v;else{const k=v<=.5?v*(1+u):v+u-v*u,w=2*v-k;this.r=Jd(w,k,o+1/3),this.g=Jd(w,k,o),this.b=Jd(w,k,o-1/3)}return An.colorSpaceToWorking(this,P),this}setStyle(o,u=zn){function v(k){k!==void 0&&parseFloat(k)<1&&console.warn("THREE.Color: Alpha component of "+o+" will be ignored.")}let P;if(P=/^(\w+)\(([^\)]*)\)/.exec(o)){let k;const w=P[1],a=P[2];switch(w){case"rgb":case"rgba":if(k=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return v(k[4]),this.setRGB(Math.min(255,parseInt(k[1],10))/255,Math.min(255,parseInt(k[2],10))/255,Math.min(255,parseInt(k[3],10))/255,u);if(k=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return v(k[4]),this.setRGB(Math.min(100,parseInt(k[1],10))/100,Math.min(100,parseInt(k[2],10))/100,Math.min(100,parseInt(k[3],10))/100,u);break;case"hsl":case"hsla":if(k=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return v(k[4]),this.setHSL(parseFloat(k[1])/360,parseFloat(k[2])/100,parseFloat(k[3])/100,u);break;default:console.warn("THREE.Color: Unknown color model "+o)}}else if(P=/^\#([A-Fa-f\d]+)$/.exec(o)){const k=P[1],w=k.length;if(w===3)return this.setRGB(parseInt(k.charAt(0),16)/15,parseInt(k.charAt(1),16)/15,parseInt(k.charAt(2),16)/15,u);if(w===6)return this.setHex(parseInt(k,16),u);console.warn("THREE.Color: Invalid hex color "+o)}else if(o&&o.length>0)return this.setColorName(o,u);return this}setColorName(o,u=zn){const v=dg[o.toLowerCase()];return v!==void 0?this.setHex(v,u):console.warn("THREE.Color: Unknown color "+o),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(o){return this.r=o.r,this.g=o.g,this.b=o.b,this}copySRGBToLinear(o){return this.r=sl(o.r),this.g=sl(o.g),this.b=sl(o.b),this}copyLinearToSRGB(o){return this.r=ol(o.r),this.g=ol(o.g),this.b=ol(o.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(o=zn){return An.workingToColorSpace(zi.copy(this),o),Math.round(kc(zi.r*255,0,255))*65536+Math.round(kc(zi.g*255,0,255))*256+Math.round(kc(zi.b*255,0,255))}getHexString(o=zn){return("000000"+this.getHex(o).toString(16)).slice(-6)}getHSL(o,u=An.workingColorSpace){An.workingToColorSpace(zi.copy(this),u);const v=zi.r,P=zi.g,k=zi.b,w=Math.max(v,P,k),a=Math.min(v,P,k);let $,K;const ne=(a+w)/2;if(a===w)$=0,K=0;else{const te=w-a;switch(K=ne<=.5?te/(w+a):te/(2-w-a),w){case v:$=(P-k)/te+(P<k?6:0);break;case P:$=(k-v)/te+2;break;case k:$=(v-P)/te+4;break}$/=6}return o.h=$,o.s=K,o.l=ne,o}getRGB(o,u=An.workingColorSpace){return An.workingToColorSpace(zi.copy(this),u),o.r=zi.r,o.g=zi.g,o.b=zi.b,o}getStyle(o=zn){An.workingToColorSpace(zi.copy(this),o);const u=zi.r,v=zi.g,P=zi.b;return o!==zn?`color(${o} ${u.toFixed(3)} ${v.toFixed(3)} ${P.toFixed(3)})`:`rgb(${Math.round(u*255)},${Math.round(v*255)},${Math.round(P*255)})`}offsetHSL(o,u,v){return this.getHSL(eo),this.setHSL(eo.h+o,eo.s+u,eo.l+v)}add(o){return this.r+=o.r,this.g+=o.g,this.b+=o.b,this}addColors(o,u){return this.r=o.r+u.r,this.g=o.g+u.g,this.b=o.b+u.b,this}addScalar(o){return this.r+=o,this.g+=o,this.b+=o,this}sub(o){return this.r=Math.max(0,this.r-o.r),this.g=Math.max(0,this.g-o.g),this.b=Math.max(0,this.b-o.b),this}multiply(o){return this.r*=o.r,this.g*=o.g,this.b*=o.b,this}multiplyScalar(o){return this.r*=o,this.g*=o,this.b*=o,this}lerp(o,u){return this.r+=(o.r-this.r)*u,this.g+=(o.g-this.g)*u,this.b+=(o.b-this.b)*u,this}lerpColors(o,u,v){return this.r=o.r+(u.r-o.r)*v,this.g=o.g+(u.g-o.g)*v,this.b=o.b+(u.b-o.b)*v,this}lerpHSL(o,u){this.getHSL(eo),o.getHSL(lu);const v=Kd(eo.h,lu.h,u),P=Kd(eo.s,lu.s,u),k=Kd(eo.l,lu.l,u);return this.setHSL(v,P,k),this}setFromVector3(o){return this.r=o.x,this.g=o.y,this.b=o.z,this}applyMatrix3(o){const u=this.r,v=this.g,P=this.b,k=o.elements;return this.r=k[0]*u+k[3]*v+k[6]*P,this.g=k[1]*u+k[4]*v+k[7]*P,this.b=k[2]*u+k[5]*v+k[8]*P,this}equals(o){return o.r===this.r&&o.g===this.g&&o.b===this.b}fromArray(o,u=0){return this.r=o[u],this.g=o[u+1],this.b=o[u+2],this}toArray(o=[],u=0){return o[u]=this.r,o[u+1]=this.g,o[u+2]=this.b,o}fromBufferAttribute(o,u){return this.r=o.getX(u),this.g=o.getY(u),this.b=o.getZ(u),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const zi=new Rp;Rp.NAMES=dg;typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:ug}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=ug);const i_={u_color:{value:new Rp("rgb(255,255,255)")},u_scale:{value:1}},no=document.getElementById("three-canvas"),n_=no.transferControlToOffscreen(),Xi=new Worker(new URL(""+new URL("worker.three-canvas-BnW0HMsc.js",import.meta.url).href,import.meta.url),{type:"module"});Xi.postMessage({type:"init",canvas:n_,width:innerWidth,height:innerHeight,devicePixelRatio},[n_]);window.addEventListener("resize",()=>{Xi.postMessage({type:"resize",width:innerWidth,height:innerHeight,devicePixelRatio})});no.addEventListener("mousedown",_=>{Xi.postMessage({type:"mouseEvent",eventType:"mousedown",clientX:_.clientX,clientY:_.clientY,button:_.button,buttons:_.buttons})});no.addEventListener("mousemove",_=>{Xi.postMessage({type:"mouseEvent",eventType:"mousemove",clientX:_.clientX,clientY:_.clientY,button:_.button,buttons:_.buttons})});no.addEventListener("mouseup",_=>{Xi.postMessage({type:"mouseEvent",eventType:"mouseup",clientX:_.clientX,clientY:_.clientY,button:_.button,buttons:_.buttons})});no.addEventListener("wheel",_=>{_.preventDefault(),Xi.postMessage({type:"wheelEvent",deltaY:_.deltaY,deltaX:_.deltaX,deltaZ:_.deltaZ})});no.addEventListener("touchstart",_=>{_.preventDefault();const o=_.touches[0];Xi.postMessage({type:"mouseEvent",eventType:"mousedown",clientX:o.clientX,clientY:o.clientY,button:0,buttons:1})});no.addEventListener("touchmove",_=>{_.preventDefault();const o=_.touches[0];Xi.postMessage({type:"mouseEvent",eventType:"mousemove",clientX:o.clientX,clientY:o.clientY,button:0,buttons:1})});no.addEventListener("touchend",_=>{_.preventDefault(),Xi.postMessage({type:"mouseEvent",eventType:"mouseup",clientX:0,clientY:0,button:0,buttons:0})});const jw=new hg({title:"",container:document.getElementById("tweakpane-3d")});jw.addBinding(i_.u_scale,"value",{min:0,max:10,label:"",step:.01}).on("change",_=>{i_.u_scale.value=_.value,Xi.postMessage({type:"updateUniforms",key:"u_scale",value:_.value})});const Vw=async(_,o,u,v="single")=>new Promise((P,k)=>{var w;if(console.log("Starting WebWorker TIFF creation..."),console.log(`Dimensions: ${(w=_[0])==null?void 0:w.length}  ${_.length}`),v==="single"){const a=new Worker(new URL(""+new URL("worker.geotiff-writer-CXtAwTFl.js",import.meta.url).href,import.meta.url),{type:"module"});a.onmessage=$=>{const{type:K,buffer:ne,error:te,stack:oe}=$.data;switch(K){case"complete":try{const H=new Blob([ne],{type:"image/tiff"}),q=URL.createObjectURL(H),le=document.createElement("a");le.href=q,le.download=u,le.style.display="none",document.body.appendChild(le),le.click(),document.body.removeChild(le),URL.revokeObjectURL(q),a.terminate(),P(!0)}catch(H){console.error("Download error:",H),a.terminate(),k(H)}break;case"error":console.error("WebWorker error:",te),console.error("Stack:",oe),a.terminate();let L="WebWorkerTIFF\\n\\n";te.includes("out of memory")?L+=": \\n: ":L+=`: ${te}`,alert(L),P(!1);break}},a.onerror=$=>{console.error("WebWorker error:",$),a.terminate(),k($)},a.postMessage({demArray:_,geoTransform:o})}else{const a=new Worker(new URL(""+new URL("worker.terrain-rgb-writer-CcN2WpUD.js",import.meta.url).href,import.meta.url),{type:"module"});a.onmessage=$=>{const{type:K,buffer:ne,error:te,stack:oe}=$.data;switch(K){case"complete":try{const L=new Blob([ne],{type:"image/tiff"}),H=URL.createObjectURL(L),q=document.createElement("a");q.href=H,q.download=u,q.style.display="none",document.body.appendChild(q),q.click(),document.body.removeChild(q),URL.revokeObjectURL(H),a.terminate(),console.log("Mapbox GL WebWorker TIFF creation completed successfully"),P(!0)}catch(L){console.error(" Download error:",L),a.terminate(),k(L)}break;case"error":console.error("Mapbox GL WebWorker error:",te),console.error("Stack:",oe),a.terminate(),alert(`Mapbox GL WebWorkerTIFF: ${te}`),P(!1);break}},a.onerror=$=>{console.error("Mapbox GL WebWorker error:",$),a.terminate(),k($)},a.postMessage({demArray:_,geoTransform:o})}}),ap=async _=>{a_();const o=Array.isArray(_),u=o?_[0]:_;console.log(`Processing ${o?"multiple files":"single file"}: ${u.name}`);const v=!o&&(u.type==="application/zip"||u.type==="application/x-zip-compressed"||u.name.toLowerCase().endsWith(".zip")),P=!o&&u.name.toLowerCase().endsWith(".xml"),k=o&&_.some(w=>w.name.toLowerCase().endsWith(".xml"));if(v||P||k)try{console.log("Starting DEM processing...");const w=performance.now(),$=await ov(_,!1,(q,le,ie)=>{console.log(` Processing XML file ${q}/${le}: ${ie}`)}),K=performance.now();console.log(` Processing completed in ${(K-w).toFixed(2)}ms`);const ne=await lv($),{geoTransform:te,demArray:oe,statistics:L}=ne;Uw(),await Rw(ne),Xi.postMessage({type:"addMesh",demArray:oe,geoTransform:te,statistics:L});const H=document.getElementById("export-button");H&&H.addEventListener("click",async()=>{await Vw(oe,te,"dem.tiff","single").catch(q=>{console.error("Error downloading GeoTIFF:",q),alert(`GeoTIFF: ${q.message||q}`)})})}catch(w){w instanceof Error&&(console.error("Error creating DEM:",w),console.error("Error details:",w.message||w),alert(`: ${w.message||w}`),await Mc())}else alert("ZIPXMLXML"),await Mc()},ta=document.getElementById("drop-zone"),Nw=()=>{if(!ta)return;document.addEventListener("dragenter",o=>{o.preventDefault()}),document.addEventListener("dragover",o=>{o.preventDefault()}),document.addEventListener("dragleave",o=>{o.preventDefault()});const _=document.getElementById("fileInput");_&&_.addEventListener("change",async o=>{o.preventDefault();const u=o.target;if(u.files&&u.files.length>0){const v=u.files[0];ap(v)}}),document.addEventListener("drop",async o=>{var v;o.preventDefault();const u=(v=o.dataTransfer)==null?void 0:v.files;if(u&&u.length>0){const P=u[0];ap(P)}})},Uw=async()=>{ta&&(ta.style.display="none");const _=document.getElementById("pane");_&&(_.style.display="block"),await Mc()};document.addEventListener("DOMContentLoaded",()=>{Nw()});const s_=document.getElementById("delete-button");s_&&s_.addEventListener("click",async()=>{Xi.postMessage({type:"clear"}),Lw(),ta&&(ta.style.display="grid");const _=document.getElementById("pane");_&&(_.style.display="none"),await Mc()});const o_=document.getElementById("sample-dem10b");o_&&o_.addEventListener("click",async()=>{a_();try{const _=await fetch("./sample/sample-dem10b.zip");if(!_.ok)throw new Error(`HTTP error! status: ${_.status}`);const o=await _.arrayBuffer(),u=new Blob([o],{type:"application/zip"}),v=new File([u],"sample-dem10b.zip",{type:"application/zip",lastModified:Date.now()});await ap(v),ta&&(ta.style.display="none")}catch(_){console.error("Error fetching or processing sample DEM:",_),alert("DEM"),await Mc()}});const cu=document.getElementById("toggle-view-button");let Qd="map";cu&&cu.addEventListener("click",()=>{cu.classList.toggle("c-mode-map"),cu.classList.toggle("c-mode-3d"),Qd==="map"?(Qd="3d",Xi.postMessage({type:"toggleView",mode:!0}),Km(!1)):(Qd="map",Xi.postMessage({type:"toggleView",mode:!1}),Km(!0))});
